:root {
  --bg-main: #0e141c;
  --bg-soft: #151f2a;
  --surface: rgba(20, 29, 39, 0.84);
  --surface-strong: #17212d;
  --surface-soft: rgba(18, 26, 36, 0.66);
  --text-main: #e7edf5;
  --text-muted: #99a7b7;
  --line: rgba(151, 176, 201, 0.22);
  --accent: #40b3ff;
  --accent-soft: rgba(64, 179, 255, 0.18);
  --danger: #ff6d85;
  --ok: #3bc47d;
  --shadow: 0 14px 40px rgba(4, 7, 12, 0.45);
  --profile-accent-hue: 198;
  --profile-accent-glow: 0.22;
}

/* Question PDF-crop assets plugin: source status + in-question media blocks */
.profile-data-pdf-status {
  margin: 8px 2px 2px;
  padding: 8px 10px;
  border-radius: 12px;
  border: 1px solid var(--line);
  background:
    linear-gradient(150deg, color-mix(in srgb, var(--surface-strong) 88%, transparent), color-mix(in srgb, var(--surface-soft) 92%, transparent));
  color: var(--text-muted);
  font-size: 0.76rem;
  font-weight: 620;
  line-height: 1.45;
}

.question-asset-stack {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 10px;
  margin: 0 0 10px;
}

.question-asset-figure {
  margin: 0;
  padding: 8px;
  border-radius: 13px;
  border: 1px solid var(--line);
  background:
    radial-gradient(circle at 12% 8%, color-mix(in srgb, var(--accent-soft) 52%, transparent), transparent 42%),
    linear-gradient(150deg, color-mix(in srgb, var(--surface-strong) 90%, transparent), color-mix(in srgb, var(--surface-soft) 94%, transparent));
  box-shadow: 0 12px 22px rgba(3, 9, 16, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.06);
  overflow: hidden;
  display: grid;
  gap: 6px;
}

.question-asset-media {
  position: relative;
  min-height: 120px;
  border-radius: 10px;
  border: 1px solid color-mix(in srgb, var(--line) 80%, transparent);
  background: color-mix(in srgb, var(--surface-soft) 88%, transparent);
  overflow: hidden;
  display: grid;
  place-items: center;
}

.question-asset-shimmer {
  width: 100%;
  height: 100%;
  min-height: 120px;
  background:
    linear-gradient(
      105deg,
      color-mix(in srgb, var(--surface-soft) 85%, transparent) 0%,
      color-mix(in srgb, var(--accent-soft) 55%, transparent) 46%,
      color-mix(in srgb, var(--surface-soft) 85%, transparent) 100%
    );
  background-size: 220% 100%;
  animation: questionAssetShimmer 1.45s ease-in-out infinite;
}

.question-asset-image {
  display: block;
  width: 100%;
  height: auto;
  object-fit: contain;
  max-height: min(62vh, 480px);
  border-radius: 8px;
}

.question-asset-caption {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.72rem;
  line-height: 1.45;
  font-weight: 610;
}

.question-asset-fallback {
  margin: 0;
  padding: 10px 12px;
  text-align: center;
  color: var(--text-muted);
  font-size: 0.74rem;
  line-height: 1.5;
}

.question-asset-source-btn {
  margin: 0 0 10px;
  min-height: 34px;
  padding: 6px 12px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: color-mix(in srgb, var(--surface-strong) 86%, transparent);
  color: var(--text-main);
  font-size: 0.71rem;
  font-weight: 700;
  cursor: pointer;
}

.question-asset-source-btn:hover {
  border-color: color-mix(in srgb, var(--accent) 48%, transparent);
}

.question-asset-figure.is-error .question-asset-media {
  border-style: dashed;
}

@keyframes questionAssetShimmer {
  0% {
    background-position: 100% 0;
  }
  100% {
    background-position: -100% 0;
  }
}

@media (max-width: 1023px) {
  .profile-data-pdf-status {
    margin-top: 7px;
    border-radius: 11px;
    font-size: 0.73rem;
    padding: 7px 9px;
  }

  .question-asset-stack {
    grid-template-columns: 1fr;
    gap: 8px;
    margin-bottom: 9px;
  }

  .question-asset-figure {
    border-radius: 11px;
    padding: 7px;
    gap: 5px;
  }

  .question-asset-media,
  .question-asset-shimmer {
    min-height: 106px;
  }

  .question-asset-image {
    max-height: min(52vh, 360px);
  }

  .question-asset-caption {
    font-size: 0.69rem;
  }
}

@media print {
  body.print-exam-only .question-asset-stack {
    display: block !important;
    margin: 1.4mm 0 1.8mm !important;
  }

  body.print-exam-only .question-asset-figure {
    margin: 0 0 1.8mm !important;
    padding: 1.1mm !important;
    border: 0.22mm solid #c8d2df !important;
    border-radius: 1.3mm !important;
    break-inside: avoid !important;
    page-break-inside: avoid !important;
    box-shadow: none !important;
    background: #fff !important;
  }

  body.print-exam-only .question-asset-image {
    max-height: none !important;
    border-radius: 0 !important;
  }

  body.print-exam-only .question-asset-caption,
  body.print-exam-only .question-asset-source-btn,
  body.print-exam-only .question-asset-shimmer {
    display: none !important;
  }
}

html[data-theme="dark-graphite"] {
  --bg-main: #0f141c;
  --bg-soft: #1a2430;
  --surface: rgba(24, 33, 44, 0.84);
  --surface-strong: #1c2734;
  --surface-soft: rgba(20, 29, 39, 0.64);
  --text-main: #e8eef7;
  --text-muted: #9aacbe;
  --line: rgba(132, 156, 181, 0.25);
  --accent: #57b4ff;
  --accent-soft: rgba(87, 180, 255, 0.16);
}

html[data-theme="dark-ocean"] {
  --bg-main: #081826;
  --bg-soft: #112338;
  --surface: rgba(13, 36, 56, 0.84);
  --surface-strong: #143553;
  --surface-soft: rgba(11, 30, 47, 0.64);
  --text-main: #e5f4ff;
  --text-muted: #8eb8d2;
  --line: rgba(114, 169, 204, 0.25);
  --accent: #41d4ff;
  --accent-soft: rgba(65, 212, 255, 0.18);
}

html[data-theme="dark-forest"] {
  --bg-main: #0d1914;
  --bg-soft: #14261f;
  --surface: rgba(19, 40, 31, 0.84);
  --surface-strong: #20372b;
  --surface-soft: rgba(18, 34, 27, 0.66);
  --text-main: #ebf8f0;
  --text-muted: #9fbea9;
  --line: rgba(123, 164, 135, 0.25);
  --accent: #56d592;
  --accent-soft: rgba(86, 213, 146, 0.18);
}

html[data-theme="dark-ember"] {
  --bg-main: #21120d;
  --bg-soft: #2c1c15;
  --surface: rgba(42, 26, 20, 0.84);
  --surface-strong: #3b261d;
  --surface-soft: rgba(35, 21, 17, 0.68);
  --text-main: #fff0ea;
  --text-muted: #d8ad9f;
  --line: rgba(191, 136, 118, 0.25);
  --accent: #ff9f6e;
  --accent-soft: rgba(255, 159, 110, 0.2);
}

html[data-theme="dark-midnight-amethyst"] {
  --bg-main: #100e18;
  --bg-soft: #1b1729;
  --surface: rgba(28, 23, 43, 0.86);
  --surface-strong: #241d36;
  --surface-soft: rgba(22, 18, 34, 0.7);
  --text-main: #efe8ff;
  --text-muted: #b7abce;
  --line: rgba(163, 142, 207, 0.27);
  --accent: #c79bff;
  --accent-soft: rgba(199, 155, 255, 0.2);
}

html[data-theme="dark-warm-espresso"] {
  --bg-main: #15100d;
  --bg-soft: #211914;
  --surface: rgba(32, 24, 18, 0.86);
  --surface-strong: #2b2019;
  --surface-soft: rgba(27, 20, 16, 0.7);
  --text-main: #f6eadf;
  --text-muted: #c8ab92;
  --line: rgba(186, 146, 117, 0.28);
  --accent: #e5b37f;
  --accent-soft: rgba(229, 179, 127, 0.2);
}

html[data-theme="dark-deep-teal"] {
  --bg-main: #071a1d;
  --bg-soft: #0f282d;
  --surface: rgba(14, 40, 46, 0.86);
  --surface-strong: #16343b;
  --surface-soft: rgba(12, 31, 36, 0.7);
  --text-main: #e4fbf8;
  --text-muted: #93c7c0;
  --line: rgba(110, 170, 163, 0.27);
  --accent: #7de8d8;
  --accent-soft: rgba(125, 232, 216, 0.2);
}

html[data-theme="dark-crimson-night"] {
  --bg-main: #190f15;
  --bg-soft: #261622;
  --surface: rgba(38, 22, 33, 0.86);
  --surface-strong: #311d2a;
  --surface-soft: rgba(30, 18, 27, 0.72);
  --text-main: #ffe9f1;
  --text-muted: #d4a5b8;
  --line: rgba(199, 131, 158, 0.29);
  --accent: #ff9dbb;
  --accent-soft: rgba(255, 157, 187, 0.21);
}

html[data-theme="dark-lunar-slate"] {
  --bg-main: #10161f;
  --bg-soft: #1a2330;
  --surface: rgba(24, 34, 47, 0.86);
  --surface-strong: #223044;
  --surface-soft: rgba(20, 29, 41, 0.7);
  --text-main: #f2f2e6;
  --text-muted: #b7bcc8;
  --line: rgba(164, 174, 196, 0.28);
  --accent: #d7c98d;
  --accent-soft: rgba(215, 201, 141, 0.2);
}

html[data-theme="dark-cosmic-void"] {
  --bg-main: #05070b;
  --bg-soft: #0a0f19;
  --surface: rgba(8, 14, 24, 0.88);
  --surface-strong: #101826;
  --surface-soft: rgba(7, 11, 19, 0.74);
  --text-main: #e4eeff;
  --text-muted: #8fa4c6;
  --line: rgba(108, 153, 215, 0.24);
  --accent: #35e6ff;
  --accent-soft: rgba(53, 230, 255, 0.19);
}

html[data-theme="light-paper"] {
  --bg-main: #f2f1ec;
  --bg-soft: #ffffff;
  --surface: rgba(255, 255, 255, 0.9);
  --surface-strong: #ffffff;
  --surface-soft: rgba(252, 250, 245, 0.92);
  --text-main: #1f2731;
  --text-muted: #5b6a79;
  --line: rgba(40, 57, 75, 0.16);
  --accent: #1d73c9;
  --accent-soft: rgba(29, 115, 201, 0.12);
  --danger: #c84554;
  --ok: #2d9a63;
  --shadow: 0 10px 28px rgba(30, 41, 56, 0.14);
}

html[data-theme="light-ice"] {
  --bg-main: #edf5fa;
  --bg-soft: #f9fcff;
  --surface: rgba(255, 255, 255, 0.9);
  --surface-strong: #ffffff;
  --surface-soft: rgba(245, 250, 255, 0.9);
  --text-main: #152537;
  --text-muted: #4f667d;
  --line: rgba(27, 71, 104, 0.15);
  --accent: #0d96bf;
  --accent-soft: rgba(13, 150, 191, 0.14);
  --danger: #ca475f;
  --ok: #1e9a78;
  --shadow: 0 10px 30px rgba(36, 77, 103, 0.14);
}

* {
  box-sizing: border-box;
}

html,
body {
  width: 100%;
  min-height: 100%;
}

body {
  margin: 0;
  font-family: "Vazirmatn", sans-serif;
  background:
    radial-gradient(circle at 85% 12%, var(--accent-soft), transparent 42%),
    radial-gradient(circle at 10% 88%, var(--accent-soft), transparent 38%),
    linear-gradient(160deg, var(--bg-main), var(--bg-soft));
  color: var(--text-main);
}

.app-shell {
  width: min(1140px, 96vw);
  margin: 0 auto;
  padding: 20px 0 30px;
}

.topbar {
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
}

.title-group h1 {
  margin: 0;
  font-size: clamp(1.2rem, 1.8vw + 0.8rem, 2rem);
  letter-spacing: -0.02em;
}

.title-group p {
  margin: 6px 0 0;
  color: var(--text-muted);
  font-size: 0.92rem;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  justify-content: flex-end;
}

.premium-topbar {
  position: sticky;
  top: 8px;
  z-index: 48;
  margin-bottom: 12px;
  padding: 9px 12px;
  border: 1px solid rgba(151, 176, 201, 0.26);
  border-radius: 16px;
  background: linear-gradient(150deg, rgba(18, 29, 41, 0.82), rgba(13, 21, 31, 0.7));
  box-shadow: 0 12px 28px rgba(5, 9, 14, 0.26), inset 0 1px 0 rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(12px) saturate(138%);
  -webkit-backdrop-filter: blur(12px) saturate(138%);
  overflow: hidden;
}

.premium-topbar::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(circle at 84% 8%, rgba(87, 180, 255, 0.16), transparent 30%),
    radial-gradient(circle at 10% 90%, rgba(67, 176, 241, 0.1), transparent 36%);
  pointer-events: none;
  z-index: 0;
}

.premium-topbar::after {
  content: "";
  position: absolute;
  top: 0;
  right: 10px;
  width: 140px;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
  opacity: 0.56;
  pointer-events: none;
  z-index: 0;
}

.premium-topbar > * {
  position: relative;
  z-index: 1;
}

html[data-theme^="light-"] .premium-topbar {
  background: linear-gradient(150deg, rgba(255, 255, 255, 0.9), rgba(245, 250, 255, 0.76));
  box-shadow: 0 16px 30px rgba(21, 54, 81, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

html[data-theme^="light-"] .premium-topbar::before {
  opacity: 0.6;
}

html[data-theme^="light-"] .premium-topbar::after {
  opacity: 0.45;
}

.premium-title-group {
  display: grid;
  gap: 3px;
  justify-items: start;
}

.header-title-row {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.header-brand-icon {
  --icon-hue: var(--profile-accent-hue, 198);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: 12px;
  border: 1px solid hsla(var(--icon-hue), 84%, 75%, 0.42);
  background:
    radial-gradient(circle at 22% 18%, rgba(255, 255, 255, 0.32), transparent 46%),
    linear-gradient(158deg, hsla(var(--icon-hue), 82%, 66%, 0.3), hsla(var(--icon-hue), 82%, 64%, 0.08));
  color: #e2f6ff;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.3),
    0 10px 20px rgba(7, 12, 18, 0.34),
    0 0 0 1px rgba(255, 255, 255, 0.04);
  position: relative;
  isolation: isolate;
  overflow: hidden;
}

.header-brand-icon::before {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 78% 24%, rgba(255, 255, 255, 0.4), transparent 44%);
  pointer-events: none;
  z-index: 0;
}

.header-brand-shell {
  position: absolute;
  width: 20px;
  height: 20px;
  border-radius: 7px;
  border: 1.2px solid rgba(255, 255, 255, 0.26);
  transform: rotate(45deg);
  background: radial-gradient(circle, rgba(255, 255, 255, 0.1), transparent 72%);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
  z-index: 1;
}

.header-brand-track {
  position: absolute;
  border-radius: 50%;
  border: 1.2px solid hsla(var(--icon-hue), 90%, 82%, 0.58);
  transform-origin: center;
  z-index: 2;
}

.header-brand-track::after {
  content: "";
  position: absolute;
  top: -1px;
  right: 5px;
  width: 3px;
  height: 3px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.86);
  box-shadow: 0 0 8px rgba(255, 255, 255, 0.52);
}

.header-brand-track-a {
  width: 21px;
  height: 21px;
  animation: brand-track-spin 7s linear infinite;
}

.header-brand-track-b {
  width: 14px;
  height: 14px;
  border-style: dashed;
  border-width: 1.1px;
  opacity: 0.9;
  animation: brand-track-counter 5.4s linear infinite;
}

.header-brand-prism {
  position: absolute;
  width: 8px;
  height: 8px;
  border-radius: 2px;
  transform: rotate(45deg);
  background: linear-gradient(150deg, rgba(255, 255, 255, 0.74), rgba(255, 255, 255, 0.18));
  box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.32), 0 0 12px hsla(var(--icon-hue), 84%, 78%, 0.4);
  z-index: 3;
  animation: brand-prism-pulse 3.2s ease-in-out infinite;
}

.header-brand-prism::after {
  content: "";
  position: absolute;
  inset: 1px;
  border-radius: 1px;
  background: linear-gradient(160deg, rgba(255, 255, 255, 0.52), transparent 72%);
}

.header-brand-flare {
  position: absolute;
  top: 7px;
  left: 8px;
  width: 7px;
  height: 7px;
  border-radius: 2px;
  transform: rotate(45deg);
  background: rgba(255, 255, 255, 0.2);
  box-shadow: 0 0 8px hsla(var(--icon-hue), 90%, 80%, 0.4);
  opacity: 0.9;
  z-index: 2;
}

.header-brand-icon[data-profile-level="1"] {
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.28),
    0 11px 22px hsla(var(--icon-hue), 62%, 22%, calc(var(--profile-accent-glow, 0.22) + 0.02));
}

.header-brand-icon[data-profile-level="2"] {
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.3),
    0 13px 24px hsla(var(--icon-hue), 64%, 24%, calc(var(--profile-accent-glow, 0.22) + 0.06));
}

.header-brand-icon[data-profile-level="3"] {
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.34),
    0 15px 28px hsla(var(--icon-hue), 66%, 26%, calc(var(--profile-accent-glow, 0.22) + 0.12));
}

@keyframes brand-track-spin {
  to {
    transform: rotate(360deg);
  }
}

@keyframes brand-track-counter {
  to {
    transform: rotate(-360deg);
  }
}

@keyframes brand-prism-pulse {
  0%,
  100% {
    transform: rotate(45deg) scale(1);
  }

  50% {
    transform: rotate(45deg) scale(1.08);
  }
}

.premium-title-group h1 {
  margin: 0;
  font-size: clamp(1.02rem, 1vw + 0.72rem, 1.45rem);
  letter-spacing: -0.028em;
  line-height: 1.24;
  text-wrap: balance;
}

.premium-title-group p {
  display: none;
}

.header-quickline {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: center;
}

.header-quick-pill {
  min-height: 24px;
  padding: 2px 9px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.28);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-muted);
  font-size: 0.75rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  white-space: nowrap;
}

.header-quick-actions {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  gap: 6px;
  scrollbar-width: none;
}

.header-quick-actions::-webkit-scrollbar {
  display: none;
}

.header-quick-btn {
  min-height: 30px;
  padding: 3px 10px;
  border-radius: 9px;
  border: 1px solid rgba(138, 172, 201, 0.24);
  background: rgba(127, 127, 127, 0.09);
  color: var(--text-main);
  font-size: 0.8rem;
  font-weight: 600;
  line-height: 1;
  white-space: nowrap;
}

.header-quick-btn:hover {
  border-color: rgba(92, 181, 241, 0.5);
  background: rgba(92, 181, 241, 0.16);
  transform: translateY(-1px);
}

.header-quick-btn.is-active {
  border-color: var(--accent);
  background: linear-gradient(150deg, var(--accent-soft), rgba(127, 127, 127, 0.08));
  box-shadow: 0 8px 16px rgba(7, 12, 18, 0.18);
}

.header-quick-btn:disabled {
  opacity: 0.5;
  transform: none;
  cursor: not-allowed;
}

.premium-header-actions {
  position: relative;
  display: grid;
  align-content: center;
  justify-items: end;
  gap: 6px;
}

.glass-btn {
  background: linear-gradient(150deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.05));
  border: 1px solid rgba(255, 255, 255, 0.18);
  box-shadow: 0 8px 18px rgba(4, 8, 12, 0.22);
}

html[data-theme^="light-"] .glass-btn {
  border-color: rgba(38, 59, 80, 0.18);
  background: linear-gradient(150deg, rgba(255, 255, 255, 0.84), rgba(243, 248, 253, 0.76));
}

html[data-theme^="light-"] .header-quick-pill,
html[data-theme^="light-"] .header-quick-btn {
  border-color: rgba(47, 82, 111, 0.2);
  background: rgba(255, 255, 255, 0.82);
}

.glass-btn:hover {
  transform: translateY(-1px) scale(1.01);
  background: var(--accent-soft);
  border-color: var(--accent);
}

.settings-trigger {
  min-width: 148px;
  min-height: 36px;
  padding: 4px 10px;
  border-radius: 10px;
  display: inline-flex;
  align-items: center;
  gap: 7px;
  justify-content: center;
  font-size: 0.8rem;
  font-weight: 600;
  border-color: rgba(142, 180, 210, 0.35);
  background: linear-gradient(150deg, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0.05));
  box-shadow: 0 8px 20px rgba(5, 9, 14, 0.2);
}

.settings-trigger-icon {
  width: 15px;
  height: 15px;
  flex: 0 0 15px;
  stroke: currentColor;
  stroke-width: 1.8;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.settings-trigger-icon svg {
  width: 100%;
  height: 100%;
}

.settings-panel {
  width: min(560px, 96vw);
  padding: 0 14px;
  margin-top: 4px;
  border: 1px solid rgba(151, 176, 201, 0.28);
  border-radius: 16px;
  background: linear-gradient(155deg, rgba(18, 29, 41, 0.92), rgba(12, 21, 30, 0.84));
  box-shadow: 0 22px 42px rgba(6, 12, 18, 0.34);
  backdrop-filter: blur(12px) saturate(130%);
  -webkit-backdrop-filter: blur(12px) saturate(130%);
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  transform: translateY(-7px) scale(0.995);
  pointer-events: none;
  transition: max-height 0.32s ease, opacity 0.24s ease, transform 0.26s ease, padding 0.26s ease;
}

.settings-panel.is-open {
  padding: 12px;
  max-height: 610px;
  opacity: 1;
  transform: translateY(0) scale(1);
  pointer-events: auto;
}

html[data-theme^="light-"] .settings-panel {
  border-color: rgba(47, 82, 111, 0.2);
  background: linear-gradient(155deg, rgba(255, 255, 255, 0.9), rgba(245, 250, 255, 0.8));
  box-shadow: 0 20px 40px rgba(24, 55, 83, 0.16);
}

html[data-theme^="light-"] .header-brand-icon {
  color: #2c7fc0;
  border-color: hsla(var(--profile-accent-hue, 198), 60%, 48%, 0.34);
  background:
    radial-gradient(circle at 22% 18%, rgba(255, 255, 255, 0.52), transparent 46%),
    linear-gradient(145deg, hsla(var(--profile-accent-hue, 198), 62%, 52%, 0.22), hsla(var(--profile-accent-hue, 198), 62%, 50%, 0.06));
}

html[data-theme^="light-"] .header-brand-shell {
  border-color: hsla(var(--profile-accent-hue, 198), 60%, 48%, 0.35);
  background: radial-gradient(circle, hsla(var(--profile-accent-hue, 198), 60%, 48%, 0.12), transparent 72%);
}

html[data-theme^="light-"] .header-brand-track {
  border-color: hsla(var(--profile-accent-hue, 198), 62%, 44%, 0.44);
}

html[data-theme^="light-"] .header-brand-track::after {
  background: hsla(var(--profile-accent-hue, 198), 66%, 46%, 0.84);
}

html[data-theme^="light-"] .header-brand-prism {
  background: linear-gradient(150deg, rgba(255, 255, 255, 0.85), hsla(var(--profile-accent-hue, 198), 62%, 48%, 0.24));
  box-shadow: 0 0 0 1px hsla(var(--profile-accent-hue, 198), 62%, 42%, 0.34), 0 0 10px hsla(var(--profile-accent-hue, 198), 62%, 44%, 0.26);
}

.settings-panel-premium {
  --settings-panel-open-max: min(72vh, 680px);
  width: min(720px, 96vw);
  padding: 0;
  max-height: 0;
  display: grid;
  grid-template-rows: auto minmax(0, 1fr);
  gap: 6px;
}

.settings-panel-premium.is-open {
  max-height: var(--settings-panel-open-max);
  padding: 8px;
}

.settings-panel-head {
  margin-bottom: 6px;
  display: grid;
  gap: 2px;
}

.settings-panel-head h3 {
  margin: 0;
  font-size: 0.96rem;
  font-weight: 700;
  letter-spacing: -0.015em;
}

.settings-panel-head p {
  margin: 0;
  font-size: 0.71rem;
  line-height: 1.55;
  color: var(--text-muted);
}

.settings-panel-layout {
  display: grid;
  grid-template-columns: minmax(226px, 0.88fr) minmax(0, 1.12fr);
  gap: 8px;
  align-items: start;
  min-height: 0;
  max-height: calc(var(--settings-panel-open-max) - 60px);
  overflow: auto;
  padding-inline-end: 2px;
  scrollbar-width: thin;
  scrollbar-color: rgba(138, 172, 201, 0.38) transparent;
}

.settings-panel-layout::-webkit-scrollbar {
  width: 8px;
}

.settings-panel-layout::-webkit-scrollbar-track {
  background: transparent;
}

.settings-panel-layout::-webkit-scrollbar-thumb {
  border-radius: 999px;
  background: linear-gradient(180deg, rgba(138, 172, 201, 0.4), rgba(138, 172, 201, 0.2));
}

.settings-panel-side,
.settings-panel-workspace {
  border: 1px solid rgba(138, 172, 201, 0.2);
  border-radius: 10px;
  background: rgba(127, 127, 127, 0.05);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.settings-panel-side {
  padding: 6px;
}

.settings-panel-workspace {
  padding: 6px;
}

.settings-overview-strip {
  display: grid;
  grid-template-columns: 1fr;
  gap: 7px;
  margin: 0;
}

.settings-overview-card {
  display: grid;
  grid-template-columns: 24px minmax(0, 1fr);
  align-items: center;
  gap: 6px;
  padding: 6px 7px;
  border-radius: 9px;
  border: 1px solid rgba(138, 172, 201, 0.24);
  background: linear-gradient(145deg, rgba(127, 127, 127, 0.12), rgba(127, 127, 127, 0.05) 70%);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05), 0 10px 18px rgba(7, 11, 16, 0.15);
  transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
}

.settings-overview-card:hover {
  transform: translateY(-1px);
  border-color: rgba(138, 172, 201, 0.4);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.07), 0 14px 24px rgba(8, 13, 20, 0.2);
}

.settings-overview-icon {
  width: 24px;
  height: 24px;
  border-radius: 8px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border: 1px solid rgba(138, 172, 201, 0.32);
  background: radial-gradient(circle at 30% 24%, rgba(255, 255, 255, 0.25), rgba(127, 127, 127, 0.06));
  color: var(--accent);
}

.settings-overview-icon svg {
  width: 13px;
  height: 13px;
  stroke: currentColor;
  stroke-width: 1.8;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.settings-overview-copy {
  display: grid;
  gap: 2px;
}

.settings-overview-label {
  color: var(--text-muted);
  font-size: 0.64rem;
}

.settings-overview-card strong {
  font-size: 0.72rem;
  font-weight: 700;
  letter-spacing: -0.01em;
  line-height: 1.35;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

html[data-theme^="light-"] .settings-overview-card {
  border-color: rgba(47, 82, 111, 0.18);
  background: linear-gradient(145deg, rgba(255, 255, 255, 0.76), rgba(244, 249, 255, 0.68) 74%);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8), 0 10px 18px rgba(24, 55, 83, 0.08);
}

html[data-theme^="light-"] .settings-overview-icon {
  border-color: rgba(45, 82, 113, 0.3);
  background: radial-gradient(circle at 30% 24%, rgba(255, 255, 255, 0.95), rgba(200, 224, 241, 0.42));
}

.settings-tab-strip {
  display: flex;
  gap: 6px;
  margin-bottom: 6px;
  padding: 4px;
  border-radius: 10px;
  border: 1px solid var(--line);
  background: rgba(127, 127, 127, 0.08);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.settings-tab-btn {
  flex: 1;
  min-height: 31px;
  border-radius: 8px;
  border: 1px solid transparent;
  background: transparent;
  color: var(--text-muted);
  font-size: 0.73rem;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
  white-space: nowrap;
  transition: border-color 0.2s ease, background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
}

.settings-tab-icon {
  width: 14px;
  height: 14px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  opacity: 0.86;
}

.settings-tab-icon svg {
  width: 100%;
  height: 100%;
  stroke: currentColor;
  stroke-width: 1.8;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.settings-tab-btn:hover {
  transform: translateY(-1px);
  border-color: var(--line);
}

.settings-tab-text {
  white-space: nowrap;
}

.settings-tab-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: currentColor;
  opacity: 0.6;
  box-shadow: 0 0 0 2px rgba(127, 127, 127, 0.16);
}

.settings-tab-btn.is-active {
  color: var(--text-main);
  border-color: var(--accent);
  background: linear-gradient(150deg, var(--accent-soft), rgba(127, 127, 127, 0.06));
  box-shadow: 0 8px 16px rgba(7, 12, 18, 0.2);
}

.settings-tab-btn.is-active .settings-tab-dot {
  opacity: 1;
}

.settings-tab-panel {
  display: none;
  gap: 7px;
  padding: 8px;
  border: 1px solid var(--line);
  border-radius: 10px;
  background: rgba(127, 127, 127, 0.05);
}

.settings-tab-panel::before {
  content: "";
  display: block;
  width: 92px;
  max-width: 100%;
  height: 1px;
  border-radius: 999px;
  background: linear-gradient(90deg, transparent, rgba(138, 172, 201, 0.62), transparent);
}

.settings-tab-panel.is-active {
  display: grid;
  animation: settings-panel-enter 0.22s ease;
}

.settings-section-head {
  display: grid;
  gap: 3px;
  padding-bottom: 6px;
  border-bottom: 1px solid rgba(138, 172, 201, 0.2);
}

.settings-section-title {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  min-width: 0;
}

.settings-section-icon {
  width: 18px;
  height: 18px;
  border-radius: 6px;
  border: 1px solid rgba(138, 172, 201, 0.34);
  background: linear-gradient(145deg, rgba(127, 127, 127, 0.16), rgba(127, 127, 127, 0.05));
  color: var(--accent);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.14);
}

.settings-section-icon svg {
  width: 11px;
  height: 11px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.settings-section-head h4 {
  margin: 0;
  font-size: 0.79rem;
  letter-spacing: -0.01em;
}

.settings-section-head p {
  margin: 0 0 1px;
  color: var(--text-muted);
  font-size: 0.67rem;
  line-height: 1.45;
}

@keyframes settings-panel-enter {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.cloud-sync-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 8px;
}

.cloud-sync-grid input[type="password"],
.cloud-sync-grid input[type="text"] {
  border-radius: 11px;
}

.settings-cloud-layout {
  display: grid;
  grid-template-columns: minmax(0, 1.05fr) minmax(200px, 0.95fr);
  gap: 8px;
  align-items: start;
}

.settings-cloud-side {
  display: grid;
  gap: 6px;
  align-content: start;
  padding: 6px;
  border: 1px solid rgba(138, 172, 201, 0.22);
  border-radius: 9px;
  background: rgba(127, 127, 127, 0.06);
}

.settings-grid {
  display: grid;
  gap: 8px;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  align-items: end;
}

.settings-grid > button {
  min-height: 38px;
}

.settings-grid-appearance {
  grid-template-columns: minmax(0, 1fr) minmax(140px, auto);
}

.settings-mode-grid {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  align-items: stretch;
}

.settings-mode-card {
  border: 1px solid rgba(138, 172, 201, 0.24);
  border-radius: 10px;
  background: linear-gradient(150deg, rgba(127, 127, 127, 0.12), rgba(127, 127, 127, 0.04));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06), 0 10px 18px rgba(8, 13, 20, 0.16);
  padding: 7px;
  gap: 5px;
  transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
}

.settings-mode-card:hover {
  transform: translateY(-1px);
  border-color: rgba(138, 172, 201, 0.4);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08), 0 14px 22px rgba(8, 13, 20, 0.2);
}

.settings-mode-card:focus-within {
  border-color: var(--accent);
  box-shadow: 0 0 0 2px var(--accent-soft), 0 12px 20px rgba(8, 13, 20, 0.2);
}

.settings-mode-head {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 0.72rem;
  font-weight: 700;
  color: var(--text-main);
}

.settings-mode-icon {
  width: 18px;
  height: 18px;
  border-radius: 6px;
  border: 1px solid rgba(138, 172, 201, 0.34);
  background: linear-gradient(145deg, rgba(127, 127, 127, 0.16), rgba(127, 127, 127, 0.05));
  color: var(--accent);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex: 0 0 auto;
}

.settings-mode-icon svg {
  width: 11px;
  height: 11px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.settings-mode-card select {
  min-height: 34px;
}

.settings-mode-card-toggle {
  display: grid;
  align-content: space-between;
}

.settings-mode-card-hybrid {
  grid-column: 1 / -1;
  display: grid;
  gap: 6px;
  align-content: start;
}

.settings-mode-note {
  margin: 0;
  font-size: 0.68rem;
  line-height: 1.5;
  color: var(--text-muted);
}

.hybrid-orientation-btn {
  min-height: 38px;
  border-radius: 10px;
  border: 1px solid rgba(138, 172, 201, 0.22);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-main);
  display: inline-flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  width: 100%;
  text-align: right;
  padding: 8px 10px;
}

.hybrid-orientation-btn:hover {
  border-color: rgba(90, 185, 244, 0.46);
  background: rgba(90, 185, 244, 0.16);
}

.hybrid-orientation-btn.is-active {
  border-color: var(--accent);
  background: linear-gradient(145deg, var(--accent-soft), rgba(127, 127, 127, 0.08));
  box-shadow: 0 8px 16px rgba(8, 13, 20, 0.16);
}

.hybrid-orientation-btn-label {
  font-size: 0.74rem;
  font-weight: 700;
}

.hybrid-orientation-btn-state {
  font-size: 0.64rem;
  color: var(--text-muted);
  white-space: nowrap;
}

.hybrid-orientation-btn.is-active .hybrid-orientation-btn-state {
  color: var(--text-main);
}

.viewport-mode-bar {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 5px;
  padding: 4px;
  border-radius: 10px;
  border: 1px solid rgba(138, 172, 201, 0.22);
  background: rgba(127, 127, 127, 0.08);
}

.viewport-mode-btn {
  min-height: 34px;
  border-radius: 8px;
  border: 1px solid rgba(138, 172, 201, 0.2);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-muted);
  font-size: 0.73rem;
  font-weight: 700;
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 1px;
  line-height: 1.2;
}

.viewport-mode-btn:hover {
  border-color: rgba(90, 185, 244, 0.46);
  background: rgba(90, 185, 244, 0.16);
  color: var(--text-main);
}

.viewport-mode-btn.is-active {
  border-color: var(--accent);
  background: linear-gradient(145deg, var(--accent-soft), rgba(127, 127, 127, 0.08));
  color: var(--text-main);
  box-shadow: 0 8px 16px rgba(8, 13, 20, 0.16);
}

.viewport-mode-state {
  font-size: 0.62rem;
  color: var(--text-muted);
}

.viewport-mode-btn.is-active .viewport-mode-state {
  color: var(--text-main);
}

.settings-cloud-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding-bottom: 4px;
  border-bottom: 1px dashed rgba(138, 172, 201, 0.28);
}

.settings-state-pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-height: 27px;
  padding: 0 10px;
  border-radius: 999px;
  border: 1px solid transparent;
  font-size: 0.67rem;
  font-weight: 700;
  letter-spacing: -0.01em;
  white-space: nowrap;
}

.settings-state-pill.settings-state-ok {
  border-color: rgba(64, 197, 132, 0.45);
  background: rgba(64, 197, 132, 0.14);
  color: #9ff0c6;
}

.settings-state-pill.settings-state-warn {
  border-color: rgba(255, 182, 95, 0.44);
  background: rgba(255, 182, 95, 0.14);
  color: #ffd18f;
}

.settings-state-pill.settings-state-muted {
  border-color: var(--line);
  background: rgba(127, 127, 127, 0.09);
  color: var(--text-muted);
}

.settings-key-visibility-btn {
  min-height: 29px;
  min-width: 94px;
  font-size: 0.7rem;
  border-radius: 999px;
}

.settings-meta-note {
  margin: 0;
  padding: 6px 8px;
  border-radius: 8px;
  border: 1px dashed rgba(138, 172, 201, 0.3);
  background: rgba(127, 127, 127, 0.06);
  color: var(--text-muted);
  font-size: 0.67rem;
  line-height: 1.45;
}

.settings-sync-row {
  margin-top: 4px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.settings-sync-row .glass-btn {
  flex: 1;
  min-width: 132px;
  min-height: 31px;
  font-size: 0.73rem;
}

.settings-sync-row-stack {
  margin-top: 0;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 6px;
}

.settings-sync-row-stack .glass-btn {
  width: 100%;
  min-width: 0;
  border-radius: 10px;
  font-weight: 700;
}

.settings-inline-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.settings-inline-actions .glass-btn {
  min-height: 31px;
  flex: 1;
  min-width: 126px;
  font-size: 0.73rem;
}

.settings-utility-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 7px;
}

.settings-utility-card {
  display: grid;
  gap: 6px;
  padding: 7px;
  border-radius: 9px;
  border: 1px solid rgba(138, 172, 201, 0.22);
  background: linear-gradient(150deg, rgba(127, 127, 127, 0.09), rgba(127, 127, 127, 0.04));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
  transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
}

.settings-utility-card:hover {
  transform: translateY(-1px);
  border-color: rgba(138, 172, 201, 0.36);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06), 0 14px 24px rgba(8, 13, 20, 0.2);
}

.settings-utility-card h4 {
  margin: 0;
  font-size: 0.76rem;
}

.settings-card-title {
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.settings-card-icon {
  width: 18px;
  height: 18px;
  border-radius: 6px;
  border: 1px solid rgba(138, 172, 201, 0.3);
  background: linear-gradient(145deg, rgba(127, 127, 127, 0.16), rgba(127, 127, 127, 0.04));
  color: var(--accent);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex: 0 0 auto;
}

.settings-card-icon svg {
  width: 11px;
  height: 11px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.settings-utility-card p {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.67rem;
  line-height: 1.45;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.settings-utility-card .control-field {
  margin-top: 1px;
}

.settings-utility-card-wide {
  grid-column: auto;
}

.settings-utility-card.settings-utility-card-danger {
  border-color: rgba(255, 109, 133, 0.24);
  background: linear-gradient(150deg, rgba(255, 109, 133, 0.08), rgba(127, 127, 127, 0.03));
}

.settings-danger-btn {
  border-color: rgba(255, 109, 133, 0.44);
  background: linear-gradient(150deg, rgba(255, 109, 133, 0.2), rgba(255, 109, 133, 0.08));
}

.settings-danger-btn:hover {
  border-color: rgba(255, 109, 133, 0.74);
  background: linear-gradient(150deg, rgba(255, 109, 133, 0.28), rgba(255, 109, 133, 0.12));
}

html[data-theme^="light-"] .settings-state-pill.settings-state-ok {
  color: #1b7f51;
}

html[data-theme^="light-"] .settings-state-pill.settings-state-warn {
  color: #8f5a0f;
}

html[data-theme^="light-"] .settings-utility-card {
  border-color: rgba(47, 82, 111, 0.17);
  background: linear-gradient(150deg, rgba(255, 255, 255, 0.76), rgba(245, 250, 255, 0.66));
}

html[data-theme^="light-"] .settings-tab-panel::before {
  background: linear-gradient(90deg, transparent, rgba(39, 74, 103, 0.42), transparent);
}

html[data-theme^="light-"] .settings-panel-side,
html[data-theme^="light-"] .settings-panel-workspace,
html[data-theme^="light-"] .settings-cloud-side {
  border-color: rgba(47, 82, 111, 0.17);
  background: rgba(255, 255, 255, 0.58);
}

html[data-theme^="light-"] .settings-section-head {
  border-bottom-color: rgba(47, 82, 111, 0.18);
}

html[data-theme^="light-"] .settings-mode-card,
html[data-theme^="light-"] .settings-card-icon,
html[data-theme^="light-"] .settings-section-icon,
html[data-theme^="light-"] .settings-mode-icon {
  border-color: rgba(47, 82, 111, 0.22);
  background: linear-gradient(145deg, rgba(255, 255, 255, 0.84), rgba(246, 250, 255, 0.72));
}

html[data-theme^="light-"] .viewport-mode-bar,
html[data-theme^="light-"] .viewport-mode-btn {
  border-color: rgba(47, 82, 111, 0.22);
  background: rgba(255, 255, 255, 0.84);
}

html[data-theme^="light-"] .viewport-mode-btn {
  color: #4f667d;
}

.sync-drive-btn {
  position: relative;
  overflow: hidden;
}

.sync-drive-btn.is-loading {
  pointer-events: none;
}

.sync-drive-btn.is-loading::after {
  content: "";
  width: 14px;
  height: 14px;
  border: 2px solid rgba(255, 255, 255, 0.35);
  border-top-color: var(--accent);
  border-radius: 50%;
  position: absolute;
  left: 10px;
  top: calc(50% - 7px);
  animation: spin 0.85s linear infinite;
}

.profile-surface {
  margin-bottom: 14px;
  padding: 12px;
  border: 1px solid var(--line);
  border-radius: 16px;
  background: var(--surface);
  box-shadow: var(--shadow);
}

.profile-orbit {
  position: relative;
  overflow: hidden;
  border-radius: 18px;
  border: 1px solid hsla(var(--profile-accent-hue, 198), 62%, 62%, 0.24);
  background:
    radial-gradient(circle at 13% 16%, hsla(var(--profile-accent-hue, 198), 86%, 62%, 0.22), transparent 34%),
    radial-gradient(circle at 86% 84%, hsla(calc(var(--profile-accent-hue, 198) + 28), 78%, 58%, 0.16), transparent 40%),
    linear-gradient(136deg, rgba(10, 20, 31, 0.92), rgba(18, 35, 50, 0.86) 52%, rgba(11, 22, 34, 0.9));
  box-shadow: 0 16px 30px rgba(6, 10, 15, 0.28), inset 0 1px 0 rgba(255, 255, 255, 0.06);
  backdrop-filter: blur(12px) saturate(130%);
  -webkit-backdrop-filter: blur(12px) saturate(130%);
  padding: 10px;
}

.profile-orbit::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(circle at 82% 14%, rgba(120, 208, 255, 0.18), transparent 35%),
    linear-gradient(115deg, rgba(255, 255, 255, 0.04), transparent 54%);
  pointer-events: none;
  z-index: 0;
}

.profile-orbit::after {
  content: "";
  position: absolute;
  top: 0;
  left: 16px;
  width: 170px;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.62), transparent);
  pointer-events: none;
  z-index: 0;
}

.profile-orbit > * {
  position: relative;
  z-index: 1;
}

html[data-theme^="light-"] .profile-orbit {
  border-color: hsla(var(--profile-accent-hue, 198), 46%, 44%, 0.22);
  background:
    radial-gradient(circle at 13% 16%, hsla(var(--profile-accent-hue, 198), 70%, 54%, 0.2), transparent 34%),
    radial-gradient(circle at 88% 84%, hsla(calc(var(--profile-accent-hue, 198) + 24), 66%, 52%, 0.14), transparent 40%),
    linear-gradient(160deg, rgba(255, 255, 255, 0.92), rgba(245, 250, 255, 0.86));
  box-shadow: 0 14px 28px rgba(24, 55, 83, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

html[data-theme^="light-"] .profile-orbit::before {
  opacity: 0.58;
}

html[data-theme^="light-"] .profile-orbit-side,
html[data-theme^="light-"] .profile-orbit-main {
  border-color: rgba(49, 82, 110, 0.18);
  background: rgba(255, 255, 255, 0.74);
}

.profile-orbit-shell {
  display: grid;
  grid-template-columns: minmax(260px, 0.82fr) minmax(0, 1.18fr);
  gap: 9px;
}

.profile-orbit-side,
.profile-orbit-main {
  border: 1px solid rgba(138, 172, 201, 0.22);
  border-radius: 14px;
  background: rgba(127, 127, 127, 0.07);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.profile-orbit-side {
  padding: 9px 10px;
  display: grid;
  grid-template-columns: auto minmax(0, 1fr);
  grid-template-areas:
    "avatar title"
    "avatar subtitle"
    "greeting greeting";
  gap: 4px 10px;
  align-items: center;
  align-content: center;
}

.profile-orbit-avatar {
  --icon-hue: var(--profile-accent-hue, 198);
  grid-area: avatar;
  width: 50px;
  height: 50px;
  border-radius: 14px;
  border: 1px solid hsla(var(--icon-hue), 84%, 76%, 0.42);
  background:
    radial-gradient(circle at 20% 16%, rgba(255, 255, 255, 0.36), transparent 44%),
    linear-gradient(152deg, hsla(var(--icon-hue), 82%, 66%, 0.28), hsla(var(--icon-hue), 82%, 64%, 0.08));
  box-shadow:
    0 12px 24px rgba(8, 12, 20, 0.28),
    inset 0 1px 0 rgba(255, 255, 255, 0.24),
    0 0 0 1px rgba(255, 255, 255, 0.05);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
  color: #def3ff;
}

.profile-orbit-aura {
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 74% 24%, rgba(255, 255, 255, 0.4), transparent 46%);
  pointer-events: none;
}

.profile-orbit-emblem-shell {
  position: absolute;
  width: 32px;
  height: 32px;
  border-radius: 11px;
  border: 1.25px solid rgba(255, 255, 255, 0.28);
  transform: rotate(45deg);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
}

.profile-orbit-emblem-track {
  position: absolute;
  border-radius: 50%;
  border: 1.2px solid hsla(var(--icon-hue), 90%, 82%, 0.55);
  transform-origin: center;
}

.profile-orbit-emblem-track::after {
  content: "";
  position: absolute;
  top: 1px;
  right: 6px;
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.88);
  box-shadow: 0 0 8px rgba(255, 255, 255, 0.54);
}

.profile-orbit-emblem-track-a {
  width: 35px;
  height: 35px;
  animation: avatar-track-spin 8s linear infinite;
}

.profile-orbit-emblem-track-b {
  width: 24px;
  height: 24px;
  border-style: dashed;
  border-width: 1.1px;
  animation: avatar-track-counter 5.8s linear infinite;
}

.profile-orbit-emblem-prism {
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 3px;
  transform: rotate(45deg);
  background: linear-gradient(150deg, rgba(255, 255, 255, 0.78), rgba(255, 255, 255, 0.18));
  box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.34), 0 0 14px hsla(var(--icon-hue), 86%, 80%, 0.34);
  z-index: 2;
  animation: avatar-prism-pulse 3.4s ease-in-out infinite;
}

.profile-orbit-emblem-prism::after {
  content: "";
  position: absolute;
  inset: 1px;
  border-radius: 2px;
  background: linear-gradient(165deg, rgba(255, 255, 255, 0.58), transparent 70%);
}

.profile-orbit-emblem-flare {
  position: absolute;
  top: 9px;
  left: 10px;
  width: 8px;
  height: 8px;
  border-radius: 2px;
  transform: rotate(45deg);
  background: rgba(255, 255, 255, 0.22);
  opacity: 0.85;
  filter: blur(0.1px);
  box-shadow: 0 0 10px hsla(var(--icon-hue), 90%, 82%, 0.38);
}

.profile-orbit-avatar[data-profile-level="1"] {
  box-shadow:
    0 14px 26px hsla(var(--icon-hue), 62%, 22%, calc(var(--profile-accent-glow, 0.22) + 0.05)),
    inset 0 1px 0 rgba(255, 255, 255, 0.24);
}

.profile-orbit-avatar[data-profile-level="2"] {
  box-shadow:
    0 16px 29px hsla(var(--icon-hue), 64%, 24%, calc(var(--profile-accent-glow, 0.22) + 0.1)),
    inset 0 1px 0 rgba(255, 255, 255, 0.26);
}

.profile-orbit-avatar[data-profile-level="3"] {
  box-shadow:
    0 18px 32px hsla(var(--icon-hue), 66%, 26%, calc(var(--profile-accent-glow, 0.22) + 0.14)),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

@keyframes avatar-track-spin {
  to {
    transform: rotate(360deg);
  }
}

@keyframes avatar-track-counter {
  to {
    transform: rotate(-360deg);
  }
}

@keyframes avatar-prism-pulse {
  0%,
  100% {
    transform: rotate(45deg) scale(1);
  }

  50% {
    transform: rotate(45deg) scale(1.08);
  }
}

html[data-theme^="light-"] .profile-orbit-avatar {
  color: #2d80c0;
  border-color: hsla(var(--profile-accent-hue, 198), 60%, 46%, 0.3);
  background:
    radial-gradient(circle at 20% 16%, rgba(255, 255, 255, 0.54), transparent 42%),
    linear-gradient(150deg, hsla(var(--profile-accent-hue, 198), 60%, 48%, 0.2), hsla(var(--profile-accent-hue, 198), 60%, 46%, 0.06));
}

html[data-theme^="light-"] .profile-orbit-emblem-shell {
  border-color: hsla(var(--profile-accent-hue, 198), 60%, 44%, 0.34);
}

html[data-theme^="light-"] .profile-orbit-emblem-track {
  border-color: hsla(var(--profile-accent-hue, 198), 62%, 44%, 0.42);
}

html[data-theme^="light-"] .profile-orbit-emblem-track::after {
  background: hsla(var(--profile-accent-hue, 198), 64%, 46%, 0.78);
}

html[data-theme^="light-"] .profile-orbit-emblem-prism {
  background: linear-gradient(150deg, rgba(255, 255, 255, 0.86), hsla(var(--profile-accent-hue, 198), 62%, 48%, 0.22));
  box-shadow: 0 0 0 1px hsla(var(--profile-accent-hue, 198), 60%, 42%, 0.3), 0 0 10px hsla(var(--profile-accent-hue, 198), 62%, 44%, 0.2);
}

.profile-orbit-side h2 {
  grid-area: title;
  margin: 0;
  font-size: 1.16rem;
  letter-spacing: -0.018em;
  line-height: 1.3;
}

.profile-orbit-side p {
  grid-area: subtitle;
  margin: 0;
  color: var(--text-muted);
  font-size: 0.94rem;
  line-height: 1.72;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.profile-greeting-panel {
  grid-area: greeting;
  border: 1px solid hsla(var(--profile-accent-hue, 198), 82%, 68%, 0.38);
  border-radius: 11px;
  background: linear-gradient(140deg, hsla(var(--profile-accent-hue, 198), 82%, 60%, 0.2), hsla(var(--profile-accent-hue, 198), 82%, 60%, 0.05));
  padding: 8px 10px;
  margin-top: 2px;
}

html[data-theme^="light-"] .profile-greeting-panel {
  border-color: hsla(var(--profile-accent-hue, 198), 56%, 48%, 0.34);
  background: linear-gradient(140deg, hsla(var(--profile-accent-hue, 198), 68%, 52%, 0.16), rgba(255, 255, 255, 0.8));
}

.profile-orbit .profile-greeting {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
  line-height: 1.85;
}

.profile-orbit-main {
  padding: 10px;
  display: grid;
  grid-template-columns: minmax(0, 1.15fr) minmax(250px, 0.85fr);
  gap: 8px;
  align-items: start;
}

.profile-orbit-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
  grid-column: 1;
  align-content: start;
}

.orbit-field {
  display: grid;
  gap: 6px;
}

.orbit-label {
  font-size: 0.84rem;
  color: var(--text-muted);
  font-weight: 600;
}

.orbit-input-wrap {
  min-height: 40px;
  border: 1px solid var(--line);
  border-radius: 11px;
  background: rgba(127, 127, 127, 0.08);
  display: flex;
  align-items: center;
  gap: 7px;
  padding: 4px 9px;
  transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
}

.orbit-input-wrap:focus-within {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-soft);
}

.orbit-icon {
  width: 22px;
  height: 22px;
  border-radius: 7px;
  border: 1px solid rgba(102, 184, 244, 0.35);
  background: linear-gradient(145deg, rgba(102, 184, 244, 0.22), rgba(102, 184, 244, 0.06));
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: #dcf3ff;
  flex: 0 0 auto;
}

.orbit-icon svg {
  width: 13px;
  height: 13px;
  stroke: currentColor;
  stroke-width: 1.8;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

html[data-theme^="light-"] .orbit-icon {
  color: #2d80c0;
  border-color: rgba(45, 128, 192, 0.24);
  background: linear-gradient(145deg, rgba(45, 128, 192, 0.16), rgba(45, 128, 192, 0.05));
}

.orbit-input-wrap input {
  min-height: 30px;
  padding: 0;
  border: 0;
  background: transparent;
  box-shadow: none;
  font-size: 0.92rem;
}

.profile-orbit-tools {
  grid-column: 2;
  margin-top: 0;
  border: 1px solid var(--line);
  border-radius: 12px;
  padding: 8px;
  background: rgba(127, 127, 127, 0.06);
  display: grid;
  grid-template-columns: 1fr;
  gap: 7px;
  align-items: start;
  align-content: start;
}

.profile-orbit-tools h3 {
  grid-column: auto;
  margin: 0;
  font-size: 0.92rem;
  color: var(--text-muted);
  font-weight: 700;
}

.orbit-json-tools {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 6px;
  margin: 0;
  align-content: start;
}

.orbit-json-tools .glass-btn {
  min-width: 0;
  min-height: 33px;
  padding: 5px 8px;
  font-size: 0.76rem;
}

.json-text-import {
  margin-top: 0;
  display: grid;
  gap: 6px;
}

.json-text-import label {
  font-size: 0.84rem;
  color: var(--text-muted);
  font-weight: 600;
}

.json-text-import textarea {
  width: 100%;
  min-height: 72px;
  resize: vertical;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-main);
  padding: 9px;
  line-height: 1.62;
  font-size: 0.84rem;
}

.json-text-import textarea:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-soft);
}

.json-text-actions {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 8px;
}

.json-text-actions .glass-btn {
  min-height: 34px;
  font-size: 0.78rem;
}

.profile-premium {
  position: relative;
  overflow: hidden;
  border-radius: 20px;
  border: 1px solid rgba(151, 176, 201, 0.26);
  padding: 14px;
  background: linear-gradient(160deg, rgba(19, 30, 42, 0.82), rgba(14, 23, 34, 0.72));
  box-shadow: 0 16px 34px rgba(7, 11, 17, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px) saturate(130%);
  -webkit-backdrop-filter: blur(10px) saturate(130%);
}

.profile-premium::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(circle at 85% 12%, rgba(94, 186, 244, 0.18), transparent 34%),
    radial-gradient(circle at 8% 90%, rgba(94, 186, 244, 0.08), transparent 36%);
  pointer-events: none;
  z-index: 0;
}

.profile-premium::after {
  content: "";
  position: absolute;
  top: 0;
  left: 16px;
  width: 180px;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.58), transparent);
  opacity: 0.56;
  pointer-events: none;
  z-index: 0;
}

.profile-premium > * {
  position: relative;
  z-index: 1;
}

html[data-theme^="light-"] .profile-premium {
  border-color: rgba(47, 82, 111, 0.2);
  background: linear-gradient(160deg, rgba(255, 255, 255, 0.9), rgba(246, 250, 255, 0.84));
  box-shadow: 0 14px 28px rgba(24, 55, 83, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.92);
}

html[data-theme^="light-"] .profile-premium::before {
  opacity: 0.62;
}

.profile-premium-head {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 12px;
}

.profile-head-copy h2 {
  margin: 0;
  font-size: 1.04rem;
  letter-spacing: -0.02em;
}

.profile-head-copy p {
  margin: 3px 0 0;
  color: var(--text-muted);
  font-size: 0.82rem;
  line-height: 1.65;
}

.profile-head-mark {
  width: 42px;
  height: 42px;
  border-radius: 13px;
  border: 1px solid rgba(112, 189, 245, 0.36);
  background: linear-gradient(150deg, rgba(98, 190, 246, 0.26), rgba(98, 190, 246, 0.08));
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: #d8f3ff;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.22), 0 10px 22px rgba(8, 12, 19, 0.28);
  position: relative;
  overflow: hidden;
}

.profile-head-glow {
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 72% 24%, rgba(255, 255, 255, 0.38), transparent 46%);
  pointer-events: none;
}

.profile-head-glyph {
  position: relative;
  z-index: 1;
  font-size: 1rem;
  font-weight: 800;
  line-height: 1;
  letter-spacing: 0.02em;
  text-shadow: 0 3px 12px rgba(5, 8, 13, 0.45);
}

html[data-theme^="light-"] .profile-head-mark {
  color: #2f82c1;
  border-color: rgba(47, 130, 193, 0.28);
  background: linear-gradient(150deg, rgba(47, 130, 193, 0.2), rgba(47, 130, 193, 0.06));
}

.profile-premium-layout {
  display: grid;
  grid-template-columns: minmax(0, 1.45fr) minmax(240px, 0.9fr);
  gap: 12px;
  align-items: stretch;
}

.profile-fields-card,
.profile-tools-card {
  border: 1px solid var(--line);
  border-radius: 14px;
  background: rgba(127, 127, 127, 0.06);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
  padding: 10px;
}

.profile-inline-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 10px;
}

.profile-inline-field {
  display: grid;
}

.profile-rich-field {
  min-height: 96px;
  padding: 10px;
  border: 1px solid var(--line);
  border-radius: 12px;
  background: linear-gradient(155deg, rgba(127, 127, 127, 0.09), rgba(127, 127, 127, 0.04));
  box-shadow: 0 7px 16px rgba(5, 9, 14, 0.12);
  gap: 8px;
  transition: border-color 0.22s ease, transform 0.22s ease, box-shadow 0.22s ease;
}

.profile-rich-field:hover {
  transform: translateY(-1px);
}

.profile-rich-field:focus-within {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-soft), 0 10px 18px rgba(8, 13, 20, 0.18);
}

.profile-field-meta {
  display: inline-flex;
  align-items: center;
  gap: 7px;
}

.profile-field-label {
  font-size: 0.78rem;
  color: var(--text-muted);
  font-weight: 600;
}

.profile-icon {
  width: 22px;
  height: 22px;
  color: #d9f2ff;
  flex: 0 0 auto;
  border-radius: 8px;
  border: 1px solid rgba(102, 184, 244, 0.35);
  background: linear-gradient(145deg, rgba(102, 184, 244, 0.22), rgba(102, 184, 244, 0.06));
  display: inline-flex;
  align-items: center;
  justify-content: center;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.18);
}

.profile-icon svg {
  width: 13px;
  height: 13px;
  stroke: currentColor;
  stroke-width: 1.8;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.profile-rich-field:nth-child(2) .profile-icon {
  border-color: rgba(132, 198, 255, 0.35);
  background: linear-gradient(145deg, rgba(132, 198, 255, 0.22), rgba(132, 198, 255, 0.06));
}

.profile-rich-field:nth-child(3) .profile-icon {
  border-color: rgba(85, 166, 230, 0.35);
  background: linear-gradient(145deg, rgba(85, 166, 230, 0.22), rgba(85, 166, 230, 0.06));
}

html[data-theme^="light-"] .profile-icon {
  color: #2f82c1;
  border-color: rgba(47, 130, 193, 0.24);
  background: linear-gradient(145deg, rgba(47, 130, 193, 0.16), rgba(47, 130, 193, 0.05));
}

.profile-rich-field input {
  min-height: 36px;
  border-radius: 10px;
  border: 1px solid var(--line);
  background: rgba(127, 127, 127, 0.08);
  padding: 6px 9px;
  box-shadow: none;
}

.profile-greeting {
  margin: 10px 0 0;
  padding: 11px 12px;
  border: 1px solid rgba(98, 190, 246, 0.34);
  border-radius: 12px;
  background: linear-gradient(140deg, rgba(98, 190, 246, 0.2), rgba(98, 190, 246, 0.06));
  font-size: 0.93rem;
  font-weight: 500;
  line-height: 1.9;
}

.profile-tools-card h3 {
  margin: 0;
  font-size: 0.9rem;
}

.profile-tools-card p {
  margin: 5px 0 10px;
  color: var(--text-muted);
  font-size: 0.79rem;
  line-height: 1.75;
}

.json-tools {
  margin: 0;
  display: grid;
  gap: 8px;
}

.json-tools .glass-btn {
  width: 100%;
  min-height: 36px;
  justify-content: center;
}

.settings-panel select:focus,
.profile-field input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-soft);
}

.control-field {
  display: grid;
  gap: 4px;
  font-size: 0.78rem;
  color: var(--text-muted);
}

button,
select,
input {
  font: inherit;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: var(--surface-soft);
  color: var(--text-main);
}

button,
select {
  min-height: 38px;
  padding: 7px 12px;
}

input {
  min-height: 38px;
  width: 100%;
  padding: 6px 10px;
}

button {
  cursor: pointer;
  transition: transform 0.18s ease, border-color 0.18s ease, background-color 0.18s ease;
}

button:hover {
  transform: translateY(-1px);
  border-color: var(--accent);
}

button:disabled {
  cursor: not-allowed;
  transform: none;
  opacity: 0.6;
}

button.primary {
  background: var(--accent);
  color: #fff;
  border-color: transparent;
}

button.ghost-btn {
  background: transparent;
}

.sync-panel {
  margin-bottom: 14px;
  border: 1px solid var(--line);
  border-radius: 14px;
  background: var(--surface-soft);
  box-shadow: var(--shadow);
}

.sync-panel summary {
  cursor: pointer;
  padding: 10px 12px;
  color: var(--text-muted);
}

.sync-grid {
  display: grid;
  gap: 10px;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  padding: 0 12px 12px;
}

.sync-grid label {
  display: grid;
  gap: 6px;
  color: var(--text-muted);
  font-size: 0.84rem;
}

.breadcrumbs {
  --crumb-accent: color-mix(in srgb, var(--accent, #74ceff) 76%, #dff4ff 24%);
  --crumb-line: color-mix(in srgb, var(--accent, #74ceff) 44%, transparent);
  position: relative;
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  gap: 9px;
  margin: 0 0 14px;
  padding: 10px 12px;
  border: 1px solid rgba(140, 188, 222, 0.28);
  border-radius: 18px;
  background:
    radial-gradient(circle at 10% 16%, rgba(114, 196, 247, 0.16), transparent 45%),
    radial-gradient(circle at 91% 84%, rgba(101, 220, 182, 0.11), transparent 42%),
    linear-gradient(148deg, rgba(9, 21, 34, 0.86), rgba(7, 16, 27, 0.68));
  box-shadow:
    0 14px 26px rgba(4, 10, 16, 0.24),
    inset 0 1px 0 rgba(255, 255, 255, 0.08),
    inset 0 -1px 0 rgba(74, 140, 190, 0.16);
  backdrop-filter: blur(10px) saturate(130%);
  -webkit-backdrop-filter: blur(10px) saturate(130%);
  overflow-x: auto;
  overflow-y: hidden;
  -ms-overflow-style: none;
  scrollbar-width: none;
  isolation: isolate;
}

.breadcrumbs::-webkit-scrollbar {
  width: 0;
  height: 0;
  display: none;
}

.breadcrumbs::before {
  content: "";
  position: absolute;
  inset: 1px;
  border-radius: 16px;
  background: linear-gradient(132deg, rgba(255, 255, 255, 0.06), transparent 52%, rgba(96, 173, 225, 0.08));
  pointer-events: none;
  z-index: 0;
}

.breadcrumbs::after {
  content: "";
  position: absolute;
  inset-inline: 12px;
  top: 50%;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--crumb-line), transparent);
  pointer-events: none;
  opacity: 0.72;
  z-index: 0;
}

.breadcrumbs > * {
  position: relative;
  z-index: 1;
  flex: 0 0 auto;
  scroll-snap-align: start;
}

.breadcrumbs .crumb-sep {
  width: 15px;
  height: 10px;
  font-size: 0;
  opacity: 0.9;
}

.breadcrumbs .crumb-sep::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 2px;
  width: 10px;
  height: 2px;
  transform: translateY(-50%);
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(122, 198, 246, 0.75), rgba(122, 198, 246, 0.2));
}

.breadcrumbs .crumb-sep::after {
  content: "";
  position: absolute;
  top: 50%;
  right: 1px;
  width: 4px;
  height: 4px;
  transform: translateY(-50%) rotate(45deg);
  border-radius: 1px;
  background: rgba(146, 216, 255, 0.9);
  box-shadow: 0 0 8px rgba(115, 202, 255, 0.42);
}

.breadcrumbs .crumb-node {
  position: relative;
  min-height: 36px;
  max-width: min(40vw, 340px);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding: 7px 13px;
  border-radius: 12px;
  border: 1px solid rgba(146, 187, 218, 0.34);
  background:
    linear-gradient(148deg, rgba(127, 127, 127, 0.13), rgba(127, 127, 127, 0.04)),
    rgba(127, 127, 127, 0.08);
  color: var(--text-main);
  font-size: 0.85rem;
  font-weight: 700;
  line-height: 1.18;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.breadcrumbs .crumb-node::after {
  content: "";
  position: absolute;
  inset-inline-start: -6px;
  top: 50%;
  width: 10px;
  height: 10px;
  transform: translateY(-50%);
  border-radius: 999px;
  border: 1px solid rgba(151, 198, 226, 0.32);
  background: rgba(8, 20, 32, 0.6);
  opacity: 0.75;
}

.breadcrumbs > :first-child.crumb-node::after {
  display: none;
}

.breadcrumbs .crumb-link {
  cursor: pointer;
  transition: transform 0.18s ease, border-color 0.18s ease, background-color 0.18s ease, box-shadow 0.18s ease, color 0.18s ease;
}

.breadcrumbs .crumb-link:hover {
  transform: translateY(-1px) scale(1.01);
  border-color: rgba(129, 208, 255, 0.58);
  background: linear-gradient(148deg, rgba(106, 188, 243, 0.22), rgba(106, 188, 243, 0.08));
  box-shadow: 0 10px 16px rgba(7, 22, 34, 0.24);
  color: #f1fbff;
}

.breadcrumbs .crumb-link:focus-visible {
  outline: none;
  border-color: rgba(129, 208, 255, 0.7);
  box-shadow: 0 0 0 3px rgba(122, 198, 247, 0.2);
}

.breadcrumbs .crumb-current {
  position: relative;
  font-weight: 800;
  border-color: color-mix(in srgb, var(--crumb-accent) 68%, rgba(189, 232, 255, 0.42));
  background:
    radial-gradient(circle at 88% 18%, rgba(140, 220, 255, 0.26), transparent 48%),
    linear-gradient(146deg, rgba(84, 162, 216, 0.3), rgba(84, 162, 216, 0.12)),
    rgba(127, 127, 127, 0.09);
  color: #eaf8ff;
  box-shadow: 0 12px 20px rgba(6, 22, 33, 0.26), 0 0 0 1px rgba(171, 226, 255, 0.2) inset;
}

.breadcrumbs .crumb-current::before {
  content: "";
  width: 7px;
  height: 7px;
  border-radius: 999px;
  margin-inline-end: 8px;
  flex: 0 0 auto;
  background: color-mix(in srgb, var(--crumb-accent) 88%, #ffffff 12%);
  box-shadow:
    0 0 12px color-mix(in srgb, var(--crumb-accent) 58%, transparent),
    0 0 0 2px rgba(176, 228, 255, 0.2);
}

.breadcrumbs.is-nested .crumb-current {
  border-radius: 13px;
}

.breadcrumbs.is-home .crumb-current {
  border-radius: 999px;
  padding-inline: 16px;
}

html[data-theme^="light-"] .breadcrumbs {
  --crumb-accent: #2c86c6;
  --crumb-line: rgba(68, 140, 188, 0.44);
  border-color: rgba(90, 150, 192, 0.28);
  background:
    radial-gradient(circle at 10% 16%, rgba(125, 193, 232, 0.19), transparent 44%),
    radial-gradient(circle at 92% 84%, rgba(128, 208, 176, 0.14), transparent 42%),
    linear-gradient(152deg, rgba(248, 252, 255, 0.96), rgba(236, 247, 255, 0.91));
  box-shadow:
    0 10px 18px rgba(22, 58, 86, 0.14),
    inset 0 1px 0 rgba(255, 255, 255, 0.88),
    inset 0 -1px 0 rgba(118, 172, 209, 0.18);
}

html[data-theme^="light-"] .breadcrumbs .crumb-node {
  border-color: rgba(100, 154, 193, 0.32);
  background: linear-gradient(150deg, rgba(255, 255, 255, 0.84), rgba(238, 247, 254, 0.76));
  color: #244867;
}

html[data-theme^="light-"] .breadcrumbs .crumb-current {
  border-color: rgba(69, 148, 200, 0.5);
  background:
    radial-gradient(circle at 85% 18%, rgba(121, 200, 241, 0.3), transparent 48%),
    linear-gradient(148deg, rgba(170, 223, 249, 0.56), rgba(170, 223, 249, 0.28)),
    rgba(255, 255, 255, 0.9);
  color: #1c4b6f;
}

@media (max-width: 760px) {
  .breadcrumbs {
    padding: 8px;
    gap: 7px;
    border-radius: 14px;
  }

  .breadcrumbs .crumb-node {
    min-height: 32px;
    max-width: min(68vw, 260px);
    padding: 5px 11px;
    font-size: 0.79rem;
  }

  .breadcrumbs .crumb-sep {
    width: 12px;
  }
}

.main-content {
  display: block;
}

.surface {
  border: 1px solid var(--line);
  border-radius: 18px;
  background: var(--surface);
  box-shadow: var(--shadow);
  padding: 16px;
  min-height: 360px;
}

.toolbar {
  display: grid;
  gap: 10px;
  margin-bottom: 14px;
}

.toolbar-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.toolbar-head h2 {
  margin: 0;
  font-size: 1.12rem;
}

.toolbar-head p {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.88rem;
}

.inline-form {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.inline-form input,
.inline-form select {
  min-width: 180px;
  flex: 1;
}

.list-grid {
  display: grid;
  gap: 10px;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
}

.subjects-dashboard {
  display: grid;
  gap: 12px;
}

.subjects-dashboard-head {
  border: 1px solid rgba(138, 172, 201, 0.24);
  border-radius: 14px;
  background:
    radial-gradient(circle at 88% 10%, rgba(111, 200, 255, 0.14), transparent 40%),
    linear-gradient(156deg, rgba(127, 127, 127, 0.11), rgba(127, 127, 127, 0.04));
  padding: 11px 12px;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.subjects-dashboard-head h2 {
  margin: 0;
  font-size: 1.17rem;
  letter-spacing: -0.018em;
}

.subjects-dashboard-head p {
  margin: 5px 0 0;
  color: var(--text-muted);
  font-size: 0.86rem;
}

.subjects-dashboard-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(126px, 1fr));
  gap: 8px;
}

.subjects-stat-chip {
  border: 1px solid rgba(138, 172, 201, 0.22);
  border-radius: 12px;
  background: rgba(127, 127, 127, 0.08);
  padding: 7px 9px;
  display: grid;
  gap: 2px;
}

.subjects-stat-value {
  font-size: 0.99rem;
  font-weight: 800;
  letter-spacing: 0.01em;
}

.subjects-stat-label {
  font-size: 0.74rem;
  color: var(--text-muted);
}

.subjects-premium-grid {
  display: grid;
  gap: 12px;
  grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
}

.subject-premium-card {
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(138, 172, 201, 0.25);
  border-radius: 16px;
  background:
    radial-gradient(circle at 86% 8%, rgba(111, 200, 255, 0.12), transparent 36%),
    linear-gradient(160deg, rgba(127, 127, 127, 0.11), rgba(127, 127, 127, 0.03));
  box-shadow: 0 14px 28px rgba(5, 9, 15, 0.24), inset 0 1px 0 rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  transition: transform 0.24s ease, box-shadow 0.24s ease, border-color 0.22s ease;
}

.subject-premium-card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 16px;
  width: 150px;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.56), transparent);
  opacity: 0.58;
  pointer-events: none;
}

.subject-premium-card:hover {
  transform: translateY(-3px);
  border-color: rgba(103, 177, 234, 0.52);
  box-shadow: 0 18px 32px rgba(5, 9, 15, 0.31);
}

.subject-open-btn {
  position: relative;
  width: 100%;
  text-align: right;
  border: 0;
  background: transparent;
  padding: 14px;
  padding-left: 54px;
}

.subject-open-btn::after {
  content: "›";
  position: absolute;
  left: 14px;
  top: 14px;
  width: 26px;
  height: 26px;
  border-radius: 9px;
  border: 1px solid rgba(102, 189, 245, 0.36);
  background: rgba(102, 189, 245, 0.14);
  color: #d9f2ff;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  font-weight: 700;
  line-height: 1;
}

.subject-open-btn h3 {
  margin: 0 0 5px;
  font-size: 1.03rem;
  letter-spacing: -0.01em;
}

.subject-open-btn p {
  margin: 0 0 11px;
  color: var(--text-muted);
  font-size: 0.82rem;
  line-height: 1.72;
}

.subject-card-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 7px;
}

.subject-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-height: 25px;
  padding: 2px 9px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.26);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-main);
  font-size: 0.74rem;
  font-weight: 600;
}

.subject-badge-chapters {
  border-color: rgba(97, 188, 245, 0.34);
  background: rgba(97, 188, 245, 0.14);
}

.subject-badge-questions {
  border-color: rgba(123, 207, 255, 0.3);
  background: rgba(123, 207, 255, 0.12);
}

.subject-badge-ready {
  border-color: rgba(116, 233, 191, 0.34);
  background: rgba(116, 233, 191, 0.14);
  color: #c8ffe6;
}

.subject-badge-empty {
  border-color: rgba(255, 191, 122, 0.32);
  background: rgba(255, 191, 122, 0.14);
  color: #ffd9a8;
}

html[data-theme^="light-"] .subjects-dashboard-head,
html[data-theme^="light-"] .subjects-stat-chip,
html[data-theme^="light-"] .subject-premium-card {
  border-color: rgba(46, 84, 114, 0.2);
  background:
    radial-gradient(circle at 86% 8%, rgba(79, 160, 221, 0.12), transparent 36%),
    linear-gradient(156deg, rgba(255, 255, 255, 0.9), rgba(244, 249, 255, 0.84));
}

html[data-theme^="light-"] .subject-open-btn::after {
  color: #2d80c0;
  border-color: rgba(45, 128, 192, 0.32);
  background: rgba(45, 128, 192, 0.14);
}

html[data-theme^="light-"] .subject-badge-ready {
  color: #257a58;
}

html[data-theme^="light-"] .subject-badge-empty {
  color: #9b6219;
}

.subject-add-card {
  position: relative;
  display: grid;
  gap: 12px;
  padding: 12px;
  border: 1px solid rgba(110, 184, 240, 0.36);
  border-radius: 18px;
  background: linear-gradient(155deg, rgba(23, 38, 52, 0.88), rgba(16, 28, 39, 0.74));
  box-shadow: 0 16px 30px rgba(7, 12, 18, 0.28), inset 0 1px 0 rgba(255, 255, 255, 0.06);
  overflow: hidden;
  isolation: isolate;
  backdrop-filter: blur(10px) saturate(120%);
  -webkit-backdrop-filter: blur(10px) saturate(120%);
}

.subject-add-card::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(circle at 85% 12%, rgba(76, 178, 240, 0.24), transparent 34%),
    radial-gradient(circle at 12% 88%, rgba(76, 178, 240, 0.12), transparent 40%);
  pointer-events: none;
  z-index: 0;
}

.subject-add-card::after {
  content: "";
  position: absolute;
  top: 0;
  right: 18px;
  width: 160px;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.56), transparent);
  pointer-events: none;
  z-index: 0;
}

.subject-add-card > * {
  position: relative;
  z-index: 1;
}

html[data-theme^="light-"] .subject-add-card {
  border-color: rgba(49, 128, 184, 0.26);
  background: linear-gradient(155deg, rgba(255, 255, 255, 0.9), rgba(244, 249, 255, 0.84));
  box-shadow: 0 13px 26px rgba(25, 62, 91, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

html[data-theme^="light-"] .subject-add-card::before {
  opacity: 0.58;
}

.subject-add-head {
  display: flex;
  align-items: flex-start;
  gap: 10px;
}

.subject-add-icon {
  --icon-hue: var(--profile-accent-hue, 198);
  width: 34px;
  height: 34px;
  border-radius: 11px;
  border: 1px solid hsla(var(--icon-hue), 84%, 74%, 0.38);
  background:
    radial-gradient(circle at 22% 18%, rgba(255, 255, 255, 0.32), transparent 42%),
    linear-gradient(145deg, hsla(var(--icon-hue), 82%, 66%, 0.28), hsla(var(--icon-hue), 82%, 64%, 0.08));
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: #dff4ff;
  flex: 0 0 auto;
  position: relative;
  overflow: hidden;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 8px 16px rgba(8, 13, 20, 0.24);
}

.subject-add-icon::before {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 74% 22%, rgba(255, 255, 255, 0.36), transparent 46%);
  pointer-events: none;
}

.subject-add-shell {
  position: absolute;
  width: 17px;
  height: 17px;
  border-radius: 6px;
  border: 1.2px solid rgba(255, 255, 255, 0.28);
  transform: rotate(45deg);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
}

.subject-add-track {
  position: absolute;
  border-radius: 50%;
  border: 1.1px solid hsla(var(--icon-hue), 90%, 82%, 0.54);
  transform-origin: center;
}

.subject-add-track::after {
  content: "";
  position: absolute;
  top: 0;
  right: 5px;
  width: 3px;
  height: 3px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.86);
  box-shadow: 0 0 8px rgba(255, 255, 255, 0.54);
}

.subject-add-track-a {
  width: 18px;
  height: 18px;
  animation: add-icon-spin 7.2s linear infinite;
}

.subject-add-track-b {
  width: 12px;
  height: 12px;
  border-style: dashed;
  border-width: 1px;
  animation: add-icon-counter 5.2s linear infinite;
}

.subject-add-prism {
  width: 8px;
  height: 8px;
  border-radius: 2px;
  transform: rotate(45deg);
  background: linear-gradient(150deg, rgba(255, 255, 255, 0.74), rgba(255, 255, 255, 0.2));
  box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.34), 0 0 10px hsla(var(--icon-hue), 88%, 80%, 0.34);
  position: relative;
  z-index: 2;
}

.subject-add-prism::after {
  content: "";
  position: absolute;
  inset: 1px;
  border-radius: 1px;
  background: linear-gradient(160deg, rgba(255, 255, 255, 0.54), transparent 68%);
}

.subject-add-flare {
  position: absolute;
  top: 8px;
  left: 9px;
  width: 6px;
  height: 6px;
  border-radius: 2px;
  transform: rotate(45deg);
  background: rgba(255, 255, 255, 0.24);
  box-shadow: 0 0 8px hsla(var(--icon-hue), 88%, 80%, 0.32);
}

@keyframes add-icon-spin {
  to {
    transform: rotate(360deg);
  }
}

@keyframes add-icon-counter {
  to {
    transform: rotate(-360deg);
  }
}

html[data-theme^="light-"] .subject-add-icon {
  color: #2c7fbf;
  border-color: hsla(var(--profile-accent-hue, 198), 60%, 46%, 0.3);
  background:
    radial-gradient(circle at 22% 18%, rgba(255, 255, 255, 0.5), transparent 46%),
    linear-gradient(145deg, hsla(var(--profile-accent-hue, 198), 60%, 50%, 0.18), hsla(var(--profile-accent-hue, 198), 60%, 48%, 0.05));
}

html[data-theme^="light-"] .subject-add-shell {
  border-color: hsla(var(--profile-accent-hue, 198), 60%, 44%, 0.34);
}

html[data-theme^="light-"] .subject-add-track {
  border-color: hsla(var(--profile-accent-hue, 198), 62%, 42%, 0.42);
}

html[data-theme^="light-"] .subject-add-track::after {
  background: hsla(var(--profile-accent-hue, 198), 64%, 46%, 0.74);
}

html[data-theme^="light-"] .subject-add-prism,
html[data-theme^="light-"] .subject-add-flare {
  background: hsla(var(--profile-accent-hue, 198), 60%, 48%, 0.2);
  box-shadow: 0 0 0 1px hsla(var(--profile-accent-hue, 198), 60%, 42%, 0.3);
}

.subject-add-copy {
  display: grid;
  gap: 3px;
}

.subject-add-label {
  font-weight: 700;
  font-size: 0.94rem;
  letter-spacing: -0.01em;
}

.subject-add-caption {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.78rem;
  line-height: 1.6;
}

.subject-add-action {
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto;
  gap: 8px;
  align-items: center;
}

.subject-add-input {
  min-height: 38px;
  border-radius: 11px;
  border: 1px solid var(--line);
  background: rgba(127, 127, 127, 0.09);
  padding: 7px 11px;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06);
}

.subject-add-btn {
  width: auto;
  min-width: 120px;
  min-height: 38px;
  border-radius: 11px;
  border-color: transparent;
  color: #fff;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 7px;
  background: linear-gradient(135deg, #2f90d3, #4cbff0);
  box-shadow: 0 10px 20px rgba(17, 76, 113, 0.34);
}

.subject-add-btn:hover {
  transform: translateY(-1px) scale(1.01);
}

.subject-add-btn-icon {
  width: 18px;
  height: 18px;
  border-radius: 6px;
  background: rgba(255, 255, 255, 0.2);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  line-height: 1;
  font-weight: 700;
}

.lesson-dashboard {
  display: grid;
  gap: 10px;
}

.lesson-dashboard-head {
  border: 1px solid rgba(138, 172, 201, 0.24);
  border-radius: 14px;
  background:
    radial-gradient(circle at 84% 10%, rgba(104, 194, 249, 0.16), transparent 36%),
    linear-gradient(156deg, rgba(127, 127, 127, 0.12), rgba(127, 127, 127, 0.05));
  padding: 10px 11px;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
  display: grid;
  gap: 8px;
}

.lesson-title-row {
  display: flex;
  gap: 8px;
  align-items: flex-start;
}

.lesson-title-row h2 {
  margin: 0;
  font-size: 1.04rem;
  letter-spacing: -0.014em;
}

.lesson-title-row p {
  margin: 4px 0 0;
  color: var(--text-muted);
  font-size: 0.82rem;
}

.lesson-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 22px;
  height: 22px;
  border-radius: 8px;
  border: 1px solid rgba(138, 172, 201, 0.3);
  background: rgba(127, 127, 127, 0.12);
  color: #89d1ff;
  flex: 0 0 auto;
}

.lesson-icon svg {
  stroke: currentColor;
  stroke-width: 1.85;
  stroke-linecap: round;
  stroke-linejoin: round;
  fill: none;
}

.lesson-dashboard-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 7px;
}

.lesson-stat-chip {
  border: 1px solid rgba(138, 172, 201, 0.22);
  border-radius: 11px;
  background: rgba(127, 127, 127, 0.1);
  padding: 6px 8px;
  display: grid;
  gap: 3px;
}

.lesson-stat-head {
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.lesson-stat-head em {
  font-style: normal;
  color: var(--text-muted);
  font-size: 0.72rem;
}

.lesson-stat-chip strong {
  font-size: 0.87rem;
  letter-spacing: -0.01em;
}

.lesson-add-card {
  display: grid;
  gap: 8px;
  border: 1px solid rgba(138, 172, 201, 0.24);
  border-radius: 13px;
  background: linear-gradient(150deg, rgba(127, 127, 127, 0.1), rgba(127, 127, 127, 0.05));
  padding: 9px;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
}

.lesson-add-top {
  display: flex;
  align-items: flex-start;
  gap: 7px;
}

.lesson-add-top h3 {
  margin: 0;
  font-size: 0.89rem;
}

.lesson-add-top p {
  margin: 3px 0 0;
  color: var(--text-muted);
  font-size: 0.75rem;
  line-height: 1.55;
}

.lesson-add-action {
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto;
  gap: 8px;
  align-items: center;
}

.lesson-add-action input {
  min-height: 35px;
}

.lesson-add-btn {
  min-height: 35px;
  min-width: 110px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
  border-radius: 10px;
}

.lesson-chapter-grid {
  display: grid;
  gap: 9px;
  grid-template-columns: repeat(auto-fill, minmax(218px, 1fr));
}

.lesson-chapter-card {
  position: relative;
  border: 1px solid rgba(138, 172, 201, 0.25);
  border-radius: 14px;
  overflow: hidden;
  background:
    radial-gradient(circle at 85% 10%, rgba(89, 186, 247, 0.14), transparent 38%),
    linear-gradient(156deg, rgba(127, 127, 127, 0.11), rgba(127, 127, 127, 0.04));
  box-shadow: 0 12px 24px rgba(6, 10, 15, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.05);
  transition: transform 0.22s ease, border-color 0.22s ease, box-shadow 0.22s ease;
}

.lesson-chapter-card:hover {
  transform: translateY(-2px);
  border-color: rgba(95, 180, 239, 0.5);
  box-shadow: 0 16px 30px rgba(7, 14, 22, 0.28);
}

.lesson-chapter-open {
  position: relative;
  width: 100%;
  text-align: right;
  border: 0;
  background: transparent;
  padding: 12px;
  display: grid;
  gap: 8px;
}

.lesson-chapter-head h3 {
  margin: 0;
  font-size: 0.97rem;
  letter-spacing: -0.01em;
}

.lesson-chapter-head p {
  margin: 4px 0 0;
  color: var(--text-muted);
  font-size: 0.78rem;
  line-height: 1.6;
}

.lesson-chapter-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.lesson-chapter-badge {
  min-height: 24px;
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.25);
  background: rgba(127, 127, 127, 0.1);
  font-size: 0.71rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.lesson-chapter-badge.is-ready {
  border-color: rgba(116, 233, 191, 0.34);
  background: rgba(116, 233, 191, 0.14);
  color: #c8ffe6;
}

.lesson-chapter-badge.is-loading {
  border-color: rgba(255, 191, 122, 0.33);
  background: rgba(255, 191, 122, 0.14);
  color: #ffd8a6;
}

html[data-theme^="light-"] .lesson-dashboard-head,
html[data-theme^="light-"] .lesson-stat-chip,
html[data-theme^="light-"] .lesson-add-card,
html[data-theme^="light-"] .lesson-chapter-card {
  border-color: rgba(47, 82, 111, 0.2);
  background:
    radial-gradient(circle at 85% 10%, rgba(79, 160, 221, 0.12), transparent 36%),
    linear-gradient(156deg, rgba(255, 255, 255, 0.9), rgba(244, 249, 255, 0.84));
}

html[data-theme^="light-"] .lesson-icon {
  color: #2d86c7;
  border-color: rgba(45, 128, 192, 0.28);
  background: rgba(45, 128, 192, 0.12);
}

html[data-theme^="light-"] .chapter-card-tools {
  border-color: rgba(47, 82, 111, 0.22);
  background: rgba(255, 255, 255, 0.9);
  box-shadow: 0 12px 22px rgba(24, 55, 83, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.88);
}

html[data-theme^="light-"] .chapter-move-group {
  border-color: rgba(47, 82, 111, 0.2);
  background: rgba(255, 255, 255, 0.86);
}

html[data-theme^="light-"] .chapter-card-tools .icon-order-btn {
  border-color: rgba(47, 82, 111, 0.28);
  background: rgba(255, 255, 255, 0.9);
  color: #2d80c0;
}

html[data-theme^="light-"] .chapter-card-tools .icon-open-btn {
  border-color: rgba(47, 130, 193, 0.34);
  background: rgba(255, 255, 255, 0.92);
  color: #2d80c0;
}

html[data-theme^="light-"] .lesson-chapter-badge.is-ready {
  color: #257a58;
}

html[data-theme^="light-"] .lesson-chapter-badge.is-loading {
  color: #9b6219;
}

.card-btn,
.question-card {
  border: 1px solid var(--line);
  border-radius: 14px;
  background: var(--surface-soft);
}

.card-btn {
  text-align: right;
  padding: 14px;
  width: 100%;
}

.card-shell {
  position: relative;
}

.chapter-card-tools {
  position: absolute;
  top: 10px;
  left: 10px;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 33px));
  grid-template-rows: repeat(2, minmax(0, 33px));
  align-items: stretch;
  justify-items: stretch;
  gap: 5px;
  padding: 7px;
  border-radius: 14px;
  border: 1px solid rgba(136, 178, 209, 0.3);
  background: linear-gradient(150deg, rgba(14, 24, 35, 0.68), rgba(11, 20, 30, 0.56));
  box-shadow: 0 10px 22px rgba(6, 10, 16, 0.32), inset 0 1px 0 rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 3;
  transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
}

.lesson-chapter-card:hover .chapter-card-tools {
  border-color: rgba(96, 184, 241, 0.54);
  box-shadow: 0 14px 25px rgba(7, 12, 18, 0.34), inset 0 1px 0 rgba(255, 255, 255, 0.14);
  transform: translateY(-1px);
}

.chapter-move-group {
  display: inline-grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 5px;
  padding: 2px;
  border-radius: 11px;
  border: 1px solid rgba(138, 183, 217, 0.25);
  background: rgba(127, 127, 127, 0.12);
}

.card-btn h3 {
  margin: 0 0 4px;
  font-size: 1rem;
}

.card-btn p {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.84rem;
}

.icon-delete-btn {
  position: absolute;
  top: 10px;
  left: 10px;
  width: 32px;
  height: 32px;
  min-height: 32px;
  padding: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  border: 1px solid rgba(255, 120, 140, 0.24);
  background: rgba(255, 110, 130, 0.1);
  color: #ff9fb0;
}

.chapter-card-tools .icon-delete-btn {
  position: static;
  width: 33px;
  height: 33px;
  min-height: 33px;
  border-radius: 10px;
}

.icon-open-btn,
.icon-order-btn {
  width: 33px;
  height: 33px;
  min-height: 33px;
  padding: 0;
  border-radius: 10px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.icon-open-btn {
  border: 1px solid rgba(102, 196, 250, 0.46);
  background: linear-gradient(145deg, rgba(102, 196, 250, 0.22), rgba(102, 196, 250, 0.08));
  color: #c7ecff;
}

.icon-order-btn {
  border: 1px solid rgba(132, 182, 223, 0.36);
  background: linear-gradient(145deg, rgba(127, 127, 127, 0.18), rgba(127, 127, 127, 0.08));
  color: var(--text-main);
}

.chapter-card-tools .icon-order-btn[data-action="move-chapter-up"] {
  border-color: rgba(118, 203, 255, 0.44);
  color: #c7ecff;
}

.chapter-card-tools .icon-order-btn[data-action="move-chapter-down"] {
  border-color: rgba(132, 182, 223, 0.34);
  color: #b9cde1;
}

.icon-open-btn svg,
.icon-order-btn svg {
  width: 15px;
  height: 15px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.icon-open-btn:hover,
.icon-order-btn:hover {
  border-color: rgba(97, 184, 243, 0.62);
  background: rgba(97, 184, 243, 0.24);
  transform: translateY(-1px);
}

.chapter-card-tools .chapter-tool-open {
  border-color: rgba(102, 196, 250, 0.5);
}

.chapter-card-tools .chapter-tool-delete {
  border-color: rgba(255, 128, 146, 0.34);
}

.icon-order-btn:disabled {
  opacity: 0.36;
  cursor: not-allowed;
  transform: none;
}

.icon-delete-btn svg {
  width: 16px;
  height: 16px;
  stroke: currentColor;
  stroke-width: 1.8;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.icon-delete-btn:hover {
  border-color: rgba(255, 126, 144, 0.65);
  background: rgba(255, 112, 133, 0.2);
  transform: translateY(-1px) scale(1.02);
}

.icon-delete-btn-inline {
  position: static;
  width: 30px;
  height: 30px;
  min-height: 30px;
  border-radius: 9px;
}

.chapter-head {
  display: grid;
  gap: 4px;
  margin-bottom: 10px;
}

.chapter-head h2 {
  margin: 0;
}

.chapter-head p {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.88rem;
}

.tabs {
  --chapter-tab-h: 44px;
  position: relative;
  isolation: isolate;
  display: flex;
  align-items: center;
  flex-wrap: nowrap;
  gap: 8px;
  margin-bottom: 14px;
  padding: 6px;
  border: 1px solid rgba(123, 170, 205, 0.34);
  border-radius: 16px;
  background:
    radial-gradient(circle at 12% 18%, rgba(91, 186, 244, 0.14), transparent 44%),
    linear-gradient(150deg, rgba(22, 42, 62, 0.82), rgba(10, 25, 41, 0.94));
  box-shadow:
    0 14px 26px rgba(4, 12, 22, 0.28),
    inset 0 1px 0 rgba(255, 255, 255, 0.1),
    inset 0 -1px 0 rgba(73, 129, 171, 0.28);
  overflow-x: auto;
  overflow-y: hidden;
  scrollbar-width: thin;
  scrollbar-color: rgba(108, 187, 238, 0.5) transparent;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: x proximity;
}

.tabs::before {
  content: "";
  position: absolute;
  inset: 1px;
  border-radius: inherit;
  pointer-events: none;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0));
}

.tabs::after {
  content: "";
  position: absolute;
  inset-inline: 16px;
  bottom: 4px;
  height: 1px;
  border-radius: 999px;
  pointer-events: none;
  background: linear-gradient(90deg, transparent, rgba(155, 219, 250, 0.56), transparent);
}

.tabs::-webkit-scrollbar {
  height: 6px;
}

.tabs::-webkit-scrollbar-track {
  background: transparent;
}

.tabs::-webkit-scrollbar-thumb {
  border-radius: 999px;
  background: rgba(105, 187, 242, 0.46);
}

.tab-btn {
  position: relative;
  z-index: 1;
  flex: 0 0 auto;
  min-height: var(--chapter-tab-h);
  height: var(--chapter-tab-h);
  padding: 0 14px;
  border-radius: 12px;
  border: 1px solid rgba(135, 185, 219, 0.26);
  background: linear-gradient(180deg, rgba(47, 79, 109, 0.26), rgba(15, 36, 56, 0.5));
  color: rgba(219, 236, 248, 0.92);
  font-size: 0.88rem;
  font-weight: 700;
  line-height: 1;
  letter-spacing: -0.01em;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  white-space: nowrap;
  scroll-snap-align: start;
  transition:
    transform 0.18s ease,
    border-color 0.22s ease,
    background-color 0.22s ease,
    box-shadow 0.22s ease,
    color 0.22s ease;
}

.tab-btn::before {
  content: "";
  position: absolute;
  inset: 1px;
  border-radius: inherit;
  pointer-events: none;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0));
  opacity: 0.34;
}

.tab-btn .tab-btn-icon {
  width: 22px;
  height: 22px;
  border-radius: 8px;
  border: 1px solid rgba(149, 198, 229, 0.32);
  background: linear-gradient(160deg, rgba(82, 131, 168, 0.34), rgba(22, 49, 73, 0.64));
  display: inline-flex;
  align-items: center;
  justify-content: center;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.14);
}

.tab-btn .tab-btn-icon svg {
  width: 12px;
  height: 12px;
  stroke-width: 2;
}

.tab-btn:hover {
  transform: translateY(-1px);
  border-color: rgba(154, 215, 249, 0.5);
  background: linear-gradient(180deg, rgba(69, 114, 153, 0.34), rgba(22, 47, 72, 0.62));
  box-shadow:
    0 10px 20px rgba(5, 14, 25, 0.32),
    inset 0 1px 0 rgba(240, 250, 255, 0.2);
}

.tab-btn.active {
  border-color: rgba(165, 225, 255, 0.72);
  color: #f6fbff;
  background: linear-gradient(138deg, rgba(108, 199, 247, 0.92), rgba(50, 141, 205, 0.94));
  box-shadow:
    0 12px 24px rgba(26, 112, 174, 0.42),
    inset 0 1px 0 rgba(241, 251, 255, 0.58);
}

.tab-btn.active::after {
  content: "";
  position: absolute;
  inset-inline: 14px;
  bottom: 4px;
  height: 2px;
  border-radius: 999px;
  background: linear-gradient(90deg, transparent, rgba(248, 253, 255, 0.96), transparent);
}

.tab-btn.active .tab-btn-icon {
  border-color: rgba(190, 236, 255, 0.86);
  background: linear-gradient(155deg, rgba(216, 242, 255, 0.54), rgba(105, 188, 239, 0.32));
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.56),
    0 4px 10px rgba(43, 126, 184, 0.26);
}

.tab-btn:focus-visible {
  outline: none;
  border-color: rgba(161, 222, 255, 0.82);
  box-shadow:
    0 0 0 3px rgba(96, 186, 238, 0.24),
    0 10px 22px rgba(6, 16, 28, 0.28);
}

@media (max-width: 860px) {
  .tabs {
    --chapter-tab-h: 40px;
    gap: 6px;
    padding: 5px;
    border-radius: 14px;
  }

  .tab-btn {
    min-width: 112px;
    padding-inline: 12px;
    font-size: 0.82rem;
  }

  .tab-btn .tab-btn-icon {
    width: 20px;
    height: 20px;
    border-radius: 7px;
  }

  .tab-btn .tab-btn-icon svg {
    width: 11px;
    height: 11px;
  }
}

.tab-panel {
  display: grid;
  gap: 12px;
}

.question-bank-panel {
  gap: 10px;
}

.chapter-map-panel {
  gap: 10px;
}

.chapter-map-toolbar {
  gap: 9px;
  padding: 10px;
}

.chapter-map-toolbar-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.chapter-map-toolbar-title {
  margin: 0;
  font-size: 0.86rem;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.chapter-map-toolbar-meta {
  font-size: 0.72rem;
  color: var(--text-muted);
  white-space: nowrap;
}

.chapter-map-search-wrap {
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto;
  gap: 8px;
  align-items: center;
  position: relative;
}

.chapter-map-search-icon {
  position: absolute;
  right: 12px;
  top: calc(50% - 8px);
  width: 16px;
  height: 16px;
  color: var(--text-muted);
  pointer-events: none;
  z-index: 1;
}

.chapter-map-search-icon svg {
  width: 100%;
  height: 100%;
  stroke: currentColor;
  stroke-width: 1.8;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.chapter-map-search {
  min-height: 35px;
  padding-right: 34px;
  border-radius: 10px;
}

.chapter-map-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  justify-content: flex-end;
}

.chapter-map-action-btn {
  min-height: 33px;
  padding: 5px 10px;
  border-radius: 10px;
  border: 1px solid rgba(138, 172, 201, 0.25);
  background: rgba(127, 127, 127, 0.09);
  color: var(--text-main);
  font-size: 0.74rem;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.chapter-map-action-btn .lesson-icon {
  width: 16px;
  height: 16px;
  border-radius: 5px;
}

.chapter-map-action-btn.is-active {
  border-color: rgba(88, 188, 245, 0.6);
  background: rgba(88, 188, 245, 0.22);
}

.chapter-map-action-btn-primary {
  border-color: rgba(88, 188, 245, 0.54);
  background: linear-gradient(145deg, rgba(88, 188, 245, 0.24), rgba(88, 188, 245, 0.1));
}

.chapter-map-layout {
  display: grid;
  grid-template-columns: minmax(0, 1.28fr) minmax(220px, 0.72fr);
  gap: 10px;
  align-items: stretch;
}

.chapter-map-stage {
  position: relative;
  overflow: hidden;
  border-radius: 16px;
  border: 1px solid rgba(140, 173, 201, 0.26);
  min-height: 360px;
  background:
    radial-gradient(circle at 12% 14%, rgba(87, 180, 255, 0.2), transparent 38%),
    radial-gradient(circle at 86% 84%, rgba(87, 180, 255, 0.14), transparent 42%),
    linear-gradient(150deg, rgba(18, 31, 44, 0.86), rgba(12, 21, 33, 0.76));
  box-shadow: 0 16px 34px rgba(6, 11, 17, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.chapter-map-canvas {
  position: relative;
  z-index: 2;
  min-height: 360px;
  display: grid;
  place-items: stretch;
}

.chapter-map-svg {
  width: 100%;
  height: 100%;
  display: block;
}

.chapter-map-blobs,
.chapter-map-particles {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.chapter-map-blobs {
  z-index: 0;
}

.chapter-map-blob {
  position: absolute;
  border-radius: 999px;
  filter: blur(34px);
  opacity: 0.34;
  animation: chapter-map-blob-drift 16s ease-in-out infinite;
}

.chapter-map-blob-a {
  width: 210px;
  height: 210px;
  top: -40px;
  right: -30px;
  background: rgba(81, 183, 244, 0.34);
}

.chapter-map-blob-b {
  width: 180px;
  height: 180px;
  left: -28px;
  bottom: -36px;
  background: rgba(90, 164, 226, 0.26);
  animation-delay: -7s;
}

.chapter-map-particles {
  z-index: 1;
}

.chapter-map-particles i {
  --dot-size: 4px;
  position: absolute;
  width: var(--dot-size);
  height: var(--dot-size);
  border-radius: 50%;
  background: rgba(210, 237, 255, 0.5);
  box-shadow: 0 0 8px rgba(146, 217, 255, 0.36);
  left: calc((var(--dot-index) * 7.6%) - 3%);
  top: calc((var(--dot-index) * 9.1%) - 7%);
  animation: chapter-map-particle-float calc(12s + (var(--dot-index) * 0.42s)) ease-in-out infinite;
  animation-delay: calc(var(--dot-index) * -0.7s);
}

.chapter-map-layout.map-fx-off .chapter-map-blobs,
.chapter-map-layout.map-fx-off .chapter-map-particles {
  display: none;
}

.chapter-map-root-glow {
  fill: rgba(90, 188, 245, 0.18);
}

.chapter-map-root-ring {
  fill: rgba(82, 176, 236, 0.2);
  stroke: rgba(120, 209, 255, 0.58);
  stroke-width: 1.4;
}

.chapter-map-root-core {
  fill: rgba(18, 30, 43, 0.84);
  stroke: rgba(136, 215, 255, 0.5);
  stroke-width: 1.3;
}

.chapter-map-root-title {
  fill: var(--text-main);
  font-size: 0.92rem;
  font-weight: 700;
}

.chapter-map-root-subtitle {
  fill: var(--text-muted);
  font-size: 0.68rem;
}

.chapter-map-link {
  fill: none;
  stroke-width: 1.65;
  opacity: 0.9;
  transition: opacity 0.22s ease, stroke-width 0.22s ease;
}

.chapter-map-link.is-focused,
.chapter-map-link.is-search-match {
  stroke-width: 2.5;
  opacity: 1;
}

.chapter-map-node-glow {
  fill: rgba(88, 188, 245, 0.18);
  opacity: 0;
  transition: opacity 0.2s ease;
}

.chapter-map-node .chapter-map-node-ring,
.chapter-map-node .chapter-map-node-card,
.chapter-map-node .chapter-map-node-glow {
  transition: stroke 0.2s ease, opacity 0.2s ease, fill 0.2s ease;
}

.chapter-map-node-ring {
  fill: rgba(88, 188, 245, 0.14);
  stroke: rgba(123, 210, 255, 0.54);
  stroke-width: 1.2;
}

.chapter-map-node-card {
  fill: rgba(12, 24, 35, 0.82);
  stroke: rgba(141, 175, 203, 0.34);
  stroke-width: 1;
}

.chapter-map-node-title {
  fill: var(--text-main);
  font-size: 0.7rem;
  font-weight: 700;
  pointer-events: none;
}

.chapter-map-node-meta text {
  fill: var(--text-muted);
  font-size: 0.62rem;
  pointer-events: none;
}

.chapter-map-node-review-dot {
  fill: #ff6d85;
  opacity: 0.9;
}

.chapter-map-node-review-text {
  fill: #ffc0cc;
  font-size: 0.57rem;
  font-weight: 700;
}

.chapter-map-node.is-current .chapter-map-node-ring,
.chapter-map-node.is-focused .chapter-map-node-ring,
.chapter-map-node.is-search-match .chapter-map-node-ring {
  stroke: rgba(116, 206, 255, 0.92);
}

.chapter-map-node.is-current .chapter-map-node-card,
.chapter-map-node.is-focused .chapter-map-node-card,
.chapter-map-node.is-search-match .chapter-map-node-card {
  stroke: rgba(116, 206, 255, 0.76);
}

.chapter-map-node.is-current .chapter-map-node-glow,
.chapter-map-node.is-focused .chapter-map-node-glow,
.chapter-map-node.is-search-match .chapter-map-node-glow {
  opacity: 1;
}

.chapter-map-legend {
  border: 1px solid rgba(140, 173, 201, 0.24);
  border-radius: 14px;
  background: rgba(127, 127, 127, 0.07);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
  padding: 9px;
  display: grid;
  align-content: start;
  gap: 8px;
  min-height: 360px;
}

.chapter-map-legend-head {
  display: grid;
  gap: 3px;
  padding-bottom: 6px;
  border-bottom: 1px dashed rgba(140, 173, 201, 0.26);
}

.chapter-map-legend-head h5 {
  margin: 0;
  font-size: 0.79rem;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.chapter-map-legend-head p {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.67rem;
}

.chapter-map-legend-list {
  display: grid;
  gap: 6px;
  max-height: 302px;
  overflow: auto;
  padding-inline-end: 2px;
}

.chapter-map-legend-item {
  min-height: 40px;
  border-radius: 10px;
  border: 1px solid rgba(138, 172, 201, 0.22);
  background: rgba(127, 127, 127, 0.09);
  padding: 6px 8px;
  display: grid;
  gap: 4px;
  align-content: center;
  text-align: right;
}

.chapter-map-legend-main {
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.chapter-map-order-pill {
  min-width: 19px;
  height: 19px;
  border-radius: 7px;
  border: 1px solid rgba(140, 173, 201, 0.34);
  background: rgba(127, 127, 127, 0.13);
  font-size: 0.67rem;
  font-weight: 700;
  color: var(--text-muted);
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.chapter-map-legend-item strong {
  font-size: 0.76rem;
  line-height: 1.45;
}

.chapter-map-legend-meta {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  color: var(--text-muted);
  font-size: 0.67rem;
}

.chapter-map-review-chip {
  min-height: 20px;
  padding: 0 6px 0 5px;
  border-radius: 999px;
  border: 1px solid rgba(255, 112, 132, 0.4);
  background: rgba(255, 112, 132, 0.14);
  color: #ffbdca;
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 0.63rem;
  font-weight: 700;
}

.chapter-map-review-chip i {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #ff6d85;
  box-shadow: 0 0 0 2px rgba(255, 112, 132, 0.22);
}

.chapter-map-legend-item.is-current,
.chapter-map-legend-item.is-focused,
.chapter-map-legend-item.is-search-match,
.chapter-map-legend-item.is-selected {
  border-color: rgba(103, 194, 248, 0.56);
  background: rgba(103, 194, 248, 0.2);
}

.chapter-map-fallback {
  display: grid;
  gap: 8px;
  padding: 10px;
}

.chapter-map-fallback-note {
  margin: 0;
  padding: 8px 10px;
  border: 1px dashed rgba(140, 173, 201, 0.32);
  border-radius: 10px;
  color: var(--text-muted);
  font-size: 0.73rem;
  background: rgba(127, 127, 127, 0.08);
}

.chapter-map-fallback-list {
  display: grid;
  gap: 6px;
}

.chapter-map-fallback-item {
  min-height: 40px;
  border-radius: 10px;
  border: 1px solid rgba(138, 172, 201, 0.25);
  background: rgba(127, 127, 127, 0.09);
  display: grid;
  gap: 4px;
  align-content: center;
  justify-items: start;
  text-align: right;
  padding: 7px 9px;
}

.chapter-map-fallback-item strong {
  font-size: 0.77rem;
}

.chapter-map-fallback-meta {
  font-size: 0.67rem;
  color: var(--text-muted);
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.chapter-map-fallback-item.is-current,
.chapter-map-fallback-item.is-search-match {
  border-color: rgba(103, 194, 248, 0.56);
  background: rgba(103, 194, 248, 0.2);
}

@keyframes chapter-map-blob-drift {
  0%,
  100% {
    transform: translate3d(0, 0, 0) scale(1);
  }
  50% {
    transform: translate3d(12px, -8px, 0) scale(1.04);
  }
}

@keyframes chapter-map-particle-float {
  0%,
  100% {
    transform: translate3d(0, 0, 0) scale(0.9);
    opacity: 0.22;
  }
  50% {
    transform: translate3d(0, -8px, 0) scale(1);
    opacity: 0.56;
  }
}

html[data-theme^="light-"] .tabs {
  border-color: rgba(102, 160, 197, 0.32);
  background:
    radial-gradient(circle at 12% 20%, rgba(112, 193, 241, 0.2), transparent 46%),
    linear-gradient(150deg, rgba(243, 250, 255, 0.96), rgba(229, 242, 252, 0.94));
  box-shadow:
    0 12px 22px rgba(38, 80, 111, 0.14),
    inset 0 1px 0 rgba(255, 255, 255, 0.88),
    inset 0 -1px 0 rgba(131, 181, 214, 0.22);
}

html[data-theme^="light-"] .tabs::after {
  background: linear-gradient(90deg, transparent, rgba(113, 180, 221, 0.58), transparent);
}

html[data-theme^="light-"] .tab-btn {
  border-color: rgba(124, 177, 210, 0.28);
  background: linear-gradient(180deg, rgba(243, 250, 255, 0.9), rgba(229, 241, 250, 0.84));
  color: #2a5c7e;
}

html[data-theme^="light-"] .tab-btn:hover {
  border-color: rgba(104, 170, 209, 0.52);
  background: linear-gradient(180deg, rgba(232, 245, 255, 0.96), rgba(214, 233, 247, 0.94));
  box-shadow:
    0 10px 18px rgba(49, 94, 127, 0.16),
    inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

html[data-theme^="light-"] .tab-btn .tab-btn-icon {
  border-color: rgba(108, 166, 202, 0.32);
  background: linear-gradient(155deg, rgba(241, 249, 255, 0.92), rgba(224, 238, 248, 0.86));
}

html[data-theme^="light-"] .tab-btn.active {
  border-color: rgba(85, 160, 208, 0.68);
  background: linear-gradient(138deg, rgba(116, 203, 246, 0.96), rgba(64, 151, 210, 0.94));
  color: #f4fbff;
  box-shadow:
    0 12px 22px rgba(68, 138, 185, 0.3),
    inset 0 1px 0 rgba(245, 253, 255, 0.86);
}

html[data-theme^="light-"] .tab-btn.active .tab-btn-icon {
  border-color: rgba(193, 234, 255, 0.9);
  background: linear-gradient(155deg, rgba(236, 248, 255, 0.78), rgba(115, 194, 238, 0.42));
}

html[data-theme^="light-"] .chapter-map-stage {
  border-color: rgba(47, 82, 111, 0.2);
  background:
    radial-gradient(circle at 12% 14%, rgba(72, 152, 214, 0.16), transparent 38%),
    radial-gradient(circle at 86% 84%, rgba(72, 152, 214, 0.12), transparent 42%),
    linear-gradient(150deg, rgba(255, 255, 255, 0.92), rgba(245, 250, 255, 0.84));
  box-shadow: 0 14px 28px rgba(24, 55, 83, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

html[data-theme^="light-"] .chapter-map-action-btn,
html[data-theme^="light-"] .chapter-map-legend,
html[data-theme^="light-"] .chapter-map-legend-item,
html[data-theme^="light-"] .chapter-map-fallback-item,
html[data-theme^="light-"] .chapter-map-fallback-note {
  border-color: rgba(47, 82, 111, 0.22);
  background: rgba(255, 255, 255, 0.82);
}

html[data-theme^="light-"] .chapter-map-root-core,
html[data-theme^="light-"] .chapter-map-node-card {
  fill: rgba(255, 255, 255, 0.92);
}

html[data-theme^="light-"] .chapter-map-node-title {
  fill: #143052;
}

html[data-theme^="light-"] .chapter-map-node-meta text,
html[data-theme^="light-"] .chapter-map-root-subtitle,
html[data-theme^="light-"] .chapter-map-toolbar-meta {
  color: #4e647b;
  fill: #4e647b;
}

.qb-filter-bar {
  display: grid;
  gap: 8px;
  padding: 10px;
  border: 1px solid rgba(145, 178, 206, 0.26);
  border-radius: 14px;
  background:
    radial-gradient(circle at 10% 10%, rgba(117, 194, 250, 0.16), transparent 38%),
    linear-gradient(150deg, rgba(126, 158, 186, 0.14), rgba(126, 158, 186, 0.04));
  box-shadow: 0 10px 22px rgba(6, 10, 15, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.qb-filter-top {
  display: flex;
  gap: 8px;
  align-items: center;
}

.qb-search-wrap {
  position: relative;
  display: flex;
  align-items: center;
  flex: 1 1 auto;
  min-width: 0;
}

.qb-filter-icon {
  position: absolute;
  right: 12px;
  display: inline-flex;
  pointer-events: none;
  color: var(--text-muted);
}

.qb-filter-icon svg {
  width: 16px;
  height: 16px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.qb-search-input {
  width: 100%;
  padding-right: 36px;
  border-radius: 11px;
  min-height: 34px;
  background: rgba(127, 127, 127, 0.1);
  border-color: rgba(145, 178, 206, 0.25);
  transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
}

.qb-search-input:focus {
  border-color: rgba(93, 182, 242, 0.56);
  box-shadow: 0 0 0 3px rgba(93, 182, 242, 0.14);
  background: rgba(127, 127, 127, 0.12);
}

.qb-filter-actions {
  display: grid;
  grid-template-columns: minmax(280px, 1fr) auto auto auto;
  gap: 8px;
  align-items: stretch;
  flex: 1 1 auto;
  min-width: 0;
}

.qb-topic-panel {
  display: grid;
  gap: 6px;
  padding: 7px;
  min-width: 280px;
  border-radius: 12px;
  border: 1px solid rgba(145, 178, 206, 0.24);
  background:
    radial-gradient(circle at 14% 24%, rgba(98, 194, 248, 0.2), transparent 42%),
    linear-gradient(150deg, rgba(127, 127, 127, 0.12), rgba(127, 127, 127, 0.05));
}

.qb-topic-panel-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.qb-topic-panel-title {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 0.76rem;
  color: var(--text-main);
}

.qb-topic-panel-title svg {
  width: 12px;
  height: 12px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.qb-topic-active-pill {
  display: inline-flex;
  align-items: center;
  max-width: min(42vw, 220px);
  min-height: 22px;
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid rgba(116, 205, 255, 0.3);
  background: rgba(116, 205, 255, 0.14);
  color: #caedff;
  font-size: 0.68rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.qb-topic-panel-controls {
  display: grid;
  gap: 6px;
}

.qb-topic-wrap {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 2px 6px;
  border-radius: 11px;
  border: 1px solid rgba(145, 178, 206, 0.23);
  background: rgba(127, 127, 127, 0.08);
}

.qb-topic-label {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 0.72rem;
  color: var(--text-muted);
  white-space: nowrap;
}

.qb-topic-label svg {
  width: 12px;
  height: 12px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.qb-topic-select {
  min-height: 28px;
  min-width: 0;
  width: 100%;
  border-radius: 999px;
  padding: 3px 26px 3px 8px;
  border: 1px solid rgba(145, 178, 206, 0.25);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-main);
  font-size: 0.72rem;
}

.qb-topic-select:focus {
  border-color: rgba(93, 182, 242, 0.56);
  box-shadow: 0 0 0 3px rgba(93, 182, 242, 0.14);
}

.qb-topic-quick {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 5px;
}

.qb-topic-quick-btn {
  min-height: 25px;
  max-width: 150px;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.28);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-muted);
  font-size: 0.67rem;
  font-weight: 700;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease;
}

.qb-topic-quick-btn:hover {
  transform: translateY(-1px);
  border-color: rgba(93, 182, 242, 0.5);
  background: rgba(93, 182, 242, 0.16);
}

.qb-topic-quick-btn.is-active {
  border-color: rgba(102, 196, 250, 0.56);
  background: rgba(102, 196, 250, 0.24);
  color: #d9f4ff;
}

.qb-solved-wrap {
  display: grid;
  align-content: center;
  gap: 5px;
  padding: 6px 8px;
  border-radius: 11px;
  border: 1px solid rgba(145, 178, 206, 0.23);
  background: rgba(127, 127, 127, 0.08);
}

.qb-solved-label {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 0.72rem;
  color: var(--text-muted);
  white-space: nowrap;
}

.qb-solved-label svg {
  width: 12px;
  height: 12px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.qb-solved-group {
  display: inline-flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 4px;
}

.qb-solved-chip {
  min-height: 26px;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid transparent;
  background: transparent;
  color: var(--text-muted);
  font-size: 0.69rem;
  font-weight: 700;
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, color 0.2s ease;
}

.qb-solved-chip:hover {
  transform: translateY(-1px);
  border-color: rgba(93, 182, 242, 0.42);
  color: var(--text-main);
}

.qb-solved-chip.is-active {
  border-color: rgba(93, 182, 242, 0.56);
  background: rgba(93, 182, 242, 0.16);
  color: var(--text-main);
}

.qb-sort-wrap {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 2px 6px;
  border-radius: 11px;
  border: 1px solid rgba(145, 178, 206, 0.23);
  background: rgba(127, 127, 127, 0.08);
}

.qb-sort-label {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 0.72rem;
  color: var(--text-muted);
  white-space: nowrap;
}

.qb-sort-label svg {
  width: 12px;
  height: 12px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.qb-sort-group {
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.qb-sort-chip {
  min-height: 28px;
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid transparent;
  background: transparent;
  color: var(--text-muted);
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 0.72rem;
  white-space: nowrap;
  transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
}

.qb-sort-chip svg {
  width: 12px;
  height: 12px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.qb-sort-chip:hover {
  transform: translateY(-1px);
  border-color: rgba(93, 182, 242, 0.42);
  color: var(--text-main);
}

.qb-sort-chip.is-active {
  border-color: rgba(93, 182, 242, 0.6);
  color: var(--text-main);
  background: rgba(93, 182, 242, 0.16);
  box-shadow: 0 6px 14px rgba(8, 30, 45, 0.2);
}

.qb-clear-btn {
  min-height: 34px;
  padding: 6px 10px;
  border-radius: 11px;
  border: 1px solid rgba(145, 178, 206, 0.25);
  background: rgba(127, 127, 127, 0.12);
  color: var(--text-main);
  font-size: 0.75rem;
  display: inline-flex;
  align-items: center;
  gap: 5px;
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
}

.qb-clear-btn svg {
  width: 12px;
  height: 12px;
  stroke: currentColor;
  stroke-width: 2;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.qb-clear-btn:hover {
  transform: translateY(-1px) scale(1.01);
  border-color: rgba(93, 182, 242, 0.52);
  background: rgba(93, 182, 242, 0.16);
  box-shadow: 0 8px 18px rgba(8, 34, 52, 0.24);
}

.qb-filter-difficulty {
  display: grid;
  gap: 6px;
  padding: 6px 8px;
  border: 1px solid rgba(145, 178, 206, 0.2);
  border-radius: 11px;
  background: rgba(127, 127, 127, 0.06);
}

.qb-filter-caption {
  font-size: 0.72rem;
  font-weight: 600;
  color: var(--text-muted);
}

.qb-overview {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(128px, 1fr));
  gap: 8px;
}

.qb-stat-chip {
  border: 1px solid var(--line);
  border-radius: 12px;
  background: rgba(127, 127, 127, 0.08);
  padding: 8px 10px;
  display: grid;
  gap: 2px;
}

.qb-stat-label {
  font-size: 0.74rem;
  color: var(--text-muted);
}

.qb-stat-value {
  font-size: 0.96rem;
  font-weight: 700;
}

.qb-empty-reset-row {
  display: flex;
  justify-content: center;
}

html[data-theme^="light-"] .qb-filter-bar {
  border-color: rgba(46, 85, 117, 0.18);
  background:
    radial-gradient(circle at 10% 10%, rgba(100, 178, 235, 0.14), transparent 38%),
    linear-gradient(150deg, rgba(255, 255, 255, 0.9), rgba(244, 249, 255, 0.84));
  box-shadow: 0 14px 26px rgba(20, 54, 85, 0.12);
}

html[data-theme^="light-"] .qb-search-input,
html[data-theme^="light-"] .qb-stat-chip,
html[data-theme^="light-"] .qb-filter-difficulty {
  background: rgba(255, 255, 255, 0.84);
}

html[data-theme^="light-"] .qb-sort-wrap {
  background: rgba(255, 255, 255, 0.82);
}

html[data-theme^="light-"] .qb-solved-wrap {
  background: rgba(255, 255, 255, 0.82);
}

html[data-theme^="light-"] .qb-topic-panel {
  border-color: rgba(50, 94, 128, 0.2);
  background:
    radial-gradient(circle at 14% 24%, rgba(47, 130, 193, 0.16), transparent 42%),
    linear-gradient(150deg, rgba(255, 255, 255, 0.92), rgba(246, 251, 255, 0.86));
}

html[data-theme^="light-"] .qb-topic-wrap {
  background: rgba(255, 255, 255, 0.82);
}

html[data-theme^="light-"] .qb-topic-select {
  background: rgba(255, 255, 255, 0.84);
  border-color: rgba(50, 94, 128, 0.2);
}

html[data-theme^="light-"] .qb-topic-active-pill {
  border-color: rgba(47, 130, 193, 0.28);
  background: rgba(47, 130, 193, 0.14);
  color: #225b84;
}

html[data-theme^="light-"] .qb-topic-quick-btn {
  border-color: rgba(50, 94, 128, 0.24);
  background: rgba(255, 255, 255, 0.86);
  color: #43647f;
}

html[data-theme^="light-"] .qb-topic-quick-btn.is-active {
  border-color: rgba(47, 130, 193, 0.42);
  background: rgba(47, 130, 193, 0.18);
  color: #1f5f8b;
}

html[data-theme^="light-"] .qb-solved-chip {
  color: #4c6b85;
}

html[data-theme^="light-"] .qb-solved-chip.is-active {
  border-color: rgba(47, 130, 193, 0.42);
  background: rgba(47, 130, 193, 0.18);
  color: #1f5f8b;
}

html[data-theme^="light-"] .qb-clear-btn {
  background: rgba(255, 255, 255, 0.78);
}

html[data-theme^="light-"] .qb-pill {
  background: rgba(255, 255, 255, 0.84);
  border-color: rgba(50, 94, 128, 0.2);
}

.meta-row {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  color: var(--text-muted);
  font-size: 0.88rem;
}

.question-list {
  display: grid;
  gap: 12px;
}

.question-card {
  position: relative;
  overflow: hidden;
  padding: 12px;
  border: 1px solid rgba(138, 172, 201, 0.24);
  border-radius: 15px;
  background:
    radial-gradient(circle at 88% 9%, rgba(119, 202, 255, 0.12), transparent 36%),
    linear-gradient(152deg, rgba(127, 127, 127, 0.12), rgba(127, 127, 127, 0.04));
  box-shadow: 0 12px 25px rgba(6, 10, 15, 0.22), inset 0 1px 0 rgba(255, 255, 255, 0.05);
  contain: content;
  transition: transform 0.22s ease, box-shadow 0.22s ease, border-color 0.22s ease, background-color 0.22s ease;
}

.question-card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 16px;
  width: 168px;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.62), transparent);
  opacity: 0.54;
  pointer-events: none;
}

.question-card::after {
  content: "";
  position: absolute;
  right: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  border-radius: 999px;
  background: linear-gradient(180deg, rgba(102, 189, 245, 0.84), rgba(102, 189, 245, 0.2));
  opacity: 0.56;
  transition: opacity 0.22s ease, filter 0.22s ease;
  pointer-events: none;
}

.question-card:hover {
  transform: translateY(-2px) scale(1.002);
  border-color: rgba(125, 186, 234, 0.52);
  box-shadow: 0 16px 30px rgba(5, 10, 16, 0.28), inset 0 1px 0 rgba(255, 255, 255, 0.07);
}

.question-card:hover::after {
  opacity: 0.86;
  filter: saturate(122%);
}

html[data-theme^="light-"] .question-card {
  border-color: rgba(44, 84, 115, 0.2);
  background:
    radial-gradient(circle at 88% 9%, rgba(53, 141, 207, 0.14), transparent 36%),
    linear-gradient(152deg, rgba(255, 255, 255, 0.92), rgba(245, 249, 255, 0.86));
  box-shadow: 0 13px 26px rgba(30, 65, 97, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

html[data-theme^="light-"] .question-card::after {
  background: linear-gradient(180deg, rgba(53, 141, 207, 0.75), rgba(53, 141, 207, 0.2));
}

.question-head {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 9px;
  padding-bottom: 8px;
  border-bottom: 1px dashed rgba(138, 172, 201, 0.24);
}

.question-head-main,
.question-head-tools {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.question-head-main {
  flex-wrap: wrap;
  min-width: 0;
}

.question-index {
  display: inline-flex;
  align-items: center;
  min-height: 26px;
  padding: 3px 10px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.3);
  background: rgba(127, 127, 127, 0.12);
  font-weight: 700;
  font-size: 0.82rem;
  letter-spacing: 0.01em;
}

.question-solved-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.3);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-muted);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.question-solved-badge svg {
  width: 14px;
  height: 14px;
  stroke: currentColor;
  stroke-width: 2;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.question-solved-badge.is-solved {
  border-color: rgba(89, 214, 153, 0.52);
  background: linear-gradient(142deg, rgba(89, 214, 153, 0.24), rgba(89, 214, 153, 0.08));
  color: #92f1c0;
}

.question-solved-badge.is-unsolved {
  border-color: rgba(156, 177, 196, 0.34);
  background: rgba(127, 127, 127, 0.08);
}

.question-solved-toggle {
  min-height: 25px;
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid rgba(145, 178, 206, 0.28);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-muted);
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 0.68rem;
  font-weight: 700;
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, color 0.2s ease;
}

.question-solved-toggle svg {
  width: 12px;
  height: 12px;
  stroke: currentColor;
  stroke-width: 2;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.question-solved-toggle:hover {
  transform: translateY(-1px);
  border-color: rgba(93, 182, 242, 0.46);
  color: var(--text-main);
}

.question-solved-toggle.is-solved {
  border-color: rgba(89, 214, 153, 0.54);
  background: linear-gradient(142deg, rgba(89, 214, 153, 0.2), rgba(89, 214, 153, 0.08));
  color: #94f2c2;
}

html[data-theme^="light-"] .question-solved-badge {
  border-color: rgba(47, 130, 193, 0.24);
  background: rgba(255, 255, 255, 0.88);
  color: #5d7d97;
}

html[data-theme^="light-"] .question-solved-badge.is-solved {
  border-color: rgba(49, 166, 115, 0.42);
  background: rgba(49, 166, 115, 0.14);
  color: #2e875f;
}

html[data-theme^="light-"] .question-solved-toggle {
  border-color: rgba(47, 130, 193, 0.22);
  background: rgba(255, 255, 255, 0.84);
  color: #516f88;
}

.question-topic-chip {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  min-height: 26px;
  max-width: min(48vw, 420px);
  padding: 3px 10px;
  border-radius: 999px;
  border: 1px solid rgba(116, 205, 255, 0.34);
  background: linear-gradient(140deg, rgba(116, 205, 255, 0.2), rgba(116, 205, 255, 0.06));
  color: #d7f2ff;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
}

.question-topic-chip svg {
  width: 12px;
  height: 12px;
  flex: 0 0 auto;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
  opacity: 0.9;
}

.question-topic-chip-text {
  display: inline-block;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-size: 0.74rem;
  font-weight: 700;
  letter-spacing: 0.01em;
}

.stars {
  display: inline-flex;
  align-items: center;
  min-height: 24px;
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid rgba(255, 201, 94, 0.36);
  background: linear-gradient(145deg, rgba(255, 201, 94, 0.16), rgba(255, 201, 94, 0.06));
  font-size: 0.9rem;
  color: #ffc95e;
  letter-spacing: 0.04em;
}

.question-body,
.disclosure {
  line-height: 1.85;
  font-size: 0.95rem;
}

.question-topic-row {
  margin-bottom: 7px;
}

.question-topic-tag {
  display: inline-flex;
  align-items: center;
  min-height: 24px;
  padding: 2px 9px;
  border-radius: 999px;
  border: 1px solid rgba(116, 205, 255, 0.34);
  background: linear-gradient(140deg, rgba(116, 205, 255, 0.16), rgba(116, 205, 255, 0.05));
  color: #cdeeff;
  font-size: 0.76rem;
  font-weight: 700;
  letter-spacing: 0.01em;
}

.question-solve-strip {
  position: relative;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
  padding: 9px 10px;
  border: 1px solid rgba(138, 172, 201, 0.26);
  border-radius: 13px;
  background:
    radial-gradient(circle at 12% 24%, rgba(102, 196, 250, 0.22), transparent 44%),
    linear-gradient(152deg, rgba(127, 127, 127, 0.12), rgba(127, 127, 127, 0.06));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
  overflow: hidden;
}

.question-solve-strip::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.09) 50%, transparent 100%);
  opacity: 0;
  transform: translateX(-32%);
  transition: opacity 0.22s ease;
  pointer-events: none;
}

.question-solve-strip.is-running {
  border-color: rgba(102, 196, 250, 0.58);
  box-shadow: 0 11px 21px rgba(7, 26, 40, 0.24), inset 0 1px 0 rgba(255, 255, 255, 0.14);
}

.question-solve-strip.is-running::before {
  opacity: 1;
}

.question-solve-main {
  display: inline-flex;
  align-items: center;
  gap: 9px;
}

.question-solve-orb {
  position: relative;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex: 0 0 auto;
}

.question-solve-orb-core {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: linear-gradient(140deg, #5fd3ff, #7ff0d2);
  box-shadow: 0 0 0 4px rgba(95, 211, 255, 0.16), 0 0 14px rgba(95, 211, 255, 0.34);
}

.question-solve-orb-wave {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  border: 1px solid rgba(95, 211, 255, 0.36);
  opacity: 0.44;
  transform: scale(0.84);
}

.question-solve-strip.is-running .question-solve-orb-wave {
  animation: timer-orb-wave 1.6s ease-out infinite;
}

.question-solve-copy {
  display: grid;
  gap: 2px;
  min-width: 0;
}

.question-solve-label {
  color: var(--text-muted);
  font-size: 0.72rem;
}

.question-solve-value {
  min-width: 92px;
  text-align: right;
  font-size: 0.96rem;
  letter-spacing: 0.08em;
  color: #d6f3ff;
  direction: ltr;
  font-variant-numeric: tabular-nums lining-nums;
  font-feature-settings: "tnum" 1, "lnum" 1;
  font-family: "Vazirmatn", "Segoe UI", Tahoma, sans-serif;
}

.question-solve-state {
  font-size: 0.68rem;
  color: var(--text-muted);
}

.question-solve-actions {
  display: inline-flex;
  flex-wrap: nowrap;
  align-items: center;
  justify-content: flex-end;
  gap: 7px;
}

.question-solve-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-height: 30px;
  min-width: 60px;
  padding: 5px 10px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.3);
  background: rgba(127, 127, 127, 0.14);
  color: var(--text-main);
  font-size: 0.73rem;
  font-weight: 700;
  white-space: nowrap;
  box-sizing: border-box;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
}

.question-solve-btn:hover {
  transform: translateY(-1px) scale(1.01);
  border-color: rgba(100, 191, 247, 0.58);
  box-shadow: 0 6px 14px rgba(8, 22, 34, 0.22);
}

.question-solve-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.question-solve-btn-start {
  border-color: rgba(102, 196, 250, 0.48);
  background: rgba(102, 196, 250, 0.2);
}

.question-solve-btn-pause {
  border-color: rgba(255, 205, 124, 0.48);
  background: rgba(255, 205, 124, 0.18);
}

.question-solve-btn-reset {
  border-color: rgba(255, 141, 159, 0.44);
  background: rgba(255, 141, 159, 0.16);
}

.question-float-timer {
  --timer-progress-deg: 0deg;
  position: fixed;
  top: calc(env(safe-area-inset-top, 0px) + 86px);
  left: 12px;
  width: 86px;
  height: 86px;
  border-radius: 50%;
  padding: 3px;
  display: grid;
  place-items: center;
  background: conic-gradient(
    from -90deg,
    rgba(106, 213, 255, 0.96) 0deg,
    rgba(126, 244, 214, 0.96) var(--timer-progress-deg),
    rgba(78, 106, 130, 0.28) var(--timer-progress-deg),
    rgba(78, 106, 130, 0.28) 360deg
  );
  box-shadow: 0 14px 25px rgba(4, 12, 20, 0.34), 0 0 0 1px rgba(136, 178, 209, 0.32);
  z-index: 90;
  opacity: 0;
  transform: translateY(-8px) scale(0.9);
  pointer-events: none;
  transition: opacity 0.2s ease, transform 0.24s ease;
}

.question-float-timer.is-visible {
  opacity: 1;
  transform: translateY(0) scale(1);
}

.question-float-ring {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  overflow: hidden;
}

.question-float-ring i {
  position: absolute;
  inset: 16%;
  border-radius: 50%;
  border: 1px solid rgba(255, 255, 255, 0.28);
  animation: float-timer-ring 2.4s ease-in-out infinite;
}

.question-float-core {
  width: 100%;
  height: 100%;
  border-radius: inherit;
  background:
    radial-gradient(circle at 28% 20%, rgba(95, 211, 255, 0.22), transparent 40%),
    linear-gradient(150deg, rgba(9, 17, 26, 0.9), rgba(11, 19, 29, 0.84));
  border: 1px solid rgba(150, 196, 228, 0.28);
  display: grid;
  align-content: center;
  justify-items: center;
  gap: 1px;
}

.question-float-label {
  font-size: 0.56rem;
  color: rgba(198, 229, 248, 0.82);
}

.question-float-value {
  font-size: 0.82rem;
  font-weight: 800;
  letter-spacing: 0.07em;
  direction: ltr;
  color: #dcf5ff;
  font-variant-numeric: tabular-nums lining-nums;
  font-feature-settings: "tnum" 1, "lnum" 1;
  font-family: "Vazirmatn", "Segoe UI", Tahoma, sans-serif;
}

.question-float-meta {
  font-size: 0.54rem;
  color: rgba(189, 226, 249, 0.74);
}

@keyframes timer-orb-wave {
  0% {
    opacity: 0.62;
    transform: scale(0.84);
  }
  100% {
    opacity: 0;
    transform: scale(1.28);
  }
}

@keyframes float-timer-ring {
  0%,
  100% {
    opacity: 0.38;
    transform: scale(0.96);
  }
  50% {
    opacity: 0.14;
    transform: scale(1.06);
  }
}

.question-body {
  border: 1px solid rgba(138, 172, 201, 0.2);
  border-radius: 11px;
  background: rgba(127, 127, 127, 0.07);
  padding: 9px 10px;
}

html[data-theme^="light-"] .question-body {
  border-color: rgba(44, 84, 115, 0.16);
  background: rgba(255, 255, 255, 0.76);
}

html[data-theme^="light-"] .question-topic-tag {
  border-color: rgba(47, 130, 193, 0.26);
  background: linear-gradient(140deg, rgba(47, 130, 193, 0.14), rgba(47, 130, 193, 0.04));
  color: #25618d;
}

html[data-theme^="light-"] .question-topic-chip {
  border-color: rgba(47, 130, 193, 0.28);
  background: linear-gradient(140deg, rgba(47, 130, 193, 0.16), rgba(255, 255, 255, 0.8));
  color: #245e88;
}

html[data-theme^="light-"] .question-solve-strip {
  border-color: rgba(47, 82, 111, 0.22);
  background:
    radial-gradient(circle at 11% 24%, rgba(47, 130, 193, 0.16), transparent 45%),
    linear-gradient(150deg, rgba(255, 255, 255, 0.92), rgba(246, 251, 255, 0.82));
}

html[data-theme^="light-"] .question-solve-strip.is-running {
  border-color: rgba(47, 130, 193, 0.36);
  box-shadow: 0 11px 20px rgba(23, 57, 84, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.92);
}

html[data-theme^="light-"] .question-solve-value {
  color: #1f628f;
}

html[data-theme^="light-"] .question-solve-state {
  color: #416e90;
}

html[data-theme^="light-"] .question-solve-orb-core {
  box-shadow: 0 0 0 4px rgba(47, 130, 193, 0.16), 0 0 14px rgba(47, 130, 193, 0.28);
}

html[data-theme^="light-"] .question-float-timer {
  background: conic-gradient(
    from -90deg,
    rgba(47, 130, 193, 0.92) 0deg,
    rgba(61, 176, 149, 0.92) var(--timer-progress-deg),
    rgba(166, 198, 223, 0.45) var(--timer-progress-deg),
    rgba(166, 198, 223, 0.45) 360deg
  );
  box-shadow: 0 13px 24px rgba(31, 70, 101, 0.2), 0 0 0 1px rgba(47, 82, 111, 0.24);
}

html[data-theme^="light-"] .question-float-core {
  background:
    radial-gradient(circle at 24% 18%, rgba(47, 130, 193, 0.2), transparent 42%),
    linear-gradient(155deg, rgba(255, 255, 255, 0.94), rgba(246, 251, 255, 0.9));
  border-color: rgba(47, 82, 111, 0.22);
}

html[data-theme^="light-"] .question-float-label {
  color: #3f6c8d;
}

html[data-theme^="light-"] .question-float-value {
  color: #1f628f;
}

html[data-theme^="light-"] .question-float-meta {
  color: #4a7697;
}

.text-line {
  margin: 0 0 0.5em;
}

.text-line:last-child {
  margin-bottom: 0;
}

.math-node {
  direction: ltr;
  unicode-bidi: isolate;
  display: inline-block;
  max-width: 100%;
  overflow-x: auto;
  vertical-align: middle;
}

.math-node[data-display="1"] {
  display: block;
  margin: 8px 0;
}

.question-tools {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 9px;
  padding-top: 8px;
  border-top: 1px dashed rgba(138, 172, 201, 0.22);
}

.qb-check {
  position: relative;
  width: 22px;
  height: 22px;
  flex: 0 0 22px;
}

.qb-check-input {
  position: absolute;
  inset: 0;
  min-height: 0;
  width: 100%;
  padding: 0;
  border: 0;
  background: transparent;
  opacity: 0;
  margin: 0;
  cursor: pointer;
  z-index: 2;
}

.qb-check-ui {
  position: absolute;
  inset: 0;
  border-radius: 7px;
  border: 1px solid var(--line);
  background: var(--surface-soft);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: border-color 0.2s ease, background-color 0.2s ease, transform 0.2s ease;
}

.qb-check-ui svg {
  width: 13px;
  height: 13px;
  stroke: #fff;
  stroke-width: 2.4;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
  opacity: 0;
  transform: scale(0.7);
  transition: opacity 0.18s ease, transform 0.18s ease;
}

.qb-check-input:focus-visible + .qb-check-ui {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-soft);
}

.qb-check-input:checked + .qb-check-ui {
  border-color: var(--accent);
  background: var(--accent);
}

.qb-check-input:checked + .qb-check-ui svg {
  opacity: 1;
  transform: scale(1);
}

.bulk-delete-bar {
  position: sticky;
  bottom: 10px;
  z-index: 8;
  margin-top: 0;
  padding: 0 10px;
  max-height: 0;
  overflow: hidden;
  border-radius: 13px;
  border: 1px solid transparent;
  background: rgba(20, 29, 39, 0.78);
  box-shadow: 0 12px 28px rgba(4, 8, 12, 0.28);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  opacity: 0;
  transform: translateY(8px);
  pointer-events: none;
  transition: opacity 0.22s ease, transform 0.22s ease, max-height 0.22s ease, padding 0.22s ease, margin 0.22s ease;
}

.bulk-delete-bar.is-active {
  margin-top: 8px;
  padding: 10px;
  max-height: 72px;
  border-color: var(--line);
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

html[data-theme^="light-"] .bulk-delete-bar {
  background: rgba(255, 255, 255, 0.86);
}

.bulk-delete-count {
  font-size: 0.84rem;
  color: var(--text-muted);
}

.bulk-delete-btn {
  min-height: 34px;
  padding: 6px 12px;
  border-radius: 10px;
  border: 1px solid rgba(255, 123, 143, 0.44);
  background: rgba(255, 106, 126, 0.14);
  color: #ff97a8;
}

.bulk-delete-btn:disabled {
  opacity: 0.45;
}

.bulk-delete-btn-danger {
  border-color: rgba(255, 97, 120, 0.54);
  background: linear-gradient(145deg, rgba(255, 97, 120, 0.22), rgba(255, 97, 120, 0.1));
  color: #ffb3be;
}

.question-danger-zone {
  margin-top: 8px;
  border: 1px solid rgba(255, 112, 134, 0.28);
  border-radius: 12px;
  background:
    radial-gradient(circle at 92% 14%, rgba(255, 112, 134, 0.18), transparent 38%),
    linear-gradient(154deg, rgba(127, 127, 127, 0.11), rgba(127, 127, 127, 0.04));
  padding: 10px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.question-danger-copy {
  min-width: 0;
  display: grid;
  gap: 3px;
}

.question-danger-copy strong {
  font-size: 0.84rem;
  color: #ffd5dd;
}

.question-danger-copy span {
  font-size: 0.75rem;
  color: var(--text-muted);
}

html[data-theme^="light-"] .question-danger-zone {
  border-color: rgba(191, 89, 106, 0.28);
  background:
    radial-gradient(circle at 92% 14%, rgba(211, 95, 113, 0.14), transparent 38%),
    linear-gradient(154deg, rgba(255, 255, 255, 0.94), rgba(246, 250, 255, 0.88));
}

html[data-theme^="light-"] .question-danger-copy strong {
  color: #a13d50;
}

.tool-btn {
  min-height: 34px;
  padding: 6px 10px;
  border-radius: 10px;
  border: 1px solid var(--line);
  background: rgba(127, 127, 127, 0.08);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  font-size: 0.79rem;
  font-weight: 600;
  color: var(--text-main);
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
}

.tool-btn:hover {
  transform: translateY(-1px);
}

.tool-btn-hint {
  border-color: rgba(102, 189, 245, 0.34);
  background: linear-gradient(145deg, rgba(102, 189, 245, 0.17), rgba(102, 189, 245, 0.07));
}

.tool-btn-solution {
  border-color: rgba(102, 224, 178, 0.34);
  background: linear-gradient(145deg, rgba(102, 224, 178, 0.17), rgba(102, 224, 178, 0.07));
}

.tool-btn-hint.is-open {
  border-color: rgba(112, 208, 255, 0.66);
  background: linear-gradient(145deg, rgba(112, 208, 255, 0.26), rgba(112, 208, 255, 0.12));
  box-shadow: 0 9px 18px rgba(11, 44, 68, 0.26);
}

.tool-btn-solution.is-open {
  border-color: rgba(116, 233, 191, 0.62);
  background: linear-gradient(145deg, rgba(116, 233, 191, 0.24), rgba(116, 233, 191, 0.1));
  box-shadow: 0 9px 18px rgba(9, 45, 33, 0.24);
}

.disclosure {
  position: relative;
  margin-top: 8px;
  padding: 28px 11px 10px;
  border: 1px solid var(--line);
  border-radius: 12px;
  background: rgba(127, 127, 127, 0.08);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
  overflow: hidden;
}

.disclosure::before {
  position: absolute;
  top: 6px;
  right: 8px;
  min-height: 20px;
  padding: 2px 8px;
  border-radius: 999px;
  font-size: 0.7rem;
  font-weight: 700;
  line-height: 1.35;
  display: inline-flex;
  align-items: center;
}

.disclosure::after {
  content: "";
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  border-radius: 999px;
}

.disclosure-hint {
  border-color: rgba(96, 187, 246, 0.34);
  background:
    radial-gradient(circle at 88% 8%, rgba(113, 198, 250, 0.16), transparent 34%),
    linear-gradient(155deg, rgba(102, 189, 245, 0.12), rgba(102, 189, 245, 0.04));
}

.disclosure-hint::before {
  content: none;
  display: none;
}

.disclosure-hint::after {
  background: linear-gradient(180deg, rgba(102, 189, 245, 0.85), rgba(102, 189, 245, 0.28));
}

.disclosure-solution {
  border-color: rgba(102, 224, 178, 0.35);
  background:
    radial-gradient(circle at 88% 8%, rgba(126, 229, 189, 0.14), transparent 34%),
    linear-gradient(155deg, rgba(102, 224, 178, 0.11), rgba(102, 224, 178, 0.04));
}

.disclosure-solution::before {
  content: none;
  display: none;
}

.disclosure-solution::after {
  background: linear-gradient(180deg, rgba(102, 224, 178, 0.84), rgba(102, 224, 178, 0.26));
}

.disclosure.is-open {
  animation: disclosure-reveal 0.24s ease;
}

html[data-theme^="light-"] .tool-btn-hint {
  border-color: rgba(45, 128, 192, 0.28);
  background: linear-gradient(145deg, rgba(45, 128, 192, 0.15), rgba(45, 128, 192, 0.06));
}

html[data-theme^="light-"] .tool-btn-solution {
  border-color: rgba(58, 153, 113, 0.28);
  background: linear-gradient(145deg, rgba(58, 153, 113, 0.15), rgba(58, 153, 113, 0.06));
}

html[data-theme^="light-"] .disclosure-hint {
  border-color: rgba(45, 128, 192, 0.28);
  background:
    radial-gradient(circle at 88% 8%, rgba(45, 128, 192, 0.14), transparent 34%),
    linear-gradient(155deg, rgba(45, 128, 192, 0.11), rgba(255, 255, 255, 0.74));
}

html[data-theme^="light-"] .disclosure-solution {
  border-color: rgba(58, 153, 113, 0.28);
  background:
    radial-gradient(circle at 88% 8%, rgba(58, 153, 113, 0.12), transparent 34%),
    linear-gradient(155deg, rgba(58, 153, 113, 0.1), rgba(255, 255, 255, 0.74));
}

@keyframes disclosure-reveal {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.disclosure[hidden] {
  display: none;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
}

.pagination .pager-info {
  min-width: 110px;
  text-align: center;
  color: var(--text-muted);
}

.empty-state {
  border: 1px dashed var(--line);
  border-radius: 12px;
  padding: 18px;
  text-align: center;
  color: var(--text-muted);
}

.exam-form {
  padding: 10px;
  border: 1px solid var(--line);
  border-radius: 12px;
  background: var(--surface-soft);
}

.status-bar {
  min-height: 24px;
  margin-top: 10px;
  color: var(--text-muted);
  font-size: 0.84rem;
}

.status-bar[data-error="1"] {
  color: var(--danger);
}

.status-bar[data-ok="1"] {
  color: var(--ok);
}

.loader {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  color: var(--text-muted);
}

.loader::before {
  content: "";
  width: 14px;
  height: 14px;
  border: 2px solid var(--line);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.9s linear infinite;
}

.deletable-node {
  transition: opacity 0.22s ease, transform 0.22s ease, filter 0.22s ease;
}

.deletable-node.is-removing {
  opacity: 0;
  transform: translateY(-6px) scale(0.985);
  filter: blur(1px);
}

.toast-stack {
  position: fixed;
  left: 18px;
  bottom: 18px;
  z-index: 120;
  display: grid;
  gap: 8px;
  width: min(320px, calc(100vw - 32px));
  pointer-events: none;
}

.toast-item {
  border-radius: 12px;
  border: 1px solid var(--line);
  padding: 10px 12px;
  background: rgba(17, 26, 36, 0.86);
  color: var(--text-main);
  font-size: 0.84rem;
  box-shadow: 0 10px 24px rgba(5, 9, 14, 0.3);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.22s ease, transform 0.22s ease;
}

.toast-item.toast-item-action {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  pointer-events: auto;
}

.toast-item .toast-text {
  min-width: 0;
}

.toast-action-btn {
  flex: 0 0 auto;
  border: 1px solid rgba(116, 186, 241, 0.5);
  border-radius: 999px;
  background: rgba(27, 52, 76, 0.88);
  color: #d8edff;
  padding: 5px 10px;
  font-size: 0.75rem;
  font-weight: 700;
  line-height: 1;
  cursor: pointer;
}

.toast-action-btn:hover {
  border-color: rgba(151, 214, 255, 0.72);
  background: rgba(36, 69, 100, 0.96);
}

.toast-action-btn:focus-visible {
  outline: 2px solid rgba(130, 208, 255, 0.76);
  outline-offset: 2px;
}

.toast-item.is-visible {
  opacity: 1;
  transform: translateY(0);
}

.toast-item.toast-success {
  border-color: rgba(77, 210, 143, 0.45);
}

.toast-item.toast-error {
  border-color: rgba(255, 122, 143, 0.45);
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

@media (max-width: 920px) {
  body:not(.force-desktop) .topbar {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .controls {
    justify-content: flex-start;
  }

  body:not(.force-desktop) .sync-grid {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .list-grid {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .premium-header-actions {
    justify-items: stretch;
  }

  body:not(.force-desktop) .header-quick-actions {
    flex-wrap: nowrap;
    overflow-x: auto;
    padding-bottom: 2px;
    scrollbar-width: thin;
  }

  body:not(.force-desktop) .header-quickline {
    gap: 4px;
  }

  body:not(.force-desktop) .settings-panel {
    width: 100%;
  }

  body:not(.force-desktop) .settings-panel-layout {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .settings-tab-strip {
    flex-wrap: wrap;
  }

  body:not(.force-desktop) .settings-grid {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .settings-overview-strip {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .settings-trigger {
    width: 100%;
    justify-content: flex-start;
  }

  body:not(.force-desktop) .cloud-sync-grid {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .settings-cloud-layout {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .settings-sync-row-stack {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .settings-cloud-head {
    flex-wrap: wrap;
    justify-content: flex-start;
  }

  body:not(.force-desktop) .settings-utility-grid {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .settings-inline-actions .glass-btn,
  body:not(.force-desktop) .settings-sync-row .glass-btn {
    min-width: 100%;
  }

  body:not(.force-desktop) .chapter-map-layout {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .chapter-map-search-wrap {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .chapter-map-actions {
    justify-content: stretch;
  }

  body:not(.force-desktop) .chapter-map-action-btn {
    flex: 1 1 0;
    justify-content: center;
  }

  body:not(.force-desktop) .chapter-map-legend {
    min-height: 0;
  }

  body:not(.force-desktop) .subjects-premium-grid {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .subject-add-action {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .subject-add-btn {
    width: 100%;
  }

  body:not(.force-desktop) .profile-grid {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .profile-orbit-shell {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .profile-orbit-side {
    grid-template-columns: 1fr;
    grid-template-areas:
      "avatar"
      "title"
      "subtitle"
      "greeting";
    gap: 7px;
    align-items: start;
  }

  body:not(.force-desktop) .profile-orbit-avatar {
    width: 48px;
    height: 48px;
  }

  body:not(.force-desktop) .profile-orbit-side h2 {
    font-size: 1.14rem;
  }

  body:not(.force-desktop) .profile-orbit-side p {
    font-size: 0.95rem;
  }

  body:not(.force-desktop) .profile-orbit .profile-greeting {
    font-size: 1rem;
  }

  body:not(.force-desktop) .profile-orbit-grid {
    grid-template-columns: 1fr;
    grid-column: auto;
  }

  body:not(.force-desktop) .profile-orbit-main {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .profile-orbit-tools {
    grid-template-columns: 1fr;
    grid-column: auto;
  }

  body:not(.force-desktop) .orbit-json-tools {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .json-text-actions {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .profile-inline-grid {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .qb-filter-bar {
    gap: 9px;
  }

  body:not(.force-desktop) .qb-filter-top {
    flex-direction: column;
    align-items: stretch;
  }

  body:not(.force-desktop) .qb-filter-actions {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .qb-topic-panel,
  body:not(.force-desktop) .qb-solved-wrap,
  body:not(.force-desktop) .qb-topic-wrap,
  body:not(.force-desktop) .qb-sort-wrap,
  body:not(.force-desktop) .qb-clear-btn {
    width: 100%;
    min-width: 0;
  }

  body:not(.force-desktop) .qb-topic-active-pill {
    max-width: 100%;
  }

  body:not(.force-desktop) .question-solve-strip {
    flex-direction: column;
    align-items: stretch;
  }

  body:not(.force-desktop) .question-solve-main,
  body:not(.force-desktop) .question-solve-actions {
    justify-content: space-between;
  }

  body:not(.force-desktop) .question-solve-copy {
    flex: 1 1 auto;
  }

  body:not(.force-desktop) .question-float-timer {
    top: calc(env(safe-area-inset-top, 0px) + 76px);
    left: 10px;
    width: 78px;
    height: 78px;
  }

  body:not(.force-desktop) .question-topic-chip {
    max-width: 100%;
  }

  body:not(.force-desktop) .lesson-dashboard-stats {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  body:not(.force-desktop) .lesson-add-action {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .lesson-chapter-grid {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .exam-builder-controls {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .exam-paper-brand-row {
    flex-direction: column;
    align-items: stretch;
  }

  body:not(.force-desktop) .exam-paper-meta-grid {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .exam-paper-instruction-grid {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .practice-focus-head {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .practice-profile-bar,
  body:not(.force-desktop) .practice-meta-strip {
    grid-template-columns: 1fr;
  }

  body:not(.force-desktop) .practice-focus-actions {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  body:not(.force-desktop) .practice-next-btn {
    grid-column: 1 / -1;
  }

  body:not(.force-desktop) .exam-paper-actions {
    flex-direction: column;
    align-items: stretch;
  }

  body:not(.force-desktop) .app-shell {
    width: min(980px, 95vw);
  }
}

body.force-mobile .topbar {
  grid-template-columns: 1fr;
}

body.force-mobile .controls {
  justify-content: flex-start;
}

body.force-mobile .sync-grid,
body.force-mobile .list-grid {
  grid-template-columns: 1fr;
}

body.force-mobile .profile-grid {
  grid-template-columns: 1fr;
}

body.force-mobile .profile-orbit-shell {
  grid-template-columns: 1fr;
}

body.force-mobile .profile-orbit-side {
  grid-template-columns: 1fr;
  grid-template-areas:
    "avatar"
    "title"
    "subtitle"
    "greeting";
  gap: 7px;
  align-items: start;
}

body.force-mobile .profile-orbit-avatar {
  width: 48px;
  height: 48px;
}

body.force-mobile .profile-orbit-side h2 {
  font-size: 1.14rem;
}

body.force-mobile .profile-orbit-side p {
  font-size: 0.95rem;
}

body.force-mobile .profile-orbit .profile-greeting {
  font-size: 1rem;
}

body.force-mobile .profile-orbit-grid {
  grid-template-columns: 1fr;
  grid-column: auto;
}

body.force-mobile .profile-orbit-main {
  grid-template-columns: 1fr;
}

body.force-mobile .profile-orbit-tools {
  grid-template-columns: 1fr;
  grid-column: auto;
}

body.force-mobile .orbit-json-tools {
  grid-template-columns: 1fr;
}

body.force-mobile .json-text-actions {
  grid-template-columns: 1fr;
}

body.force-mobile .profile-inline-grid {
  grid-template-columns: 1fr;
}

body.force-mobile .settings-panel {
  width: 100%;
}

body.force-mobile .header-quick-actions {
  flex-wrap: nowrap;
  overflow-x: auto;
  padding-bottom: 2px;
  scrollbar-width: thin;
}

body.force-mobile .header-quickline {
  gap: 4px;
}

body.force-mobile .settings-panel-layout {
  grid-template-columns: 1fr;
}

body.force-mobile .settings-grid {
  grid-template-columns: 1fr;
}

body.force-mobile .settings-overview-strip {
  grid-template-columns: 1fr;
}

body.force-mobile .settings-cloud-layout {
  grid-template-columns: 1fr;
}

body.force-mobile .settings-sync-row-stack {
  grid-template-columns: 1fr;
}

body.force-mobile .settings-cloud-head {
  flex-wrap: wrap;
  justify-content: flex-start;
}

body.force-mobile .settings-utility-grid {
  grid-template-columns: 1fr;
}

body.force-mobile .settings-inline-actions .glass-btn,
body.force-mobile .settings-sync-row .glass-btn {
  min-width: 100%;
}

body.force-mobile .chapter-map-layout {
  grid-template-columns: 1fr;
}

body.force-mobile .chapter-map-search-wrap {
  grid-template-columns: 1fr;
}

body.force-mobile .chapter-map-actions {
  justify-content: stretch;
}

body.force-mobile .chapter-map-action-btn {
  flex: 1 1 0;
  justify-content: center;
}

body.force-mobile .chapter-map-legend {
  min-height: 0;
}

body.force-mobile .qb-filter-top {
  flex-direction: column;
  align-items: stretch;
}

body.force-mobile .qb-filter-actions {
  grid-template-columns: 1fr;
}

body.force-mobile .qb-topic-panel,
body.force-mobile .qb-solved-wrap,
body.force-mobile .qb-topic-wrap,
body.force-mobile .qb-sort-wrap,
body.force-mobile .qb-clear-btn {
  width: 100%;
  min-width: 0;
}

body.force-mobile .qb-topic-active-pill {
  max-width: 100%;
}

body.force-mobile .question-solve-strip {
  flex-direction: column;
  align-items: stretch;
}

body.force-mobile .question-solve-main,
body.force-mobile .question-solve-actions {
  justify-content: space-between;
}

body.force-mobile .question-solve-copy {
  flex: 1 1 auto;
}

body.force-mobile .question-float-timer {
  top: calc(env(safe-area-inset-top, 0px) + 76px);
  left: 10px;
  width: 78px;
  height: 78px;
}

body.force-mobile .question-topic-chip {
  max-width: 100%;
}

body.force-mobile .lesson-dashboard-stats {
  grid-template-columns: 1fr;
}

body.force-mobile .lesson-add-action {
  grid-template-columns: 1fr;
}

body.force-mobile .lesson-chapter-grid {
  grid-template-columns: 1fr;
}

body.force-mobile .exam-builder-controls {
  grid-template-columns: 1fr;
}

body.force-mobile .exam-paper-brand-row {
  flex-direction: column;
  align-items: stretch;
}

body.force-mobile .exam-paper-meta-grid {
  grid-template-columns: 1fr;
}

body.force-mobile .exam-paper-instruction-grid {
  grid-template-columns: 1fr;
}

body.force-mobile .practice-focus-head {
  grid-template-columns: 1fr;
}

body.force-mobile .practice-profile-bar,
body.force-mobile .practice-meta-strip {
  grid-template-columns: 1fr;
}

body.force-mobile .practice-focus-actions {
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

body.force-mobile .practice-next-btn {
  grid-column: 1 / -1;
}

body.force-mobile .cloud-sync-grid,
body.force-mobile .subjects-premium-grid {
  grid-template-columns: 1fr;
}

body.force-mobile .subject-add-action {
  grid-template-columns: 1fr;
}

body.force-mobile .subject-add-btn {
  width: 100%;
}

body.force-mobile .qb-filter-bar {
  grid-template-columns: 1fr;
}

body.force-mobile .inline-form {
  flex-direction: column;
}

body.force-mobile .inline-form input,
body.force-mobile .inline-form select,
body.force-mobile .inline-form button {
  width: 100%;
}

body.force-desktop .app-shell {
  width: min(1220px, 94vw);
}

body.force-desktop .list-grid {
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
}

.stagger-item {
  opacity: 0;
  transform: translateY(10px);
  animation: fade-slide-up 0.42s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  animation-delay: calc(var(--stagger-index, 0) * 36ms);
}

@keyframes fade-slide-up {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.premium-empty-state {
  display: grid;
  justify-items: center;
  gap: 10px;
  text-align: center;
  padding: 22px 14px;
}

.premium-empty-state svg {
  width: 118px;
  height: 88px;
  stroke: rgba(151, 176, 201, 0.62);
  stroke-width: 2;
  fill: rgba(127, 127, 127, 0.06);
  border-radius: 12px;
}

.premium-empty-state p {
  margin: 0;
  color: var(--text-muted);
}

.json-info-btn {
  min-width: 110px;
}

.schema-modal {
  position: fixed;
  inset: 0;
  z-index: 130;
  display: grid;
  place-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
}

.schema-modal.is-open {
  opacity: 1;
  pointer-events: auto;
}

.schema-modal-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(7, 12, 18, 0.58);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

.schema-modal-card {
  position: relative;
  z-index: 1;
  width: min(760px, calc(100vw - 28px));
  border: 1px solid var(--line);
  border-radius: 18px;
  background: rgba(17, 25, 35, 0.82);
  box-shadow: 0 18px 40px rgba(6, 9, 15, 0.4);
  padding: 14px;
}

html[data-theme^="light-"] .schema-modal-card {
  background: rgba(255, 255, 255, 0.9);
}

.schema-modal-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.schema-modal-head h3 {
  margin: 0;
  font-size: 1rem;
}

.schema-close-btn {
  min-height: 30px;
  width: 32px;
  padding: 0;
  border-radius: 10px;
}

.schema-modal-subtitle {
  margin: 8px 0 10px;
  color: var(--text-muted);
  font-size: 0.86rem;
}

.schema-pre {
  margin: 0;
  max-height: 55vh;
  overflow: auto;
  border: 1px solid var(--line);
  border-radius: 12px;
  padding: 12px;
  background: rgba(4, 10, 16, 0.82);
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size: 0.84rem;
  line-height: 1.75;
  direction: ltr;
  text-align: left;
}

.schema-guide-notes {
  margin-top: 10px;
  border: 1px solid var(--line);
  border-radius: 12px;
  padding: 10px 11px;
  background: rgba(127, 127, 127, 0.07);
}

.schema-guide-list {
  margin: 0;
  padding-inline-start: 16px;
  display: grid;
  gap: 5px;
  color: var(--text-muted);
  font-size: 0.78rem;
  line-height: 1.75;
}

.schema-guide-list strong {
  color: var(--text-main);
}

.schema-guide-list code {
  color: var(--text-main);
  background: rgba(127, 127, 127, 0.16);
  border: 1px solid rgba(138, 172, 201, 0.24);
  border-radius: 7px;
  padding: 1px 5px;
  font-size: 0.75rem;
}

html[data-theme^="light-"] .schema-guide-notes {
  background: rgba(255, 255, 255, 0.84);
  border-color: rgba(44, 84, 115, 0.16);
}

.json-key {
  color: #79c0ff;
}

.json-str {
  color: #a5d6a7;
}

.json-num {
  color: #ffcc80;
}

.json-bool {
  color: #f9b3ff;
}

.json-punc {
  color: #c5ced8;
}

.qb-filter-pill-mode {
  grid-template-columns: 1fr;
  gap: 10px;
}

.qb-pill-group {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.qb-pill {
  min-height: 33px;
  padding: 5px 11px;
  border-radius: 999px;
  border: 1px solid rgba(145, 178, 206, 0.24);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-muted);
  font-size: 0.78rem;
  transition: transform 0.2s ease, border-color 0.2s ease, color 0.2s ease, background-color 0.2s ease;
}

.qb-pill:hover {
  transform: translateY(-1px);
  border-color: rgba(93, 182, 242, 0.45);
  color: var(--text-main);
}

.qb-pill.is-active {
  color: var(--text-main);
  border-color: rgba(93, 182, 242, 0.56);
  background: rgba(93, 182, 242, 0.17);
  box-shadow: 0 8px 18px rgba(7, 26, 40, 0.2);
}

.practice-mode-panel {
  display: grid;
  gap: 12px;
}

.practice-focus-card {
  border: 1px solid var(--line);
  border-radius: 18px;
  background: rgba(127, 127, 127, 0.08);
  box-shadow: 0 14px 28px rgba(5, 9, 15, 0.25);
  padding: 14px;
  display: grid;
  gap: 11px;
}

.practice-focus-card-premium {
  border-color: rgba(138, 172, 201, 0.28);
  background:
    radial-gradient(circle at 88% 9%, rgba(94, 186, 244, 0.2), transparent 36%),
    linear-gradient(156deg, rgba(18, 30, 43, 0.84), rgba(13, 22, 32, 0.74));
  box-shadow: 0 18px 34px rgba(6, 10, 15, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.06);
  backdrop-filter: blur(11px) saturate(128%);
  -webkit-backdrop-filter: blur(11px) saturate(128%);
}

.practice-focus-head {
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto;
  align-items: start;
  gap: 10px;
}

.practice-focus-title h3 {
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 1rem;
  letter-spacing: -0.014em;
}

.practice-focus-title p {
  margin: 4px 0 0;
  color: var(--text-muted);
  font-size: 0.82rem;
  line-height: 1.72;
}

.practice-progress {
  min-width: 160px;
  padding: 8px 9px;
  border: 1px solid var(--line);
  border-radius: 11px;
  background: rgba(127, 127, 127, 0.08);
  display: grid;
  gap: 4px;
}

.practice-progress-label {
  font-size: 0.73rem;
  color: var(--text-muted);
}

.practice-progress strong {
  font-size: 0.82rem;
  letter-spacing: 0.01em;
}

.practice-progress-track {
  height: 6px;
  border-radius: 999px;
  background: rgba(127, 127, 127, 0.22);
  overflow: hidden;
}

.practice-progress-track i {
  display: block;
  height: 100%;
  width: 0;
  border-radius: inherit;
  background: linear-gradient(90deg, rgba(99, 192, 250, 0.92), rgba(117, 232, 198, 0.92));
  transition: width 0.24s ease;
}

.practice-profile-bar {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
  align-items: center;
}

.practice-profile-chip {
  min-height: 34px;
  padding: 5px 10px;
  border-radius: 999px;
  border: 1px solid rgba(145, 178, 206, 0.26);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-muted);
  font-size: 0.77rem;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, color 0.2s ease;
}

.practice-profile-chip:hover {
  transform: translateY(-1px);
  color: var(--text-main);
  border-color: rgba(93, 182, 242, 0.42);
}

.practice-profile-chip.is-active {
  color: var(--text-main);
  border-color: rgba(93, 182, 242, 0.56);
  background: rgba(93, 182, 242, 0.18);
  box-shadow: 0 10px 18px rgba(7, 26, 40, 0.2);
}

.practice-profile-note {
  grid-column: 1 / -1;
  font-size: 0.74rem;
  color: var(--text-muted);
  padding: 0 3px;
}

.practice-meta-strip {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
}

.practice-meta-chip {
  border: 1px solid rgba(138, 172, 201, 0.24);
  border-radius: 12px;
  background: rgba(127, 127, 127, 0.1);
  padding: 7px 8px;
  display: inline-grid;
  grid-auto-flow: column;
  grid-auto-columns: max-content;
  align-items: center;
  gap: 6px;
}

.practice-meta-copy {
  display: grid;
  gap: 1px;
}

.practice-meta-copy em {
  font-style: normal;
  color: var(--text-muted);
  font-size: 0.73rem;
}

.practice-meta-copy strong {
  font-size: 0.81rem;
  font-weight: 700;
}

.practice-icon {
  width: 18px;
  height: 18px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
  border: 1px solid rgba(138, 172, 201, 0.26);
  background: rgba(127, 127, 127, 0.12);
  color: currentColor;
  flex: 0 0 auto;
}

.practice-icon svg {
  width: 13px;
  height: 13px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.practice-question-shell {
  border: 1px solid var(--line);
  border-radius: 14px;
  background: linear-gradient(155deg, var(--surface-soft), rgba(127, 127, 127, 0.06));
  padding: 12px;
  position: relative;
  overflow: hidden;
}

.practice-question-shell::before {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 86% 8%, rgba(255, 255, 255, 0.08), transparent 35%);
  pointer-events: none;
}

.practice-question-shell > * {
  position: relative;
  z-index: 1;
}

.practice-question-index {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  font-weight: 700;
  margin-bottom: 9px;
}

.practice-index-pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.28);
  background: rgba(127, 127, 127, 0.12);
  font-size: 0.79rem;
}

.practice-focus-actions {
  display: grid;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap: 8px;
}

.practice-action-btn {
  min-height: 36px;
  border-radius: 10px;
  border: 1px solid var(--line);
  background: rgba(127, 127, 127, 0.08);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 6px 9px;
  font-size: 0.79rem;
  font-weight: 600;
  color: var(--text-main);
  transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
}

.practice-action-btn:hover {
  transform: translateY(-1px);
  border-color: rgba(93, 182, 242, 0.48);
}

.practice-action-btn.is-active {
  border-color: rgba(93, 182, 242, 0.56);
  background: rgba(93, 182, 242, 0.16);
  box-shadow: 0 10px 20px rgba(7, 26, 40, 0.22);
}

.practice-action-btn.primary {
  box-shadow: 0 12px 22px rgba(12, 38, 56, 0.26);
}

.practice-action-btn:disabled {
  opacity: 0.55;
  cursor: not-allowed;
  transform: none;
}

.practice-next-btn {
  margin-right: 0;
}

.practice-reveal-box {
  border: 1px solid var(--line);
  border-radius: 12px;
  padding: 10px 12px;
  background: rgba(127, 127, 127, 0.08);
  display: grid;
  gap: 7px;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
}

.practice-reveal-head {
  display: inline-flex;
  align-items: center;
  gap: 7px;
  font-size: 0.82rem;
  font-weight: 700;
}

.practice-reveal-content {
  line-height: 1.86;
  font-size: 0.93rem;
}

.practice-reveal-hint {
  border-color: rgba(129, 200, 255, 0.38);
}

.practice-reveal-solution {
  border-color: rgba(120, 223, 184, 0.34);
}

html[data-theme^="light-"] .practice-focus-card-premium {
  border-color: rgba(47, 82, 111, 0.22);
  background:
    radial-gradient(circle at 88% 9%, rgba(47, 130, 193, 0.14), transparent 36%),
    linear-gradient(156deg, rgba(255, 255, 255, 0.9), rgba(245, 250, 255, 0.82));
  box-shadow: 0 16px 30px rgba(24, 55, 83, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.92);
}

html[data-theme^="light-"] .practice-icon {
  border-color: rgba(47, 130, 193, 0.25);
  background: rgba(47, 130, 193, 0.12);
}

html[data-theme^="light-"] .practice-progress,
html[data-theme^="light-"] .practice-profile-chip,
html[data-theme^="light-"] .practice-meta-chip,
html[data-theme^="light-"] .practice-action-btn {
  border-color: rgba(47, 82, 111, 0.2);
}

.exam-builder-form {
  display: grid;
  gap: 13px;
  border: 1px solid rgba(138, 172, 201, 0.26);
  border-radius: 18px;
  background:
    radial-gradient(circle at 9% 7%, rgba(89, 186, 247, 0.18), transparent 42%),
    linear-gradient(150deg, rgba(127, 127, 127, 0.14), rgba(127, 127, 127, 0.05));
  padding: 15px;
  box-shadow: 0 18px 34px rgba(5, 10, 16, 0.24), inset 0 1px 0 rgba(255, 255, 255, 0.07);
  backdrop-filter: blur(10px) saturate(128%);
  -webkit-backdrop-filter: blur(10px) saturate(128%);
  position: relative;
  overflow: hidden;
}

.exam-builder-form::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(circle at 86% 14%, rgba(255, 255, 255, 0.16), transparent 40%);
}

.exam-builder-head {
  display: grid;
  gap: 5px;
}

.exam-builder-title {
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-size: 1rem;
  letter-spacing: -0.014em;
}

.exam-builder-head p {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.84rem;
}

.exam-builder-stats {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
}

.exam-stat-chip {
  display: inline-grid;
  grid-auto-flow: column;
  grid-auto-columns: max-content;
  gap: 6px;
  align-items: center;
  border: 1px solid rgba(138, 172, 201, 0.24);
  border-radius: 999px;
  padding: 5px 10px;
  background: rgba(127, 127, 127, 0.12);
}

.exam-stat-copy {
  display: grid;
  gap: 1px;
}

.exam-stat-chip em {
  font-style: normal;
  color: var(--text-muted);
  font-size: 0.76rem;
  line-height: 1.05;
}

.exam-stat-chip strong {
  font-size: 0.82rem;
  line-height: 1.1;
}

.exam-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  border-radius: 7px;
  border: 1px solid rgba(138, 172, 201, 0.28);
  background: rgba(127, 127, 127, 0.12);
  color: var(--text-main);
  flex: 0 0 auto;
}

.exam-icon svg {
  stroke: currentColor;
  stroke-width: 1.8;
  stroke-linecap: round;
  stroke-linejoin: round;
  fill: none;
}

.exam-builder-title .exam-icon-spark svg {
  animation: exam-spark-spin 9s linear infinite;
  transform-origin: center;
}

.exam-icon-spark,
.exam-icon-bolt {
  color: #ffd37a;
}

.exam-icon-leaf {
  color: #8ce0ad;
}

.exam-icon-print {
  color: #a7d6ff;
}

.exam-chapter-toolbar {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.exam-chapter-title {
  display: inline-flex;
  align-items: center;
  gap: 7px;
}

.exam-chapter-toolbar-actions {
  display: inline-flex;
  gap: 8px;
}

.exam-chip-btn {
  min-height: 34px;
  padding: 6px 11px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.26);
  background: rgba(127, 127, 127, 0.12);
  color: var(--text-main);
  font-size: 0.76rem;
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
}

.exam-chip-btn:hover {
  border-color: rgba(86, 181, 241, 0.52);
  background: rgba(86, 181, 241, 0.17);
  box-shadow: 0 8px 18px rgba(8, 30, 45, 0.22);
}

.exam-chapter-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 9px;
}

.exam-chapter-check {
  position: relative;
}

.exam-chapter-check > input[name="chapterIds"] {
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

.exam-chapter-check-ui {
  display: grid;
  gap: 5px;
  width: 100%;
  min-height: 62px;
  align-content: center;
  border-radius: 13px;
  border: 1px solid rgba(138, 172, 201, 0.22);
  background: linear-gradient(150deg, rgba(127, 127, 127, 0.11), rgba(127, 127, 127, 0.06));
  padding: 8px 11px;
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
}

.exam-chapter-check:hover .exam-chapter-check-ui {
  transform: translateY(-1px);
  border-color: rgba(97, 183, 239, 0.36);
}

.exam-chapter-name {
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.exam-chapter-check-ui strong {
  font-size: 0.84rem;
}

.exam-chapter-check-ui small {
  color: var(--text-muted);
  font-size: 0.75rem;
}

.exam-chapter-check > input[name="chapterIds"]:checked + .exam-chapter-check-ui {
  border-color: rgba(84, 180, 241, 0.6);
  background: linear-gradient(150deg, rgba(84, 180, 241, 0.18), rgba(127, 127, 127, 0.06));
  box-shadow: 0 12px 22px rgba(7, 24, 37, 0.22);
}

.exam-builder-controls {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 8px;
}

.exam-control-field {
  display: grid;
  gap: 6px;
}

.exam-control-label {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 0.78rem;
  font-weight: 600;
  color: var(--text-muted);
}

.exam-builder-controls input,
.exam-builder-controls select {
  min-height: 38px;
  border-radius: 12px;
  background: rgba(127, 127, 127, 0.1);
  border-color: rgba(138, 172, 201, 0.24);
}

.exam-builder-controls input:focus,
.exam-builder-controls select:focus {
  border-color: rgba(93, 182, 242, 0.56);
  box-shadow: 0 0 0 3px rgba(93, 182, 242, 0.14);
}

.exam-generate-btn {
  align-self: end;
  min-height: 40px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 7px;
  border-radius: 12px;
  background: linear-gradient(140deg, #3aa8f5, #6ad4ff);
  box-shadow: 0 12px 24px rgba(10, 57, 84, 0.32);
}

.exam-countdown-panel {
  border: 1px solid rgba(127, 205, 255, 0.34);
  border-radius: 13px;
  padding: 9px 10px;
  background: linear-gradient(145deg, rgba(74, 181, 243, 0.18), rgba(74, 181, 243, 0.06));
  box-shadow: 0 10px 18px rgba(8, 30, 45, 0.22);
  display: grid;
  gap: 7px;
}

.exam-countdown-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.exam-countdown-label {
  color: var(--text-muted);
  font-size: 0.78rem;
}

.exam-countdown-value {
  font-size: 1.02rem;
  font-weight: 700;
  letter-spacing: 0.08em;
  color: #d2f2ff;
  direction: ltr;
  min-width: 82px;
  text-align: right;
  font-variant-numeric: tabular-nums lining-nums;
  font-feature-settings: "tnum" 1, "lnum" 1;
  font-family: "Vazirmatn", "Segoe UI", Tahoma, sans-serif;
}

.exam-countdown-track {
  height: 7px;
  border-radius: 999px;
  background: rgba(127, 127, 127, 0.2);
  overflow: hidden;
}

.exam-countdown-track i {
  display: block;
  height: 100%;
  width: 100%;
  border-radius: inherit;
  background: linear-gradient(90deg, #53bcff, #76e8cf);
  transition: width 0.35s linear;
}

.exam-countdown-panel.is-warning {
  border-color: rgba(255, 171, 126, 0.54);
  background: linear-gradient(145deg, rgba(255, 171, 126, 0.22), rgba(255, 171, 126, 0.08));
}

.exam-countdown-panel.is-warning .exam-countdown-value {
  color: #ffd7be;
}

.exam-countdown-panel.is-warning .exam-countdown-track i {
  background: linear-gradient(90deg, #ffab7e, #ff7f95);
}

.exam-completion-banner {
  border: 1px solid rgba(120, 214, 178, 0.4);
  border-radius: 13px;
  padding: 10px 12px;
  background: linear-gradient(150deg, rgba(120, 214, 178, 0.2), rgba(120, 214, 178, 0.07));
  box-shadow: 0 10px 20px rgba(8, 33, 28, 0.2);
  display: grid;
  gap: 6px;
}

.exam-completion-title {
  margin: 0;
  font-size: 0.98rem;
  display: inline-flex;
  align-items: center;
  gap: 7px;
}

.exam-completion-caption {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.82rem;
}

.exam-answer-key {
  margin-top: 12px;
  border-top: 1px dashed rgba(138, 172, 201, 0.35);
  padding-top: 12px;
  display: grid;
  gap: 10px;
}

.exam-answer-key-head h4 {
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 7px;
  font-size: 0.93rem;
}

.exam-answer-key-head p {
  margin: 5px 0 0;
  font-size: 0.79rem;
  color: var(--text-muted);
}

.exam-answer-key-list {
  display: grid;
  gap: 8px;
}

.exam-answer-key-item {
  border: 1px solid rgba(138, 172, 201, 0.24);
  border-radius: 12px;
  background: rgba(127, 127, 127, 0.08);
  padding: 9px 10px;
  display: grid;
  gap: 7px;
}

.exam-answer-key-title {
  font-size: 0.82rem;
  color: var(--text-muted);
}

.exam-answer-key-body {
  border: 1px solid rgba(138, 172, 201, 0.2);
  border-radius: 10px;
  background: rgba(127, 127, 127, 0.06);
  padding: 8px 9px;
}

.exam-eval-panel {
  margin-top: 10px;
  border: 1px solid rgba(143, 183, 226, 0.3);
  border-radius: 14px;
  padding: 10px;
  background: linear-gradient(150deg, rgba(127, 175, 223, 0.16), rgba(127, 175, 223, 0.06));
  display: grid;
  gap: 8px;
}

.exam-eval-title {
  margin: 0;
  font-size: 0.93rem;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.exam-eval-caption {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.8rem;
}

.exam-eval-controls {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
}

.exam-eval-input {
  min-height: 38px;
  min-width: 180px;
  padding: 8px 10px;
  border-radius: 11px;
  border: 1px solid rgba(138, 172, 201, 0.3);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-main);
}

.exam-eval-input:focus {
  border-color: rgba(96, 183, 245, 0.56);
  box-shadow: 0 0 0 3px rgba(96, 183, 245, 0.14);
}

.exam-eval-btn {
  min-height: 38px;
  border-radius: 11px;
}

.exam-eval-result {
  border: 1px solid rgba(138, 172, 201, 0.28);
  border-radius: 12px;
  padding: 9px;
  background: rgba(127, 127, 127, 0.1);
  display: grid;
  gap: 8px;
}

.exam-eval-result-top {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.exam-eval-status {
  margin: 0;
  font-size: 0.84rem;
  line-height: 1.8;
}

.exam-eval-result-excellent {
  border-color: rgba(116, 222, 160, 0.45);
}

.exam-eval-result-very-good,
.exam-eval-result-good {
  border-color: rgba(116, 196, 255, 0.42);
}

.exam-eval-result-acceptable {
  border-color: rgba(255, 198, 116, 0.45);
}

.exam-eval-result-needs-work {
  border-color: rgba(255, 140, 140, 0.45);
}

.exam-eval-recommendation {
  border: 1px solid rgba(138, 172, 201, 0.26);
  border-radius: 11px;
  padding: 8px 9px;
  background: rgba(127, 127, 127, 0.08);
  display: grid;
  gap: 6px;
}

.exam-eval-recommendation-title {
  margin: 0;
  font-size: 0.82rem;
}

.exam-eval-recommendation-list {
  margin: 0;
  padding: 0 17px 0 0;
  display: grid;
  gap: 5px;
}

.exam-eval-recommendation-item {
  font-size: 0.77rem;
  color: var(--text-muted);
  line-height: 1.65;
}

.exam-library-panel {
  border: 1px solid rgba(138, 172, 201, 0.26);
  border-radius: 14px;
  padding: 10px;
  background: linear-gradient(145deg, rgba(127, 127, 127, 0.09), rgba(127, 127, 127, 0.03));
  display: grid;
  gap: 8px;
}

.exam-library-head {
  display: grid;
  gap: 3px;
}

.exam-library-title {
  margin: 0;
  font-size: 0.9rem;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.exam-library-note {
  margin: 0;
  font-size: 0.76rem;
  color: var(--text-muted);
}

.exam-library-list {
  display: grid;
  gap: 7px;
}

.exam-library-empty {
  margin: 0;
  font-size: 0.8rem;
  color: var(--text-muted);
}

.exam-library-item {
  border: 1px solid rgba(138, 172, 201, 0.22);
  border-radius: 11px;
  padding: 8px;
  background: rgba(127, 127, 127, 0.09);
  display: grid;
  gap: 5px;
}

.exam-library-item.is-current {
  border-color: rgba(110, 214, 170, 0.34);
  background: rgba(110, 214, 170, 0.1);
}

.exam-library-item-title {
  font-size: 0.81rem;
}

.exam-library-item-meta {
  margin: 0;
  font-size: 0.74rem;
  color: var(--text-muted);
  line-height: 1.6;
}

.exam-library-item-date {
  font-size: 0.7rem;
  color: var(--text-muted);
}

.exam-library-actions {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 6px;
}

.exam-library-btn {
  min-height: 32px;
  border-radius: 9px;
  border: 1px solid rgba(138, 172, 201, 0.28);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-main);
  font-size: 0.74rem;
  font-weight: 700;
}

.exam-library-btn.is-danger {
  border-color: rgba(238, 154, 154, 0.42);
  color: #ffd7d7;
}

.exam-library-save-btn {
  min-height: 36px;
  border-radius: 10px;
  border: 1px solid rgba(120, 226, 175, 0.4);
  background: linear-gradient(145deg, rgba(120, 226, 175, 0.2), rgba(120, 226, 175, 0.08));
  color: #d5ffe9;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  font-weight: 700;
}

.exam-library-save-btn:disabled {
  opacity: 0.55;
  cursor: not-allowed;
}

.exam-mobile-nav-dock {
  display: none;
}

.exam-paper-answer-sheet {
  display: none;
}

.exam-paper-actions {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.exam-paper-quick-stats {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 8px;
}

.exam-paper-quick-stats .exam-stat-chip {
  background: rgba(127, 127, 127, 0.08);
}

.exam-print-btn {
  min-height: 40px;
  display: inline-flex;
  align-items: center;
  gap: 7px;
  border-radius: 12px;
}

html[data-theme^="light-"] .exam-builder-form {
  border-color: rgba(43, 81, 110, 0.18);
  background:
    radial-gradient(circle at 9% 7%, rgba(82, 170, 226, 0.16), transparent 42%),
    linear-gradient(150deg, rgba(255, 255, 255, 0.9), rgba(244, 249, 255, 0.84));
  box-shadow: 0 14px 28px rgba(27, 60, 90, 0.12);
}

html[data-theme^="light-"] .exam-countdown-panel {
  border-color: rgba(47, 130, 193, 0.28);
  background: linear-gradient(145deg, rgba(47, 130, 193, 0.16), rgba(255, 255, 255, 0.86));
  box-shadow: 0 10px 18px rgba(24, 55, 83, 0.14);
}

html[data-theme^="light-"] .exam-countdown-value {
  color: #205f8a;
}

html[data-theme^="light-"] .exam-completion-banner {
  border-color: rgba(53, 147, 111, 0.28);
  background: linear-gradient(145deg, rgba(53, 147, 111, 0.14), rgba(255, 255, 255, 0.88));
  box-shadow: 0 8px 16px rgba(22, 64, 50, 0.14);
}

html[data-theme^="light-"] .exam-answer-key {
  border-top-color: rgba(43, 81, 110, 0.2);
}

html[data-theme^="light-"] .exam-answer-key-item,
html[data-theme^="light-"] .exam-answer-key-body,
html[data-theme^="light-"] .exam-eval-panel,
html[data-theme^="light-"] .exam-eval-result {
  border-color: rgba(43, 81, 110, 0.2);
  background: rgba(255, 255, 255, 0.82);
}

html[data-theme^="light-"] .exam-stat-chip,
html[data-theme^="light-"] .exam-chip-btn,
html[data-theme^="light-"] .exam-paper-quick-stats .exam-stat-chip {
  background: rgba(255, 255, 255, 0.82);
}

html[data-theme^="light-"] .exam-icon {
  border-color: rgba(43, 81, 110, 0.2);
  background: rgba(255, 255, 255, 0.82);
}

html[data-theme^="light-"] .exam-chapter-check > input[name="chapterIds"]:checked + .exam-chapter-check-ui {
  box-shadow: 0 10px 20px rgba(33, 76, 112, 0.16);
}

.exam-paper-actions .primary {
  min-height: 38px;
}

.exam-paper {
  border: 1px solid rgba(138, 172, 201, 0.24);
  border-radius: 16px;
  background: linear-gradient(150deg, rgba(127, 127, 127, 0.08), rgba(127, 127, 127, 0.03));
  padding: 18px;
  box-shadow: 0 14px 30px rgba(5, 10, 16, 0.2);
}

.exam-paper-print-goodluck {
  display: none;
}

.exam-paper-head {
  padding-bottom: 10px;
  margin-bottom: 2px;
  border-bottom: 1px dashed rgba(138, 172, 201, 0.28);
}

.exam-paper-title {
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 7px;
  font-size: 1.04rem;
  text-align: center;
  justify-content: center;
}

.exam-paper-head p {
  margin: 8px 0 0;
  font-size: 0.85rem;
  color: var(--text-muted);
  text-align: center;
}

.exam-paper-list {
  margin: 14px 0 0;
  padding: 0 18px 0 0;
  display: grid;
  gap: 14px;
}

.exam-paper-item {
  page-break-inside: avoid;
  padding: 8px 10px;
  border: 1px dashed rgba(138, 172, 201, 0.2);
  border-radius: 12px;
  background: rgba(127, 127, 127, 0.05);
}

.exam-answer-area {
  margin-top: 10px;
  display: grid;
  gap: 4px;
}

.exam-answer-area > span {
  font-size: 0.82rem;
  color: var(--text-muted);
}

.exam-answer-area > div {
  min-height: 42px;
  border-bottom: 1px dashed var(--line);
}

/* Final layout pass: Practice + Exam aligned with Question Bank flow */
.practice-mode-panel,
.exam-mode-panel {
  gap: 10px;
}

.practice-toolbar {
  display: grid;
  gap: 8px;
}

.practice-toolbar-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  flex-wrap: wrap;
}

.practice-toolbar-title {
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 7px;
  font-size: 0.92rem;
}

.practice-toolbar-progress {
  display: inline-flex;
  align-items: center;
  min-height: 28px;
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.22);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-muted);
  font-size: 0.76rem;
}

.practice-toolbar-toggle {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  min-height: 30px;
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.28);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-muted);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 7px;
  font-size: 0.72rem;
  font-weight: 700;
  white-space: nowrap;
  margin-inline-start: auto;
  transition: border-color 0.18s ease, background-color 0.18s ease, color 0.18s ease;
}

.practice-toolbar-toggle:hover {
  border-color: rgba(149, 202, 236, 0.42);
  background: rgba(127, 127, 127, 0.15);
  color: var(--text-main);
}

.practice-toolbar-toggle .qb-filter-toggle-caret {
  width: 7px;
  height: 7px;
  border-inline-end: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: rotate(45deg);
  margin-top: -2px;
  opacity: 0.88;
  flex: 0 0 auto;
  transition: transform 0.18s ease, opacity 0.18s ease;
}

.practice-toolbar-toggle[aria-expanded="true"] .qb-filter-toggle-caret {
  transform: rotate(225deg);
}

.practice-toolbar-filters {
  display: grid;
  gap: 8px;
}

.practice-toolbar-filters[hidden],
.practice-toolbar-filters.is-collapsed {
  display: none !important;
}

.practice-profile-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.practice-profile-chip {
  flex: 0 0 auto;
  min-height: 31px;
  padding: 5px 10px;
  border-radius: 999px;
  border: 1px solid rgba(145, 178, 206, 0.26);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-muted);
  font-size: 0.76rem;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, color 0.2s ease;
}

.practice-profile-chip:hover {
  transform: translateY(-1px);
  color: var(--text-main);
  border-color: rgba(93, 182, 242, 0.42);
}

.practice-profile-chip.is-active {
  color: var(--text-main);
  border-color: rgba(93, 182, 242, 0.56);
  background: rgba(93, 182, 242, 0.16);
}

.practice-profile-note {
  width: 100%;
  font-size: 0.74rem;
  color: var(--text-muted);
}

.practice-options-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.practice-solved-switch {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  min-height: 32px;
  padding: 5px 10px;
  border-radius: 11px;
  border: 1px solid rgba(145, 178, 206, 0.24);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-main);
}

.practice-solved-switch-input {
  position: absolute;
  opacity: 0;
  width: 1px;
  height: 1px;
  pointer-events: none;
}

.practice-solved-switch-ui {
  position: relative;
  width: 34px;
  height: 19px;
  border-radius: 999px;
  border: 1px solid rgba(145, 178, 206, 0.38);
  background: rgba(127, 127, 127, 0.22);
  transition: background-color 0.2s ease, border-color 0.2s ease;
}

.practice-solved-switch-ui::before {
  content: "";
  position: absolute;
  top: 1px;
  left: 1px;
  width: 15px;
  height: 15px;
  border-radius: 50%;
  background: rgba(239, 247, 255, 0.9);
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.24);
  transition: transform 0.2s ease;
}

.practice-solved-switch-input:checked + .practice-solved-switch-ui {
  border-color: rgba(93, 182, 242, 0.56);
  background: rgba(93, 182, 242, 0.38);
}

.practice-solved-switch-input:checked + .practice-solved-switch-ui::before {
  transform: translateX(15px);
}

.practice-solved-switch-input:focus-visible + .practice-solved-switch-ui {
  box-shadow: 0 0 0 3px rgba(93, 182, 242, 0.2);
}

.practice-solved-switch-text {
  font-size: 0.72rem;
  color: var(--text-muted);
  font-weight: 600;
}

html[data-theme^="light-"] .practice-solved-switch {
  border-color: rgba(47, 130, 193, 0.22);
  background: rgba(255, 255, 255, 0.84);
}

html[data-theme^="light-"] .practice-toolbar-toggle {
  border-color: rgba(47, 82, 111, 0.24);
  background: rgba(255, 255, 255, 0.88);
  color: #4a6983;
}

html[data-theme^="light-"] .practice-solved-switch-ui {
  border-color: rgba(47, 130, 193, 0.3);
  background: rgba(215, 230, 242, 0.7);
}

html[data-theme^="light-"] .practice-solved-switch-ui::before {
  background: #ffffff;
}

.practice-question-card {
  padding-top: 10px;
}

.practice-focus-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 10px;
}

.practice-focus-actions > .practice-action-btn,
.practice-focus-actions > .practice-solution-stack {
  flex: 1 1 170px;
  min-width: 0;
}

.practice-solution-stack {
  display: grid;
  gap: 8px;
}

.practice-solution-stack .practice-action-btn {
  width: 100%;
}

.practice-action-btn {
  min-height: 34px;
  border-radius: 10px;
  border: 1px solid var(--line);
  background: rgba(127, 127, 127, 0.08);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 6px 9px;
  font-size: 0.79rem;
  font-weight: 600;
  color: var(--text-main);
}

.practice-reveal-box {
  margin-top: 9px;
  border-radius: 10px;
  padding: 9px 10px;
}

.practice-reveal-content {
  font-size: 0.92rem;
  line-height: 1.84;
}

.exam-builder-form {
  display: grid;
  gap: 8px;
  border-radius: 14px;
  padding: 10px;
}

.exam-builder-title {
  font-size: 0.92rem;
}

.exam-builder-head p {
  font-size: 0.8rem;
}

.exam-pane {
  display: grid;
  gap: 8px;
  border: 1px solid rgba(138, 172, 201, 0.2);
  border-radius: 12px;
  background: rgba(127, 127, 127, 0.08);
  padding: 8px;
}

.exam-pane-title {
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 0.79rem;
  color: var(--text-muted);
}

.exam-chapter-grid {
  grid-template-columns: repeat(auto-fit, minmax(166px, 1fr));
  gap: 7px;
}

.exam-chapter-check-ui {
  min-height: 54px;
  border-radius: 11px;
}

.exam-chip-btn {
  min-height: 31px;
  font-size: 0.74rem;
}

.exam-builder-controls {
  grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
  gap: 7px;
}

.exam-builder-controls input,
.exam-builder-controls select {
  min-height: 35px;
  font-size: 0.88rem;
}

.exam-builder-controls .exam-generate-btn {
  grid-column: 1 / -1;
  width: auto;
}

.exam-paper-actions {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
}

.exam-paper {
  display: grid;
  gap: 10px;
  border: 1px solid var(--line);
  border-radius: 14px;
  background: linear-gradient(150deg, rgba(127, 127, 127, 0.08), rgba(127, 127, 127, 0.03));
  padding: 12px;
  box-shadow: 0 12px 24px rgba(6, 10, 15, 0.2);
}

.exam-paper-head {
  display: grid;
  gap: 7px;
  padding-bottom: 8px;
  border-bottom: 1px dashed rgba(138, 172, 201, 0.28);
}

.exam-paper-title {
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 7px;
  font-size: 0.95rem;
  justify-content: flex-start;
  text-align: right;
}

.exam-paper-brand-row {
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  justify-content: space-between;
  gap: 8px;
}

.exam-paper-brand {
  display: grid;
  gap: 2px;
}

.exam-paper-brand p {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.79rem;
  text-align: right;
}

.exam-paper-code {
  min-height: 30px;
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.28);
  background: rgba(127, 127, 127, 0.12);
  font-size: 0.74rem;
  font-weight: 700;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.exam-paper-meta-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(145px, 1fr));
  gap: 6px;
}

.exam-paper-meta-pill {
  min-height: 30px;
  padding: 4px 8px;
  border: 1px solid rgba(138, 172, 201, 0.22);
  border-radius: 999px;
  background: rgba(127, 127, 127, 0.1);
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.exam-paper-meta-pill em {
  font-style: normal;
  color: var(--text-muted);
  font-size: 0.72rem;
}

.exam-paper-meta-pill strong {
  font-size: 0.78rem;
}

.exam-paper-student-line {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.8rem;
  text-align: right;
}

.exam-paper-chapter-list {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.exam-paper-chapter-pill {
  min-height: 26px;
  padding: 2px 9px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.25);
  background: rgba(127, 127, 127, 0.1);
  font-size: 0.73rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.exam-paper-instructions {
  border: 1px dashed rgba(138, 172, 201, 0.3);
  border-radius: 10px;
  background: rgba(127, 127, 127, 0.08);
  padding: 6px 8px;
  display: grid;
  gap: 4px;
}

.exam-paper-instructions h4 {
  margin: 0;
  font-size: 0.79rem;
}

.exam-paper-instruction-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 4px 6px;
}

.exam-paper-instruction-item {
  min-height: 24px;
  padding: 2px 7px;
  border: 1px solid rgba(138, 172, 201, 0.24);
  border-radius: 8px;
  background: rgba(127, 127, 127, 0.1);
  font-size: 0.74rem;
  line-height: 1.4;
  color: var(--text-muted);
  display: inline-flex;
  align-items: center;
}

.exam-paper-list {
  margin: 0;
  padding: 0;
  display: grid;
  gap: 10px;
}

.exam-paper-item {
  page-break-inside: avoid;
}

.exam-paper-question-meta {
  margin-top: 8px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.exam-paper-question-tag,
.exam-paper-question-points {
  min-height: 24px;
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid rgba(138, 172, 201, 0.24);
  background: rgba(127, 127, 127, 0.1);
  font-size: 0.71rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.exam-paper-question-points {
  border-color: rgba(116, 233, 191, 0.34);
  background: rgba(116, 233, 191, 0.14);
  color: #c8ffe6;
}

.exam-answer-area {
  margin-top: 9px;
  display: grid;
  gap: 4px;
}

.exam-answer-area > span {
  font-size: 0.8rem;
  color: var(--text-muted);
}

.exam-answer-lines {
  display: grid;
  gap: 8px;
}

.exam-answer-area > .exam-answer-lines {
  min-height: 0;
  border-bottom: 0;
}

.exam-answer-lines i {
  display: block;
  min-height: 16px;
  border-bottom: 1px dashed var(--line);
}

html[data-theme^="light-"] .exam-paper-code,
html[data-theme^="light-"] .exam-paper-chapter-pill,
html[data-theme^="light-"] .exam-paper-question-tag,
html[data-theme^="light-"] .exam-paper-question-points,
html[data-theme^="light-"] .exam-paper-instructions,
html[data-theme^="light-"] .exam-paper-instruction-item {
  border-color: rgba(47, 82, 111, 0.22);
  background: rgba(255, 255, 255, 0.82);
}

html[data-theme^="light-"] .exam-paper-question-points {
  color: #257a58;
}

@media (min-width: 1024px) {
  .exam-builder-controls {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .practice-focus-actions > .practice-solution-stack {
    flex-basis: 220px;
  }
}

@keyframes exam-spark-spin {
  to {
    transform: rotate(360deg);
  }
}

@media print {
  html,
  body {
    background: #fff !important;
    color: #000 !important;
  }

  .topbar,
  .profile-surface,
  .breadcrumbs,
  .status-bar,
  .tabs,
  .chapter-head,
  .exam-builder-form,
  .exam-countdown-panel,
  .question-float-timer,
  .exam-eval-panel,
  .exam-paper-actions,
  .question-review-tools,
  .question-review-badge,
  .toast-stack,
  .settings-panel,
  button,
  input,
  select,
  .sync-panel {
    display: none !important;
  }

  .app-shell,
  .surface,
  .main-content,
  .tab-panel {
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
    box-shadow: none !important;
    background: #fff !important;
  }

  .exam-paper {
    border: 0 !important;
    box-shadow: none !important;
    padding: 0 !important;
    background: #fff !important;
  }

  .exam-paper-head h3,
  .exam-paper-head p,
  .exam-paper-item,
  .question-body,
  .exam-paper-instruction-item {
    color: #000 !important;
  }

  .exam-icon,
  .exam-paper-title .exam-icon {
    display: none !important;
  }

  .exam-paper-code,
  .exam-paper-chapter-pill,
  .exam-paper-meta-pill,
  .exam-paper-question-tag,
  .exam-paper-question-points {
    background: transparent !important;
    color: #000 !important;
    border-color: #9d9d9d !important;
  }

  .exam-paper-instructions {
    background: transparent !important;
    border-color: #9d9d9d !important;
  }

  .exam-paper-instruction-item {
    background: transparent !important;
    border-color: #9d9d9d !important;
  }

  .exam-answer-lines i {
    border-bottom-color: #8d8d8d !important;
  }

  body.print-exam-only .topbar,
  body.print-exam-only .profile-hub,
  body.print-exam-only #breadcrumbs,
  body.print-exam-only #statusBar,
  body.print-exam-only #toastStack,
  body.print-exam-only #schemaModal,
  body.print-exam-only .settings-panel,
  body.print-exam-only .exam-builder-form,
  body.print-exam-only .exam-countdown-panel,
  body.print-exam-only .exam-paper-actions,
  body.print-exam-only .exam-paper-head,
  body.print-exam-only .exam-paper-question-meta,
  body.print-exam-only .qb-overview,
  body.print-exam-only .meta-row,
  body.print-exam-only .exam-completion-banner,
  body.print-exam-only .exam-eval-panel,
  body.print-exam-only .question-review-tools,
  body.print-exam-only .question-tools,
  body.print-exam-only .disclosure,
  body.print-exam-only .question-review-badge,
  body.print-exam-only .question-solved-badge,
  body.print-exam-only .question-head-tools,
  body.print-exam-only .question-solve-timer,
  body.print-exam-only .exam-question-review,
  body.print-exam-only .exam-answer-area,
  body.print-exam-only .exam-answer-lines,
  body.print-exam-only .exam-paper-meta-grid,
  body.print-exam-only .exam-paper-chapter-list,
  body.print-exam-only .exam-paper-student-line,
  body.print-exam-only .exam-paper-brand-row {
    display: none !important;
  }

  body.print-exam-only .app-shell > :not(.main-content),
  body.print-exam-only .main-content > :not(#levelContainer),
  body.print-exam-only #levelContainer > :not(.exam-mode-panel),
  body.print-exam-only .exam-mode-panel > :not(.exam-session-region),
  body.print-exam-only .exam-session-region > :not(.exam-paper),
  body.print-exam-only .exam-paper > :not(.exam-paper-list) {
    display: none !important;
  }

  body.print-exam-only,
  body.print-exam-only .app-shell,
  body.print-exam-only .main-content,
  body.print-exam-only #levelContainer,
  body.print-exam-only .surface,
  body.print-exam-only .exam-mode-panel,
  body.print-exam-only .exam-session-region,
  body.print-exam-only .exam-paper,
  body.print-exam-only .exam-paper-list {
    min-height: 0 !important;
    height: auto !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: visible !important;
    box-sizing: border-box !important;
  }

  body.print-exam-only .app-shell {
    display: block !important;
    grid-template-columns: none !important;
    grid-template-rows: none !important;
    gap: 0 !important;
  }

  body.print-exam-only .app-shell,
  body.print-exam-only .surface,
  body.print-exam-only .main-content,
  body.print-exam-only .tab-panel,
  body.print-exam-only .exam-mode-panel,
  body.print-exam-only .exam-session-region,
  body.print-exam-only .exam-paper {
    width: 100% !important;
    max-width: none !important;
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    background: #fff !important;
  }

  body.print-exam-only .main-content,
  body.print-exam-only #levelContainer,
  body.print-exam-only .exam-mode-panel,
  body.print-exam-only .exam-session-region {
    display: block !important;
    margin-top: 0 !important;
    padding-top: 0 !important;
  }

  body.print-exam-only .exam-paper-list {
    display: block !important;
    margin: 0 !important;
    padding: 0 !important;
    gap: 0 !important;
    background: #fff !important;
  }

  body.print-exam-only .exam-paper-item {
    margin: 0 0 2.5mm !important;
    padding: 0 !important;
    border: 0 !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    background: transparent !important;
    break-inside: avoid-page !important;
    page-break-inside: avoid !important;
  }

  body.print-exam-only .question-card {
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    background: transparent !important;
    min-height: 0 !important;
    gap: 1.4mm !important;
    color: #000 !important;
  }

  body.print-exam-only .question-head {
    margin: 0 0 1.1mm !important;
    padding: 0 !important;
    min-height: 0 !important;
    border: 0 !important;
    background: transparent !important;
    color: #000 !important;
  }

  body.print-exam-only .question-head-main {
    gap: 0 !important;
  }

  body.print-exam-only .question-head-main > :not(.question-index),
  body.print-exam-only .stars {
    display: none !important;
  }

  body.print-exam-only .question-index {
    margin: 0 !important;
    padding: 0 !important;
    font-size: 10.8pt !important;
    line-height: 1.25 !important;
    font-weight: 750 !important;
    color: #000 !important;
    background: transparent !important;
    border: 0 !important;
  }

  body.print-exam-only .question-body,
  body.print-exam-only .question-body * {
    color: #000 !important;
  }

  body.print-exam-only .question-body {
    margin: 0 !important;
    padding: 0 !important;
    font-size: 10.6pt !important;
    line-height: 1.42 !important;
  }

  body.print-exam-only .question-body p {
    margin: 0 0 1.2mm !important;
  }

  body.print-exam-only .question-body :is(ul, ol) {
    margin: 0 0 1.6mm !important;
    padding: 0 4.8mm 0 0 !important;
  }

  body.print-exam-only .question-body li {
    margin: 0 0 0.85mm !important;
  }

  body.print-exam-only .math-node,
  body.print-exam-only .katex,
  body.print-exam-only .katex * {
    color: #000 !important;
  }

  body.print-exam-only .katex-display {
    margin: 1.05mm 0 !important;
  }

  body.print-exam-only .katex-display > .katex {
    max-width: 100% !important;
    white-space: normal !important;
  }

  @page {
    size: A4;
    margin: 11mm 9mm;
  }
}

/* Header redesign v4: compact command ribbon */
.topbar.premium-topbar {
  grid-template-columns: minmax(0, 1fr) auto;
  gap: 8px;
  align-items: start;
}

.premium-topbar {
  top: 6px;
  margin-bottom: 10px;
  padding: 8px 10px;
  border-radius: 20px;
  border: 1px solid rgba(130, 174, 209, 0.28);
  background:
    linear-gradient(154deg, rgba(9, 18, 28, 0.92), rgba(13, 25, 38, 0.78)),
    radial-gradient(circle at 12% 14%, rgba(96, 194, 249, 0.18), transparent 40%);
  box-shadow: 0 14px 28px rgba(5, 10, 16, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.06);
  animation: header-shell-float 8s ease-in-out infinite;
}

.premium-topbar::before {
  background:
    linear-gradient(102deg, rgba(255, 255, 255, 0.05), transparent 55%),
    radial-gradient(circle at 84% 12%, rgba(82, 182, 242, 0.2), transparent 34%),
    radial-gradient(circle at 9% 88%, rgba(82, 182, 242, 0.12), transparent 40%);
}

.premium-topbar::after {
  top: auto;
  bottom: 10px;
  right: 12px;
  left: 12px;
  width: auto;
  background: linear-gradient(90deg, transparent, rgba(123, 209, 255, 0.56), transparent);
}

.premium-topbar > .title-group::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 14px;
  background: linear-gradient(96deg, rgba(255, 255, 255, 0.07), transparent 58%);
  pointer-events: none;
  z-index: 0;
}

.premium-title-group {
  position: relative;
  gap: 6px;
}

.premium-title-group > * {
  position: relative;
  z-index: 1;
}

.header-title-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

.header-title-stack {
  display: grid;
  gap: 2px;
  min-width: 0;
}

.premium-title-group h1 {
  font-size: clamp(1.02rem, 0.88vw + 0.78rem, 1.36rem);
  letter-spacing: -0.024em;
  line-height: 1.22;
}

.premium-title-group p {
  display: block;
  margin: 0;
  color: rgba(184, 206, 226, 0.86);
  font-size: 0.71rem;
  line-height: 1.5;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.header-brand-icon {
  width: 34px;
  height: 34px;
  border-radius: 11px;
  border: 1px solid hsla(var(--profile-accent-hue, 198), 82%, 74%, 0.46);
  background:
    radial-gradient(circle at 22% 18%, rgba(255, 255, 255, 0.36), transparent 44%),
    linear-gradient(150deg, hsla(var(--profile-accent-hue, 198), 82%, 68%, 0.34), hsla(var(--profile-accent-hue, 198), 82%, 58%, 0.1));
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.28),
    0 10px 18px rgba(8, 13, 20, 0.28);
}

.header-brand-shell {
  width: 18px;
  height: 18px;
  border-radius: 6px;
  border-width: 1px;
}

.header-brand-track-a {
  width: 18px;
  height: 18px;
}

.header-brand-track-b {
  width: 12px;
  height: 12px;
}

.header-brand-prism {
  width: 7px;
  height: 7px;
}

.header-quickline {
  display: flex;
  gap: 5px;
  flex-wrap: wrap;
}

.header-quick-pill {
  min-height: 23px;
  border-radius: 8px;
  padding: 1px 8px;
  border-color: rgba(130, 174, 209, 0.28);
  background: rgba(124, 174, 208, 0.1);
  color: #b8cfe3;
  font-size: 0.72rem;
}

.header-quick-actions {
  display: flex;
  flex-wrap: nowrap;
  gap: 5px;
  overflow-x: auto;
  padding: 3px;
  border: 1px solid rgba(132, 178, 215, 0.24);
  border-radius: 12px;
  background: rgba(124, 174, 208, 0.06);
}

.header-quick-btn {
  min-height: 29px;
  border-radius: 8px;
  padding: 3px 9px;
  border-color: rgba(132, 178, 215, 0.16);
  background: rgba(125, 174, 207, 0.08);
  font-size: 0.76rem;
  font-weight: 700;
  display: inline-flex;
  align-items: center;
  gap: 5px;
  position: relative;
  overflow: hidden;
}

.header-quick-btn::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(110deg, transparent 18%, rgba(255, 255, 255, 0.16) 48%, transparent 78%);
  transform: translateX(120%);
  transition: transform 0.42s ease;
}

.header-quick-btn:hover {
  background: rgba(95, 184, 242, 0.2);
  border-color: rgba(95, 184, 242, 0.48);
  transform: translateY(-1px);
}

.header-quick-btn:hover::after {
  transform: translateX(-120%);
}

.header-quick-btn.is-active {
  border-color: rgba(99, 191, 247, 0.72);
  background: linear-gradient(150deg, rgba(99, 191, 247, 0.3), rgba(99, 191, 247, 0.1));
  box-shadow: 0 8px 16px rgba(8, 14, 21, 0.2);
}

.header-quick-glyph {
  width: 9px;
  height: 9px;
  border-radius: 3px;
  background: linear-gradient(160deg, rgba(195, 236, 255, 0.9), rgba(123, 206, 255, 0.6));
  box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.16), 0 0 10px rgba(116, 205, 255, 0.3);
  flex: 0 0 auto;
}

.header-quick-icon {
  width: 16px;
  height: 16px;
  border-radius: 6px;
  border: 1px solid rgba(141, 208, 248, 0.36);
  background: linear-gradient(145deg, rgba(129, 199, 242, 0.22), rgba(129, 199, 242, 0.08));
  color: #d7f0ff;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex: 0 0 auto;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.16);
}

.header-quick-icon svg {
  width: 10px;
  height: 10px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

#headerQuickGotoSubjects .header-quick-glyph {
  background: linear-gradient(160deg, rgba(188, 233, 255, 0.95), rgba(99, 197, 255, 0.66));
}

#headerQuickGotoChapters .header-quick-glyph {
  background: linear-gradient(160deg, rgba(176, 240, 255, 0.95), rgba(76, 215, 255, 0.64));
}

#headerQuickTabBank .header-quick-glyph {
  background: linear-gradient(160deg, rgba(202, 231, 255, 0.95), rgba(123, 179, 255, 0.64));
}

#headerQuickTabPractice .header-quick-glyph {
  background: linear-gradient(160deg, rgba(189, 247, 232, 0.95), rgba(86, 216, 172, 0.64));
}

#headerQuickTabExam .header-quick-glyph {
  background: linear-gradient(160deg, rgba(255, 218, 189, 0.95), rgba(255, 163, 96, 0.7));
}

.premium-header-actions {
  align-content: start;
  justify-items: end;
  gap: 5px;
}

.settings-trigger {
  min-width: 116px;
  min-height: 34px;
  padding: 4px 10px;
  border-radius: 10px;
  gap: 6px;
  font-size: 0.76rem;
  font-weight: 700;
  border-color: rgba(133, 179, 214, 0.34);
  background: linear-gradient(150deg, rgba(126, 176, 210, 0.22), rgba(126, 176, 210, 0.08));
  position: relative;
  overflow: hidden;
}

.settings-trigger::after {
  content: "";
  position: absolute;
  inset: -40% auto -40% -28%;
  width: 28%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.24), transparent);
  transform: skewX(-18deg) translateX(-180%);
  animation: settings-trigger-shine 4.8s ease-in-out infinite;
}

.settings-trigger-status {
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: rgba(112, 233, 170, 0.95);
  box-shadow: 0 0 0 4px rgba(112, 233, 170, 0.18);
  animation: settings-status-pulse 2.4s ease-in-out infinite;
  flex: 0 0 auto;
}

.settings-trigger[aria-expanded="true"] {
  border-color: rgba(101, 192, 247, 0.68);
  background: linear-gradient(150deg, rgba(101, 192, 247, 0.28), rgba(101, 192, 247, 0.12));
}

.settings-panel {
  margin-top: 6px;
}

@keyframes settings-status-pulse {
  0%,
  100% {
    box-shadow: 0 0 0 0 rgba(112, 233, 170, 0.34);
  }
  50% {
    box-shadow: 0 0 0 6px rgba(112, 233, 170, 0.1);
  }
}

@keyframes settings-trigger-shine {
  0%,
  72%,
  100% {
    transform: skewX(-18deg) translateX(-180%);
  }
  86% {
    transform: skewX(-18deg) translateX(520%);
  }
}

@keyframes header-shell-float {
  0%,
  100% {
    box-shadow: 0 14px 28px rgba(5, 10, 16, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.06);
  }
  50% {
    box-shadow: 0 17px 32px rgba(5, 10, 16, 0.34), inset 0 1px 0 rgba(255, 255, 255, 0.08);
  }
}

html[data-theme^="light-"] .premium-topbar {
  background:
    linear-gradient(154deg, rgba(255, 255, 255, 0.94), rgba(244, 249, 255, 0.84)),
    radial-gradient(circle at 12% 14%, rgba(88, 163, 221, 0.14), transparent 40%);
  border-color: rgba(47, 82, 111, 0.22);
  box-shadow: 0 14px 24px rgba(24, 55, 83, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.94);
}

html[data-theme^="light-"] .premium-title-group p,
html[data-theme^="light-"] .header-quick-pill {
  color: #4e657b;
}

html[data-theme^="light-"] .header-quick-pill,
html[data-theme^="light-"] .header-quick-actions,
html[data-theme^="light-"] .header-quick-btn,
html[data-theme^="light-"] .settings-trigger {
  border-color: rgba(47, 82, 111, 0.2);
  background: rgba(255, 255, 255, 0.86);
}

html[data-theme^="light-"] .header-quick-icon {
  color: #2d7fbf;
  border-color: rgba(47, 130, 193, 0.28);
  background: linear-gradient(145deg, rgba(47, 130, 193, 0.17), rgba(47, 130, 193, 0.05));
}

html[data-theme^="light-"] .header-brand-icon {
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.84), 0 10px 18px rgba(24, 55, 83, 0.18);
}

@media (max-width: 920px) {
  body:not(.force-desktop) .premium-topbar {
    padding: 8px;
    border-radius: 16px;
  }

  body:not(.force-desktop) .header-title-stack p {
    white-space: normal;
  }

  body:not(.force-desktop) .header-quick-actions {
    padding: 2px;
  }

  body:not(.force-desktop) .premium-header-actions {
    justify-items: stretch;
  }

  body:not(.force-desktop) .settings-trigger {
    width: 100%;
    justify-content: center;
  }
}

body.force-mobile .premium-topbar {
  padding: 8px;
  border-radius: 16px;
}

body.force-mobile .header-title-stack p {
  white-space: normal;
}

body.force-mobile .header-quick-actions {
  padding: 2px;
}

body.force-mobile .settings-trigger {
  width: 100%;
  justify-content: center;
}

.control-hint {
  margin-top: -1px;
  color: var(--text-muted);
  font-size: 0.65rem;
  line-height: 1.45;
  opacity: 0.9;
}

/* Mobile stability pack: compact spacing, static motion, reliable scrolling */
:is(body.force-mobile, body.auto-mobile) {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

:is(body.force-mobile, body.auto-mobile) .app-shell {
  width: min(100vw - 12px, 980px);
  padding: 10px 0 16px;
}

:is(body.force-mobile, body.auto-mobile) .surface {
  padding: 10px;
  border-radius: 14px;
  min-height: 0;
}

:is(body.force-mobile, body.auto-mobile) .tab-panel,
:is(body.force-mobile, body.auto-mobile) .question-bank-panel,
:is(body.force-mobile, body.auto-mobile) .practice-mode-panel,
:is(body.force-mobile, body.auto-mobile) .exam-mode-panel,
:is(body.force-mobile, body.auto-mobile) .chapter-map-panel {
  gap: 8px;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar,
:is(body.force-mobile, body.auto-mobile) .chapter-map-toolbar,
:is(body.force-mobile, body.auto-mobile) .practice-focus-card,
:is(body.force-mobile, body.auto-mobile) .exam-builder-form,
:is(body.force-mobile, body.auto-mobile) .exam-paper {
  padding: 8px;
  border-radius: 12px;
}

:is(body.force-mobile, body.auto-mobile) .settings-panel-layout,
:is(body.force-mobile, body.auto-mobile) .settings-panel-workspace,
:is(body.force-mobile, body.auto-mobile) .chapter-map-legend-list,
:is(body.force-mobile, body.auto-mobile) .header-quick-actions,
:is(body.force-mobile, body.auto-mobile) .schema-pre {
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: auto;
}

:is(body.force-mobile, body.auto-mobile) .settings-panel-layout {
  max-height: min(72vh, 560px);
  overflow: auto;
}

:is(body.force-mobile, body.auto-mobile) .chapter-map-stage,
:is(body.force-mobile, body.auto-mobile) .chapter-map-canvas {
  min-height: 248px;
}

:is(body.force-mobile, body.auto-mobile) .chapter-map-legend {
  min-height: 0;
}

:is(body.force-mobile, body.auto-mobile) .chapter-map-legend-list {
  max-height: min(32vh, 240px);
}

:is(body.force-mobile, body.auto-mobile) .chapter-map-actions {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .chapter-map-action-btn {
  min-height: 31px;
  padding: 4px 7px;
  font-size: 0.7rem;
  justify-content: center;
}

:is(body.force-mobile, body.auto-mobile) .chapter-map-node-title {
  font-size: 0.64rem;
}

:is(body.force-mobile, body.auto-mobile) .chapter-map-node-meta text {
  font-size: 0.56rem;
}

:is(body.force-mobile, body.auto-mobile) .chapter-map-node-review-text {
  font-size: 0.52rem;
}

:is(body.force-mobile, body.auto-mobile) .chapter-map-blobs,
:is(body.force-mobile, body.auto-mobile) .chapter-map-particles {
  display: none;
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions > .practice-action-btn,
:is(body.force-mobile, body.auto-mobile) .practice-focus-actions > .practice-solution-stack {
  flex: initial;
}

:is(body.force-mobile, body.auto-mobile) .practice-action-btn {
  min-height: 32px;
  font-size: 0.76rem;
}

:is(body.force-mobile, body.auto-mobile) .exam-chapter-grid,
:is(body.force-mobile, body.auto-mobile) .exam-builder-controls {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-controls .exam-generate-btn {
  grid-column: 1 / -1;
}

:is(body.force-mobile, body.auto-mobile) .exam-chapter-check-ui {
  min-height: 50px;
  padding: 7px 8px;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-list {
  gap: 8px;
}

:is(body.force-mobile, body.auto-mobile) .stagger-item {
  opacity: 1 !important;
  transform: none !important;
}

:is(body.force-mobile, body.auto-mobile) * {
  animation: none !important;
  transition-duration: 0ms !important;
  transition-delay: 0ms !important;
}

@media (max-width: 920px) {
  body:not(.force-desktop) .app-shell {
    width: min(100vw - 12px, 980px);
    padding: 10px 0 16px;
  }

  body:not(.force-desktop) .surface {
    padding: 10px;
    border-radius: 14px;
    min-height: 0;
  }

  body:not(.force-desktop) .settings-panel-layout,
  body:not(.force-desktop) .settings-panel-workspace,
  body:not(.force-desktop) .chapter-map-legend-list,
  body:not(.force-desktop) .header-quick-actions,
  body:not(.force-desktop) .schema-pre {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: auto;
  }

  body:not(.force-desktop) .chapter-map-stage,
  body:not(.force-desktop) .chapter-map-canvas {
    min-height: 248px;
  }

  body:not(.force-desktop) .chapter-map-actions {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 6px;
  }

  body:not(.force-desktop) .chapter-map-action-btn {
    min-height: 31px;
    padding: 4px 7px;
    font-size: 0.7rem;
    justify-content: center;
  }

  body:not(.force-desktop) .practice-focus-actions {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 6px;
  }

  body:not(.force-desktop) .practice-action-btn {
    min-height: 32px;
    font-size: 0.76rem;
  }

  body:not(.force-desktop) .exam-chapter-grid,
  body:not(.force-desktop) .exam-builder-controls {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 6px;
  }

  body:not(.force-desktop) .exam-builder-controls .exam-generate-btn {
    grid-column: 1 / -1;
  }

  body:not(.force-desktop) .chapter-map-blobs,
  body:not(.force-desktop) .chapter-map-particles {
    display: none;
  }

  body:not(.force-desktop) .stagger-item {
    opacity: 1 !important;
    transform: none !important;
  }

  body:not(.force-desktop) * {
    animation: none !important;
    transition-duration: 0ms !important;
    transition-delay: 0ms !important;
  }
}

@media (max-width: 560px) {
  :is(body.force-mobile, body.auto-mobile) .exam-chapter-grid,
  :is(body.force-mobile, body.auto-mobile) .exam-builder-controls,
  body:not(.force-desktop) .exam-chapter-grid,
  body:not(.force-desktop) .exam-builder-controls {
    grid-template-columns: 1fr;
  }

  :is(body.force-mobile, body.auto-mobile) .chapter-map-actions,
  body:not(.force-desktop) .chapter-map-actions {
    grid-template-columns: 1fr;
  }
}

/* Desktop premium revamp: header + timers */
:is(body.force-desktop, body.auto-desktop) .topbar.premium-topbar {
  grid-template-columns: minmax(0, 1fr) 188px;
  align-items: stretch;
  gap: 12px;
  padding: 10px 12px;
  border-radius: 20px;
  border: 1px solid rgba(138, 181, 216, 0.28);
  background:
    linear-gradient(148deg, rgba(7, 16, 26, 0.92), rgba(9, 21, 34, 0.8)),
    radial-gradient(circle at 8% 14%, rgba(92, 189, 246, 0.2), transparent 44%);
  box-shadow: 0 16px 34px rgba(4, 9, 15, 0.34), inset 0 1px 0 rgba(255, 255, 255, 0.06);
  overflow: visible;
}

:is(body.force-desktop, body.auto-desktop) .premium-topbar::before {
  background:
    radial-gradient(circle at 85% 12%, rgba(92, 189, 246, 0.24), transparent 38%),
    linear-gradient(108deg, rgba(255, 255, 255, 0.06), transparent 56%);
  opacity: 0.85;
}

:is(body.force-desktop, body.auto-desktop) .premium-topbar::after {
  inset: auto 16px 10px 16px;
  width: auto;
  background: linear-gradient(90deg, transparent, rgba(119, 213, 255, 0.62), transparent);
}

:is(body.force-desktop, body.auto-desktop) .premium-topbar > .title-group {
  display: grid;
  gap: 9px;
  padding: 8px 9px;
  border-radius: 14px;
  border: 1px solid rgba(132, 176, 209, 0.22);
  background:
    radial-gradient(circle at 12% 18%, rgba(95, 183, 238, 0.14), transparent 46%),
    linear-gradient(148deg, rgba(127, 127, 127, 0.1), rgba(127, 127, 127, 0.03));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

:is(body.force-desktop, body.auto-desktop) .header-title-row {
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 0;
}

:is(body.force-desktop, body.auto-desktop) .header-brand-icon {
  width: 36px;
  height: 36px;
  border-radius: 12px;
}

:is(body.force-desktop, body.auto-desktop) .header-title-stack {
  min-width: 0;
  display: grid;
  gap: 2px;
}

:is(body.force-desktop, body.auto-desktop) .premium-title-group h1 {
  margin: 0;
  font-size: clamp(1.02rem, 0.92vw + 0.72rem, 1.34rem);
  line-height: 1.25;
}

:is(body.force-desktop, body.auto-desktop) .premium-title-group p {
  display: block;
  margin: 0;
  font-size: 0.72rem;
  color: rgba(186, 210, 229, 0.88);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

:is(body.force-desktop, body.auto-desktop) .header-quickline {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 6px;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-pill {
  min-height: 24px;
  border-radius: 8px;
  padding: 2px 8px;
  font-size: 0.71rem;
  border-color: rgba(134, 180, 214, 0.3);
  background: rgba(127, 171, 203, 0.12);
  color: #c3dcf0;
  overflow: hidden;
  text-overflow: ellipsis;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-actions {
  display: grid;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap: 6px;
  overflow: visible;
  padding: 4px;
  border-radius: 12px;
  border: 1px solid rgba(132, 177, 212, 0.22);
  background: rgba(127, 169, 197, 0.08);
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn {
  min-width: 0;
  min-height: 34px;
  padding: 4px 8px;
  border-radius: 10px;
  gap: 6px;
  justify-content: center;
  border-color: rgba(134, 180, 214, 0.2);
  background: linear-gradient(145deg, rgba(127, 178, 212, 0.12), rgba(127, 178, 212, 0.04));
  font-size: 0.73rem;
  font-weight: 700;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn span:last-child {
  display: block;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn::after {
  display: none;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn:hover {
  transform: translateY(-1px);
  border-color: rgba(97, 193, 247, 0.56);
  background: linear-gradient(145deg, rgba(97, 193, 247, 0.24), rgba(97, 193, 247, 0.1));
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn.is-active {
  border-color: rgba(108, 204, 255, 0.74);
  background: linear-gradient(146deg, rgba(108, 204, 255, 0.34), rgba(108, 204, 255, 0.14));
  box-shadow: 0 10px 18px rgba(6, 18, 30, 0.3);
}

:is(body.force-desktop, body.auto-desktop) .header-quick-icon {
  width: 17px;
  height: 17px;
  border-radius: 6px;
}

:is(body.force-desktop, body.auto-desktop) .premium-header-actions {
  position: relative;
  align-content: start;
  justify-items: stretch;
  gap: 0;
}

:is(body.force-desktop, body.auto-desktop) .settings-trigger {
  width: 100%;
  min-height: 40px;
  border-radius: 12px;
  font-size: 0.77rem;
  font-weight: 700;
  border-color: rgba(126, 176, 212, 0.36);
  background:
    radial-gradient(circle at 22% 20%, rgba(255, 255, 255, 0.18), transparent 40%),
    linear-gradient(150deg, rgba(128, 182, 219, 0.24), rgba(128, 182, 219, 0.08));
}

:is(body.force-desktop, body.auto-desktop) .settings-panel.settings-panel-premium {
  position: absolute;
  top: calc(100% + 9px);
  inset-inline-end: 0;
  width: min(780px, 78vw);
  margin-top: 0;
  z-index: 120;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-premium {
  --settings-panel-open-max: min(74vh, 700px);
}

:is(body.force-desktop, body.auto-desktop) .question-solve-strip {
  border-radius: 15px;
  border: 1px solid rgba(126, 185, 223, 0.34);
  padding: 10px 11px;
  background:
    radial-gradient(circle at 9% 24%, rgba(96, 194, 248, 0.26), transparent 44%),
    linear-gradient(150deg, rgba(10, 19, 30, 0.68), rgba(9, 17, 26, 0.56));
  box-shadow: 0 12px 24px rgba(4, 14, 24, 0.24), inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

:is(body.force-desktop, body.auto-desktop) .question-solve-strip.is-running {
  border-color: rgba(109, 213, 255, 0.68);
  box-shadow: 0 16px 28px rgba(4, 18, 30, 0.32), inset 0 1px 0 rgba(255, 255, 255, 0.12);
}

:is(body.force-desktop, body.auto-desktop) .question-solve-value {
  min-width: 110px;
  font-size: 1rem;
  letter-spacing: 0.12em;
  color: #d8f6ff;
  text-shadow: 0 0 14px rgba(110, 218, 255, 0.26);
}

:is(body.force-desktop, body.auto-desktop) .question-solve-state {
  font-size: 0.7rem;
}

:is(body.force-desktop, body.auto-desktop) .question-solve-btn {
  min-height: 32px;
  padding: 5px 11px;
  border-radius: 999px;
  font-size: 0.72rem;
}

:is(body.force-desktop, body.auto-desktop) .question-float-timer {
  top: calc(env(safe-area-inset-top, 0px) + 92px);
  left: 14px;
  width: 98px;
  height: 98px;
  border-radius: 26px;
  background: conic-gradient(
    from -90deg,
    rgba(111, 213, 255, 0.98) 0deg,
    rgba(127, 248, 218, 0.96) var(--timer-progress-deg),
    rgba(75, 103, 128, 0.26) var(--timer-progress-deg),
    rgba(75, 103, 128, 0.26) 360deg
  );
  box-shadow: 0 18px 30px rgba(4, 12, 22, 0.35), 0 0 0 1px rgba(136, 180, 211, 0.36);
}

:is(body.force-desktop, body.auto-desktop) .question-float-ring i {
  inset: 13%;
  border-color: rgba(218, 244, 255, 0.34);
}

:is(body.force-desktop, body.auto-desktop) .question-float-core {
  border-radius: 22px;
  border-color: rgba(142, 194, 230, 0.34);
  background:
    radial-gradient(circle at 24% 16%, rgba(105, 204, 255, 0.3), transparent 44%),
    linear-gradient(150deg, rgba(7, 16, 26, 0.94), rgba(10, 20, 30, 0.88));
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

:is(body.force-desktop, body.auto-desktop) .question-float-label {
  font-size: 0.58rem;
  letter-spacing: 0.04em;
}

:is(body.force-desktop, body.auto-desktop) .question-float-value {
  font-size: 0.88rem;
  letter-spacing: 0.1em;
}

:is(body.force-desktop, body.auto-desktop) .question-float-meta {
  font-size: 0.56rem;
}

:is(body.force-desktop, body.auto-desktop) .exam-countdown-panel {
  border-radius: 14px;
  border: 1px solid rgba(116, 202, 252, 0.4);
  background:
    radial-gradient(circle at 9% 18%, rgba(104, 198, 248, 0.24), transparent 42%),
    linear-gradient(145deg, rgba(74, 181, 243, 0.16), rgba(74, 181, 243, 0.06));
  box-shadow: 0 14px 24px rgba(8, 33, 49, 0.24);
}

:is(body.force-desktop, body.auto-desktop) .exam-countdown-value {
  font-size: 1.08rem;
  letter-spacing: 0.1em;
  text-shadow: 0 0 14px rgba(105, 208, 255, 0.22);
}

:is(body.force-desktop, body.auto-desktop) .exam-countdown-track {
  height: 8px;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .topbar.premium-topbar {
  background:
    linear-gradient(148deg, rgba(255, 255, 255, 0.95), rgba(245, 251, 255, 0.86)),
    radial-gradient(circle at 8% 14%, rgba(84, 164, 224, 0.18), transparent 44%);
  border-color: rgba(47, 82, 111, 0.22);
  box-shadow: 0 16px 28px rgba(24, 55, 83, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.94);
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .premium-topbar > .title-group {
  border-color: rgba(47, 82, 111, 0.2);
  background:
    radial-gradient(circle at 12% 18%, rgba(47, 130, 193, 0.14), transparent 46%),
    linear-gradient(148deg, rgba(255, 255, 255, 0.92), rgba(247, 251, 255, 0.86));
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .header-quick-pill,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .header-quick-actions,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .header-quick-btn,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-trigger {
  border-color: rgba(47, 82, 111, 0.22);
  background: rgba(255, 255, 255, 0.88);
  color: #4a6881;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .question-float-core {
  background:
    radial-gradient(circle at 24% 16%, rgba(47, 130, 193, 0.2), transparent 44%),
    linear-gradient(150deg, rgba(255, 255, 255, 0.94), rgba(246, 251, 255, 0.9));
  border-color: rgba(47, 82, 111, 0.22);
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .question-float-label {
  color: #3d6787;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .question-float-value {
  color: #1f638f;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .question-float-meta {
  color: #4b7695;
}

/* Mobile premium pack: timer-first + compact sizing */
:is(body.force-mobile, body.auto-mobile) .topbar.premium-topbar {
  grid-template-columns: 1fr;
  gap: 8px;
  padding: 8px;
  border-radius: 16px;
}

:is(body.force-mobile, body.auto-mobile) .premium-topbar > .title-group {
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .premium-title-group h1 {
  font-size: clamp(1rem, 3.8vw, 1.2rem);
  line-height: 1.28;
}

:is(body.force-mobile, body.auto-mobile) .premium-title-group p {
  font-size: 0.72rem;
  line-height: 1.55;
}

:is(body.force-mobile, body.auto-mobile) .header-quickline {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 5px;
}

:is(body.force-mobile, body.auto-mobile) .header-quick-pill {
  min-height: 23px;
  font-size: 0.69rem;
  padding: 2px 7px;
}

:is(body.force-mobile, body.auto-mobile) .header-quick-actions {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  gap: 5px;
  padding: 3px;
  scrollbar-width: thin;
  scroll-snap-type: x proximity;
}

:is(body.force-mobile, body.auto-mobile) .header-quick-btn {
  min-height: 32px;
  padding: 4px 8px;
  border-radius: 9px;
  font-size: 0.73rem;
  white-space: nowrap;
  scroll-snap-align: start;
}

:is(body.force-mobile, body.auto-mobile) .settings-trigger {
  width: 100%;
  min-height: 36px;
  justify-content: center;
}

:is(body.force-mobile, body.auto-mobile) .question-card {
  border-radius: 13px;
  padding: 9px;
}

:is(body.force-mobile, body.auto-mobile) .question-head {
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .question-body,
:is(body.force-mobile, body.auto-mobile) .disclosure {
  font-size: 0.91rem;
  line-height: 1.76;
}

:is(body.force-mobile, body.auto-mobile) .question-solve-strip {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
  border-radius: 14px;
  border: 1px solid rgba(122, 191, 234, 0.36);
  padding: 8px 9px;
  background:
    radial-gradient(circle at 9% 18%, rgba(94, 194, 248, 0.24), transparent 43%),
    linear-gradient(150deg, rgba(10, 18, 28, 0.66), rgba(9, 17, 26, 0.54));
  box-shadow: 0 10px 18px rgba(6, 19, 31, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

:is(body.force-mobile, body.auto-mobile) .question-solve-main {
  display: grid;
  grid-template-columns: auto minmax(0, 1fr);
  align-items: center;
  gap: 8px;
}

:is(body.force-mobile, body.auto-mobile) .question-solve-orb {
  width: 28px;
  height: 28px;
}

:is(body.force-mobile, body.auto-mobile) .question-solve-value {
  min-width: 0;
  font-size: 0.95rem;
  letter-spacing: 0.09em;
}

:is(body.force-mobile, body.auto-mobile) .question-solve-state {
  font-size: 0.69rem;
}

:is(body.force-mobile, body.auto-mobile) .question-solve-actions {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .question-solve-btn {
  min-height: 33px;
  padding: 4px 6px;
  border-radius: 10px;
  font-size: 0.71rem;
  white-space: nowrap;
}

:is(body.force-mobile, body.auto-mobile) .question-float-timer {
  top: auto;
  left: 10px;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 12px);
  width: 86px;
  height: 86px;
  border-radius: 24px;
  background: conic-gradient(
    from -90deg,
    rgba(108, 213, 255, 0.98) 0deg,
    rgba(122, 244, 214, 0.96) var(--timer-progress-deg),
    rgba(75, 103, 128, 0.26) var(--timer-progress-deg),
    rgba(75, 103, 128, 0.26) 360deg
  );
  box-shadow: 0 14px 24px rgba(4, 12, 22, 0.34), 0 0 0 1px rgba(136, 180, 211, 0.34);
}

:is(body.force-mobile, body.auto-mobile) .question-float-core {
  border-radius: 20px;
  border-color: rgba(135, 188, 224, 0.32);
  background:
    radial-gradient(circle at 24% 16%, rgba(97, 204, 255, 0.28), transparent 44%),
    linear-gradient(150deg, rgba(7, 16, 26, 0.93), rgba(10, 20, 30, 0.86));
}

:is(body.force-mobile, body.auto-mobile) .question-float-label {
  font-size: 0.56rem;
}

:is(body.force-mobile, body.auto-mobile) .question-float-value {
  font-size: 0.84rem;
  letter-spacing: 0.09em;
}

:is(body.force-mobile, body.auto-mobile) .question-float-meta {
  font-size: 0.55rem;
}

:is(body.force-mobile, body.auto-mobile) .exam-countdown-panel {
  border-radius: 13px;
  border: 1px solid rgba(117, 202, 252, 0.4);
  padding: 8px 9px;
  background:
    radial-gradient(circle at 10% 18%, rgba(101, 198, 248, 0.24), transparent 42%),
    linear-gradient(145deg, rgba(74, 181, 243, 0.16), rgba(74, 181, 243, 0.06));
  box-shadow: 0 10px 18px rgba(8, 33, 49, 0.24);
}

:is(body.force-mobile, body.auto-mobile) .exam-countdown-top {
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .exam-countdown-label {
  font-size: 0.76rem;
}

:is(body.force-mobile, body.auto-mobile) .exam-countdown-value {
  font-size: 0.98rem;
  letter-spacing: 0.08em;
}

:is(body.force-mobile, body.auto-mobile) .exam-countdown-track {
  height: 7px;
}

:is(body.force-mobile, body.auto-mobile) .qb-overview {
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

:is(body.force-mobile, body.auto-mobile) .qb-stat-chip {
  padding: 7px 8px;
}

html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .question-solve-strip {
  border-color: rgba(47, 130, 193, 0.3);
  background:
    radial-gradient(circle at 11% 22%, rgba(47, 130, 193, 0.18), transparent 44%),
    linear-gradient(150deg, rgba(255, 255, 255, 0.94), rgba(246, 251, 255, 0.86));
}

html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .question-solve-value {
  color: #205f8a;
}

html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .question-float-core {
  background:
    radial-gradient(circle at 24% 16%, rgba(47, 130, 193, 0.2), transparent 44%),
    linear-gradient(150deg, rgba(255, 255, 255, 0.94), rgba(246, 251, 255, 0.9));
  border-color: rgba(47, 82, 111, 0.22);
}

html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .question-float-label {
  color: #3f6b8c;
}

html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .question-float-value {
  color: #1f638f;
}

html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .question-float-meta {
  color: #4a7697;
}

html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .exam-countdown-panel {
  border-color: rgba(47, 130, 193, 0.28);
  background: linear-gradient(145deg, rgba(47, 130, 193, 0.16), rgba(255, 255, 255, 0.86));
}

@media (max-width: 560px) {
  :is(body.force-mobile, body.auto-mobile) .question-float-timer {
    width: 76px;
    height: 76px;
    border-radius: 20px;
    left: 8px;
    bottom: calc(env(safe-area-inset-bottom, 0px) + 10px);
  }

  :is(body.force-mobile, body.auto-mobile) .question-float-core {
    border-radius: 16px;
  }

  :is(body.force-mobile, body.auto-mobile) .question-float-value {
    font-size: 0.78rem;
  }

  :is(body.force-mobile, body.auto-mobile) .question-solve-actions {
    grid-template-columns: 1fr;
  }
}

/* Mobile premium pack: practice + exam panels */
:is(body.force-mobile, body.auto-mobile) .practice-mode-panel,
:is(body.force-mobile, body.auto-mobile) .exam-mode-panel {
  gap: 9px;
}

:is(body.force-mobile, body.auto-mobile) .practice-toolbar {
  padding: 9px;
  border-radius: 14px;
  border: 1px solid rgba(132, 183, 218, 0.3);
  background:
    radial-gradient(circle at 10% 18%, rgba(97, 191, 246, 0.22), transparent 42%),
    linear-gradient(152deg, rgba(12, 22, 33, 0.7), rgba(8, 16, 26, 0.6));
  box-shadow: 0 12px 22px rgba(4, 14, 24, 0.24), inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

:is(body.force-mobile, body.auto-mobile) .practice-toolbar-top {
  display: grid;
  grid-template-columns: 1fr;
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .practice-toolbar-title {
  font-size: 0.9rem;
}

:is(body.force-mobile, body.auto-mobile) .practice-toolbar-progress {
  justify-content: center;
  min-height: 29px;
  font-size: 0.74rem;
  border-color: rgba(132, 183, 218, 0.28);
  background: rgba(127, 173, 206, 0.12);
}

:is(body.force-mobile, body.auto-mobile) .practice-toolbar-toggle {
  width: 100%;
  margin-inline-start: 0;
  justify-content: center;
}

:is(body.force-mobile, body.auto-mobile) .practice-profile-bar {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .practice-profile-chip {
  min-height: 32px;
  padding: 4px 7px;
  border-radius: 10px;
  font-size: 0.72rem;
  border-color: rgba(134, 183, 217, 0.26);
  background: rgba(127, 173, 206, 0.1);
}

:is(body.force-mobile, body.auto-mobile) .practice-options-bar {
  display: grid;
  grid-template-columns: 1fr;
}

:is(body.force-mobile, body.auto-mobile) .practice-solved-switch {
  width: 100%;
  justify-content: center;
}

:is(body.force-mobile, body.auto-mobile) .practice-question-card {
  border-radius: 14px;
  border: 1px solid rgba(131, 183, 217, 0.24);
  background:
    radial-gradient(circle at 88% 8%, rgba(96, 191, 246, 0.2), transparent 40%),
    linear-gradient(150deg, rgba(12, 21, 31, 0.64), rgba(8, 16, 25, 0.52));
  box-shadow: 0 12px 22px rgba(5, 15, 24, 0.22), inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 7px;
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions > .practice-action-btn,
:is(body.force-mobile, body.auto-mobile) .practice-focus-actions > .practice-solution-stack {
  flex: initial;
}

:is(body.force-mobile, body.auto-mobile) .practice-solution-stack {
  display: grid;
  gap: 7px;
}

:is(body.force-mobile, body.auto-mobile) .practice-action-btn {
  min-height: 34px;
  border-radius: 10px;
  font-size: 0.74rem;
  border-color: rgba(134, 183, 217, 0.24);
  background: rgba(127, 173, 206, 0.1);
}

:is(body.force-mobile, body.auto-mobile) .practice-next-btn {
  grid-column: 1 / -1;
}

:is(body.force-mobile, body.auto-mobile) .practice-reveal-box {
  border-radius: 12px;
  border-color: rgba(131, 183, 217, 0.24);
  background: rgba(127, 173, 206, 0.08);
}

:is(body.force-mobile, body.auto-mobile) .practice-reveal-content {
  font-size: 0.9rem;
  line-height: 1.8;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-form {
  padding: 10px;
  border-radius: 15px;
  border-color: rgba(132, 183, 218, 0.3);
  background:
    radial-gradient(circle at 11% 12%, rgba(96, 191, 246, 0.22), transparent 42%),
    linear-gradient(152deg, rgba(12, 22, 33, 0.7), rgba(8, 16, 26, 0.6));
  box-shadow: 0 12px 22px rgba(4, 14, 24, 0.24), inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-head p {
  font-size: 0.78rem;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-stats {
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .exam-stat-chip {
  min-height: 30px;
  padding: 4px 8px;
}

:is(body.force-mobile, body.auto-mobile) .exam-pane {
  border-radius: 13px;
  border: 1px solid rgba(132, 183, 218, 0.24);
  background: rgba(127, 173, 206, 0.08);
  padding: 8px;
}

:is(body.force-mobile, body.auto-mobile) .exam-chapter-toolbar {
  gap: 7px;
}

:is(body.force-mobile, body.auto-mobile) .exam-chip-btn {
  min-height: 32px;
  border-radius: 10px;
  font-size: 0.72rem;
  padding: 4px 8px;
}

:is(body.force-mobile, body.auto-mobile) .exam-chapter-grid {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 7px;
}

:is(body.force-mobile, body.auto-mobile) .exam-chapter-check-ui {
  min-height: 56px;
  border-radius: 11px;
  padding: 7px 8px;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-controls {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 7px;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-controls input,
:is(body.force-mobile, body.auto-mobile) .exam-builder-controls select {
  min-height: 36px;
  border-radius: 10px;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-controls .exam-generate-btn {
  grid-column: 1 / -1;
  min-height: 38px;
  border-radius: 11px;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-actions {
  display: grid;
  grid-template-columns: 1fr;
  gap: 7px;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper {
  border-radius: 14px;
  padding: 10px;
  border: 1px solid rgba(132, 183, 218, 0.24);
  background:
    radial-gradient(circle at 10% 10%, rgba(96, 191, 246, 0.16), transparent 44%),
    linear-gradient(152deg, rgba(12, 22, 33, 0.58), rgba(8, 16, 26, 0.5));
  box-shadow: 0 10px 20px rgba(5, 15, 24, 0.22);
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-head {
  padding-bottom: 8px;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-title {
  font-size: 0.94rem;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-head p {
  font-size: 0.78rem;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-meta-grid,
:is(body.force-mobile, body.auto-mobile) .exam-paper-instruction-grid {
  grid-template-columns: 1fr;
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-list {
  margin-top: 10px;
  padding-inline-end: 0;
  gap: 9px;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-item {
  border-radius: 11px;
  padding: 7px 8px;
}

:is(body.force-mobile, body.auto-mobile) .exam-answer-key,
:is(body.force-mobile, body.auto-mobile) .exam-eval-panel {
  border-radius: 12px;
  padding: 8px;
}

:is(body.force-mobile, body.auto-mobile) .exam-eval-controls {
  display: grid;
  grid-template-columns: 1fr;
}

:is(body.force-mobile, body.auto-mobile) .exam-eval-input,
:is(body.force-mobile, body.auto-mobile) .exam-eval-btn {
  min-height: 36px;
  width: 100%;
}

html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .practice-toolbar,
html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .practice-question-card,
html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .exam-builder-form,
html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .exam-paper {
  border-color: rgba(47, 82, 111, 0.22);
  background:
    radial-gradient(circle at 11% 12%, rgba(47, 130, 193, 0.14), transparent 42%),
    linear-gradient(152deg, rgba(255, 255, 255, 0.94), rgba(246, 251, 255, 0.88));
}

@media (max-width: 560px) {
  :is(body.force-mobile, body.auto-mobile) .practice-profile-bar {
    grid-template-columns: 1fr;
  }

  :is(body.force-mobile, body.auto-mobile) .exam-chapter-grid,
  :is(body.force-mobile, body.auto-mobile) .exam-builder-controls {
    grid-template-columns: 1fr;
  }
}

/* Profile redesign: desktop premium + mobile compact without smaller fonts */
:is(body.force-desktop, body.auto-desktop) .profile-surface.profile-orbit {
  padding: 12px;
  border-radius: 20px;
  border: 1px solid hsla(var(--profile-accent-hue, 198), 64%, 64%, 0.28);
  background:
    radial-gradient(circle at 9% 14%, hsla(var(--profile-accent-hue, 198), 84%, 62%, 0.24), transparent 38%),
    radial-gradient(circle at 88% 86%, hsla(calc(var(--profile-accent-hue, 198) + 30), 80%, 58%, 0.18), transparent 42%),
    linear-gradient(138deg, rgba(8, 18, 29, 0.92), rgba(15, 31, 46, 0.86) 54%, rgba(9, 19, 31, 0.9));
  box-shadow: 0 20px 36px rgba(5, 10, 16, 0.32), inset 0 1px 0 rgba(255, 255, 255, 0.07);
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit::before {
  background:
    radial-gradient(circle at 82% 14%, rgba(122, 212, 255, 0.2), transparent 36%),
    linear-gradient(114deg, rgba(255, 255, 255, 0.06), transparent 56%);
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-shell {
  grid-template-columns: minmax(300px, 0.92fr) minmax(0, 1.08fr);
  gap: 10px;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side {
  position: relative;
  padding: 10px 11px;
  border-radius: 15px;
  border-color: rgba(136, 178, 208, 0.26);
  background:
    radial-gradient(circle at 18% 14%, rgba(101, 193, 246, 0.18), transparent 40%),
    linear-gradient(154deg, rgba(127, 127, 127, 0.1), rgba(127, 127, 127, 0.04));
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side::before {
  content: "";
  position: absolute;
  top: 10px;
  bottom: 10px;
  inset-inline-start: 74px;
  width: 1px;
  background: linear-gradient(180deg, transparent, rgba(134, 196, 234, 0.46), transparent);
  pointer-events: none;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-avatar {
  width: 54px;
  height: 54px;
  border-radius: 15px;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side h2 {
  font-size: 1.22rem;
  line-height: 1.28;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side p {
  line-height: 1.75;
}

:is(body.force-desktop, body.auto-desktop) .profile-greeting-panel {
  border-radius: 12px;
  padding: 9px 11px;
  border-color: hsla(var(--profile-accent-hue, 198), 80%, 68%, 0.4);
  background:
    radial-gradient(circle at 85% 12%, hsla(var(--profile-accent-hue, 198), 82%, 62%, 0.18), transparent 42%),
    linear-gradient(142deg, hsla(var(--profile-accent-hue, 198), 82%, 60%, 0.2), hsla(var(--profile-accent-hue, 198), 82%, 60%, 0.05));
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-main {
  grid-template-columns: minmax(0, 1.16fr) minmax(260px, 0.84fr);
  gap: 9px;
  padding: 10px;
  border-radius: 15px;
  border-color: rgba(136, 178, 208, 0.24);
  background:
    radial-gradient(circle at 88% 10%, rgba(100, 193, 246, 0.16), transparent 40%),
    linear-gradient(154deg, rgba(127, 127, 127, 0.09), rgba(127, 127, 127, 0.04));
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-grid {
  gap: 9px;
}

:is(body.force-desktop, body.auto-desktop) .orbit-field {
  border: 1px solid rgba(136, 178, 208, 0.2);
  border-radius: 12px;
  padding: 7px;
  background: rgba(127, 127, 127, 0.06);
}

:is(body.force-desktop, body.auto-desktop) .orbit-label {
  padding-inline: 2px;
}

:is(body.force-desktop, body.auto-desktop) .orbit-input-wrap {
  min-height: 42px;
  border-color: rgba(136, 178, 208, 0.24);
  background: rgba(127, 127, 127, 0.08);
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-tools {
  border-radius: 13px;
  border-color: rgba(136, 178, 208, 0.24);
  background:
    radial-gradient(circle at 12% 14%, rgba(100, 193, 246, 0.14), transparent 42%),
    linear-gradient(152deg, rgba(127, 127, 127, 0.1), rgba(127, 127, 127, 0.04));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06);
}

:is(body.force-desktop, body.auto-desktop) .orbit-json-tools {
  gap: 7px;
}

:is(body.force-desktop, body.auto-desktop) .json-text-import textarea {
  min-height: 78px;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-surface.profile-orbit {
  border-color: hsla(var(--profile-accent-hue, 198), 46%, 44%, 0.22);
  background:
    radial-gradient(circle at 9% 14%, hsla(var(--profile-accent-hue, 198), 70%, 54%, 0.18), transparent 38%),
    radial-gradient(circle at 88% 86%, hsla(calc(var(--profile-accent-hue, 198) + 26), 66%, 52%, 0.14), transparent 42%),
    linear-gradient(160deg, rgba(255, 255, 255, 0.94), rgba(246, 251, 255, 0.88));
  box-shadow: 0 16px 30px rgba(24, 55, 83, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.92);
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-side,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-main,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-tools,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .orbit-field {
  border-color: rgba(47, 82, 111, 0.18);
  background: rgba(255, 255, 255, 0.78);
}

:is(body.force-mobile, body.auto-mobile) .profile-surface.profile-orbit {
  padding: 8px;
  border-radius: 15px;
}

:is(body.force-mobile, body.auto-mobile) .profile-orbit-shell {
  gap: 7px;
}

:is(body.force-mobile, body.auto-mobile) .profile-orbit-side {
  grid-template-columns: auto minmax(0, 1fr);
  grid-template-areas:
    "avatar title"
    "avatar subtitle"
    "greeting greeting";
  gap: 4px 9px;
  align-items: center;
  align-content: start;
  padding: 8px 9px;
}

:is(body.force-mobile, body.auto-mobile) .profile-greeting-panel {
  margin-top: 1px;
  padding: 7px 9px;
}

:is(body.force-mobile, body.auto-mobile) .profile-orbit-main {
  grid-template-columns: 1fr;
  gap: 7px;
  padding: 8px;
}

:is(body.force-mobile, body.auto-mobile) .profile-orbit-grid {
  grid-template-columns: repeat(6, minmax(0, 1fr));
  gap: 7px;
}

:is(body.force-mobile, body.auto-mobile) .profile-orbit-grid > .orbit-field:nth-child(1),
:is(body.force-mobile, body.auto-mobile) .profile-orbit-grid > .orbit-field:nth-child(2) {
  grid-column: span 3;
}

:is(body.force-mobile, body.auto-mobile) .profile-orbit-grid > .orbit-field:nth-child(3) {
  grid-column: 1 / -1;
}

:is(body.force-mobile, body.auto-mobile) .orbit-field {
  gap: 5px;
}

:is(body.force-mobile, body.auto-mobile) .orbit-input-wrap {
  min-height: 40px;
  padding: 4px 8px;
}

:is(body.force-mobile, body.auto-mobile) .profile-orbit-tools {
  padding: 7px;
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .orbit-json-tools {
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .orbit-json-tools .glass-btn {
  min-height: 32px;
}

:is(body.force-mobile, body.auto-mobile) .json-text-import {
  gap: 5px;
}

:is(body.force-mobile, body.auto-mobile) .json-text-import textarea {
  min-height: 58px;
}

:is(body.force-mobile, body.auto-mobile) .json-text-actions {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 6px;
}

:is(body.force-mobile, body.auto-mobile) .json-text-actions .glass-btn {
  min-height: 32px;
}

@media (max-width: 560px) {
  :is(body.force-mobile, body.auto-mobile) .profile-orbit-grid {
    grid-template-columns: 1fr;
  }

  :is(body.force-mobile, body.auto-mobile) .profile-orbit-grid > .orbit-field:nth-child(1),
  :is(body.force-mobile, body.auto-mobile) .profile-orbit-grid > .orbit-field:nth-child(2),
  :is(body.force-mobile, body.auto-mobile) .profile-orbit-grid > .orbit-field:nth-child(3) {
    grid-column: auto;
  }
}

/* Ribbon icon text clarity pack */
:is(body.force-desktop, body.auto-desktop) .header-quick-actions {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  gap: 6px;
  scrollbar-width: thin;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn {
  flex: 0 0 auto;
  min-width: max-content;
  padding-inline: 10px;
  justify-content: flex-start;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn span:last-child,
:is(body.force-mobile, body.auto-mobile) .header-quick-btn span:last-child {
  display: inline-flex;
  align-items: center;
  min-width: 0;
  max-width: none;
  white-space: nowrap;
  overflow: visible;
  text-overflow: clip;
  padding: 2px 7px;
  border-radius: 7px;
  background: rgba(6, 14, 23, 0.42);
  color: #eaf7ff;
  text-shadow: 0 1px 9px rgba(0, 0, 0, 0.44);
  line-height: 1.28;
}

:is(body.force-mobile, body.auto-mobile) .header-quick-btn {
  flex: 0 0 auto;
  min-width: max-content;
  padding-inline: 10px;
}

.header-quick-btn,
.chapter-map-action-btn,
.settings-tab-btn,
.exam-chip-btn,
.practice-profile-chip {
  color: #e9f6ff;
  text-shadow: 0 1px 8px rgba(0, 0, 0, 0.36);
}

.settings-tab-text {
  display: inline-flex;
  align-items: center;
  padding: 1px 6px;
  border-radius: 7px;
  background: rgba(7, 14, 23, 0.34);
  color: #eaf6ff;
  text-shadow: 0 1px 8px rgba(0, 0, 0, 0.38);
}

.chapter-map-action-btn,
.exam-chip-btn,
.practice-profile-chip {
  font-weight: 700;
  letter-spacing: 0.01em;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .header-quick-btn span:last-child,
html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .header-quick-btn span:last-child,
html[data-theme^="light-"] .settings-tab-text {
  background: rgba(255, 255, 255, 0.9);
  color: #2e5f84;
  text-shadow: none;
}

html[data-theme^="light-"] .header-quick-btn,
html[data-theme^="light-"] .chapter-map-action-btn,
html[data-theme^="light-"] .settings-tab-btn,
html[data-theme^="light-"] .exam-chip-btn,
html[data-theme^="light-"] .practice-profile-chip {
  color: #2f5f83;
  text-shadow: none;
}

/* Desktop settings redesign: layout, sizing, visual hierarchy */
:is(body.force-desktop, body.auto-desktop) .premium-header-actions {
  width: 208px;
}

:is(body.force-desktop, body.auto-desktop) .settings-trigger {
  min-height: 42px;
  font-size: 0.8rem;
  border-radius: 13px;
  padding: 6px 12px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel.settings-panel-premium {
  width: min(1000px, 88vw);
  top: calc(100% + 10px);
  inset-inline-end: 0;
  border-radius: 18px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-premium {
  --settings-panel-open-max: min(80vh, 760px);
  gap: 8px;
  padding: 0;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-premium.is-open {
  padding: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head {
  display: grid;
  gap: 4px;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(138, 172, 201, 0.24);
  background:
    radial-gradient(circle at 88% 14%, rgba(101, 194, 248, 0.2), transparent 40%),
    linear-gradient(150deg, rgba(127, 127, 127, 0.12), rgba(127, 127, 127, 0.04));
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head h3 {
  font-size: 1.08rem;
  letter-spacing: -0.016em;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head p {
  font-size: 0.78rem;
  line-height: 1.66;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-layout {
  grid-template-columns: minmax(280px, 0.9fr) minmax(0, 1.1fr);
  gap: 12px;
  max-height: calc(var(--settings-panel-open-max) - 72px);
  padding-inline-end: 4px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-side,
:is(body.force-desktop, body.auto-desktop) .settings-panel-workspace {
  border-radius: 12px;
  border: 1px solid rgba(138, 172, 201, 0.22);
  background: rgba(127, 127, 127, 0.06);
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-side {
  position: sticky;
  top: 0;
  align-self: start;
  padding: 9px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-workspace {
  padding: 9px;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-strip {
  gap: 8px;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-card {
  min-height: 62px;
  grid-template-columns: 28px minmax(0, 1fr);
  gap: 8px;
  padding: 8px 9px;
  border-radius: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-icon {
  width: 28px;
  height: 28px;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-label {
  font-size: 0.68rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-card strong {
  font-size: 0.76rem;
  line-height: 1.38;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-strip {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 7px;
  padding: 5px;
  margin-bottom: 8px;
  border-radius: 11px;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-btn {
  min-height: 38px;
  justify-content: flex-start;
  padding: 6px 9px;
  gap: 7px;
  border-radius: 10px;
  font-size: 0.77rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-icon {
  width: 15px;
  height: 15px;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-text {
  padding: 0;
  background: transparent;
  line-height: 1.3;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-panel {
  padding: 11px;
  gap: 10px;
  border-radius: 11px;
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head {
  gap: 4px;
  padding-bottom: 8px;
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head h4 {
  font-size: 0.86rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head p {
  font-size: 0.74rem;
  line-height: 1.6;
}

:is(body.force-desktop, body.auto-desktop) .settings-grid-appearance {
  grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-grid {
  gap: 9px;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-card {
  min-height: 116px;
  padding: 9px;
  border-radius: 11px;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-head {
  font-size: 0.76rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-icon {
  width: 20px;
  height: 20px;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-card select {
  min-height: 38px;
}

:is(body.force-desktop, body.auto-desktop) .viewport-mode-bar {
  padding: 5px;
  gap: 6px;
  border-radius: 11px;
}

:is(body.force-desktop, body.auto-desktop) .viewport-mode-btn {
  min-height: 38px;
  border-radius: 9px;
  font-size: 0.75rem;
}

:is(body.force-desktop, body.auto-desktop) .viewport-mode-state {
  font-size: 0.64rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-inline-actions {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 8px;
}

:is(body.force-desktop, body.auto-desktop) .settings-inline-actions .glass-btn {
  min-height: 34px;
  min-width: 0;
  width: 100%;
  font-size: 0.75rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-layout {
  grid-template-columns: minmax(0, 1.18fr) minmax(240px, 0.82fr);
  gap: 10px;
}

:is(body.force-desktop, body.auto-desktop) .cloud-sync-grid {
  gap: 9px;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-side {
  padding: 8px;
  border-radius: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-head {
  gap: 7px;
}

:is(body.force-desktop, body.auto-desktop) .settings-state-pill {
  min-height: 29px;
  font-size: 0.7rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-key-visibility-btn {
  min-height: 30px;
  min-width: 106px;
  font-size: 0.72rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-meta-note {
  font-size: 0.7rem;
  line-height: 1.56;
  padding: 7px 9px;
}

:is(body.force-desktop, body.auto-desktop) .settings-sync-row-stack {
  grid-template-columns: 1fr;
  gap: 7px;
}

:is(body.force-desktop, body.auto-desktop) .settings-sync-row-stack .glass-btn {
  min-height: 34px;
  font-size: 0.74rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-grid {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 9px;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-card {
  border-radius: 11px;
  padding: 9px;
  gap: 8px;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-card-wide {
  grid-column: 1 / -1;
}

:is(body.force-desktop, body.auto-desktop) .settings-card-title {
  font-size: 0.82rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-card-icon {
  width: 19px;
  height: 19px;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-card p {
  font-size: 0.72rem;
  line-height: 1.62;
  -webkit-line-clamp: 3;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel .control-field {
  gap: 5px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel .control-field > span {
  font-size: 0.75rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel input,
:is(body.force-desktop, body.auto-desktop) .settings-panel select {
  min-height: 38px;
  border-radius: 11px;
  font-size: 0.78rem;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel-head,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel-side,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel-workspace,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-mode-card,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-cloud-side,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-utility-card {
  border-color: rgba(47, 82, 111, 0.18);
  background:
    radial-gradient(circle at 88% 12%, rgba(47, 130, 193, 0.12), transparent 40%),
    linear-gradient(154deg, rgba(255, 255, 255, 0.92), rgba(246, 251, 255, 0.86));
}

/* Desktop final priority overrides */
:is(body.force-desktop, body.auto-desktop) .topbar.premium-topbar {
  grid-template-columns: minmax(0, 1fr) auto;
  align-items: start;
  gap: 12px;
  padding: 11px 12px;
  border-radius: 22px;
}

:is(body.force-desktop, body.auto-desktop) .premium-title-group {
  display: grid;
  grid-template-columns: minmax(280px, 0.95fr) minmax(0, 1.15fr);
  grid-template-areas:
    "title stats"
    "title actions";
  row-gap: 6px;
  column-gap: 10px;
}

:is(body.force-desktop, body.auto-desktop) .header-title-row {
  grid-area: title;
  min-height: 66px;
  padding: 8px 11px;
  border-radius: 16px;
}

:is(body.force-desktop, body.auto-desktop) .header-quickline {
  grid-area: stats;
  justify-content: flex-end;
  gap: 6px;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-actions {
  grid-area: actions;
  justify-self: end;
  width: min(100%, 700px);
  display: grid;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap: 6px;
  padding: 6px;
  border-radius: 14px;
  overflow: visible;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn {
  min-height: 34px;
  padding: 4px 8px;
  justify-content: center;
  gap: 6px;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn span:last-child {
  padding: 0;
  border-radius: 0;
  background: transparent;
  text-shadow: none;
}

:is(body.force-desktop, body.auto-desktop) .premium-header-actions {
  width: 176px;
}

:is(body.force-desktop, body.auto-desktop) .settings-trigger {
  min-height: 42px;
  min-width: 150px;
  border-radius: 12px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel.settings-panel-premium {
  --settings-panel-open-max: min(84vh, 860px);
  position: absolute;
  top: calc(100% + 12px);
  right: 0;
  width: min(1020px, 92vw);
  border-radius: 20px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-premium.is-open {
  padding: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head {
  margin-bottom: 9px;
  padding: 10px 12px 11px;
  border-radius: 14px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head h3 {
  font-size: 1rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head p {
  font-size: 0.74rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-layout {
  grid-template-columns: minmax(240px, 0.88fr) minmax(0, 1.12fr);
  gap: 10px;
  max-height: calc(var(--settings-panel-open-max) - 108px);
  overflow: hidden;
  padding: 0;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-side {
  padding: 8px;
  top: 0;
  max-height: none;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-workspace {
  display: grid;
  grid-template-rows: auto minmax(0, 1fr);
  gap: 8px;
  padding: 8px;
  overflow: hidden;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-strip {
  gap: 7px;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-card {
  min-height: 0;
  grid-template-columns: 30px minmax(0, 1fr);
  padding: 8px 9px;
  border-radius: 11px;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-label {
  font-size: 0.68rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-card strong {
  font-size: 0.78rem;
  white-space: nowrap;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-strip {
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 6px;
  padding: 4px;
  border-radius: 12px;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-btn {
  min-height: 40px;
  padding: 6px 10px;
  justify-content: center;
  font-size: 0.8rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-text {
  padding: 0;
  border-radius: 0;
  background: transparent;
  text-shadow: none;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-panel {
  gap: 10px;
  padding: 10px;
  border-radius: 12px;
  max-height: calc(var(--settings-panel-open-max) - 172px);
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head h4 {
  font-size: 0.9rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head p {
  font-size: 0.76rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-card {
  min-height: 124px;
  padding: 11px;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-head {
  font-size: 0.82rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-layout {
  grid-template-columns: minmax(0, 1.16fr) minmax(265px, 0.84fr);
  gap: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-side {
  padding: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-grid {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-card {
  padding: 10px;
  border-radius: 12px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel .control-field > span {
  font-size: 0.78rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel input,
:is(body.force-desktop, body.auto-desktop) .settings-panel select,
:is(body.force-desktop, body.auto-desktop) .settings-panel textarea {
  min-height: 40px;
  font-size: 0.8rem;
}

/* Desktop master redesign: header + settings */
:is(body.force-desktop, body.auto-desktop) .topbar.premium-topbar {
  --header-glow: rgba(76, 187, 252, 0.28);
  --header-line: rgba(126, 180, 220, 0.3);
  --panel-glass: linear-gradient(148deg, rgba(11, 22, 34, 0.96), rgba(12, 24, 38, 0.84));
  position: sticky;
  top: 8px;
  z-index: 52;
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto;
  align-items: start;
  gap: 12px;
  margin-bottom: 12px;
  padding: 11px 12px;
  border-radius: 22px;
  border: 1px solid var(--header-line);
  background:
    radial-gradient(circle at 9% 10%, rgba(112, 208, 255, 0.18), transparent 42%),
    radial-gradient(circle at 86% 88%, rgba(58, 155, 222, 0.14), transparent 38%),
    linear-gradient(154deg, rgba(10, 19, 29, 0.94), rgba(14, 27, 41, 0.84));
  box-shadow:
    0 22px 44px rgba(4, 9, 15, 0.36),
    inset 0 1px 0 rgba(255, 255, 255, 0.08),
    inset 0 -1px 0 rgba(149, 197, 233, 0.1);
  backdrop-filter: blur(16px) saturate(160%);
  -webkit-backdrop-filter: blur(16px) saturate(160%);
  overflow: visible;
  isolation: isolate;
}

:is(body.force-desktop, body.auto-desktop) .premium-topbar::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background:
    linear-gradient(118deg, rgba(255, 255, 255, 0.1), transparent 44%),
    radial-gradient(circle at 82% 14%, rgba(101, 198, 255, 0.18), transparent 30%);
  pointer-events: none;
  z-index: 0;
}

:is(body.force-desktop, body.auto-desktop) .premium-topbar::after {
  content: "";
  position: absolute;
  top: -1px;
  right: 46%;
  width: 180px;
  height: 2px;
  border-radius: 999px;
  background: linear-gradient(90deg, transparent, rgba(163, 220, 255, 0.85), transparent);
  filter: blur(0.2px);
  opacity: 0.9;
  pointer-events: none;
  z-index: 0;
}

:is(body.force-desktop, body.auto-desktop) .premium-topbar > * {
  position: relative;
  z-index: 1;
}

:is(body.force-desktop, body.auto-desktop) .premium-title-group {
  position: relative;
  display: grid;
  grid-template-columns: minmax(280px, 0.95fr) minmax(0, 1.15fr);
  grid-template-areas:
    "title stats"
    "title actions";
  align-items: center;
  column-gap: 10px;
  row-gap: 6px;
  min-width: 0;
}

:is(body.force-desktop, body.auto-desktop) .header-title-row {
  grid-area: title;
  display: flex;
  align-items: center;
  gap: 10px;
  min-height: 66px;
  padding: 8px 11px;
  border-radius: 16px;
  border: 1px solid rgba(135, 190, 229, 0.24);
  background:
    linear-gradient(136deg, rgba(125, 186, 226, 0.12), rgba(125, 186, 226, 0.03)),
    rgba(5, 13, 21, 0.45);
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.08),
    0 14px 22px rgba(5, 10, 16, 0.24);
}

:is(body.force-desktop, body.auto-desktop) .header-brand-icon {
  width: 40px;
  height: 40px;
  border-radius: 14px;
  border: 1px solid rgba(144, 210, 248, 0.45);
  background:
    radial-gradient(circle at 22% 18%, rgba(255, 255, 255, 0.42), transparent 44%),
    linear-gradient(150deg, rgba(101, 198, 255, 0.36), rgba(101, 198, 255, 0.08));
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.3),
    0 10px 22px rgba(8, 13, 20, 0.35),
    0 0 0 1px rgba(255, 255, 255, 0.06);
}

:is(body.force-desktop, body.auto-desktop) .header-title-stack {
  display: grid;
  gap: 4px;
  min-width: 0;
}

:is(body.force-desktop, body.auto-desktop) .premium-title-group h1 {
  margin: 0;
  font-size: clamp(1.06rem, 0.52vw + 0.92rem, 1.36rem);
  letter-spacing: -0.028em;
  line-height: 1.24;
}

:is(body.force-desktop, body.auto-desktop) .premium-title-group p {
  margin: 0;
  font-size: 0.75rem;
  line-height: 1.5;
  color: rgba(197, 216, 234, 0.9);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

:is(body.force-desktop, body.auto-desktop) .header-quickline {
  grid-area: stats;
  display: flex;
  justify-content: flex-end;
  flex-wrap: wrap;
  gap: 6px;
  min-width: 0;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-pill {
  min-height: 25px;
  padding: 3px 10px;
  border-radius: 999px;
  border: 1px solid rgba(132, 187, 226, 0.3);
  background:
    linear-gradient(136deg, rgba(102, 197, 251, 0.2), rgba(102, 197, 251, 0.06)),
    rgba(8, 17, 27, 0.42);
  color: #deefff;
  font-size: 0.73rem;
  font-weight: 700;
  line-height: 1.2;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
}

:is(body.force-desktop, body.auto-desktop) .header-quick-actions {
  grid-area: actions;
  justify-self: end;
  width: min(100%, 700px);
  display: grid;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap: 6px;
  padding: 6px;
  margin: 0;
  border: 1px solid rgba(126, 183, 224, 0.26);
  border-radius: 14px;
  background:
    linear-gradient(145deg, rgba(106, 188, 237, 0.08), rgba(106, 188, 237, 0.02)),
    rgba(6, 15, 24, 0.48);
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.08),
    0 10px 20px rgba(3, 7, 12, 0.24);
  overflow: visible;
  scrollbar-width: thin;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn {
  min-height: 34px;
  padding: 4px 8px;
  border-radius: 10px;
  border: 1px solid rgba(124, 179, 218, 0.2);
  background:
    linear-gradient(150deg, rgba(117, 185, 225, 0.12), rgba(117, 185, 225, 0.03)),
    rgba(9, 18, 28, 0.52);
  color: #e8f4ff;
  font-size: 0.76rem;
  font-weight: 800;
  letter-spacing: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  text-shadow: none;
  transition:
    border-color 0.2s ease,
    background-color 0.2s ease,
    transform 0.2s ease,
    box-shadow 0.2s ease;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: linear-gradient(108deg, transparent 20%, rgba(255, 255, 255, 0.18) 50%, transparent 78%);
  transform: translateX(130%);
  transition: transform 0.44s ease;
  pointer-events: none;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn:hover {
  transform: translateY(-1px);
  border-color: rgba(123, 203, 254, 0.56);
  background:
    linear-gradient(150deg, rgba(84, 189, 249, 0.26), rgba(84, 189, 249, 0.1)),
    rgba(9, 18, 28, 0.58);
  box-shadow: 0 12px 20px rgba(5, 10, 16, 0.26);
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn:hover::after {
  transform: translateX(-130%);
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn.is-active {
  border-color: rgba(117, 206, 255, 0.86);
  background: linear-gradient(148deg, rgba(92, 198, 255, 0.34), rgba(92, 198, 255, 0.12));
  box-shadow: 0 14px 24px rgba(6, 12, 18, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.22);
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn span:last-child {
  display: inline;
  padding: 0;
  border-radius: 0;
  background: transparent;
  color: inherit;
  text-shadow: none;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-icon {
  width: 17px;
  height: 17px;
  border-radius: 6px;
  border: 1px solid rgba(135, 203, 245, 0.34);
  background: linear-gradient(146deg, rgba(124, 203, 247, 0.26), rgba(124, 203, 247, 0.08));
  color: #def2ff;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-icon svg {
  width: 10px;
  height: 10px;
}

:is(body.force-desktop, body.auto-desktop) .premium-header-actions {
  position: relative;
  align-content: start;
  justify-items: end;
  width: 176px;
}

:is(body.force-desktop, body.auto-desktop) .settings-trigger {
  min-height: 42px;
  min-width: 150px;
  padding: 6px 12px;
  border-radius: 12px;
  gap: 7px;
  font-size: 0.8rem;
  font-weight: 800;
  border: 1px solid rgba(123, 185, 228, 0.38);
  background:
    linear-gradient(150deg, rgba(111, 194, 244, 0.26), rgba(111, 194, 244, 0.08)),
    rgba(7, 16, 26, 0.54);
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.18),
    0 14px 24px rgba(5, 10, 16, 0.3);
  color: #e8f6ff;
  text-shadow: none;
}

:is(body.force-desktop, body.auto-desktop) .settings-trigger::after {
  content: "";
  position: absolute;
  inset: -32% auto -32% -18%;
  width: 24%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.28), transparent);
  transform: skewX(-18deg) translateX(-200%);
  animation: header-premium-shimmer 5.2s ease-in-out infinite;
}

:is(body.force-desktop, body.auto-desktop) .settings-trigger[aria-expanded="true"] {
  border-color: rgba(100, 200, 255, 0.82);
  background: linear-gradient(150deg, rgba(98, 198, 255, 0.38), rgba(98, 198, 255, 0.12));
}

:is(body.force-desktop, body.auto-desktop) .settings-trigger-status {
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: #71e6b4;
  box-shadow: 0 0 0 4px rgba(113, 230, 180, 0.18);
}

@keyframes header-premium-shimmer {
  0%,
  72%,
  100% {
    transform: skewX(-18deg) translateX(-220%);
  }
  86% {
    transform: skewX(-18deg) translateX(540%);
  }
}

:is(body.force-desktop, body.auto-desktop) .settings-panel.settings-panel-premium {
  --settings-panel-open-max: min(84vh, 860px);
  position: absolute;
  top: calc(100% + 12px);
  right: 0;
  left: auto;
  width: min(1020px, 92vw);
  padding: 0;
  border-radius: 20px;
  border: 1px solid rgba(122, 183, 225, 0.3);
  background:
    radial-gradient(circle at 12% 14%, rgba(84, 185, 246, 0.2), transparent 42%),
    radial-gradient(circle at 88% 86%, rgba(84, 185, 246, 0.12), transparent 40%),
    var(--panel-glass);
  box-shadow:
    0 30px 56px rgba(2, 6, 11, 0.42),
    inset 0 1px 0 rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(16px) saturate(165%);
  -webkit-backdrop-filter: blur(16px) saturate(165%);
  transform: translateY(-10px) scale(0.985);
  transform-origin: top right;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-premium.is-open {
  padding: 10px;
  max-height: var(--settings-panel-open-max);
  opacity: 1;
  transform: translateY(0) scale(1);
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head {
  position: relative;
  display: grid;
  gap: 4px;
  margin: 0 0 9px;
  padding: 10px 12px 11px;
  border-radius: 14px;
  border: 1px solid rgba(123, 183, 224, 0.28);
  background:
    linear-gradient(140deg, rgba(113, 187, 231, 0.16), rgba(113, 187, 231, 0.05)),
    rgba(5, 13, 22, 0.52);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head::after {
  content: "";
  position: absolute;
  bottom: 0;
  right: 16px;
  width: 180px;
  height: 1px;
  background: linear-gradient(90deg, rgba(116, 200, 248, 0.6), transparent);
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head h3 {
  margin: 0;
  font-size: 1rem;
  letter-spacing: -0.02em;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head p {
  margin: 0;
  font-size: 0.74rem;
  line-height: 1.62;
  color: rgba(193, 215, 236, 0.86);
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-layout {
  display: grid;
  grid-template-columns: minmax(240px, 0.88fr) minmax(0, 1.12fr);
  gap: 10px;
  align-items: stretch;
  max-height: calc(var(--settings-panel-open-max) - 108px);
  overflow: hidden;
  min-height: 0;
  padding: 0;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-side,
:is(body.force-desktop, body.auto-desktop) .settings-panel-workspace {
  border: 1px solid rgba(120, 178, 219, 0.22);
  border-radius: 14px;
  background:
    linear-gradient(145deg, rgba(97, 176, 224, 0.1), rgba(97, 176, 224, 0.03)),
    rgba(8, 16, 25, 0.5);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
  min-height: 0;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-side {
  padding: 8px;
  overflow: auto;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-strip {
  display: grid;
  gap: 7px;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-card {
  display: grid;
  grid-template-columns: 30px minmax(0, 1fr);
  align-items: center;
  gap: 7px;
  padding: 8px 9px;
  border-radius: 11px;
  border: 1px solid rgba(125, 184, 224, 0.22);
  background:
    linear-gradient(142deg, rgba(106, 188, 237, 0.16), rgba(106, 188, 237, 0.05)),
    rgba(8, 16, 25, 0.44);
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.08),
    0 12px 20px rgba(4, 8, 13, 0.2);
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-icon {
  width: 30px;
  height: 30px;
  border-radius: 10px;
  border: 1px solid rgba(132, 197, 235, 0.36);
  background: linear-gradient(145deg, rgba(114, 200, 246, 0.26), rgba(114, 200, 246, 0.08));
  color: #d6eeff;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-icon svg {
  width: 13px;
  height: 13px;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-label {
  font-size: 0.68rem;
  color: rgba(187, 211, 234, 0.8);
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-card strong {
  font-size: 0.78rem;
  line-height: 1.4;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-workspace {
  display: grid;
  grid-template-rows: auto minmax(0, 1fr);
  gap: 8px;
  padding: 8px;
  overflow: hidden;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-strip {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 6px;
  margin: 0;
  padding: 4px;
  border-radius: 12px;
  border: 1px solid rgba(124, 182, 223, 0.24);
  background:
    linear-gradient(145deg, rgba(114, 193, 241, 0.1), rgba(114, 193, 241, 0.03)),
    rgba(8, 17, 27, 0.38);
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-btn {
  min-height: 40px;
  padding: 6px 10px;
  border-radius: 10px;
  border: 1px solid transparent;
  background: transparent;
  color: rgba(189, 214, 235, 0.9);
  font-size: 0.8rem;
  font-weight: 800;
  justify-content: center;
  gap: 7px;
  text-shadow: none;
  transition: border-color 0.2s ease, background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-btn:hover {
  transform: translateY(-1px);
  border-color: rgba(118, 202, 255, 0.5);
  color: #e9f5ff;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-btn.is-active {
  border-color: rgba(111, 199, 250, 0.82);
  color: #eaf5ff;
  background: linear-gradient(145deg, rgba(88, 190, 250, 0.28), rgba(88, 190, 250, 0.1));
  box-shadow: 0 10px 18px rgba(4, 9, 15, 0.24), inset 0 1px 0 rgba(255, 255, 255, 0.16);
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-icon {
  width: 16px;
  height: 16px;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-text {
  padding: 0;
  border-radius: 0;
  background: transparent;
  color: inherit;
  text-shadow: none;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-dot {
  width: 6px;
  height: 6px;
  opacity: 0.5;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-btn.is-active .settings-tab-dot {
  opacity: 1;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-panel {
  display: none;
  gap: 10px;
  padding: 10px;
  border-radius: 12px;
  border: 1px solid rgba(118, 177, 218, 0.24);
  background:
    linear-gradient(142deg, rgba(100, 182, 232, 0.12), rgba(100, 182, 232, 0.03)),
    rgba(7, 15, 24, 0.42);
  overflow: auto;
  max-height: calc(var(--settings-panel-open-max) - 172px);
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-panel.is-active {
  display: grid;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-panel::before {
  width: 148px;
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head {
  gap: 5px;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(122, 181, 222, 0.24);
}

:is(body.force-desktop, body.auto-desktop) .settings-section-icon {
  width: 20px;
  height: 20px;
  border-radius: 7px;
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head h4 {
  font-size: 0.9rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head p {
  font-size: 0.76rem;
  line-height: 1.62;
}

:is(body.force-desktop, body.auto-desktop) .settings-grid-appearance {
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-card {
  min-height: 124px;
  padding: 11px;
  border-radius: 12px;
  border: 1px solid rgba(123, 183, 224, 0.24);
  background:
    linear-gradient(140deg, rgba(106, 187, 236, 0.16), rgba(106, 187, 236, 0.04)),
    rgba(8, 16, 25, 0.44);
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-head {
  gap: 8px;
  font-size: 0.82rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-icon {
  width: 22px;
  height: 22px;
}

:is(body.force-desktop, body.auto-desktop) .viewport-mode-bar {
  padding: 5px;
  gap: 6px;
  border-radius: 11px;
  border: 1px solid rgba(121, 179, 219, 0.24);
  background: rgba(8, 16, 25, 0.45);
}

:is(body.force-desktop, body.auto-desktop) .viewport-mode-btn {
  min-height: 37px;
  border-radius: 9px;
  font-size: 0.77rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-layout {
  grid-template-columns: minmax(0, 1.16fr) minmax(265px, 0.84fr);
  gap: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-side {
  padding: 10px;
  border-radius: 12px;
  border: 1px solid rgba(120, 182, 223, 0.24);
  background:
    linear-gradient(142deg, rgba(102, 185, 234, 0.14), rgba(102, 185, 234, 0.04)),
    rgba(8, 16, 25, 0.42);
}

:is(body.force-desktop, body.auto-desktop) .settings-state-pill {
  min-height: 30px;
  font-size: 0.73rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-grid {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-card {
  padding: 10px;
  border-radius: 12px;
  border: 1px solid rgba(118, 180, 221, 0.24);
  background:
    linear-gradient(145deg, rgba(102, 186, 235, 0.14), rgba(102, 186, 235, 0.05)),
    rgba(8, 16, 25, 0.45);
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-card-wide {
  grid-column: 1 / -1;
}

:is(body.force-desktop, body.auto-desktop) .settings-card-title {
  font-size: 0.86rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel .control-field {
  gap: 6px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel .control-field > span {
  font-size: 0.78rem;
  font-weight: 700;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel input,
:is(body.force-desktop, body.auto-desktop) .settings-panel select,
:is(body.force-desktop, body.auto-desktop) .settings-panel textarea {
  min-height: 40px;
  border-radius: 11px;
  border: 1px solid rgba(122, 181, 221, 0.26);
  background: rgba(4, 11, 19, 0.52);
  color: var(--text-main);
  font-size: 0.8rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel input:focus,
:is(body.force-desktop, body.auto-desktop) .settings-panel select:focus,
:is(body.force-desktop, body.auto-desktop) .settings-panel textarea:focus {
  outline: none;
  border-color: rgba(106, 202, 255, 0.78);
  box-shadow: 0 0 0 3px rgba(106, 202, 255, 0.18);
}

:is(body.force-desktop, body.auto-desktop) .settings-panel .control-hint,
:is(body.force-desktop, body.auto-desktop) .settings-meta-note {
  font-size: 0.72rem;
  line-height: 1.6;
}

:is(body.force-desktop, body.auto-desktop) .settings-inline-actions {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 8px;
}

:is(body.force-desktop, body.auto-desktop) .settings-inline-actions .glass-btn,
:is(body.force-desktop, body.auto-desktop) .settings-sync-row .glass-btn {
  width: 100%;
  min-width: 0;
  min-height: 36px;
  border-radius: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel .glass-btn {
  border: 1px solid rgba(120, 181, 222, 0.3);
  background:
    linear-gradient(145deg, rgba(102, 188, 238, 0.2), rgba(102, 188, 238, 0.07)),
    rgba(8, 16, 25, 0.5);
  text-shadow: none;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel .glass-btn:hover {
  border-color: rgba(108, 205, 255, 0.72);
  background:
    linear-gradient(145deg, rgba(84, 190, 250, 0.3), rgba(84, 190, 250, 0.1)),
    rgba(8, 16, 25, 0.55);
}

:is(body.force-desktop, body.auto-desktop) .settings-panel .settings-danger-btn {
  border-color: rgba(255, 123, 153, 0.4);
  background:
    linear-gradient(145deg, rgba(255, 95, 132, 0.22), rgba(255, 95, 132, 0.08)),
    rgba(18, 12, 16, 0.52);
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .topbar.premium-topbar {
  border-color: rgba(47, 92, 128, 0.24);
  background:
    radial-gradient(circle at 10% 10%, rgba(87, 170, 225, 0.14), transparent 40%),
    radial-gradient(circle at 88% 84%, rgba(87, 170, 225, 0.1), transparent 36%),
    linear-gradient(154deg, rgba(255, 255, 255, 0.95), rgba(244, 250, 255, 0.9));
  box-shadow:
    0 20px 38px rgba(24, 55, 83, 0.16),
    inset 0 1px 0 rgba(255, 255, 255, 0.96),
    inset 0 -1px 0 rgba(113, 162, 197, 0.12);
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .header-title-row,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .header-quick-actions,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .header-quick-pill,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-trigger {
  border-color: rgba(47, 92, 128, 0.2);
  background:
    linear-gradient(142deg, rgba(46, 131, 190, 0.14), rgba(46, 131, 190, 0.04)),
    rgba(255, 255, 255, 0.88);
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .premium-title-group p,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .header-quick-pill {
  color: #4f6780;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .header-quick-btn {
  color: #234f73;
  border-color: rgba(48, 104, 149, 0.2);
  background:
    linear-gradient(150deg, rgba(46, 133, 193, 0.15), rgba(46, 133, 193, 0.05)),
    rgba(255, 255, 255, 0.92);
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .header-quick-icon {
  color: #287cb8;
  border-color: rgba(46, 133, 193, 0.28);
  background: linear-gradient(145deg, rgba(46, 133, 193, 0.2), rgba(46, 133, 193, 0.08));
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel.settings-panel-premium {
  border-color: rgba(47, 92, 128, 0.24);
  background:
    radial-gradient(circle at 12% 14%, rgba(47, 130, 193, 0.14), transparent 42%),
    radial-gradient(circle at 88% 86%, rgba(47, 130, 193, 0.1), transparent 40%),
    linear-gradient(148deg, rgba(255, 255, 255, 0.96), rgba(245, 250, 255, 0.9));
  box-shadow: 0 30px 50px rgba(24, 55, 83, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.94);
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel-head,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel-side,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel-workspace,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-tab-strip,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-tab-panel,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-mode-card,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-cloud-side,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-utility-card {
  border-color: rgba(47, 92, 128, 0.18);
  background:
    linear-gradient(145deg, rgba(46, 131, 190, 0.12), rgba(46, 131, 190, 0.04)),
    rgba(255, 255, 255, 0.9);
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel-head p,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-section-head p,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-overview-label {
  color: #5a7189;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-tab-btn {
  color: #557492;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-tab-btn.is-active {
  color: #1f547c;
  border-color: rgba(46, 133, 193, 0.62);
  background: linear-gradient(145deg, rgba(46, 133, 193, 0.2), rgba(46, 133, 193, 0.08));
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel input,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel select,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel textarea {
  background: rgba(255, 255, 255, 0.95);
  border-color: rgba(47, 92, 128, 0.24);
  color: #234159;
}

/* PWA / Chrome app mode optimization */
body.is-standalone {
  min-height: 100dvh;
  overscroll-behavior-y: contain;
  overscroll-behavior-x: none;
}

body.is-standalone .app-shell {
  width: min(1280px, calc(100vw - 20px));
  padding-top: calc(env(safe-area-inset-top, 0px) + 12px);
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 18px);
}

body.is-standalone .premium-topbar {
  top: calc(env(safe-area-inset-top, 0px) + 6px);
}

body.is-standalone .main-content {
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 8px);
}

body.is-standalone .status-bar {
  margin-bottom: env(safe-area-inset-bottom, 0px);
}

:is(body.standalone-desktop, body.is-standalone.force-desktop, body.is-standalone.auto-desktop) .app-shell {
  width: min(1380px, calc(100vw - 32px));
  padding-top: calc(env(safe-area-inset-top, 0px) + 10px);
}

:is(body.standalone-mobile, body.is-standalone.force-mobile, body.is-standalone.auto-mobile) .app-shell {
  width: min(100%, calc(100vw - 10px));
  padding-top: calc(env(safe-area-inset-top, 0px) + 8px);
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 14px);
}

:is(body.standalone-mobile, body.is-standalone.force-mobile, body.is-standalone.auto-mobile) .premium-topbar {
  top: calc(env(safe-area-inset-top, 0px) + 4px);
}

:is(body.standalone-mobile, body.is-standalone.force-mobile, body.is-standalone.auto-mobile) {
  overscroll-behavior-y: auto;
}

:is(body.standalone-mobile, body.is-standalone.force-mobile, body.is-standalone.auto-mobile) .profile-surface,
:is(body.standalone-mobile, body.is-standalone.force-mobile, body.is-standalone.auto-mobile) .surface {
  border-radius: 14px;
}

:is(body.standalone-mobile, body.is-standalone.force-mobile, body.is-standalone.auto-mobile) .main-content {
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 92px);
}

.pwa-mobile-dock {
  position: fixed;
  inset-inline: 10px;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 8px);
  z-index: 90;
  display: none;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  align-items: stretch;
  gap: 7px;
  padding: 8px;
  border-radius: 18px;
  border: 1px solid var(--line);
  background:
    linear-gradient(150deg, color-mix(in srgb, var(--surface-strong) 90%, transparent), color-mix(in srgb, var(--surface-soft) 88%, transparent));
  backdrop-filter: blur(14px);
  box-shadow: 0 16px 32px rgba(2, 10, 16, 0.36), inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.pwa-mobile-dock-btn {
  min-height: 56px;
  border-radius: 14px;
  border: 1px solid transparent;
  background: color-mix(in srgb, var(--surface-soft) 92%, transparent);
  color: var(--text-main);
  display: grid;
  justify-items: center;
  align-content: center;
  gap: 4px;
  padding: 6px 4px;
  font-family: inherit;
  cursor: pointer;
  transition: border-color 0.22s ease, background-color 0.22s ease, transform 0.22s ease;
}

.pwa-mobile-dock-btn[disabled] {
  opacity: 0.45;
  cursor: not-allowed;
}

.pwa-mobile-dock-btn.is-active {
  border-color: color-mix(in srgb, var(--accent) 70%, transparent);
  background: color-mix(in srgb, var(--accent-soft) 78%, var(--surface-soft));
  box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--accent) 22%, transparent);
}

.pwa-mobile-dock-icon {
  width: 18px;
  height: 18px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.pwa-mobile-dock-icon svg {
  width: 18px;
  height: 18px;
  fill: none;
  stroke: currentColor;
  stroke-width: 1.8;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.pwa-mobile-dock-label {
  font-size: 0.67rem;
  font-weight: 700;
  line-height: 1.1;
  letter-spacing: -0.01em;
}

.pwa-scroll-top-btn {
  position: fixed;
  inset-inline-end: 14px;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 88px);
  z-index: 91;
  width: 42px;
  height: 42px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: color-mix(in srgb, var(--surface-strong) 92%, transparent);
  color: var(--text-main);
  font-size: 1.15rem;
  font-weight: 700;
  opacity: 0;
  pointer-events: none;
  transform: translateY(10px);
  transition: opacity 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
}

.pwa-scroll-top-btn.is-visible {
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
}

.pwa-scroll-top-btn:focus-visible,
.pwa-mobile-dock-btn:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px var(--accent-soft);
}

:is(body.standalone-mobile, body.is-standalone.force-mobile, body.is-standalone.auto-mobile) .pwa-mobile-dock {
  display: grid;
}

:is(body.standalone-mobile, body.is-standalone.force-mobile, body.is-standalone.auto-mobile) .pwa-scroll-top-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

@media (display-mode: standalone) {
  body {
    min-height: 100dvh;
  }
}

/* Desktop settings redesign v2 */
:is(body.force-desktop, body.auto-desktop) .premium-header-actions {
  width: 220px;
}

:is(body.force-desktop, body.auto-desktop) .settings-trigger {
  min-height: 44px;
  border-radius: 14px;
  font-size: 0.82rem;
  font-weight: 700;
  letter-spacing: 0.01em;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel.settings-panel-premium {
  width: min(1080px, 90vw);
  border-radius: 20px;
  border: 1px solid rgba(136, 183, 218, 0.3);
  background:
    radial-gradient(circle at 88% 10%, rgba(99, 194, 248, 0.22), transparent 40%),
    linear-gradient(150deg, rgba(10, 20, 31, 0.93), rgba(13, 24, 36, 0.82));
  box-shadow: 0 26px 52px rgba(5, 11, 17, 0.36), inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-premium {
  --settings-panel-open-max: min(82vh, 780px);
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-premium.is-open {
  padding: 12px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head {
  position: relative;
  overflow: hidden;
  margin-bottom: 2px;
  padding: 12px 14px;
  border-radius: 14px;
  border: 1px solid rgba(136, 183, 218, 0.24);
  background:
    radial-gradient(circle at 86% 14%, rgba(102, 197, 250, 0.2), transparent 42%),
    linear-gradient(152deg, rgba(127, 127, 127, 0.14), rgba(127, 127, 127, 0.05));
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head::after {
  content: "";
  position: absolute;
  inset-inline-start: 14px;
  inset-inline-end: 14px;
  bottom: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(139, 203, 239, 0.72), transparent);
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head h3 {
  font-size: 1.14rem;
  letter-spacing: -0.018em;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head p {
  font-size: 0.8rem;
  line-height: 1.68;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-layout {
  grid-template-columns: minmax(300px, 0.9fr) minmax(0, 1.1fr);
  gap: 14px;
  max-height: calc(var(--settings-panel-open-max) - 84px);
  padding-inline-end: 4px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-side,
:is(body.force-desktop, body.auto-desktop) .settings-panel-workspace {
  border-radius: 13px;
  border: 1px solid rgba(136, 183, 218, 0.22);
  background: rgba(127, 127, 127, 0.07);
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-side {
  position: sticky;
  top: 0;
  align-self: start;
  padding: 10px;
  max-height: calc(var(--settings-panel-open-max) - 90px);
  overflow: auto;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-workspace {
  padding: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-strip {
  gap: 9px;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-card {
  min-height: 68px;
  grid-template-columns: 30px minmax(0, 1fr);
  gap: 9px;
  padding: 8px 9px;
  border-radius: 11px;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-icon {
  width: 30px;
  height: 30px;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-label {
  font-size: 0.69rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-card strong {
  font-size: 0.79rem;
  line-height: 1.42;
  white-space: normal;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-strip {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
  padding: 5px;
  margin-bottom: 9px;
  border-radius: 12px;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-btn {
  min-height: 40px;
  padding: 6px 10px;
  gap: 8px;
  border-radius: 10px;
  justify-content: flex-start;
  font-size: 0.79rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-icon {
  width: 16px;
  height: 16px;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-text {
  padding: 0;
  border-radius: 0;
  background: transparent;
  color: currentColor;
  text-shadow: inherit;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-panel {
  padding: 12px;
  gap: 11px;
  border-radius: 12px;
  max-height: calc(var(--settings-panel-open-max) - 150px);
  overflow: auto;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-panel::before {
  width: 130px;
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head {
  gap: 5px;
  padding-bottom: 8px;
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head h4 {
  font-size: 0.88rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head p {
  font-size: 0.75rem;
  line-height: 1.65;
}

:is(body.force-desktop, body.auto-desktop) .settings-grid-appearance {
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-grid {
  gap: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-card {
  min-height: 124px;
  padding: 10px;
  border-radius: 12px;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-head {
  font-size: 0.78rem;
  gap: 7px;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-icon {
  width: 21px;
  height: 21px;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-card select {
  min-height: 39px;
}

:is(body.force-desktop, body.auto-desktop) .viewport-mode-bar {
  padding: 5px;
  gap: 6px;
  border-radius: 11px;
}

:is(body.force-desktop, body.auto-desktop) .viewport-mode-btn {
  min-height: 38px;
  border-radius: 9px;
  font-size: 0.76rem;
}

:is(body.force-desktop, body.auto-desktop) .viewport-mode-state {
  font-size: 0.65rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-inline-actions {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
  gap: 8px;
}

:is(body.force-desktop, body.auto-desktop) .settings-inline-actions .glass-btn {
  min-height: 35px;
  width: 100%;
  min-width: 0;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-layout {
  grid-template-columns: minmax(0, 1.16fr) minmax(260px, 0.84fr);
  gap: 11px;
}

:is(body.force-desktop, body.auto-desktop) .cloud-sync-grid {
  gap: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-side {
  padding: 9px;
  border-radius: 11px;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-head {
  gap: 8px;
}

:is(body.force-desktop, body.auto-desktop) .settings-state-pill {
  min-height: 30px;
  font-size: 0.71rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-key-visibility-btn {
  min-height: 31px;
  min-width: 110px;
  font-size: 0.73rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-meta-note {
  font-size: 0.71rem;
  line-height: 1.6;
}

:is(body.force-desktop, body.auto-desktop) .settings-sync-row-stack {
  grid-template-columns: 1fr;
  gap: 8px;
}

:is(body.force-desktop, body.auto-desktop) .settings-sync-row-stack .glass-btn {
  min-height: 35px;
  font-size: 0.75rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-grid {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-card {
  border-radius: 12px;
  padding: 10px;
  gap: 8px;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-card-wide {
  grid-column: 1 / -1;
}

:is(body.force-desktop, body.auto-desktop) .settings-card-title {
  font-size: 0.84rem;
  gap: 7px;
}

:is(body.force-desktop, body.auto-desktop) .settings-card-icon {
  width: 20px;
  height: 20px;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-card p {
  font-size: 0.73rem;
  line-height: 1.68;
  -webkit-line-clamp: 3;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel .control-field {
  gap: 5px;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel .control-field > span {
  font-size: 0.76rem;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel input,
:is(body.force-desktop, body.auto-desktop) .settings-panel select {
  min-height: 39px;
  border-radius: 11px;
  font-size: 0.79rem;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel.settings-panel-premium {
  border-color: rgba(47, 82, 111, 0.22);
  background:
    radial-gradient(circle at 88% 10%, rgba(47, 130, 193, 0.16), transparent 40%),
    linear-gradient(154deg, rgba(255, 255, 255, 0.95), rgba(246, 251, 255, 0.9));
  box-shadow: 0 24px 42px rgba(24, 55, 83, 0.16), inset 0 1px 0 rgba(255, 255, 255, 0.94);
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel-head,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel-side,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-panel-workspace,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-mode-card,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-cloud-side,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .settings-utility-card {
  border-color: rgba(47, 82, 111, 0.18);
  background:
    radial-gradient(circle at 88% 12%, rgba(47, 130, 193, 0.12), transparent 40%),
    linear-gradient(154deg, rgba(255, 255, 255, 0.92), rgba(246, 251, 255, 0.86));
}

/* Desktop final lock overrides v2 */
:is(body.force-desktop, body.auto-desktop) .topbar.premium-topbar {
  grid-template-columns: minmax(0, 1fr) auto !important;
  align-items: start !important;
  gap: 12px !important;
  padding: 11px 12px !important;
  border-radius: 22px !important;
}

:is(body.force-desktop, body.auto-desktop) .premium-title-group {
  display: grid !important;
  grid-template-columns: minmax(280px, 0.95fr) minmax(0, 1.15fr) !important;
  grid-template-areas:
    "title stats"
    "title actions" !important;
  row-gap: 6px !important;
  column-gap: 10px !important;
}

:is(body.force-desktop, body.auto-desktop) .header-title-row {
  grid-area: title !important;
  min-height: 66px !important;
  padding: 8px 11px !important;
  border-radius: 16px !important;
}

:is(body.force-desktop, body.auto-desktop) .header-quickline {
  grid-area: stats !important;
  justify-content: flex-end !important;
  gap: 6px !important;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-actions {
  grid-area: actions !important;
  justify-self: end !important;
  width: min(100%, 700px) !important;
  display: grid !important;
  grid-template-columns: repeat(5, minmax(0, 1fr)) !important;
  gap: 6px !important;
  padding: 6px !important;
  border-radius: 14px !important;
  overflow: visible !important;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn {
  min-height: 34px !important;
  padding: 4px 8px !important;
  justify-content: center !important;
  gap: 6px !important;
}

:is(body.force-desktop, body.auto-desktop) .header-quick-btn span:last-child {
  padding: 0 !important;
  border-radius: 0 !important;
  background: transparent !important;
  text-shadow: none !important;
}

:is(body.force-desktop, body.auto-desktop) .premium-header-actions {
  width: 176px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-trigger {
  min-height: 42px !important;
  min-width: 150px !important;
  border-radius: 12px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel.settings-panel-premium {
  --settings-panel-open-max: min(84vh, 860px) !important;
  position: absolute !important;
  top: calc(100% + 12px) !important;
  right: 0 !important;
  left: auto !important;
  width: min(1020px, 92vw) !important;
  border-radius: 20px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-premium.is-open {
  padding: 10px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head {
  margin-bottom: 9px !important;
  padding: 10px 12px 11px !important;
  border-radius: 14px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head h3 {
  font-size: 1rem !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head p {
  font-size: 0.74rem !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-layout {
  grid-template-columns: minmax(240px, 0.88fr) minmax(0, 1.12fr) !important;
  gap: 10px !important;
  max-height: calc(var(--settings-panel-open-max) - 108px) !important;
  overflow: hidden !important;
  padding: 0 !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-side {
  padding: 8px !important;
  max-height: none !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-workspace {
  display: grid !important;
  grid-template-rows: auto minmax(0, 1fr) !important;
  gap: 8px !important;
  padding: 8px !important;
  overflow: hidden !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-strip {
  gap: 7px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-card {
  min-height: 0 !important;
  grid-template-columns: 30px minmax(0, 1fr) !important;
  padding: 8px 9px !important;
  border-radius: 11px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-label {
  font-size: 0.68rem !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-card strong {
  font-size: 0.78rem !important;
  white-space: nowrap !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-strip {
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap: 6px !important;
  padding: 4px !important;
  border-radius: 12px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-btn {
  min-height: 40px !important;
  padding: 6px 10px !important;
  justify-content: center !important;
  font-size: 0.8rem !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-text {
  padding: 0 !important;
  border-radius: 0 !important;
  background: transparent !important;
  text-shadow: none !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-panel {
  gap: 10px !important;
  padding: 10px !important;
  border-radius: 12px !important;
  max-height: calc(var(--settings-panel-open-max) - 172px) !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head h4 {
  font-size: 0.9rem !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-section-head p {
  font-size: 0.76rem !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-card {
  min-height: 124px !important;
  padding: 11px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-mode-head {
  font-size: 0.82rem !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-layout {
  grid-template-columns: minmax(0, 1.16fr) minmax(265px, 0.84fr) !important;
  gap: 10px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-side {
  padding: 10px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-grid {
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 10px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-utility-card {
  padding: 10px !important;
  border-radius: 12px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel .control-field > span {
  font-size: 0.78rem !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel input,
:is(body.force-desktop, body.auto-desktop) .settings-panel select,
:is(body.force-desktop, body.auto-desktop) .settings-panel textarea {
  min-height: 40px !important;
  font-size: 0.8rem !important;
}
/* Mobile practice final polish: compact premium layout */
:is(body.force-mobile, body.auto-mobile) .practice-question-card {
  border-radius: 16px !important;
  border: 1px solid rgba(132, 187, 224, 0.3) !important;
  background:
    radial-gradient(circle at 86% 10%, rgba(98, 193, 248, 0.24), transparent 42%),
    linear-gradient(152deg, rgba(11, 21, 33, 0.74), rgba(8, 16, 26, 0.6)) !important;
  box-shadow:
    0 14px 24px rgba(4, 12, 20, 0.24),
    inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions {
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 8px !important;
  align-items: start !important;
  margin-top: 10px !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-solution-stack {
  display: contents !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions > .practice-action-btn {
  order: 1;
}

:is(body.force-mobile, body.auto-mobile) .practice-solution-stack .practice-action-btn:first-child {
  order: 2;
}

:is(body.force-mobile, body.auto-mobile) .practice-solution-stack .practice-action-btn:last-child {
  order: 3;
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions > .practice-action-nav {
  order: 4;
}

:is(body.force-mobile, body.auto-mobile) .practice-next-btn {
  order: 5;
  grid-column: 1 / -1 !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-action-btn {
  width: 100% !important;
  min-height: 39px !important;
  padding: 7px 10px !important;
  border-radius: 12px !important;
  border: 1px solid rgba(133, 188, 225, 0.3) !important;
  background:
    linear-gradient(145deg, rgba(104, 190, 241, 0.18), rgba(104, 190, 241, 0.06)),
    rgba(8, 17, 27, 0.52) !important;
  font-size: 0.82rem !important;
  font-weight: 700 !important;
  line-height: 1.28 !important;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.12),
    0 10px 18px rgba(4, 11, 18, 0.2) !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-action-btn .practice-icon {
  width: 17px;
  height: 17px;
  border-radius: 6px;
}

:is(body.force-mobile, body.auto-mobile) .practice-reveal-box {
  margin-top: 8px !important;
  border-radius: 13px !important;
  border: 1px solid rgba(129, 188, 228, 0.28) !important;
  background:
    linear-gradient(144deg, rgba(101, 190, 244, 0.14), rgba(101, 190, 244, 0.04)),
    rgba(8, 17, 26, 0.45) !important;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.09),
    0 10px 18px rgba(4, 11, 19, 0.18) !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-reveal-head {
  font-size: 0.84rem !important;
  font-weight: 800 !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-reveal-content {
  font-size: 0.94rem !important;
  line-height: 1.88 !important;
}

html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .practice-question-card,
html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .practice-action-btn,
html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .practice-reveal-box {
  border-color: rgba(47, 98, 137, 0.24) !important;
  background:
    linear-gradient(145deg, rgba(47, 130, 193, 0.14), rgba(47, 130, 193, 0.05)),
    rgba(255, 255, 255, 0.92) !important;
}

html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .practice-action-btn,
html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile) .practice-reveal-head {
  color: #234f73;
}
/* Desktop profile neo redesign v2 (full refresh) */
:is(body.force-desktop, body.auto-desktop) .profile-surface.profile-orbit {
  position: relative !important;
  margin-bottom: 14px !important;
  padding: 14px !important;
  border-radius: 24px !important;
  border: 1px solid hsla(var(--profile-accent-hue, 198), 70%, 66%, 0.34) !important;
  background:
    radial-gradient(circle at 7% 12%, hsla(var(--profile-accent-hue, 198), 88%, 62%, 0.24), transparent 38%),
    radial-gradient(circle at 91% 88%, hsla(calc(var(--profile-accent-hue, 198) + 28), 82%, 58%, 0.2), transparent 42%),
    linear-gradient(142deg, rgba(9, 18, 29, 0.95), rgba(14, 30, 45, 0.88) 56%, rgba(9, 19, 32, 0.92)) !important;
  box-shadow:
    0 26px 52px rgba(4, 8, 14, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.1),
    inset 0 -1px 0 rgba(120, 190, 235, 0.12) !important;
  backdrop-filter: blur(15px) saturate(155%) !important;
  -webkit-backdrop-filter: blur(15px) saturate(155%) !important;
  overflow: hidden !important;
  isolation: isolate !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit::before {
  background:
    radial-gradient(circle at 83% 15%, rgba(122, 215, 255, 0.24), transparent 34%),
    radial-gradient(circle at 16% 82%, rgba(85, 190, 246, 0.14), transparent 44%),
    linear-gradient(112deg, rgba(255, 255, 255, 0.07), transparent 55%) !important;
  z-index: 0 !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit::after {
  top: 0 !important;
  left: auto !important;
  right: 24px !important;
  width: 220px !important;
  height: 2px !important;
  background: linear-gradient(90deg, transparent, rgba(176, 226, 255, 0.86), transparent) !important;
  opacity: 0.9 !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit > * {
  position: relative !important;
  z-index: 1 !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-shell {
  display: grid !important;
  grid-template-columns: minmax(320px, 0.9fr) minmax(0, 1.1fr) !important;
  gap: 12px !important;
  align-items: stretch !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side {
  position: relative !important;
  display: grid !important;
  grid-template-columns: 1fr !important;
  grid-template-areas:
    "avatar"
    "title"
    "subtitle"
    "greeting" !important;
  align-content: start !important;
  justify-items: start !important;
  gap: 10px !important;
  padding: 14px 14px 12px !important;
  border-radius: 18px !important;
  border: 1px solid rgba(134, 194, 233, 0.3) !important;
  background:
    linear-gradient(150deg, rgba(108, 196, 247, 0.14), rgba(108, 196, 247, 0.04)),
    rgba(7, 15, 24, 0.52) !important;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.1),
    0 16px 26px rgba(4, 9, 15, 0.26) !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side::before {
  content: "" !important;
  position: absolute !important;
  top: 14px !important;
  bottom: 14px !important;
  right: 12px !important;
  width: 3px !important;
  border-radius: 999px !important;
  background: linear-gradient(180deg, rgba(119, 204, 250, 0.82), rgba(119, 204, 250, 0.14)) !important;
  box-shadow: 0 0 16px rgba(119, 204, 250, 0.32) !important;
  pointer-events: none !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-avatar {
  grid-area: avatar !important;
  width: 68px !important;
  height: 68px !important;
  border-radius: 20px !important;
  margin-right: 2px !important;
  border: 1px solid hsla(var(--profile-accent-hue, 198), 86%, 76%, 0.5) !important;
  box-shadow:
    0 18px 30px rgba(6, 12, 20, 0.34),
    inset 0 1px 0 rgba(255, 255, 255, 0.3),
    0 0 0 1px rgba(255, 255, 255, 0.08) !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side h2 {
  grid-area: title !important;
  margin: 0 !important;
  font-size: 1.34rem !important;
  letter-spacing: -0.02em !important;
  line-height: 1.24 !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side p {
  grid-area: subtitle !important;
  margin: 0 !important;
  font-size: 0.96rem !important;
  line-height: 1.8 !important;
  color: rgba(195, 217, 236, 0.9) !important;
  -webkit-line-clamp: 3 !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-greeting-panel {
  grid-area: greeting !important;
  width: 100% !important;
  padding: 12px 14px !important;
  border-radius: 14px !important;
  border: 1px solid hsla(var(--profile-accent-hue, 198), 84%, 70%, 0.42) !important;
  background:
    radial-gradient(circle at 89% 12%, hsla(var(--profile-accent-hue, 198), 84%, 64%, 0.22), transparent 44%),
    linear-gradient(145deg, hsla(var(--profile-accent-hue, 198), 84%, 60%, 0.2), hsla(var(--profile-accent-hue, 198), 84%, 60%, 0.06)) !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.14) !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit .profile-greeting {
  margin: 0 !important;
  font-size: 1.07rem !important;
  font-weight: 700 !important;
  line-height: 1.9 !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-main {
  display: grid !important;
  grid-template-columns: 1fr !important;
  grid-template-areas:
    "inputs"
    "tools" !important;
  gap: 11px !important;
  padding: 12px !important;
  border-radius: 18px !important;
  border: 1px solid rgba(134, 194, 233, 0.28) !important;
  background:
    radial-gradient(circle at 88% 10%, rgba(102, 196, 248, 0.17), transparent 40%),
    linear-gradient(150deg, rgba(108, 196, 247, 0.1), rgba(108, 196, 247, 0.03)),
    rgba(7, 15, 24, 0.5) !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-grid {
  grid-area: inputs !important;
  display: grid !important;
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap: 10px !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-field {
  display: grid !important;
  gap: 7px !important;
  padding: 9px !important;
  border: 1px solid rgba(136, 196, 235, 0.24) !important;
  border-radius: 13px !important;
  background:
    linear-gradient(142deg, rgba(101, 193, 246, 0.14), rgba(101, 193, 246, 0.04)),
    rgba(8, 16, 25, 0.42) !important;
  transition: border-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-field:focus-within {
  transform: translateY(-1px) !important;
  border-color: rgba(108, 203, 255, 0.74) !important;
  box-shadow: 0 14px 22px rgba(5, 11, 18, 0.24) !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-label {
  font-size: 0.86rem !important;
  font-weight: 700 !important;
  color: rgba(193, 216, 236, 0.86) !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-input-wrap {
  min-height: 44px !important;
  border: 1px solid rgba(131, 191, 230, 0.3) !important;
  border-radius: 12px !important;
  padding: 5px 10px !important;
  gap: 8px !important;
  background: rgba(7, 15, 24, 0.56) !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.09) !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-input-wrap:focus-within {
  border-color: rgba(102, 204, 255, 0.8) !important;
  box-shadow:
    0 0 0 3px rgba(102, 204, 255, 0.16),
    inset 0 1px 0 rgba(255, 255, 255, 0.12) !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-icon {
  width: 24px !important;
  height: 24px !important;
  border-radius: 8px !important;
  border: 1px solid rgba(119, 203, 250, 0.38) !important;
  background: linear-gradient(145deg, rgba(109, 201, 250, 0.28), rgba(109, 201, 250, 0.08)) !important;
  color: #ddf2ff !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-input-wrap input {
  min-height: 32px !important;
  font-size: 0.95rem !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-tools {
  grid-area: tools !important;
  margin-top: 0 !important;
  padding: 11px !important;
  border-radius: 14px !important;
  border: 1px solid rgba(132, 192, 232, 0.28) !important;
  background:
    radial-gradient(circle at 14% 12%, rgba(103, 196, 248, 0.18), transparent 40%),
    linear-gradient(150deg, rgba(105, 194, 245, 0.12), rgba(105, 194, 245, 0.03)),
    rgba(8, 16, 26, 0.45) !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
  display: grid !important;
  gap: 9px !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-tools h3 {
  margin: 0 !important;
  font-size: 0.98rem !important;
  color: #e7f4ff !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-json-tools {
  display: grid !important;
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap: 8px !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-json-tools .glass-btn {
  min-height: 36px !important;
  border-radius: 11px !important;
  font-size: 0.78rem !important;
  font-weight: 700 !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-import {
  margin-top: 0 !important;
  gap: 7px !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-import label {
  font-size: 0.86rem !important;
  font-weight: 700 !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-import textarea {
  min-height: 108px !important;
  border-radius: 13px !important;
  padding: 10px !important;
  font-size: 0.86rem !important;
  line-height: 1.68 !important;
  border: 1px solid rgba(129, 191, 231, 0.3) !important;
  background: rgba(8, 16, 26, 0.52) !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-import textarea:focus {
  border-color: rgba(102, 203, 255, 0.82) !important;
  box-shadow: 0 0 0 3px rgba(102, 203, 255, 0.17) !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-actions {
  gap: 8px !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-actions .glass-btn {
  min-height: 36px !important;
  border-radius: 11px !important;
  font-size: 0.78rem !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-surface.profile-orbit {
  border-color: hsla(var(--profile-accent-hue, 198), 46%, 44%, 0.24) !important;
  background:
    radial-gradient(circle at 7% 12%, hsla(var(--profile-accent-hue, 198), 70%, 54%, 0.2), transparent 38%),
    radial-gradient(circle at 91% 88%, hsla(calc(var(--profile-accent-hue, 198) + 26), 66%, 52%, 0.15), transparent 42%),
    linear-gradient(160deg, rgba(255, 255, 255, 0.95), rgba(245, 250, 255, 0.9)) !important;
  box-shadow:
    0 20px 38px rgba(24, 55, 83, 0.16),
    inset 0 1px 0 rgba(255, 255, 255, 0.96),
    inset 0 -1px 0 rgba(109, 162, 197, 0.14) !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-side,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-main,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-tools,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .orbit-field {
  border-color: rgba(47, 92, 128, 0.2) !important;
  background:
    linear-gradient(145deg, rgba(47, 130, 193, 0.12), rgba(47, 130, 193, 0.04)),
    rgba(255, 255, 255, 0.9) !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-side p,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .orbit-label,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .json-text-import label {
  color: #577189 !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-tools h3,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-greeting,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-side h2 {
  color: #1f4d72 !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .orbit-input-wrap,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .json-text-import textarea {
  border-color: rgba(47, 98, 137, 0.24) !important;
  background: rgba(255, 255, 255, 0.96) !important;
}

/* Final override: exam timer must stay visible and pinned below header */
:root {
  --exam-countdown-top-offset: calc(env(safe-area-inset-top, 0px) + 96px);
  --exam-countdown-panel-height: 72px;
}

.exam-mode-panel.exam-has-live-timer {
  padding-top: calc(var(--exam-countdown-panel-height) + 12px) !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile)
  .exam-countdown-panel.exam-countdown-panel-pinned {
  position: fixed !important;
  top: max(var(--exam-countdown-top-offset), calc(env(safe-area-inset-top, 0px) + 120px)) !important;
  z-index: 2500 !important;
  backdrop-filter: blur(12px) saturate(140%) !important;
  -webkit-backdrop-filter: blur(12px) saturate(140%) !important;
}

:is(body.force-desktop, body.auto-desktop) .exam-countdown-panel.exam-countdown-panel-pinned {
  right: max(12px, calc((100vw - min(1220px, 94vw)) / 2 + 12px)) !important;
  left: auto !important;
  width: min(268px, calc(100vw - 24px)) !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-countdown-panel.exam-countdown-panel-pinned {
  right: 8px !important;
  left: 8px !important;
  width: auto !important;
}

@media (max-width: 980px) {
  .exam-countdown-panel.exam-countdown-panel-pinned {
    right: 8px !important;
    left: 8px !important;
    width: auto !important;
  }
}

/* Exam action buttons redesign: premium hierarchy + responsive layout */
.exam-actions-grid {
  display: flex !important;
  justify-content: flex-end !important;
  align-items: center !important;
  gap: 1rem !important;
  flex-wrap: wrap !important;
}

.exam-actions-grid .btn-exam {
  min-height: 48px !important;
  padding: 0.72rem 0.96rem !important;
  border-radius: 12px !important;
  border: 1px solid transparent !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  gap: 0.5rem !important;
  font-family: "Vazirmatn", sans-serif !important;
  font-size: 0.84rem !important;
  font-weight: 700 !important;
  line-height: 1.2 !important;
  white-space: nowrap !important;
  cursor: pointer !important;
  transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, background-color 0.2s ease,
    color 0.2s ease !important;
}

.exam-actions-grid .btn-exam svg {
  width: 16px !important;
  height: 16px !important;
  opacity: 0.96 !important;
}

.exam-actions-grid .btn-exam:hover {
  transform: translateY(-1px) !important;
}

.exam-actions-grid .btn-exam:disabled {
  opacity: 0.56 !important;
  cursor: not-allowed !important;
  transform: none !important;
  box-shadow: none !important;
}

.exam-actions-grid .btn-exam-primary-print {
  color: #e9f6ff !important;
  border-color: rgba(104, 201, 255, 0.55) !important;
  background: linear-gradient(145deg, rgba(64, 176, 245, 0.92), rgba(78, 201, 255, 0.86)) !important;
  box-shadow: 0 12px 24px rgba(6, 49, 76, 0.28), inset 0 1px 0 rgba(255, 255, 255, 0.28) !important;
}

.exam-actions-grid .btn-exam-primary-finish {
  color: #ecfff5 !important;
  border-color: rgba(123, 229, 179, 0.55) !important;
  background: linear-gradient(145deg, rgba(64, 184, 126, 0.92), rgba(82, 209, 153, 0.84)) !important;
  box-shadow: 0 12px 24px rgba(7, 51, 34, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.24) !important;
}

.exam-actions-grid .btn-exam-ghost-copy {
  color: #d7ecff !important;
  border-color: rgba(141, 196, 236, 0.42) !important;
  background: rgba(255, 255, 255, 0.06) !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08), 0 8px 18px rgba(6, 18, 31, 0.2) !important;
}

.exam-actions-grid .btn-exam-ghost-danger {
  color: #ffc4c8 !important;
  border-color: rgba(255, 137, 147, 0.45) !important;
  background: rgba(255, 113, 128, 0.08) !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05), 0 8px 18px rgba(39, 9, 14, 0.2) !important;
}

@media (max-width: 768px) {
  .exam-actions-grid {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 0.75rem !important;
    width: 100% !important;
  }

  .exam-actions-grid .btn-exam {
    width: 100% !important;
    min-height: 48px !important;
    padding: 0.72rem !important;
    font-size: 0.8rem !important;
  }
}

html[data-theme^="light-"] .exam-actions-grid .btn-exam-ghost-copy {
  color: #1e5e89 !important;
  border-color: rgba(47, 130, 193, 0.34) !important;
  background: rgba(255, 255, 255, 0.9) !important;
}

html[data-theme^="light-"] .exam-actions-grid .btn-exam-ghost-danger {
  color: #98424a !important;
  border-color: rgba(198, 93, 106, 0.34) !important;
  background: rgba(255, 255, 255, 0.9) !important;
}

html[data-theme^="light-"] .exam-actions-grid .btn-exam-primary-print {
  color: #ffffff !important;
}

html[data-theme^="light-"] .exam-actions-grid .btn-exam-primary-finish {
  color: #ffffff !important;
}

/* Header overflow hard fix (desktop + mobile) */
.topbar.premium-topbar.header-premium-compact {
  width: 100% !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
  overflow-x: clip !important;
  overflow-y: visible !important;
}

.header-premium-compact .header-compact-top {
  grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) auto !important;
  min-width: 0 !important;
}

.header-premium-compact .header-compact-brand,
.header-premium-compact .header-compact-stats,
.header-premium-compact .header-compact-controls,
.header-premium-compact .header-nav-segmented {
  min-width: 0 !important;
  max-width: 100% !important;
}

.header-premium-compact .header-compact-stats {
  justify-content: flex-start !important;
  align-content: center !important;
}

.header-premium-compact .header-compact-stats .header-quick-pill {
  max-width: 100% !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.header-premium-compact .header-compact-controls {
  flex-wrap: wrap !important;
  row-gap: 0.35rem !important;
}

.header-premium-compact .header-nav-segmented {
  width: 100% !important;
}

@media (max-width: 1100px) {
  .header-premium-compact .header-compact-top {
    grid-template-columns: minmax(0, 1fr) auto !important;
  }

  .header-premium-compact .header-compact-stats {
    grid-column: 1 / -1 !important;
  }
}

/* Absolute final lock: exam timer must stay above header on desktop/mobile */
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile)
  .exam-countdown-panel.exam-countdown-panel-pinned {
  top: max(var(--exam-countdown-top-offset), calc(env(safe-area-inset-top, 0px) + 120px)) !important;
  z-index: 3200 !important;
}

@media (min-width: 769px) {
  :is(body.force-desktop, body.auto-desktop) .header-premium-compact .header-compact-stats {
    display: inline-flex !important;
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 0.38rem !important;
    grid-column: auto !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    scrollbar-width: none !important;
  }

  :is(body.force-desktop, body.auto-desktop) .header-premium-compact .header-compact-stats::-webkit-scrollbar {
    display: none !important;
  }
}

/* Prompt pair apply: profile/data management + cloud sync redesign */
.profile-redesign-v2 {
  position: relative !important;
  margin: 0 0 0.95rem !important;
  padding: 1.2rem !important;
  border-radius: 22px !important;
  border: 1px solid rgba(125, 186, 234, 0.28) !important;
  background:
    radial-gradient(circle at 8% 10%, rgba(74, 170, 244, 0.2), transparent 34%),
    radial-gradient(circle at 92% 88%, rgba(74, 170, 244, 0.12), transparent 42%),
    linear-gradient(148deg, rgba(9, 19, 30, 0.92), rgba(9, 18, 29, 0.84)) !important;
  box-shadow: 0 22px 40px rgba(3, 9, 16, 0.32), inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
}

.profile-redesign-v2::before,
.profile-redesign-v2::after {
  display: none !important;
}

.profile-redesign-v2 .profile-v2-grid {
  display: grid !important;
  grid-template-columns: 1fr 1fr !important;
  gap: 2rem !important;
  align-items: stretch !important;
}

.profile-redesign-v2 .profile-v2-card {
  min-width: 0 !important;
  padding: 1rem !important;
  border-radius: 16px !important;
  border: 1px solid rgba(132, 192, 232, 0.26) !important;
  background: linear-gradient(150deg, rgba(100, 190, 245, 0.11), rgba(100, 190, 245, 0.03)) !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06), 0 14px 26px rgba(4, 11, 19, 0.22) !important;
}

.profile-redesign-v2 .profile-v2-head {
  display: flex !important;
  align-items: flex-start !important;
  justify-content: space-between !important;
  gap: 0.75rem !important;
  margin-bottom: 0.9rem !important;
}

.profile-redesign-v2 .profile-v2-title-wrap h2 {
  margin: 0 !important;
  font-size: 1.2rem !important;
  line-height: 1.35 !important;
}

.profile-redesign-v2 .profile-v2-title-wrap p {
  margin: 0.32rem 0 0 !important;
  color: var(--text-muted) !important;
  font-size: 0.9rem !important;
  line-height: 1.75 !important;
}

.profile-redesign-v2 .profile-v2-avatar {
  flex: 0 0 auto !important;
  width: 52px !important;
  height: 52px !important;
}

.profile-redesign-v2 .profile-v2-greeting-card {
  margin-bottom: 0.95rem !important;
  padding: 0.82rem 0.95rem !important;
  border-radius: 13px !important;
  border: 1px solid rgba(137, 201, 244, 0.38) !important;
  background: linear-gradient(145deg, rgba(96, 185, 241, 0.2), rgba(96, 185, 241, 0.08)) !important;
}

.profile-redesign-v2 .profile-greeting {
  margin: 0 !important;
  font-size: 1.03rem !important;
  font-weight: 700 !important;
  line-height: 1.86 !important;
}

.profile-redesign-v2 .profile-v2-fields {
  display: flex !important;
  flex-direction: column !important;
  gap: 0.78rem !important;
}

.profile-redesign-v2 .profile-v2-field {
  display: flex !important;
  flex-direction: column !important;
  gap: 0.42rem !important;
}

.profile-redesign-v2 .profile-v2-label {
  font-size: 0.86rem !important;
  font-weight: 700 !important;
  color: var(--text-muted) !important;
}

.profile-redesign-v2 .profile-v2-input-wrap {
  display: flex !important;
  align-items: center !important;
  gap: 0.55rem !important;
  min-height: 44px !important;
  padding: 0.35rem 0.65rem !important;
  border-radius: 12px !important;
  border: 1px solid rgba(130, 193, 235, 0.28) !important;
  background: rgba(8, 16, 25, 0.58) !important;
}

.profile-redesign-v2 .profile-v2-icon {
  width: 24px !important;
  height: 24px !important;
  border-radius: 8px !important;
  border: 1px solid rgba(130, 193, 235, 0.3) !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  color: #a8dbff !important;
  background: rgba(255, 255, 255, 0.06) !important;
}

.profile-redesign-v2 .profile-v2-icon svg {
  width: 14px !important;
  height: 14px !important;
  stroke: currentColor !important;
  stroke-width: 1.8 !important;
  fill: none !important;
  stroke-linecap: round !important;
  stroke-linejoin: round !important;
}

.profile-redesign-v2 .profile-v2-input-wrap input {
  flex: 1 !important;
  min-width: 0 !important;
  border: 0 !important;
  background: transparent !important;
  color: var(--text-main) !important;
  font-size: 0.95rem !important;
  font-family: "Vazirmatn", sans-serif !important;
}

.profile-redesign-v2 .profile-v2-input-wrap input:focus {
  outline: none !important;
}

.profile-redesign-v2 .profile-v2-data h3 {
  margin: 0 0 0.82rem !important;
  font-size: 1.02rem !important;
}

.profile-redesign-v2 .profile-v2-actions {
  display: flex !important;
  flex-wrap: wrap !important;
  gap: 0.58rem !important;
  margin-bottom: 0.88rem !important;
}

.profile-redesign-v2 .profile-v2-actions .glass-btn {
  flex: 1 1 calc(50% - 0.29rem) !important;
  min-height: 40px !important;
  border-radius: 12px !important;
  font-weight: 700 !important;
}

.profile-redesign-v2 .profile-v2-json-label {
  display: block !important;
  margin: 0 0 0.45rem !important;
  color: var(--text-muted) !important;
  font-size: 0.85rem !important;
  font-weight: 700 !important;
}

.profile-redesign-v2 #jsonImportText {
  width: 100% !important;
  min-height: 200px !important;
  resize: vertical !important;
  border-radius: 13px !important;
  border: 1px solid rgba(130, 193, 235, 0.29) !important;
  background: rgba(7, 16, 26, 0.64) !important;
  color: #d6e9fb !important;
  font-family: "Cascadia Code", "Consolas", "Courier New", monospace !important;
  font-size: 0.84rem !important;
  line-height: 1.68 !important;
  padding: 0.8rem !important;
}

.profile-redesign-v2 #jsonImportText::placeholder {
  color: rgba(185, 208, 230, 0.72) !important;
}

.profile-redesign-v2 .profile-v2-json-actions {
  margin-top: 0.72rem !important;
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 0.58rem !important;
}

.profile-redesign-v2 .profile-v2-json-actions .glass-btn {
  min-height: 39px !important;
  border-radius: 12px !important;
  font-weight: 700 !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-redesign {
  display: flex !important;
  flex-direction: column !important;
  gap: 1.5rem !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-redesign-head {
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
  gap: 0.75rem !important;
  padding-bottom: 0.65rem !important;
  border-bottom: 1px solid rgba(138, 172, 201, 0.22) !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-redesign-title {
  display: inline-flex !important;
  align-items: center !important;
  gap: 0.52rem !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-redesign-title h4 {
  margin: 0 !important;
  font-size: 0.95rem !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-redesign-intro {
  margin: -0.35rem 0 0 !important;
  color: var(--text-muted) !important;
  font-size: 0.78rem !important;
  line-height: 1.75 !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-redesign-form {
  display: flex !important;
  flex-direction: column !important;
  gap: 1.15rem !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-field-group {
  display: flex !important;
  flex-direction: column !important;
  gap: 0.45rem !important;
  margin: 0 !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-field-label {
  font-size: 0.82rem !important;
  font-weight: 700 !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-field-group > :is(input, select) {
  width: 100% !important;
  min-height: 40px !important;
  border-radius: 12px !important;
  border: 1px solid rgba(132, 192, 232, 0.28) !important;
  background: rgba(9, 19, 30, 0.55) !important;
  color: var(--text-main) !important;
  font-size: 0.86rem !important;
  padding: 0.56rem 0.8rem !important;
  font-family: "Vazirmatn", sans-serif !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-field-group > select {
  appearance: none !important;
  -webkit-appearance: none !important;
  cursor: pointer !important;
  background-image:
    linear-gradient(45deg, transparent 50%, rgba(177, 218, 245, 0.88) 50%),
    linear-gradient(135deg, rgba(177, 218, 245, 0.88) 50%, transparent 50%);
  background-position:
    calc(1rem) calc(50% - 2px),
    calc(0.72rem) calc(50% - 2px);
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
  padding-inline: 0.8rem 2rem !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-field-hint {
  margin: 0 !important;
  color: var(--text-muted) !important;
  font-size: 0.72rem !important;
  line-height: 1.7 !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-redesign-footer {
  display: flex !important;
  flex-direction: column !important;
  gap: 0.78rem !important;
  padding-top: 0.75rem !important;
  border-top: 1px solid rgba(138, 172, 201, 0.2) !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-redesign-footer .settings-meta-note {
  margin: 0 !important;
  font-size: 0.74rem !important;
  line-height: 1.75 !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-redesign-actions {
  display: flex !important;
  flex-wrap: wrap !important;
  gap: 0.55rem !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-redesign-actions .glass-btn {
  flex: 1 1 220px !important;
  min-height: 40px !important;
  border-radius: 12px !important;
  font-size: 0.8rem !important;
  font-weight: 700 !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-diagnostics {
  display: flex !important;
  flex-direction: column !important;
  gap: 0.72rem !important;
  padding: 0.82rem !important;
  border: 1px solid rgba(134, 178, 213, 0.25) !important;
  border-radius: 14px !important;
  background: linear-gradient(150deg, rgba(91, 141, 184, 0.08), rgba(9, 20, 32, 0.2)) !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-diagnostics-head {
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
  gap: 0.6rem !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-diagnostics-head h5 {
  margin: 0 !important;
  font-size: 0.81rem !important;
  font-weight: 800 !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-debug-toggle {
  display: inline-flex !important;
  align-items: center !important;
  gap: 0.38rem !important;
  font-size: 0.72rem !important;
  color: var(--text-muted) !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-debug-toggle > input {
  width: 14px !important;
  height: 14px !important;
  accent-color: #68c8ff !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-diagnostics-grid {
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 0.5rem !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-diag-item {
  display: flex !important;
  flex-direction: column !important;
  gap: 0.24rem !important;
  min-height: 62px !important;
  padding: 0.48rem 0.56rem !important;
  border-radius: 10px !important;
  border: 1px solid rgba(130, 179, 218, 0.2) !important;
  background: rgba(6, 16, 26, 0.34) !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-diag-item-wide {
  grid-column: 1 / -1 !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-diag-label {
  font-size: 0.67rem !important;
  color: rgba(197, 221, 243, 0.78) !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-diag-value {
  font-size: 0.74rem !important;
  font-weight: 700 !important;
  color: var(--text-main) !important;
  direction: ltr !important;
  text-align: left !important;
  unicode-bidi: plaintext !important;
  overflow-wrap: anywhere !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-diag-error {
  margin: 0 !important;
  min-height: 56px !important;
  max-height: 138px !important;
  padding: 0.44rem 0.5rem !important;
  border-radius: 9px !important;
  border: 1px solid rgba(220, 120, 120, 0.32) !important;
  background: rgba(40, 13, 18, 0.36) !important;
  color: #ffd2d7 !important;
  font-size: 0.67rem !important;
  line-height: 1.62 !important;
  white-space: pre-wrap !important;
  overflow: auto !important;
  direction: ltr !important;
  text-align: left !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-diag-copy-btn {
  align-self: flex-start !important;
  min-height: 32px !important;
  padding-inline: 0.64rem !important;
  font-size: 0.68rem !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-diagnostics-log {
  display: flex !important;
  flex-direction: column !important;
  gap: 0.38rem !important;
  padding: 0.52rem !important;
  border-radius: 10px !important;
  border: 1px solid rgba(130, 179, 218, 0.22) !important;
  background: rgba(5, 14, 24, 0.35) !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-diagnostics-log-head {
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
  gap: 0.55rem !important;
  font-size: 0.69rem !important;
  color: var(--text-muted) !important;
}

.settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-debug-log {
  margin: 0 !important;
  min-height: 86px !important;
  max-height: 188px !important;
  padding: 0.42rem 0.52rem !important;
  border-radius: 8px !important;
  border: 1px solid rgba(125, 168, 202, 0.24) !important;
  background: rgba(2, 9, 16, 0.52) !important;
  color: rgba(223, 240, 255, 0.92) !important;
  font-size: 0.66rem !important;
  line-height: 1.56 !important;
  white-space: pre-wrap !important;
  overflow: auto !important;
  direction: ltr !important;
  text-align: left !important;
}

html[data-theme^="light-"] .profile-redesign-v2 {
  border-color: rgba(45, 87, 122, 0.2) !important;
  background:
    radial-gradient(circle at 8% 10%, rgba(93, 164, 220, 0.16), transparent 34%),
    radial-gradient(circle at 92% 88%, rgba(93, 164, 220, 0.1), transparent 42%),
    linear-gradient(154deg, rgba(255, 255, 255, 0.93), rgba(244, 249, 255, 0.9)) !important;
  box-shadow: 0 16px 30px rgba(19, 56, 87, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.88) !important;
}

html[data-theme^="light-"] .profile-redesign-v2 .profile-v2-card {
  border-color: rgba(47, 90, 124, 0.2) !important;
  background: linear-gradient(150deg, rgba(54, 132, 188, 0.12), rgba(54, 132, 188, 0.04)), rgba(255, 255, 255, 0.88) !important;
}

html[data-theme^="light-"] .profile-redesign-v2 .profile-v2-input-wrap,
html[data-theme^="light-"] .profile-redesign-v2 #jsonImportText,
html[data-theme^="light-"] .settings-tab-panel[data-tab-panel="cloud-sync"] .drive-field-group > :is(input, select) {
  border-color: rgba(47, 98, 137, 0.24) !important;
  background: rgba(255, 255, 255, 0.95) !important;
}

@media (max-width: 980px) {
  .profile-redesign-v2 {
    padding: 0.9rem !important;
  }

  .profile-redesign-v2 .profile-v2-grid {
    grid-template-columns: 1fr !important;
    gap: 0.9rem !important;
  }

  .profile-redesign-v2 .profile-v2-actions .glass-btn {
    flex: 1 1 calc(50% - 0.29rem) !important;
  }

  .profile-redesign-v2 #jsonImportText {
    min-height: 180px !important;
  }

  .settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-redesign-head {
    flex-wrap: wrap !important;
    align-items: flex-start !important;
  }

  .settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-diagnostics-head {
    align-items: flex-start !important;
    flex-wrap: wrap !important;
  }

  .settings-tab-panel[data-tab-panel="cloud-sync"] .drive-sync-diagnostics-grid {
    grid-template-columns: 1fr !important;
  }
}

/* Exam timer visibility fix: desktop + mobile pinned and always above header */
:root {
  --exam-countdown-top-offset: calc(env(safe-area-inset-top, 0px) + 96px);
  --exam-countdown-panel-height: 72px;
}

.exam-mode-panel.exam-has-live-timer {
  padding-top: calc(var(--exam-countdown-panel-height) + 12px) !important;
}

.exam-countdown-panel.exam-countdown-panel-pinned {
  position: fixed !important;
  top: var(--exam-countdown-top-offset) !important;
  z-index: 1405 !important;
  backdrop-filter: blur(12px) saturate(140%) !important;
  -webkit-backdrop-filter: blur(12px) saturate(140%) !important;
}

:is(body.force-desktop, body.auto-desktop) .exam-countdown-panel.exam-countdown-panel-pinned {
  right: max(12px, calc((100vw - min(1220px, 94vw)) / 2 + 12px)) !important;
  left: auto !important;
  width: min(268px, calc(100vw - 24px)) !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-countdown-panel.exam-countdown-panel-pinned {
  right: 8px !important;
  left: 8px !important;
  width: auto !important;
}

@media (max-width: 980px) {
  .exam-countdown-panel.exam-countdown-panel-pinned {
    right: 8px !important;
    left: 8px !important;
    width: auto !important;
  }
}

/* Compact premium header redesign */
.topbar.premium-topbar.header-premium-compact {
  position: sticky !important;
  top: 0 !important;
  z-index: 1000 !important;
  display: grid !important;
  grid-template-columns: 1fr !important;
  gap: 0.55rem !important;
  margin: 0 0 0.75rem !important;
  padding: 0.75rem 1.5rem !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
  border-radius: 0 0 18px 18px !important;
  background: rgba(15, 23, 42, 0.6) !important;
  backdrop-filter: blur(12px) saturate(180%) !important;
  -webkit-backdrop-filter: blur(12px) saturate(180%) !important;
  box-shadow: 0 14px 28px rgba(2, 8, 22, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.07) !important;
  overflow: visible !important;
}

.topbar.premium-topbar.header-premium-compact::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(circle at 88% 12%, rgba(64, 179, 255, 0.18), transparent 34%),
    radial-gradient(circle at 15% 88%, rgba(115, 195, 255, 0.11), transparent 40%);
  pointer-events: none;
}

.topbar.premium-topbar.header-premium-compact > * {
  position: relative;
  z-index: 1;
}

.header-premium-compact .header-compact-top {
  display: grid;
  grid-template-columns: minmax(220px, 1fr) auto auto;
  align-items: center;
  gap: 0.5rem 1rem;
  min-width: 0;
}

.header-premium-compact .header-compact-brand {
  display: inline-flex;
  align-items: center;
  gap: 0.55rem;
  min-width: 0;
}

.header-premium-compact .header-brand-icon {
  width: 34px;
  height: 34px;
  border-radius: 11px;
  border: 1px solid rgba(146, 203, 255, 0.46);
  background: linear-gradient(155deg, rgba(125, 203, 255, 0.28), rgba(57, 124, 188, 0.12));
  color: #dff3ff;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 8px 16px rgba(4, 20, 39, 0.32), inset 0 1px 0 rgba(255, 255, 255, 0.32);
}

.header-premium-compact .header-brand-icon svg {
  width: 18px;
  height: 18px;
  stroke: currentColor;
  stroke-width: 1.7;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.header-premium-compact .header-brand-title {
  margin: 0;
  font-size: clamp(0.95rem, 1vw + 0.55rem, 1.18rem);
  font-weight: 800;
  line-height: 1.2;
  letter-spacing: -0.015em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.header-premium-compact .header-compact-stats {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 0.38rem;
}

.header-premium-compact .header-quick-pill {
  min-height: 24px;
  padding: 0 0.62rem;
  border-radius: 999px;
  border: 1px solid rgba(182, 214, 241, 0.24);
  background: rgba(255, 255, 255, 0.08);
  color: #d6e8f8;
  font-size: 0.72rem;
  font-weight: 600;
  white-space: nowrap;
}

.header-premium-compact .header-compact-controls {
  display: inline-flex;
  align-items: center;
  justify-content: flex-end;
  gap: 0.42rem;
}

.header-premium-compact .header-view-chip {
  position: relative;
  min-height: 34px;
  padding: 0 0.78rem 0 1.6rem;
  border-radius: 11px;
  border: 1px solid rgba(172, 205, 233, 0.28);
  background: rgba(255, 255, 255, 0.1);
  color: #e4effa;
  font-size: 0.74rem;
  font-weight: 700;
  display: inline-flex;
  align-items: center;
  white-space: nowrap;
}

.header-premium-compact .header-view-chip::after {
  content: "▾";
  position: absolute;
  inset-inline-start: 0.58rem;
  top: 50%;
  transform: translateY(-52%);
  font-size: 0.65rem;
  opacity: 0.9;
}

.header-premium-compact .header-settings-btn.settings-trigger {
  min-width: auto;
  min-height: 34px;
  padding: 0 0.72rem;
  border-radius: 11px;
  border: 1px solid rgba(172, 205, 233, 0.3);
  background: rgba(255, 255, 255, 0.11);
  box-shadow: 0 8px 16px rgba(3, 14, 30, 0.28);
  font-size: 0.75rem;
  font-weight: 700;
  display: inline-flex;
  align-items: center;
  gap: 0.42rem;
}

.header-premium-compact .header-settings-btn.settings-trigger:hover {
  transform: translateY(-1px);
  border-color: rgba(109, 196, 255, 0.62);
  background: rgba(64, 179, 255, 0.2);
}

.header-premium-compact .header-nav-segmented {
  display: flex !important;
  flex-direction: row !important;
  flex-wrap: nowrap !important;
  align-items: center;
  gap: 0.34rem;
  padding: 0.25rem;
  border: 1px solid rgba(174, 208, 236, 0.22);
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.06);
  overflow-x: auto;
  scrollbar-width: none;
}

.header-premium-compact .header-nav-segmented::-webkit-scrollbar {
  display: none;
}

.header-premium-compact .header-nav-segmented .header-quick-btn {
  min-height: 34px;
  padding: 0.35rem 0.72rem;
  border-radius: 9px;
  border: 1px solid rgba(177, 209, 236, 0.22);
  background: rgba(255, 255, 255, 0.07);
  color: #e8f2fb;
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  font-size: 0.76rem;
  font-weight: 700;
  white-space: nowrap;
  transition: transform 0.2s ease, background-color 0.2s ease, border-color 0.2s ease;
}

.header-premium-compact .header-nav-segmented .header-quick-btn .header-quick-icon {
  width: 16px;
  height: 16px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 5px;
  background: rgba(255, 255, 255, 0.11);
  border: 1px solid rgba(190, 217, 240, 0.25);
}

.header-premium-compact .header-nav-segmented .header-quick-btn .header-quick-icon svg {
  width: 12px;
  height: 12px;
  stroke: currentColor;
  stroke-width: 1.8;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.header-premium-compact .header-nav-segmented .header-quick-btn:hover {
  transform: translateY(-1px);
  border-color: rgba(111, 199, 255, 0.62);
  background: rgba(64, 179, 255, 0.22);
}

.header-premium-compact .header-nav-segmented .header-quick-btn.is-active {
  border-color: rgba(111, 199, 255, 0.78);
  background: linear-gradient(150deg, rgba(64, 179, 255, 0.28), rgba(64, 179, 255, 0.14));
  box-shadow: 0 8px 16px rgba(4, 25, 46, 0.3);
}

.header-premium-compact .header-nav-segmented .header-quick-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.header-premium-compact .settings-panel.settings-panel-premium {
  width: min(980px, calc(100vw - 2rem));
  margin: 0;
  margin-inline-start: auto;
}

html[data-theme^="light-"] .topbar.premium-topbar.header-premium-compact {
  background: rgba(255, 255, 255, 0.72) !important;
  border-color: rgba(50, 87, 118, 0.18) !important;
  border-bottom-color: rgba(50, 87, 118, 0.16) !important;
  box-shadow: 0 12px 24px rgba(23, 58, 86, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.88) !important;
}

html[data-theme^="light-"] .header-premium-compact .header-brand-title,
html[data-theme^="light-"] .header-premium-compact .header-quick-pill,
html[data-theme^="light-"] .header-premium-compact .header-view-chip,
html[data-theme^="light-"] .header-premium-compact .header-nav-segmented .header-quick-btn {
  color: #1e344a;
}

@media (max-width: 980px) {
  .topbar.premium-topbar.header-premium-compact {
    padding: 0.65rem 0.85rem !important;
    border-radius: 0 0 14px 14px !important;
  }

  .header-premium-compact .header-compact-top {
    grid-template-columns: 1fr auto;
    gap: 0.45rem 0.55rem;
  }

  .header-premium-compact .header-compact-stats {
    grid-column: 1 / -1;
    justify-content: flex-start;
  }

  .header-premium-compact .header-brand-title {
    font-size: clamp(0.88rem, 3.4vw, 1rem);
  }

  .header-premium-compact .header-nav-segmented .header-quick-btn {
    min-height: 32px;
    padding: 0.3rem 0.62rem;
  }
}

@media (max-width: 560px) {
  .header-premium-compact .header-settings-btn.settings-trigger > span:not(.settings-trigger-status) {
    display: none;
  }

  .header-premium-compact .header-settings-btn.settings-trigger {
    width: 34px;
    padding: 0;
    justify-content: center;
  }

  .header-premium-compact .header-view-chip {
    min-height: 32px;
    font-size: 0.7rem;
  }

  .header-premium-compact .header-quick-pill {
    min-height: 22px;
    font-size: 0.68rem;
    padding: 0 0.5rem;
  }
}

/* Exam mode final polish: pinned timer + compact mobile layout + distinct answer theme */
:is(body.force-desktop, body.auto-desktop) .exam-countdown-panel-pinned {
  position: fixed !important;
  top: calc(env(safe-area-inset-top, 0px) + 78px) !important;
  right: max(12px, calc((100vw - min(1220px, 94vw)) / 2 + 12px)) !important;
  width: min(252px, calc(100vw - 24px)) !important;
  z-index: 128 !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-countdown-panel-pinned {
  position: fixed !important;
  top: calc(env(safe-area-inset-top, 0px) + 62px) !important;
  right: 8px !important;
  left: 8px !important;
  width: auto !important;
  z-index: 132 !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-mode-panel.exam-has-live-timer {
  padding-top: 74px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-mode-panel {
  gap: 7px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-form {
  gap: 7px !important;
  padding: 8px !important;
  border-radius: 13px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-head {
  gap: 7px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-head p {
  font-size: 0.76rem !important;
  line-height: 1.64 !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-stats {
  gap: 5px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-pane {
  padding: 7px !important;
  border-radius: 11px !important;
  gap: 7px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-chapter-toolbar {
  display: grid !important;
  grid-template-columns: 1fr auto !important;
  gap: 6px !important;
  align-items: center !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-chapter-toolbar-actions {
  display: inline-flex !important;
  gap: 5px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-chip-btn {
  min-height: 30px !important;
  border-radius: 9px !important;
  font-size: 0.7rem !important;
  padding: 3px 7px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-chapter-grid {
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 6px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-chapter-check-ui {
  min-height: 52px !important;
  padding: 6px 7px !important;
  border-radius: 10px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-controls {
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 6px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-controls input,
:is(body.force-mobile, body.auto-mobile) .exam-builder-controls select {
  min-height: 34px !important;
  font-size: 0.78rem !important;
  border-radius: 10px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-builder-controls .exam-generate-btn {
  min-height: 36px !important;
  font-size: 0.78rem !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-actions {
  gap: 6px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-quick-stats {
  display: flex !important;
  flex-wrap: nowrap !important;
  overflow-x: auto !important;
  -webkit-overflow-scrolling: touch !important;
  scrollbar-width: thin !important;
  gap: 5px !important;
  padding-bottom: 1px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-quick-stats .exam-stat-chip {
  flex: 0 0 auto !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-session-actions {
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 6px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-session-btn {
  min-height: 33px !important;
  font-size: 0.72rem !important;
  padding: 4px 6px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper {
  padding: 9px !important;
  gap: 8px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-meta-grid {
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 5px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-list {
  gap: 8px !important;
  margin-top: 8px !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-item {
  padding: 7px !important;
  border-radius: 10px !important;
}

@media (max-width: 520px) {
  :is(body.force-mobile, body.auto-mobile) .exam-builder-controls,
  :is(body.force-mobile, body.auto-mobile) .exam-chapter-grid,
  :is(body.force-mobile, body.auto-mobile) .exam-paper-meta-grid {
    grid-template-columns: 1fr !important;
  }
}

.exam-paper.is-completed {
  border-color: rgba(136, 222, 182, 0.34);
  background:
    radial-gradient(circle at 88% 10%, rgba(120, 225, 175, 0.16), transparent 42%),
    linear-gradient(152deg, rgba(10, 24, 20, 0.56), rgba(8, 18, 15, 0.44));
}

.exam-paper.is-completed .exam-answer-key {
  border-top: 1px dashed rgba(120, 225, 175, 0.45);
  background:
    radial-gradient(circle at 9% 12%, rgba(120, 225, 175, 0.12), transparent 40%),
    linear-gradient(152deg, rgba(120, 225, 175, 0.08), rgba(120, 225, 175, 0.02));
  border-radius: 12px;
  padding: 10px;
}

.exam-paper.is-completed .exam-answer-key-head h4 {
  color: #d8fff0;
}

.exam-paper.is-completed .exam-answer-key-head p {
  color: #a8d9c6;
}

.exam-paper.is-completed .exam-answer-key-item {
  border-color: rgba(120, 225, 175, 0.28);
  background:
    linear-gradient(145deg, rgba(120, 225, 175, 0.16), rgba(120, 225, 175, 0.05)),
    rgba(8, 22, 19, 0.56);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.exam-paper.is-completed .exam-answer-key-title {
  color: #d0ffea;
}

html[data-theme^="light-"] .exam-paper.is-completed {
  border-color: rgba(49, 149, 107, 0.24);
  background:
    radial-gradient(circle at 88% 10%, rgba(49, 149, 107, 0.12), transparent 42%),
    linear-gradient(152deg, rgba(255, 255, 255, 0.95), rgba(246, 252, 248, 0.92));
}

html[data-theme^="light-"] .exam-paper.is-completed .exam-answer-key {
  border-top-color: rgba(49, 149, 107, 0.34);
  background:
    radial-gradient(circle at 9% 12%, rgba(49, 149, 107, 0.1), transparent 40%),
    linear-gradient(152deg, rgba(49, 149, 107, 0.08), rgba(255, 255, 255, 0.92));
}

html[data-theme^="light-"] .exam-paper.is-completed .exam-answer-key-head h4,
html[data-theme^="light-"] .exam-paper.is-completed .exam-answer-key-title {
  color: #1f6d4d;
}

html[data-theme^="light-"] .exam-paper.is-completed .exam-answer-key-head p {
  color: #4e7b67;
}

html[data-theme^="light-"] .exam-paper.is-completed .exam-answer-key-item {
  border-color: rgba(49, 149, 107, 0.24);
  background:
    linear-gradient(145deg, rgba(49, 149, 107, 0.12), rgba(49, 149, 107, 0.04)),
    rgba(255, 255, 255, 0.94);
}

/* Mobile Question-Bank filters: compact desktop-like layout */
:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode {
  gap: 6px !important;
  padding: 7px !important;
  border-radius: 12px !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-filter-top {
  display: grid !important;
  grid-template-columns: 1fr !important;
  gap: 6px !important;
  align-items: start !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-search-wrap {
  min-width: 0 !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-search-input {
  min-height: 32px !important;
  border-radius: 10px !important;
  font-size: 0.8rem !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-filter-actions {
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 6px !important;
  align-items: start !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-topic-panel {
  grid-column: 1 / -1 !important;
  min-width: 0 !important;
  padding: 6px !important;
  gap: 5px !important;
  border-radius: 10px !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-topic-panel-head {
  gap: 6px !important;
  flex-wrap: wrap !important;
  justify-content: space-between !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-topic-panel-title {
  font-size: 0.72rem !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-topic-active-pill {
  max-width: 100% !important;
  min-height: 20px !important;
  font-size: 0.64rem !important;
  padding: 1px 7px !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-topic-panel-controls {
  gap: 5px !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode :is(.qb-topic-wrap, .qb-solved-wrap, .qb-sort-wrap) {
  width: 100% !important;
  min-width: 0 !important;
  padding: 4px 6px !important;
  border-radius: 10px !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-topic-select {
  min-height: 28px !important;
  font-size: 0.7rem !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode :is(.qb-topic-quick, .qb-solved-group, .qb-sort-group, .qb-pill-group) {
  display: flex !important;
  flex-wrap: nowrap !important;
  overflow-x: auto !important;
  -webkit-overflow-scrolling: touch !important;
  scrollbar-width: thin !important;
  gap: 4px !important;
  padding-bottom: 1px !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode :is(.qb-topic-quick-btn, .qb-solved-chip, .qb-sort-chip, .qb-pill) {
  flex: 0 0 auto !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-topic-quick-btn {
  max-width: none !important;
  min-height: 24px !important;
  font-size: 0.66rem !important;
  padding: 2px 7px !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-solved-chip,
:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-sort-chip {
  min-height: 25px !important;
  font-size: 0.67rem !important;
  padding: 2px 7px !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-clear-btn {
  grid-column: 1 / -1 !important;
  min-height: 32px !important;
  width: 100% !important;
  justify-content: center !important;
  border-radius: 10px !important;
  font-size: 0.72rem !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-filter-difficulty {
  gap: 5px !important;
  padding: 6px !important;
  border-radius: 10px !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-filter-caption {
  font-size: 0.7rem !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode .qb-pill {
  min-height: 26px !important;
  padding: 3px 8px !important;
  font-size: 0.7rem !important;
}

/* Universal readable bars + select dropdown lock (desktop + mobile) */
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .app-shell select {
  color: #eaf6ff !important;
  font-weight: 700 !important;
  text-shadow: 0 1px 0 rgba(2, 8, 13, 0.42) !important;
  border-color: rgba(132, 194, 233, 0.42) !important;
  background:
    linear-gradient(145deg, rgba(104, 193, 245, 0.22), rgba(104, 193, 245, 0.08)),
    rgba(7, 15, 24, 0.58) !important;
  appearance: none !important;
  -webkit-appearance: none !important;
  -moz-appearance: none !important;
  padding-inline-start: 34px !important;
  background-image:
    linear-gradient(145deg, rgba(104, 193, 245, 0.22), rgba(104, 193, 245, 0.08)),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23eaf6ff' stroke-width='2.3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E") !important;
  background-repeat: no-repeat !important;
  background-size: auto, 14px 14px !important;
  background-position: 0 0, left 10px center !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .app-shell .qb-topic-select {
  min-height: 30px !important;
  padding-inline-start: 28px !important;
  background-size: auto, 12px 12px !important;
  background-position: 0 0, left 8px center !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .app-shell select:focus {
  outline: none !important;
  border-color: rgba(108, 206, 255, 0.86) !important;
  box-shadow: 0 0 0 3px rgba(108, 206, 255, 0.18) !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .app-shell select option,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .app-shell select optgroup {
  color: #183d58 !important;
  background: #f4f8fd !important;
  font-weight: 700 !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .app-shell select option:checked {
  color: #ffffff !important;
  background: #2b72ca !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .app-shell select option:disabled {
  color: #72879d !important;
  background: #e8eef6 !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) :is(.qb-topic-wrap, .qb-solved-wrap, .qb-sort-wrap) {
  border-color: rgba(132, 194, 233, 0.34) !important;
  background:
    linear-gradient(146deg, rgba(104, 193, 245, 0.14), rgba(104, 193, 245, 0.05)),
    rgba(8, 16, 25, 0.5) !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) :is(
    .qb-topic-label,
    .qb-solved-label,
    .qb-sort-label,
    .qb-topic-active-pill,
    .qb-topic-quick-btn,
    .qb-solved-chip,
    .qb-sort-chip,
    .qb-clear-btn
  ) {
  color: #eaf6ff !important;
  opacity: 1 !important;
  text-shadow: 0 1px 0 rgba(2, 8, 13, 0.34) !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) :is(
    .qb-topic-quick-btn,
    .qb-solved-chip,
    .qb-sort-chip
  ) {
  border-color: rgba(132, 194, 233, 0.34) !important;
  background: rgba(8, 16, 25, 0.42) !important;
  font-weight: 700 !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) :is(
    .qb-topic-quick-btn.is-active,
    .qb-solved-chip.is-active,
    .qb-sort-chip.is-active
  ) {
  border-color: rgba(116, 213, 255, 0.8) !important;
  background:
    linear-gradient(146deg, rgba(84, 194, 252, 0.34), rgba(84, 194, 252, 0.14)),
    rgba(7, 15, 24, 0.62) !important;
  color: #ffffff !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .app-shell select {
  color: #1f5379 !important;
  text-shadow: none !important;
  border-color: rgba(47, 98, 137, 0.28) !important;
  background:
    linear-gradient(145deg, rgba(47, 130, 193, 0.2), rgba(47, 130, 193, 0.08)),
    rgba(255, 255, 255, 0.96) !important;
  background-image:
    linear-gradient(145deg, rgba(47, 130, 193, 0.2), rgba(47, 130, 193, 0.08)),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%231f5379' stroke-width='2.3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E") !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) :is(
    .qb-topic-wrap,
    .qb-solved-wrap,
    .qb-sort-wrap
  ) {
  border-color: rgba(47, 98, 137, 0.24) !important;
  background:
    linear-gradient(145deg, rgba(47, 130, 193, 0.16), rgba(47, 130, 193, 0.06)),
    rgba(255, 255, 255, 0.92) !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) :is(
    .qb-topic-label,
    .qb-solved-label,
    .qb-sort-label,
    .qb-topic-active-pill,
    .qb-topic-quick-btn,
    .qb-solved-chip,
    .qb-sort-chip,
    .qb-clear-btn
  ) {
  color: #22567c !important;
  text-shadow: none !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) :is(
    .qb-topic-quick-btn,
    .qb-solved-chip,
    .qb-sort-chip
  ) {
  border-color: rgba(47, 98, 137, 0.24) !important;
  background: rgba(255, 255, 255, 0.9) !important;
}
/* Desktop settings visibility fix v3 (complete render + safe scrolling) */
:is(body.force-desktop, body.auto-desktop) .settings-panel.settings-panel-premium {
  --settings-panel-open-max: min(88dvh, calc(100dvh - 84px), 920px) !important;
  position: fixed !important;
  top: calc(env(safe-area-inset-top, 0px) + 64px) !important;
  right: 12px !important;
  left: auto !important;
  width: min(1100px, calc(100vw - 24px)) !important;
  max-width: calc(100vw - 24px) !important;
  max-height: 0 !important;
  z-index: 130 !important;
  overflow: hidden !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-premium.is-open {
  max-height: var(--settings-panel-open-max) !important;
  padding: 10px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-head {
  margin: 0 0 9px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-layout {
  display: grid !important;
  grid-template-columns: minmax(230px, 0.86fr) minmax(0, 1.14fr) !important;
  gap: 10px !important;
  max-height: calc(var(--settings-panel-open-max) - 98px) !important;
  min-height: 0 !important;
  overflow: hidden !important;
  padding: 0 !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-side,
:is(body.force-desktop, body.auto-desktop) .settings-panel-workspace {
  min-height: 0 !important;
  max-height: 100% !important;
  overflow: auto !important;
  -webkit-overflow-scrolling: touch !important;
  overscroll-behavior: contain !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-panel-workspace {
  display: grid !important;
  grid-template-rows: auto minmax(0, 1fr) !important;
  gap: 8px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-strip {
  position: sticky !important;
  top: 0 !important;
  z-index: 2 !important;
  backdrop-filter: blur(6px) !important;
  -webkit-backdrop-filter: blur(6px) !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-tab-panel {
  max-height: none !important;
  overflow: visible !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-overview-card strong {
  white-space: normal !important;
  overflow: visible !important;
  text-overflow: clip !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-cloud-layout {
  grid-template-columns: minmax(0, 1fr) minmax(260px, 0.92fr) !important;
  gap: 10px !important;
}

:is(body.force-desktop, body.auto-desktop) .settings-inline-actions {
  grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)) !important;
}

@media (max-width: 1280px) and (min-width: 921px) {
  :is(body.force-desktop, body.auto-desktop) .settings-panel.settings-panel-premium {
    right: 10px !important;
    width: min(1040px, calc(100vw - 20px)) !important;
    --settings-panel-open-max: min(89dvh, calc(100dvh - 78px), 940px) !important;
  }

  :is(body.force-desktop, body.auto-desktop) .settings-panel-layout {
    grid-template-columns: 1fr !important;
    max-height: calc(var(--settings-panel-open-max) - 96px) !important;
    overflow: auto !important;
  }

  :is(body.force-desktop, body.auto-desktop) .settings-panel-side,
  :is(body.force-desktop, body.auto-desktop) .settings-panel-workspace {
    max-height: none !important;
    overflow: visible !important;
  }

  :is(body.force-desktop, body.auto-desktop) .settings-cloud-layout {
    grid-template-columns: 1fr !important;
  }
}

/* Ribbon readability override v4 (clear text in all bar-like controls) */
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .header-quick-btn > span:last-child,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .settings-tab-btn > .settings-tab-text,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .viewport-mode-btn > span,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .viewport-mode-btn > .viewport-mode-state,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .practice-profile-chip,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .exam-chip-btn,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .chapter-map-action-btn,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .qb-pill {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  min-width: 0 !important;
  max-width: 100% !important;
  padding: 2px 8px !important;
  border-radius: 8px !important;
  border: 1px solid rgba(155, 210, 245, 0.38) !important;
  background:
    linear-gradient(145deg, rgba(104, 190, 241, 0.22), rgba(104, 190, 241, 0.08)),
    rgba(7, 15, 24, 0.54) !important;
  color: #f3faff !important;
  font-weight: 800 !important;
  letter-spacing: 0 !important;
  line-height: 1.35 !important;
  white-space: nowrap !important;
  overflow: visible !important;
  text-overflow: clip !important;
  text-shadow: 0 1px 0 rgba(2, 7, 11, 0.44) !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .header-quick-btn,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .settings-tab-btn,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .practice-profile-chip,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .exam-chip-btn,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .chapter-map-action-btn,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .qb-pill {
  color: #edf8ff !important;
  text-shadow: none !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .header-quick-btn.is-active > span:last-child,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .settings-tab-btn.is-active > .settings-tab-text,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .practice-profile-chip.is-active,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .qb-pill.is-active {
  border-color: rgba(121, 213, 255, 0.82) !important;
  background:
    linear-gradient(145deg, rgba(78, 196, 255, 0.34), rgba(78, 196, 255, 0.14)),
    rgba(7, 15, 24, 0.62) !important;
  color: #ffffff !important;
  box-shadow: 0 10px 18px rgba(4, 10, 15, 0.26) !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .header-quick-icon,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .settings-tab-icon {
  opacity: 1 !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .header-quick-icon svg,
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .settings-tab-icon svg {
  stroke-width: 2 !important;
  opacity: 1 !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .header-quick-btn > span:last-child,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .settings-tab-btn > .settings-tab-text,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .viewport-mode-btn > span,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .viewport-mode-btn > .viewport-mode-state,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .practice-profile-chip,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .exam-chip-btn,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .chapter-map-action-btn,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .qb-pill {
  border-color: rgba(47, 97, 136, 0.28) !important;
  background:
    linear-gradient(145deg, rgba(47, 130, 193, 0.2), rgba(47, 130, 193, 0.08)),
    rgba(255, 255, 255, 0.95) !important;
  color: #1f5075 !important;
  text-shadow: none !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .header-quick-btn.is-active > span:last-child,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .settings-tab-btn.is-active > .settings-tab-text,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .practice-profile-chip.is-active,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile) .qb-pill.is-active {
  border-color: rgba(47, 130, 193, 0.62) !important;
  background:
    linear-gradient(145deg, rgba(47, 130, 193, 0.28), rgba(47, 130, 193, 0.12)),
    rgba(255, 255, 255, 0.98) !important;
  color: #17486c !important;
}

/* Schema modal viewport fit fix v2 (desktop + mobile + windows) */
.schema-modal {
  padding: clamp(10px, 1.6vw, 20px) !important;
  align-items: center !important;
  justify-items: center !important;
}

.schema-modal-card {
  width: min(720px, calc(100vw - 24px)) !important;
  max-height: min(88dvh, calc(100dvh - 24px)) !important;
  display: grid !important;
  grid-template-rows: auto auto minmax(0, 1fr) auto !important;
  gap: 10px !important;
  overflow: hidden !important;
  padding: 12px !important;
}

.schema-modal-subtitle {
  margin: 0 !important;
}

.schema-pre {
  margin: 0 !important;
  max-height: none !important;
  min-height: 0 !important;
  overflow: auto !important;
  -webkit-overflow-scrolling: touch !important;
}

.schema-guide-notes {
  margin-top: 0 !important;
  max-height: min(30dvh, 230px) !important;
  overflow: auto !important;
  -webkit-overflow-scrolling: touch !important;
}

@media (max-height: 760px) {
  .schema-modal-card {
    max-height: min(92dvh, calc(100dvh - 14px)) !important;
    gap: 8px !important;
    padding: 10px !important;
  }

  .schema-modal-head h3 {
    font-size: 0.94rem !important;
  }

  .schema-pre {
    font-size: 0.8rem !important;
    line-height: 1.65 !important;
  }

  .schema-guide-list {
    font-size: 0.74rem !important;
    line-height: 1.62 !important;
  }
}

:is(body.force-mobile, body.auto-mobile) .schema-modal {
  padding: 8px !important;
}

:is(body.force-mobile, body.auto-mobile) .schema-modal-card {
  width: min(100%, calc(100vw - 12px)) !important;
  max-height: min(92dvh, calc(100dvh - 12px)) !important;
  border-radius: 14px !important;
  padding: 10px !important;
  gap: 8px !important;
}

:is(body.force-mobile, body.auto-mobile) .schema-modal-head h3 {
  font-size: 0.92rem !important;
}

:is(body.force-mobile, body.auto-mobile) .schema-modal-subtitle {
  font-size: 0.8rem !important;
}

:is(body.force-mobile, body.auto-mobile) .schema-pre {
  padding: 9px !important;
  font-size: 0.78rem !important;
  line-height: 1.62 !important;
  border-radius: 10px !important;
}

:is(body.force-mobile, body.auto-mobile) .schema-guide-notes {
  padding: 9px !important;
  border-radius: 10px !important;
  max-height: min(32dvh, 200px) !important;
}

/* Desktop profile complete redesign v3 (compact + premium) */
:is(body.force-desktop, body.auto-desktop) .profile-surface.profile-orbit {
  margin-bottom: 12px !important;
  padding: 10px !important;
  border-radius: 22px !important;
  border: 1px solid hsla(var(--profile-accent-hue, 198), 68%, 64%, 0.3) !important;
  background:
    radial-gradient(circle at 8% 12%, hsla(var(--profile-accent-hue, 198), 86%, 60%, 0.2), transparent 38%),
    radial-gradient(circle at 90% 86%, hsla(calc(var(--profile-accent-hue, 198) + 26), 82%, 56%, 0.16), transparent 40%),
    linear-gradient(146deg, rgba(9, 18, 29, 0.95), rgba(13, 27, 40, 0.88)) !important;
  box-shadow:
    0 20px 40px rgba(4, 8, 14, 0.34),
    inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-shell {
  display: grid !important;
  grid-template-columns: minmax(292px, 0.84fr) minmax(0, 1.16fr) !important;
  gap: 9px !important;
  align-items: stretch !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side,
:is(body.force-desktop, body.auto-desktop) .profile-orbit-main {
  border-radius: 16px !important;
  border: 1px solid rgba(132, 190, 229, 0.24) !important;
  background:
    linear-gradient(148deg, rgba(103, 194, 246, 0.12), rgba(103, 194, 246, 0.03)),
    rgba(8, 16, 25, 0.5) !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.09) !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side {
  display: grid !important;
  grid-template-columns: auto minmax(0, 1fr) !important;
  grid-template-areas:
    "avatar title"
    "avatar subtitle"
    "greeting greeting" !important;
  gap: 5px 10px !important;
  align-content: start !important;
  padding: 10px 11px !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-avatar {
  grid-area: avatar !important;
  width: 56px !important;
  height: 56px !important;
  border-radius: 16px !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side h2 {
  grid-area: title !important;
  margin: 0 !important;
  font-size: 1.26rem !important;
  line-height: 1.22 !important;
  letter-spacing: -0.018em !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side p {
  grid-area: subtitle !important;
  margin: 0 !important;
  font-size: 0.92rem !important;
  line-height: 1.66 !important;
  color: rgba(191, 214, 234, 0.9) !important;
  -webkit-line-clamp: 2 !important;
  display: -webkit-box !important;
  -webkit-box-orient: vertical !important;
  overflow: hidden !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-greeting-panel {
  grid-area: greeting !important;
  margin-top: 3px !important;
  padding: 9px 11px !important;
  border-radius: 12px !important;
  border: 1px solid hsla(var(--profile-accent-hue, 198), 82%, 68%, 0.4) !important;
  background:
    radial-gradient(circle at 85% 14%, hsla(var(--profile-accent-hue, 198), 84%, 62%, 0.2), transparent 44%),
    linear-gradient(145deg, hsla(var(--profile-accent-hue, 198), 84%, 58%, 0.18), hsla(var(--profile-accent-hue, 198), 84%, 58%, 0.05)) !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit .profile-greeting {
  font-size: 1.03rem !important;
  line-height: 1.76 !important;
  font-weight: 700 !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-main {
  display: grid !important;
  grid-template-columns: minmax(0, 1.22fr) minmax(280px, 0.78fr) !important;
  grid-template-areas: "inputs tools" !important;
  gap: 9px !important;
  padding: 10px !important;
  align-items: start !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-grid {
  grid-area: inputs !important;
  display: grid !important;
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap: 8px !important;
  align-content: start !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-field {
  border: 1px solid rgba(132, 190, 229, 0.22) !important;
  border-radius: 12px !important;
  background: rgba(8, 16, 25, 0.45) !important;
  padding: 7px !important;
  gap: 6px !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-label {
  font-size: 0.82rem !important;
  font-weight: 700 !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-input-wrap {
  min-height: 42px !important;
  border-radius: 11px !important;
  padding: 4px 9px !important;
  border-color: rgba(132, 190, 229, 0.28) !important;
  background: rgba(6, 13, 22, 0.58) !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-input-wrap input {
  min-height: 30px !important;
  font-size: 0.91rem !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-tools {
  grid-area: tools !important;
  margin-top: 0 !important;
  padding: 9px !important;
  border-radius: 12px !important;
  border: 1px solid rgba(132, 190, 229, 0.24) !important;
  background:
    radial-gradient(circle at 12% 10%, rgba(102, 194, 248, 0.16), transparent 40%),
    rgba(8, 16, 26, 0.44) !important;
  display: grid !important;
  gap: 8px !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-tools h3 {
  margin: 0 !important;
  font-size: 0.9rem !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-json-tools {
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap: 7px !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-json-tools .glass-btn {
  min-height: 34px !important;
  font-size: 0.76rem !important;
  border-radius: 10px !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-import {
  gap: 6px !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-import label {
  font-size: 0.81rem !important;
  font-weight: 700 !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-import textarea {
  min-height: 78px !important;
  max-height: 124px !important;
  border-radius: 11px !important;
  padding: 9px !important;
  font-size: 0.8rem !important;
  line-height: 1.56 !important;
  resize: vertical !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-actions {
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 7px !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-actions .glass-btn {
  min-height: 34px !important;
  font-size: 0.76rem !important;
  border-radius: 10px !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-surface.profile-orbit {
  border-color: hsla(var(--profile-accent-hue, 198), 48%, 44%, 0.24) !important;
  background:
    radial-gradient(circle at 8% 12%, hsla(var(--profile-accent-hue, 198), 70%, 54%, 0.16), transparent 38%),
    radial-gradient(circle at 90% 86%, hsla(calc(var(--profile-accent-hue, 198) + 24), 66%, 52%, 0.12), transparent 40%),
    linear-gradient(160deg, rgba(255, 255, 255, 0.95), rgba(246, 251, 255, 0.9)) !important;
  box-shadow: 0 16px 32px rgba(24, 55, 83, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.96) !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-side,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-main,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-tools,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .orbit-field {
  border-color: rgba(47, 92, 128, 0.18) !important;
  background:
    linear-gradient(145deg, rgba(47, 130, 193, 0.1), rgba(47, 130, 193, 0.03)),
    rgba(255, 255, 255, 0.92) !important;
}

/* Desktop add-lesson optimization (subjects level) */
:is(body.force-desktop, body.auto-desktop) .subjects-premium-grid {
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)) !important;
  gap: 12px !important;
}

:is(body.force-desktop, body.auto-desktop) .subjects-premium-grid > .subject-add-card {
  grid-column: 1 / -1 !important;
  display: grid !important;
  grid-template-columns: minmax(300px, 0.88fr) minmax(0, 1.12fr) !important;
  align-items: center !important;
  gap: 10px 12px !important;
  padding: 12px !important;
  border-radius: 18px !important;
}

:is(body.force-desktop, body.auto-desktop) .subject-add-head {
  gap: 11px !important;
  align-items: center !important;
}

:is(body.force-desktop, body.auto-desktop) .subject-add-icon {
  width: 38px !important;
  height: 38px !important;
  border-radius: 12px !important;
}

:is(body.force-desktop, body.auto-desktop) .subject-add-label {
  font-size: 1rem !important;
}

:is(body.force-desktop, body.auto-desktop) .subject-add-caption {
  font-size: 0.82rem !important;
  line-height: 1.65 !important;
}

:is(body.force-desktop, body.auto-desktop) .subject-add-action {
  grid-template-columns: minmax(0, 1fr) auto !important;
  gap: 9px !important;
  align-items: center !important;
}

:is(body.force-desktop, body.auto-desktop) .subject-add-input {
  min-height: 42px !important;
  border-radius: 12px !important;
  padding: 8px 12px !important;
  font-size: 0.86rem !important;
}

:is(body.force-desktop, body.auto-desktop) .subject-add-btn {
  min-width: 150px !important;
  min-height: 42px !important;
  border-radius: 12px !important;
  font-size: 0.82rem !important;
  font-weight: 800 !important;
  white-space: nowrap !important;
}

:is(body.force-desktop, body.auto-desktop) .subject-add-btn-icon {
  width: 19px !important;
  height: 19px !important;
}

@media (max-width: 1220px) and (min-width: 921px) {
  :is(body.force-desktop, body.auto-desktop) .subjects-premium-grid > .subject-add-card {
    grid-template-columns: 1fr !important;
    gap: 9px !important;
  }

  :is(body.force-desktop, body.auto-desktop) .subject-add-action {
    grid-template-columns: minmax(0, 1fr) auto !important;
  }
}

/* Mobile practice action order tune: prev beside hint (3 clean rows) */
:is(body.force-mobile, body.auto-mobile) .practice-focus-actions {
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 8px !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions .practice-solution-stack {
  display: contents !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions > .practice-action-btn[data-action="practice-reveal-hint"] {
  order: 1 !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions > .practice-action-btn[data-action="practice-prev"] {
  order: 2 !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions .practice-action-btn[data-action="practice-reveal-solution"] {
  order: 3 !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions .practice-action-btn[data-action="practice-random"] {
  order: 4 !important;
}

:is(body.force-mobile, body.auto-mobile) .practice-focus-actions > .practice-next-btn {
  order: 5 !important;
  grid-column: 1 / -1 !important;
}

/* Exam mode hardening: pinned timer + complete session controls */
.exam-mode-panel {
  --exam-countdown-sticky-offset: 76px;
}

.exam-countdown-panel-pinned {
  position: sticky;
  top: var(--exam-countdown-sticky-offset);
  z-index: 36;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.exam-paper-actions {
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto;
  align-items: start;
  gap: 10px;
}

.exam-paper-quick-stats {
  min-width: 0;
}

.exam-session-actions {
  display: flex;
  flex-wrap: wrap;
  justify-content: flex-end;
  gap: 7px;
}

.exam-session-btn {
  min-height: 37px;
  padding: 6px 11px;
  border-radius: 11px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  white-space: nowrap;
  font-size: 0.78rem;
  font-weight: 700;
  box-shadow: 0 10px 20px rgba(4, 13, 23, 0.2);
}

.exam-session-btn svg {
  width: 14px;
  height: 14px;
  opacity: 0.95;
}

.exam-session-btn-finish {
  border-color: rgba(120, 226, 175, 0.45);
  background: linear-gradient(145deg, rgba(120, 226, 175, 0.22), rgba(120, 226, 175, 0.08));
  color: #d4ffe8;
}

.exam-session-btn-copy {
  border-color: rgba(117, 202, 252, 0.42);
  background: linear-gradient(145deg, rgba(117, 202, 252, 0.2), rgba(117, 202, 252, 0.06));
  color: #d6f2ff;
}

.exam-session-btn-reset {
  border-color: rgba(255, 165, 153, 0.45);
  background: linear-gradient(145deg, rgba(255, 165, 153, 0.2), rgba(255, 165, 153, 0.06));
  color: #ffd9d2;
}

.exam-session-actions .exam-print-btn {
  border-radius: 11px;
  box-shadow: 0 10px 20px rgba(8, 41, 64, 0.24);
}

html[data-theme^="light-"] .exam-session-btn-finish {
  border-color: rgba(41, 145, 92, 0.28);
  background: linear-gradient(145deg, rgba(41, 145, 92, 0.14), rgba(255, 255, 255, 0.9));
  color: #1f6e45;
}

html[data-theme^="light-"] .exam-session-btn-copy {
  border-color: rgba(47, 130, 193, 0.28);
  background: linear-gradient(145deg, rgba(47, 130, 193, 0.15), rgba(255, 255, 255, 0.9));
  color: #1c5a84;
}

html[data-theme^="light-"] .exam-session-btn-reset {
  border-color: rgba(181, 94, 82, 0.28);
  background: linear-gradient(145deg, rgba(181, 94, 82, 0.15), rgba(255, 255, 255, 0.9));
  color: #8d4038;
}

/* Keep any legacy answer-area block hidden in exam paper flow */
.exam-paper .exam-answer-area {
  display: none !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-mode-panel {
  --exam-countdown-sticky-offset: calc(env(safe-area-inset-top, 0px) + 60px);
}

:is(body.force-mobile, body.auto-mobile) .exam-paper-actions {
  grid-template-columns: 1fr;
  gap: 8px;
}

:is(body.force-mobile, body.auto-mobile) .exam-session-actions {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 7px;
}

:is(body.force-mobile, body.auto-mobile) .exam-session-btn {
  width: 100%;
  min-height: 35px;
  border-radius: 10px;
  font-size: 0.74rem;
  padding: 5px 8px;
}

:is(body.force-mobile, body.auto-mobile) .exam-session-btn-finish,
:is(body.force-mobile, body.auto-mobile) .exam-session-actions .exam-print-btn {
  grid-column: 1 / -1;
}

:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
  .exam-session-region
  .exam-mobile-nav-dock {
  position: sticky;
  bottom: 8px;
  z-index: 44;
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto minmax(0, 1fr);
  gap: 6px;
  align-items: center;
  border: 1px solid rgba(138, 172, 201, 0.28);
  border-radius: 12px;
  padding: 6px;
  background: linear-gradient(145deg, rgba(18, 34, 52, 0.92), rgba(16, 28, 44, 0.9));
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
  .exam-session-region {
  scroll-behavior: smooth;
}

:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
  .exam-mobile-nav-btn {
  min-height: 35px;
  border-radius: 9px;
  border: 1px solid rgba(138, 172, 201, 0.28);
  background: rgba(127, 127, 127, 0.12);
  color: var(--text-main);
  font-size: 0.72rem;
  font-weight: 700;
}

:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
  .exam-mobile-nav-indicator {
  min-width: 70px;
  text-align: center;
  font-size: 0.73rem;
  font-weight: 700;
  color: var(--text-muted);
}

:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
  .exam-library-panel {
  border-radius: 12px;
  padding: 8px;
  gap: 7px;
}

:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
  .exam-library-list {
  max-height: min(44vh, 360px);
  overflow-y: auto;
  padding-inline-start: 1px;
}

:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
  .exam-library-btn {
  min-height: 34px;
  font-size: 0.72rem;
}

/* Desktop profile one-surface redesign v4 (single-panel, non-split, fresh layout) */
:is(body.force-desktop, body.auto-desktop) .profile-surface.profile-orbit {
  position: relative !important;
  margin-bottom: 12px !important;
  padding: 12px !important;
  border-radius: 24px !important;
  border: 1px solid hsla(var(--profile-accent-hue, 198), 72%, 66%, 0.34) !important;
  background:
    radial-gradient(circle at 7% 10%, hsla(var(--profile-accent-hue, 198), 90%, 62%, 0.23), transparent 36%),
    radial-gradient(circle at 94% 88%, hsla(calc(var(--profile-accent-hue, 198) + 26), 84%, 58%, 0.18), transparent 44%),
    linear-gradient(146deg, rgba(8, 17, 28, 0.96), rgba(12, 26, 40, 0.9)) !important;
  box-shadow:
    0 22px 46px rgba(4, 9, 14, 0.36),
    inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
  overflow: hidden !important;
  isolation: isolate !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit::before {
  content: "" !important;
  position: absolute !important;
  inset: 0 !important;
  background:
    radial-gradient(circle at 84% 14%, rgba(129, 220, 255, 0.2), transparent 34%),
    linear-gradient(112deg, rgba(255, 255, 255, 0.07), transparent 56%) !important;
  pointer-events: none !important;
  z-index: 0 !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit::after {
  content: "" !important;
  position: absolute !important;
  top: 0 !important;
  right: 28px !important;
  width: 220px !important;
  height: 2px !important;
  border-radius: 999px !important;
  background: linear-gradient(90deg, transparent, rgba(182, 228, 255, 0.9), transparent) !important;
  pointer-events: none !important;
  z-index: 1 !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit > * {
  position: relative !important;
  z-index: 2 !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-shell {
  display: grid !important;
  grid-template-columns: 1fr !important;
  gap: 12px !important;
  align-items: start !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side {
  display: grid !important;
  grid-template-columns: auto minmax(0, 1fr) minmax(260px, 0.88fr) !important;
  grid-template-areas:
    "avatar title greeting"
    "avatar subtitle greeting" !important;
  gap: 6px 12px !important;
  align-items: center !important;
  padding: 0 !important;
  border: 0 !important;
  border-radius: 0 !important;
  background: transparent !important;
  box-shadow: none !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side::before {
  display: none !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-avatar {
  grid-area: avatar !important;
  width: 62px !important;
  height: 62px !important;
  border-radius: 18px !important;
  margin: 0 !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side h2 {
  grid-area: title !important;
  margin: 0 !important;
  font-size: 1.34rem !important;
  line-height: 1.22 !important;
  letter-spacing: -0.02em !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-side p {
  grid-area: subtitle !important;
  margin: 0 !important;
  font-size: 0.96rem !important;
  line-height: 1.8 !important;
  color: rgba(193, 216, 236, 0.92) !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-greeting-panel {
  grid-area: greeting !important;
  align-self: stretch !important;
  margin: 0 !important;
  padding: 10px 12px !important;
  border-radius: 14px !important;
  border: 1px solid hsla(var(--profile-accent-hue, 198), 82%, 70%, 0.42) !important;
  background:
    radial-gradient(circle at 86% 14%, hsla(var(--profile-accent-hue, 198), 84%, 62%, 0.22), transparent 44%),
    linear-gradient(145deg, hsla(var(--profile-accent-hue, 198), 84%, 58%, 0.2), hsla(var(--profile-accent-hue, 198), 84%, 58%, 0.06)) !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12) !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit .profile-greeting {
  margin: 0 !important;
  font-size: 1.05rem !important;
  font-weight: 700 !important;
  line-height: 1.82 !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-main {
  display: grid !important;
  grid-template-columns: 1fr !important;
  gap: 12px !important;
  padding: 0 !important;
  border: 0 !important;
  border-radius: 0 !important;
  background: transparent !important;
  box-shadow: none !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-grid {
  display: grid !important;
  grid-template-columns: repeat(12, minmax(0, 1fr)) !important;
  gap: 10px !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-grid > .orbit-field:nth-child(1),
:is(body.force-desktop, body.auto-desktop) .profile-orbit-grid > .orbit-field:nth-child(2),
:is(body.force-desktop, body.auto-desktop) .profile-orbit-grid > .orbit-field:nth-child(3) {
  grid-column: span 4 !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-field {
  padding: 9px !important;
  border-radius: 14px !important;
  border: 1px solid rgba(133, 193, 232, 0.26) !important;
  background:
    linear-gradient(146deg, rgba(104, 195, 247, 0.14), rgba(104, 195, 247, 0.04)),
    rgba(7, 15, 24, 0.5) !important;
  gap: 7px !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-label {
  font-size: 0.86rem !important;
  font-weight: 700 !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-input-wrap {
  min-height: 44px !important;
  border-radius: 12px !important;
  border: 1px solid rgba(131, 191, 231, 0.32) !important;
  background: rgba(7, 15, 24, 0.58) !important;
  padding: 5px 10px !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-input-wrap input {
  min-height: 32px !important;
  font-size: 0.95rem !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-tools {
  margin-top: 0 !important;
  padding: 11px !important;
  border-radius: 15px !important;
  border: 1px solid rgba(132, 192, 232, 0.3) !important;
  background:
    radial-gradient(circle at 12% 14%, rgba(103, 196, 248, 0.19), transparent 40%),
    linear-gradient(150deg, rgba(105, 194, 245, 0.12), rgba(105, 194, 245, 0.03)),
    rgba(8, 16, 26, 0.48) !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
  display: grid !important;
  grid-template-columns: minmax(0, 1fr) minmax(300px, 0.95fr) !important;
  gap: 10px 12px !important;
  align-items: start !important;
}

:is(body.force-desktop, body.auto-desktop) .profile-orbit-tools h3 {
  grid-column: 1 / -1 !important;
  margin: 0 !important;
  font-size: 1rem !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-json-tools {
  display: grid !important;
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap: 8px !important;
}

:is(body.force-desktop, body.auto-desktop) .orbit-json-tools .glass-btn {
  min-height: 38px !important;
  border-radius: 11px !important;
  font-size: 0.8rem !important;
  font-weight: 700 !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-import {
  margin-top: 0 !important;
  gap: 7px !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-import label {
  font-size: 0.86rem !important;
  font-weight: 700 !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-import textarea {
  min-height: 108px !important;
  max-height: 176px !important;
  border-radius: 13px !important;
  border: 1px solid rgba(129, 191, 231, 0.32) !important;
  background: rgba(8, 16, 26, 0.56) !important;
  padding: 10px !important;
  font-size: 0.84rem !important;
  line-height: 1.66 !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-actions {
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 8px !important;
}

:is(body.force-desktop, body.auto-desktop) .json-text-actions .glass-btn {
  min-height: 36px !important;
  border-radius: 11px !important;
  font-size: 0.79rem !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-surface.profile-orbit {
  border-color: hsla(var(--profile-accent-hue, 198), 48%, 44%, 0.24) !important;
  background:
    radial-gradient(circle at 7% 10%, hsla(var(--profile-accent-hue, 198), 70%, 54%, 0.17), transparent 36%),
    radial-gradient(circle at 94% 88%, hsla(calc(var(--profile-accent-hue, 198) + 24), 66%, 52%, 0.12), transparent 44%),
    linear-gradient(160deg, rgba(255, 255, 255, 0.95), rgba(246, 251, 255, 0.9)) !important;
  box-shadow: 0 16px 34px rgba(24, 55, 83, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.95) !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .orbit-field,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .profile-orbit-tools {
  border-color: rgba(47, 92, 128, 0.2) !important;
  background:
    linear-gradient(145deg, rgba(47, 130, 193, 0.12), rgba(47, 130, 193, 0.04)),
    rgba(255, 255, 255, 0.92) !important;
}

html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .orbit-input-wrap,
html[data-theme^="light-"] :is(body.force-desktop, body.auto-desktop) .json-text-import textarea {
  border-color: rgba(47, 98, 137, 0.24) !important;
  background: rgba(255, 255, 255, 0.96) !important;
}

/* Final override: exam timer must stay visible and pinned below header */
:root {
  --exam-countdown-top-offset: calc(env(safe-area-inset-top, 0px) + 96px);
  --exam-countdown-panel-height: 72px;
}

.exam-mode-panel.exam-has-live-timer {
  padding-top: calc(var(--exam-countdown-panel-height) + 12px) !important;
}

:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile)
  .exam-countdown-panel.exam-countdown-panel-pinned {
  position: fixed !important;
  top: var(--exam-countdown-top-offset) !important;
  z-index: 1405 !important;
  backdrop-filter: blur(12px) saturate(140%) !important;
  -webkit-backdrop-filter: blur(12px) saturate(140%) !important;
}

:is(body.force-desktop, body.auto-desktop) .exam-countdown-panel.exam-countdown-panel-pinned {
  right: max(12px, calc((100vw - min(1220px, 94vw)) / 2 + 12px)) !important;
  left: auto !important;
  width: min(268px, calc(100vw - 24px)) !important;
}

:is(body.force-mobile, body.auto-mobile) .exam-countdown-panel.exam-countdown-panel-pinned {
  right: 8px !important;
  left: 8px !important;
  width: auto !important;
}

@media (max-width: 980px) {
  .exam-countdown-panel.exam-countdown-panel-pinned {
    right: 8px !important;
    left: 8px !important;
    width: auto !important;
  }
}

/* Final override: header must never overflow container */
.topbar.premium-topbar.header-premium-compact {
  width: 100% !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
  overflow-x: clip !important;
  overflow-y: visible !important;
}

.header-premium-compact .header-compact-top {
  grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) auto !important;
  min-width: 0 !important;
}

.header-premium-compact .header-compact-brand,
.header-premium-compact .header-compact-stats,
.header-premium-compact .header-compact-controls,
.header-premium-compact .header-nav-segmented {
  min-width: 0 !important;
  max-width: 100% !important;
}

.header-premium-compact .header-compact-stats {
  justify-content: flex-start !important;
  align-content: center !important;
}

.header-premium-compact .header-compact-stats .header-quick-pill {
  max-width: 100% !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.header-premium-compact .header-compact-controls {
  flex-wrap: wrap !important;
  row-gap: 0.35rem !important;
}

.header-premium-compact .header-nav-segmented {
  width: 100% !important;
}

@media (max-width: 1100px) {
  .header-premium-compact .header-compact-top {
    grid-template-columns: minmax(0, 1fr) auto !important;
  }

  .header-premium-compact .header-compact-stats {
    grid-column: 1 / -1 !important;
  }
}

/* FINAL END OVERRIDE: exam timer always above header */
:is(body.force-desktop, body.auto-desktop, body.force-mobile, body.auto-mobile)
  .exam-countdown-panel.exam-countdown-panel-pinned {
  top: max(var(--exam-countdown-top-offset), calc(env(safe-area-inset-top, 0px) + 120px)) !important;
  z-index: 3800 !important;
}

/* Mobile header recovery: prevent broken wrap/overflow */
@media (max-width: 768px) {
  .topbar.premium-topbar.header-premium-compact {
    padding: 0.62rem 0.62rem !important;
  }

  .header-premium-compact .header-compact-top {
    grid-template-columns: 1fr !important;
    grid-template-areas:
      "brand"
      "controls"
      "stats" !important;
    gap: 0.45rem !important;
  }

  .header-premium-compact .header-compact-brand {
    grid-area: brand !important;
    width: 100% !important;
    min-width: 0 !important;
  }

  .header-premium-compact .header-brand-title {
    max-width: 100% !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  .header-premium-compact .header-compact-controls {
    grid-area: controls !important;
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) !important;
    gap: 0.45rem !important;
    width: 100% !important;
    flex-wrap: nowrap !important;
  }

  .header-premium-compact .header-view-chip,
  .header-premium-compact .header-settings-btn.settings-trigger {
    width: 100% !important;
    min-width: 0 !important;
    justify-content: center !important;
  }

  .header-premium-compact .header-settings-btn.settings-trigger > span:not(.settings-trigger-status) {
    display: inline !important;
  }

  .header-premium-compact .header-compact-stats {
    grid-area: stats !important;
    display: flex !important;
    flex-wrap: nowrap !important;
    justify-content: flex-start !important;
    gap: 0.35rem !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    scrollbar-width: none !important;
  }

  .header-premium-compact .header-compact-stats::-webkit-scrollbar {
    display: none !important;
  }

  .header-premium-compact .header-compact-stats .header-quick-pill {
    flex: 0 0 auto !important;
    max-width: none !important;
  }

  .header-premium-compact .header-nav-segmented {
    display: grid !important;
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
    gap: 0.35rem !important;
    overflow: visible !important;
    padding: 0.3rem !important;
  }

  .header-premium-compact .header-nav-segmented .header-quick-btn {
    width: 100% !important;
    min-width: 0 !important;
    justify-content: center !important;
    padding: 0.34rem 0.42rem !important;
  }

  .header-premium-compact .header-nav-segmented .header-quick-btn span:last-child {
    font-size: 0.72rem !important;
  }
}

@media (max-width: 480px) {
  .header-premium-compact .header-nav-segmented {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }
}

/* Desktop header restore */
@media (min-width: 769px) {
  :is(body.force-desktop, body.auto-desktop) .header-premium-compact .header-compact-top {
    grid-template-columns: minmax(220px, 1fr) auto auto !important;
    grid-template-areas: none !important;
    align-items: center !important;
    gap: 0.45rem 0.75rem !important;
  }

  :is(body.force-desktop, body.auto-desktop) .header-premium-compact .header-compact-brand {
    width: auto !important;
    min-width: 0 !important;
  }

  :is(body.force-desktop, body.auto-desktop) .header-premium-compact .header-brand-title {
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  :is(body.force-desktop, body.auto-desktop) .header-premium-compact .header-compact-stats {
    grid-column: auto !important;
    display: inline-flex !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 0.36rem !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    scrollbar-width: none !important;
  }

  :is(body.force-desktop, body.auto-desktop) .header-premium-compact .header-compact-stats::-webkit-scrollbar {
    display: none !important;
  }

  :is(body.force-desktop, body.auto-desktop) .header-premium-compact .header-compact-controls {
    display: inline-flex !important;
    flex-wrap: nowrap !important;
    width: auto !important;
    gap: 0.42rem !important;
    justify-content: flex-end !important;
    align-items: center !important;
  }

  :is(body.force-desktop, body.auto-desktop) .header-premium-compact .header-view-chip,
  :is(body.force-desktop, body.auto-desktop) .header-premium-compact .header-settings-btn.settings-trigger {
    width: auto !important;
    min-width: 0 !important;
  }

  :is(body.force-desktop, body.auto-desktop) .header-premium-compact .header-nav-segmented {
    display: flex !important;
    grid-template-columns: none !important;
    flex-wrap: nowrap !important;
    overflow-x: auto !important;
  }
}

/* FINAL JSON GUIDE MODAL SIZE OPTIMIZATION (desktop + mobile) */
.schema-modal {
  z-index: 4200 !important;
  padding: clamp(10px, 1.8vw, 22px) !important;
  align-items: center !important;
  justify-items: center !important;
  overflow-y: auto !important;
}

.schema-modal-card {
  width: min(760px, calc(100vw - 32px)) !important;
  max-width: 100% !important;
  max-height: min(86dvh, calc(100dvh - 28px)) !important;
  display: grid !important;
  grid-template-rows: auto auto minmax(0, 1fr) auto !important;
  gap: 10px !important;
  padding: 12px !important;
  border-radius: 16px !important;
  overflow: hidden !important;
}

.schema-modal-subtitle {
  margin: 0 !important;
}

.schema-pre {
  margin: 0 !important;
  min-height: 0 !important;
  max-height: none !important;
  overflow: auto !important;
  -webkit-overflow-scrolling: touch !important;
}

.schema-guide-notes {
  margin-top: 0 !important;
  max-height: min(28dvh, 220px) !important;
  overflow: auto !important;
  -webkit-overflow-scrolling: touch !important;
}

@media (max-width: 768px) {
  .schema-modal {
    padding: 8px !important;
  }

  .schema-modal-card {
    width: min(100%, calc(100vw - 10px)) !important;
    max-height: min(92dvh, calc(100dvh - 10px)) !important;
    padding: 10px !important;
    gap: 8px !important;
    border-radius: 14px !important;
  }

  .schema-modal-head h3 {
    font-size: 0.92rem !important;
  }

  .schema-modal-subtitle {
    font-size: 0.8rem !important;
    line-height: 1.65 !important;
  }

  .schema-pre {
    padding: 9px !important;
    font-size: 0.78rem !important;
    line-height: 1.62 !important;
    border-radius: 10px !important;
  }

  .schema-guide-notes {
    max-height: min(30dvh, 190px) !important;
    padding: 9px !important;
    border-radius: 10px !important;
  }
}

/* ===== HEADER REWRITE (RTL, Three-Pillar, Responsive) ===== */
/* Legacy header rules can be removed after validating this block. */
.topbar.premium-topbar.qb-header {
  --hdr-border: rgba(255, 255, 255, 0.1);
  --hdr-surface: linear-gradient(135deg, rgba(11, 20, 34, 0.78), rgba(8, 14, 26, 0.62));
  --hdr-pill: rgba(255, 255, 255, 0.06);
  --hdr-pill-hover: rgba(255, 255, 255, 0.12);
  --hdr-text: rgba(237, 244, 255, 0.96);
  --hdr-muted: rgba(204, 220, 246, 0.8);
  position: sticky !important;
  display: block !important;
  direction: rtl !important;
  padding: 0 !important;
  top: clamp(6px, 1.2vw, 14px) !important;
  z-index: 1300 !important;
  width: min(100% - 18px, 1440px) !important;
  margin: 10px auto 18px !important;
  border-radius: 24px !important;
  border: 1px solid var(--hdr-border) !important;
  background: var(--hdr-surface) !important;
  box-shadow: 0 20px 44px rgba(0, 0, 0, 0.34) !important;
  backdrop-filter: blur(16px) !important;
  -webkit-backdrop-filter: blur(16px) !important;
  overflow: visible !important;
}

.topbar.premium-topbar.qb-header::before,
.topbar.premium-topbar.qb-header::after {
  content: none !important;
}

.topbar.premium-topbar.qb-header .header-container {
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
  gap: clamp(12px, 1.8vw, 22px) !important;
  padding: clamp(14px, 1.8vw, 22px) clamp(14px, 2.2vw, 28px) !important;
}

.topbar.premium-topbar.qb-header .header-pillar {
  min-width: 0 !important;
}

.topbar.premium-topbar.qb-header .header-pillar-brand,
.topbar.premium-topbar.qb-header .header-pillar-controls {
  flex-shrink: 0 !important;
}

.topbar.premium-topbar.qb-header .header-pillar-brand {
  display: flex !important;
  justify-content: flex-start !important;
  align-items: center !important;
  max-inline-size: min(36vw, 460px) !important;
}

.topbar.premium-topbar.qb-header .header-brand-block {
  display: inline-flex !important;
  align-items: center !important;
  gap: 12px !important;
  min-width: 0 !important;
}

.topbar.premium-topbar.qb-header .header-brand-icon {
  inline-size: 44px !important;
  block-size: 44px !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  color: var(--hdr-text) !important;
  border-radius: 14px !important;
  border: 1px solid var(--hdr-border) !important;
  background: rgba(255, 255, 255, 0.06) !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.18) !important;
}

.topbar.premium-topbar.qb-header .header-brand-icon svg {
  inline-size: 24px !important;
  block-size: 24px !important;
  fill: none !important;
  stroke: currentColor !important;
  stroke-width: 1.7 !important;
}

.topbar.premium-topbar.qb-header .header-brand-icon::before,
.topbar.premium-topbar.qb-header .header-brand-icon::after {
  content: none !important;
}

.topbar.premium-topbar.qb-header .header-brand-title {
  margin: 0 !important;
  color: var(--hdr-text) !important;
  font-size: clamp(1rem, 1.2vw, 1.22rem) !important;
  font-weight: 700 !important;
  line-height: 1.45 !important;
  white-space: normal !important;
  overflow: visible !important;
  text-overflow: clip !important;
}

.topbar.premium-topbar.qb-header .header-pillar-stats {
  flex: 1 1 auto !important;
  min-width: 0 !important;
  display: flex !important;
  justify-content: center !important;
  align-items: center !important;
}

.topbar.premium-topbar.qb-header .header-stats-track {
  inline-size: 100% !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  gap: 10px !important;
  min-width: 0 !important;
  overflow-x: auto !important;
  overflow-y: hidden !important;
  scrollbar-width: thin !important;
  scrollbar-color: rgba(255, 255, 255, 0.25) transparent !important;
  padding-block-end: 2px !important;
  scroll-padding-inline: 6px !important;
}

.topbar.premium-topbar.qb-header .header-stats-track::-webkit-scrollbar {
  height: 5px !important;
}

.topbar.premium-topbar.qb-header .header-stats-track::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.22) !important;
  border-radius: 999px !important;
}

.topbar.premium-topbar.qb-header .header-stat-pill,
.topbar.premium-topbar.qb-header .header-view-pill,
.topbar.premium-topbar.qb-header .header-control-btn,
.topbar.premium-topbar.qb-header .header-toggle {
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-radius: 12px !important;
  background: var(--hdr-pill) !important;
  color: var(--hdr-text) !important;
  transition: background-color 0.24s ease, border-color 0.24s ease, transform 0.24s ease, box-shadow 0.24s ease !important;
}

.topbar.premium-topbar.qb-header .header-stat-pill {
  display: inline-flex !important;
  align-items: center !important;
  flex: 0 0 auto !important;
  flex-shrink: 0 !important;
  min-inline-size: max-content !important;
  max-inline-size: none !important;
  white-space: nowrap !important;
  overflow: visible !important;
  text-overflow: clip !important;
  font-size: 0.84rem !important;
  font-weight: 500 !important;
  line-height: 1.65 !important;
  color: var(--hdr-muted) !important;
  padding: 8px 12px !important;
}

.topbar.premium-topbar.qb-header .header-pillar-controls {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: flex-end !important;
  gap: 10px !important;
  max-inline-size: min(48vw, 640px) !important;
  min-width: 0 !important;
}

.topbar.premium-topbar.qb-header .header-control-btn {
  display: inline-flex !important;
  align-items: center !important;
  gap: 8px !important;
  white-space: nowrap !important;
  padding: 9px 12px !important;
  font: inherit !important;
  font-weight: 600 !important;
  cursor: pointer !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.14) !important;
}

.topbar.premium-topbar.qb-header .settings-trigger::after {
  content: none !important;
}

.topbar.premium-topbar.qb-header .settings-trigger-icon {
  inline-size: 17px !important;
  block-size: 17px !important;
  color: currentColor !important;
}

.topbar.premium-topbar.qb-header .settings-trigger-icon path,
.topbar.premium-topbar.qb-header .settings-trigger-icon circle {
  fill: none !important;
  stroke: currentColor !important;
  stroke-width: 1.7 !important;
}

.topbar.premium-topbar.qb-header .settings-trigger-status {
  inline-size: 8px !important;
  block-size: 8px !important;
  border-radius: 999px !important;
  background: rgba(133, 234, 180, 0.95) !important;
  box-shadow: 0 0 0 4px rgba(133, 234, 180, 0.16) !important;
}

.topbar.premium-topbar.qb-header .header-view-pill {
  display: inline-flex !important;
  align-items: center !important;
  white-space: nowrap !important;
  font-size: 0.8rem !important;
  font-weight: 600 !important;
  color: var(--hdr-muted) !important;
  padding: 8px 10px !important;
}

.topbar.premium-topbar.qb-header .header-controls-track {
  display: flex !important;
  align-items: center !important;
  gap: 8px !important;
  min-width: 0 !important;
  max-inline-size: min(38vw, 420px) !important;
  overflow-x: auto !important;
  overflow-y: hidden !important;
  padding: 4px !important;
  border-radius: 14px !important;
  border: 1px solid rgba(255, 255, 255, 0.08) !important;
  background: rgba(255, 255, 255, 0.03) !important;
  scrollbar-width: thin !important;
}

.topbar.premium-topbar.qb-header .header-controls-track::-webkit-scrollbar {
  height: 5px !important;
}

.topbar.premium-topbar.qb-header .header-controls-track::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2) !important;
  border-radius: 999px !important;
}

.topbar.premium-topbar.qb-header .header-toggle {
  display: inline-flex !important;
  align-items: center !important;
  gap: 7px !important;
  padding: 8px 11px !important;
  font: inherit !important;
  font-size: 0.78rem !important;
  font-weight: 600 !important;
  white-space: nowrap !important;
  cursor: pointer !important;
  flex-shrink: 0 !important;
}

.topbar.premium-topbar.qb-header .header-toggle-icon {
  inline-size: 16px !important;
  block-size: 16px !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
}

.topbar.premium-topbar.qb-header .header-toggle-icon svg {
  inline-size: 16px !important;
  block-size: 16px !important;
  fill: none !important;
  stroke: currentColor !important;
  stroke-width: 1.7 !important;
}

.topbar.premium-topbar.qb-header .header-control-btn:hover,
.topbar.premium-topbar.qb-header .header-toggle:hover,
.topbar.premium-topbar.qb-header .header-view-pill:hover,
.topbar.premium-topbar.qb-header .header-stat-pill:hover {
  background: var(--hdr-pill-hover) !important;
  border-color: rgba(255, 255, 255, 0.2) !important;
  transform: translateY(-1px) !important;
}

.topbar.premium-topbar.qb-header .header-toggle.is-active,
.topbar.premium-topbar.qb-header .header-control-btn[aria-expanded="true"] {
  background: rgba(114, 196, 255, 0.2) !important;
  border-color: rgba(114, 196, 255, 0.5) !important;
  box-shadow: 0 8px 18px rgba(32, 116, 176, 0.2) !important;
}

.topbar.premium-topbar.qb-header .header-toggle:disabled {
  opacity: 0.52 !important;
  cursor: not-allowed !important;
  transform: none !important;
}

.topbar.premium-topbar.qb-header .header-brand-icon[data-profile-level="1"] {
  box-shadow: 0 0 0 1px rgba(141, 214, 255, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.16) !important;
}

.topbar.premium-topbar.qb-header .header-brand-icon[data-profile-level="2"] {
  box-shadow: 0 0 0 1px rgba(168, 236, 179, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.16) !important;
}

.topbar.premium-topbar.qb-header .header-brand-icon[data-profile-level="3"] {
  box-shadow: 0 0 0 1px rgba(255, 205, 137, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.16) !important;
}

@media (min-width: 1024px) {
  .topbar.premium-topbar.qb-header .header-container {
    flex-wrap: nowrap !important;
    align-items: center !important;
    justify-content: space-between !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-stats {
    order: 2 !important;
  }
}

@media (max-width: 1023px) {
  .topbar.premium-topbar.qb-header .header-container {
    flex-wrap: wrap !important;
    row-gap: 12px !important;
    column-gap: 10px !important;
    align-items: center !important;
    justify-content: space-between !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-brand {
    order: 1 !important;
    flex: 1 1 calc(50% - 6px) !important;
    max-inline-size: none !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-controls {
    order: 2 !important;
    flex: 1 1 calc(50% - 6px) !important;
    max-inline-size: none !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-stats {
    order: 3 !important;
    flex: 0 0 100% !important;
    inline-size: 100% !important;
    justify-content: center !important;
  }

  .topbar.premium-topbar.qb-header .header-stats-track {
    justify-content: flex-start !important;
    inline-size: 100% !important;
    overflow-x: auto !important;
    padding-inline: 2px !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track {
    max-inline-size: min(36vw, 260px) !important;
  }
}

/* Final mobile header visibility lock: ensure all header controls are reachable */
@media (max-width: 1023px) {
  .topbar.premium-topbar.qb-header {
    width: calc(100% - 10px) !important;
    max-width: calc(100% - 10px) !important;
    margin: 8px auto 12px !important;
    border-radius: 16px !important;
    overflow: visible !important;
  }

  .topbar.premium-topbar.qb-header .header-container {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) !important;
    grid-template-areas:
      "brand"
      "controls"
      "stats" !important;
    align-items: stretch !important;
    gap: 10px !important;
    padding: 10px !important;
    min-width: 0 !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-brand,
  .topbar.premium-topbar.qb-header .header-pillar-controls,
  .topbar.premium-topbar.qb-header .header-pillar-stats {
    min-width: 0 !important;
    max-inline-size: none !important;
    inline-size: 100% !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-brand {
    grid-area: brand !important;
    justify-content: stretch !important;
  }

  .topbar.premium-topbar.qb-header .header-brand-block {
    display: grid !important;
    grid-template-columns: auto minmax(0, 1fr) !important;
    align-items: center !important;
    gap: 9px !important;
    min-width: 0 !important;
  }

  .topbar.premium-topbar.qb-header .header-brand-title {
    font-size: clamp(0.92rem, 3.8vw, 1.04rem) !important;
    line-height: 1.46 !important;
    white-space: normal !important;
    overflow: visible !important;
    text-overflow: clip !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-controls {
    grid-area: controls !important;
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    grid-template-areas:
      "settings mode"
      "nav nav" !important;
    align-items: center !important;
    gap: 8px !important;
  }

  .topbar.premium-topbar.qb-header #settingsPanelToggle {
    grid-area: settings !important;
    inline-size: 100% !important;
    min-width: 0 !important;
    justify-content: center !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickMode {
    grid-area: mode !important;
    inline-size: 100% !important;
    max-inline-size: none !important;
    min-width: 0 !important;
    justify-content: center !important;
    font-size: 0.76rem !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    padding-inline: 8px !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track {
    grid-area: nav !important;
    inline-size: 100% !important;
    max-inline-size: none !important;
    min-width: 0 !important;
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    gap: 8px !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    padding: 4px 3px 6px !important;
    border-radius: 12px !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    scroll-snap-type: inline proximity !important;
    scrollbar-width: thin !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track .header-toggle {
    flex: 0 0 auto !important;
    min-inline-size: max-content !important;
    justify-content: center !important;
    white-space: nowrap !important;
    scroll-snap-align: start !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-stats {
    grid-area: stats !important;
    justify-content: stretch !important;
  }

  .topbar.premium-topbar.qb-header .header-stats-track {
    inline-size: 100% !important;
    min-width: 0 !important;
    justify-content: flex-start !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    padding-bottom: 4px !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickContext {
    flex: 0 0 auto !important;
    min-inline-size: max-content !important;
    max-inline-size: none !important;
    white-space: nowrap !important;
    overflow: visible !important;
    text-overflow: clip !important;
  }
}

@media (max-width: 640px) {
  .topbar.premium-topbar.qb-header .header-pillar-controls {
    grid-template-columns: minmax(0, 1fr) !important;
    grid-template-areas:
      "mode"
      "settings"
      "nav" !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickMode,
  .topbar.premium-topbar.qb-header #settingsPanelToggle {
    justify-content: flex-start !important;
  }
}

/* Mobile performance booster: flatten expensive effects in lite mode */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile).mobile-lite :is(
    .subject-add-card,
    .subject-premium-card,
    .lesson-dashboard-head,
    .lesson-stat-chip,
    .lesson-add-card,
    .lesson-chapter-card,
    .chapter-card-tools,
    .header-control-btn,
    .header-toggle,
    .header-view-pill,
    .header-stat-pill,
    .settings-overview-card,
    .settings-tab-btn
  ) {
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  :is(body.force-mobile, body.auto-mobile).mobile-lite :is(
    .subject-add-icon,
    .subject-open-btn::before,
    .subject-open-btn::after,
    .question-card::before,
    .question-card::after
  ) {
    display: none !important;
  }

  :is(body.force-mobile, body.auto-mobile).mobile-lite :is(
    .subject-premium-card,
    .lesson-chapter-card,
    .question-card,
    .practice-question-card,
    .exam-paper-item,
    .header-toggle,
    .settings-tab-btn
  ) {
    transition: none !important;
    transform: none !important;
  }
}

/* Final lesson stats layout: keep 4 metrics in one row (desktop + mobile) */
.lesson-dashboard-stats {
  display: grid !important;
  grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
  gap: 8px !important;
  align-items: stretch !important;
}

.lesson-stat-chip {
  min-width: 0 !important;
  min-height: 46px !important;
  padding: 7px 9px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
  gap: 8px !important;
}

.lesson-stat-head {
  min-width: 0 !important;
  flex: 1 1 auto !important;
}

.lesson-stat-head em {
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.lesson-stat-chip strong {
  flex: 0 0 auto !important;
  white-space: nowrap !important;
  font-variant-numeric: tabular-nums !important;
}

@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .lesson-dashboard-stats,
  body:not(.force-desktop) .lesson-dashboard-stats {
    grid-template-columns: repeat(4, minmax(112px, 1fr)) !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    padding: 2px 2px 4px !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    scrollbar-width: thin !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .lesson-stat-chip,
  body:not(.force-desktop) .lesson-stat-chip {
    min-width: 112px !important;
    min-height: 42px !important;
    padding: 6px 7px !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .lesson-stat-head em,
  body:not(.force-desktop) .lesson-stat-head em {
    font-size: 0.65rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .lesson-stat-chip strong,
  body:not(.force-desktop) .lesson-stat-chip strong {
    font-size: 0.86rem !important;
  }
}

/* Mobile final performance lock: practice + exam */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .practice-mode-panel.practice-mobile-perf,
      .exam-mode-panel.exam-mobile-perf
    ) {
    min-width: 0 !important;
    overflow-x: hidden !important;
    overscroll-behavior-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .practice-mode-panel.practice-mobile-perf .practice-toolbar,
      .practice-mode-panel.practice-mobile-perf .practice-question-card,
      .practice-mode-panel.practice-mobile-perf .practice-reveal-box,
      .exam-mode-panel.exam-mobile-perf .exam-builder-form,
      .exam-mode-panel.exam-mobile-perf .exam-pane,
      .exam-mode-panel.exam-mobile-perf .exam-paper,
      .exam-mode-panel.exam-mobile-perf .exam-paper-item,
      .exam-mode-panel.exam-mobile-perf .exam-answer-key,
      .exam-mode-panel.exam-mobile-perf .exam-eval-panel
    ) {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    box-shadow: none !important;
    background-image: none !important;
    border-color: rgba(124, 178, 213, 0.3) !important;
    background-color: rgba(9, 20, 31, 0.66) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .practice-mode-panel.practice-mobile-perf .practice-question-card,
      .exam-mode-panel.exam-mobile-perf .exam-paper-item
    ) {
    content-visibility: auto !important;
    contain: layout style paint !important;
    contain-intrinsic-size: 280px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf .exam-paper-list {
    content-visibility: auto !important;
    contain-intrinsic-size: 900px !important;
    overflow-anchor: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .practice-mode-panel.practice-mobile-perf .practice-focus-actions,
      .exam-mode-panel.exam-mobile-perf .exam-actions-grid,
      .exam-mode-panel.exam-mobile-perf .exam-session-actions
    ) {
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .practice-mode-panel.practice-mobile-perf .practice-profile-bar,
      .practice-mode-panel.practice-mobile-perf .practice-focus-actions,
      .exam-mode-panel.exam-mobile-perf .exam-paper-quick-stats,
      .exam-mode-panel.exam-mobile-perf .exam-session-actions
    ) {
    overflow: visible !important;
    -webkit-overflow-scrolling: auto !important;
    overscroll-behavior-inline: auto !important;
    scrollbar-width: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .practice-mode-panel.practice-mobile-perf .practice-action-btn,
      .practice-mode-panel.practice-mobile-perf .practice-profile-chip,
      .practice-mode-panel.practice-mobile-perf .question-review-btn,
      .exam-mode-panel.exam-mobile-perf .exam-chip-btn,
      .exam-mode-panel.exam-mobile-perf .btn-exam,
      .exam-mode-panel.exam-mobile-perf .exam-session-btn,
      .exam-mode-panel.exam-mobile-perf .question-review-btn
    ) {
    touch-action: manipulation !important;
    transition: none !important;
    animation: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .practice-mode-panel.practice-mobile-perf .question-card:hover,
      .practice-mode-panel.practice-mobile-perf .practice-action-btn:hover,
      .exam-mode-panel.exam-mobile-perf .question-card:hover,
      .exam-mode-panel.exam-mobile-perf .exam-session-btn:hover,
      .exam-mode-panel.exam-mobile-perf .btn-exam:hover
    ) {
    transform: none !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .practice-mode-panel.practice-mobile-perf .question-card::before,
      .practice-mode-panel.practice-mobile-perf .question-card::after,
      .exam-mode-panel.exam-mobile-perf .question-card::before,
      .exam-mode-panel.exam-mobile-perf .question-card::after
    ) {
    opacity: 0.42 !important;
    filter: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf .exam-paper-meta-grid {
    gap: 6px !important;
  }

  html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .practice-mode-panel.practice-mobile-perf .practice-toolbar,
      .practice-mode-panel.practice-mobile-perf .practice-question-card,
      .practice-mode-panel.practice-mobile-perf .practice-reveal-box,
      .exam-mode-panel.exam-mobile-perf .exam-builder-form,
      .exam-mode-panel.exam-mobile-perf .exam-pane,
      .exam-mode-panel.exam-mobile-perf .exam-paper,
      .exam-mode-panel.exam-mobile-perf .exam-paper-item,
      .exam-mode-panel.exam-mobile-perf .exam-answer-key,
      .exam-mode-panel.exam-mobile-perf .exam-eval-panel
    ) {
    border-color: rgba(47, 92, 128, 0.24) !important;
    background-color: rgba(255, 255, 255, 0.94) !important;
  }
}

@media (max-width: 740px) {
  .topbar.premium-topbar.qb-header {
    border-radius: 18px !important;
    width: min(100% - 12px, 1440px) !important;
  }

  .topbar.premium-topbar.qb-header .header-brand-title {
    font-size: 0.96rem !important;
  }

  .topbar.premium-topbar.qb-header .header-view-pill {
    display: none !important;
  }

  .topbar.premium-topbar.qb-header .header-control-btn {
    padding: 8px 10px !important;
  }

  .topbar.premium-topbar.qb-header .header-control-btn > span:not(.settings-trigger-status) {
    display: none !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track {
    max-inline-size: min(42vw, 210px) !important;
  }
}

@media (max-width: 520px) {
  .topbar.premium-topbar.qb-header .header-pillar-brand {
    flex-basis: calc(52% - 6px) !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-controls {
    flex-basis: calc(48% - 6px) !important;
  }

  .topbar.premium-topbar.qb-header .header-brand-icon {
    inline-size: 40px !important;
    block-size: 40px !important;
  }

  .topbar.premium-topbar.qb-header .header-stat-pill {
    font-size: 0.78rem !important;
    padding: 7px 10px !important;
  }

  .topbar.premium-topbar.qb-header .header-toggle {
    padding: 7px 9px !important;
  }
}

/* JSON text import diagnostics */
.profile-redesign-v2 .json-import-diagnostics {
  margin-top: 0.72rem !important;
  padding: 0.78rem 0.82rem !important;
  border-radius: 12px !important;
  border: 1px solid rgba(138, 172, 201, 0.26) !important;
  background: rgba(9, 20, 31, 0.58) !important;
  color: var(--text-main) !important;
  display: grid !important;
  gap: 0.58rem !important;
}

.profile-redesign-v2 .json-import-diagnostics[hidden] {
  display: none !important;
}

.profile-redesign-v2 .json-import-diagnostics[data-state="error"] {
  border-color: rgba(209, 88, 72, 0.5) !important;
  background:
    radial-gradient(circle at 12% 16%, rgba(209, 88, 72, 0.16), transparent 46%),
    rgba(35, 14, 14, 0.58) !important;
}

.profile-redesign-v2 .json-import-diagnostics[data-state="warn"] {
  border-color: rgba(205, 157, 55, 0.5) !important;
  background:
    radial-gradient(circle at 12% 16%, rgba(205, 157, 55, 0.16), transparent 46%),
    rgba(37, 29, 11, 0.54) !important;
}

.profile-redesign-v2 .json-import-diag-title {
  margin: 0 !important;
  font-size: 0.88rem !important;
  font-weight: 800 !important;
}

.profile-redesign-v2 .json-import-diag-summary {
  margin: 0 !important;
  font-size: 0.8rem !important;
  line-height: 1.75 !important;
  color: var(--text-muted) !important;
}

.profile-redesign-v2 .json-import-diag-section {
  display: grid !important;
  gap: 0.34rem !important;
}

.profile-redesign-v2 .json-import-diag-heading {
  margin: 0 !important;
  font-size: 0.79rem !important;
  font-weight: 700 !important;
}

.profile-redesign-v2 .json-import-diag-list {
  margin: 0 !important;
  padding-inline-start: 1.05rem !important;
  display: grid !important;
  gap: 0.28rem !important;
  font-size: 0.76rem !important;
  line-height: 1.72 !important;
  color: var(--text-muted) !important;
}

.profile-redesign-v2 .json-import-diag-code {
  margin: 0 !important;
  padding: 0.62rem !important;
  border-radius: 10px !important;
  border: 1px solid rgba(138, 172, 201, 0.24) !important;
  background: rgba(5, 10, 17, 0.84) !important;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace !important;
  font-size: 0.74rem !important;
  line-height: 1.62 !important;
  overflow-x: auto !important;
  white-space: pre !important;
}

html[data-theme^="light-"] .profile-redesign-v2 .json-import-diagnostics {
  background: rgba(255, 255, 255, 0.88) !important;
  border-color: rgba(44, 84, 115, 0.22) !important;
}

html[data-theme^="light-"] .profile-redesign-v2 .json-import-diagnostics[data-state="error"] {
  background:
    radial-gradient(circle at 12% 16%, rgba(201, 84, 67, 0.14), transparent 46%),
    rgba(255, 246, 245, 0.96) !important;
  border-color: rgba(180, 85, 72, 0.42) !important;
}

html[data-theme^="light-"] .profile-redesign-v2 .json-import-diagnostics[data-state="warn"] {
  background:
    radial-gradient(circle at 12% 16%, rgba(192, 149, 49, 0.13), transparent 46%),
    rgba(255, 251, 237, 0.96) !important;
  border-color: rgba(180, 140, 54, 0.42) !important;
}

@media (max-width: 640px) {
  .profile-redesign-v2 .json-import-diagnostics {
    padding: 0.66rem 0.7rem !important;
    border-radius: 11px !important;
  }

  .profile-redesign-v2 .json-import-diag-title {
    font-size: 0.84rem !important;
  }

  .profile-redesign-v2 .json-import-diag-summary {
    font-size: 0.77rem !important;
  }

  .profile-redesign-v2 .json-import-diag-list {
    font-size: 0.74rem !important;
    line-height: 1.64 !important;
  }
}

/* Hide scrollbars in answer/hint/solution content blocks */
.question-body,
.disclosure,
.practice-reveal-content,
.question-body *,
.disclosure *,
.practice-reveal-content * {
  -ms-overflow-style: none !important;
  scrollbar-width: none !important;
}

.question-body::-webkit-scrollbar,
.disclosure::-webkit-scrollbar,
.practice-reveal-content::-webkit-scrollbar,
.question-body *::-webkit-scrollbar,
.disclosure *::-webkit-scrollbar,
.practice-reveal-content *::-webkit-scrollbar {
  width: 0 !important;
  height: 0 !important;
  display: none !important;
}

/* Desktop Header Redesign v6 */
@media (min-width: 1024px) {
  .topbar.premium-topbar.qb-header {
    --desk-hdr-border: rgba(160, 206, 242, 0.22);
    --desk-hdr-surface:
      radial-gradient(130% 150% at 92% -18%, rgba(106, 186, 255, 0.26), transparent 46%),
      radial-gradient(110% 130% at 6% 124%, rgba(104, 228, 191, 0.18), transparent 52%),
      linear-gradient(148deg, rgba(7, 16, 30, 0.94), rgba(9, 22, 39, 0.86));
    border-color: var(--desk-hdr-border) !important;
    border-radius: 26px !important;
    background: var(--desk-hdr-surface) !important;
    box-shadow:
      0 24px 46px rgba(1, 6, 13, 0.42),
      inset 0 1px 0 rgba(255, 255, 255, 0.14),
      inset 0 -1px 0 rgba(95, 168, 224, 0.14) !important;
    backdrop-filter: blur(18px) saturate(132%) !important;
    -webkit-backdrop-filter: blur(18px) saturate(132%) !important;
  }

  .topbar.premium-topbar.qb-header .header-container {
    display: grid !important;
    grid-template-columns: minmax(250px, 1fr) minmax(340px, 1.18fr) minmax(440px, 1.46fr) !important;
    grid-template-areas: "brand stats controls" !important;
    align-items: center !important;
    gap: 14px !important;
    padding: 14px 18px !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-brand {
    grid-area: brand !important;
    max-inline-size: none !important;
    justify-self: stretch !important;
  }

  .topbar.premium-topbar.qb-header .header-brand-block {
    display: inline-grid !important;
    grid-template-columns: auto minmax(0, 1fr) !important;
    align-items: center !important;
    gap: 10px !important;
    inline-size: 100% !important;
  }

  .topbar.premium-topbar.qb-header .header-brand-icon {
    inline-size: 46px !important;
    block-size: 46px !important;
    border-radius: 15px !important;
    border-color: rgba(157, 211, 250, 0.34) !important;
    background:
      radial-gradient(circle at 22% 16%, rgba(255, 255, 255, 0.22), transparent 46%),
      linear-gradient(145deg, rgba(116, 202, 255, 0.24), rgba(116, 202, 255, 0.08)) !important;
    box-shadow:
      0 10px 18px rgba(6, 25, 40, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
  }

  .topbar.premium-topbar.qb-header .header-brand-title {
    font-size: clamp(1.02rem, 0.5vw + 0.8rem, 1.28rem) !important;
    font-weight: 800 !important;
    line-height: 1.34 !important;
    letter-spacing: -0.012em !important;
    color: #f2f8ff !important;
    text-wrap: balance !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-stats {
    grid-area: stats !important;
    justify-self: center !important;
    inline-size: 100% !important;
  }

  .topbar.premium-topbar.qb-header .header-stats-track {
    overflow: visible !important;
    padding: 0 !important;
    inline-size: 100% !important;
    justify-content: center !important;
    gap: 10px !important;
  }

  .topbar.premium-topbar.qb-header .header-stats-track::-webkit-scrollbar {
    display: none !important;
  }

  .topbar.premium-topbar.qb-header .header-stat-pill,
  .topbar.premium-topbar.qb-header .header-view-pill {
    min-height: 42px !important;
    border-radius: 13px !important;
    border-color: rgba(170, 214, 245, 0.2) !important;
    background:
      linear-gradient(145deg, rgba(108, 184, 239, 0.16), rgba(108, 184, 239, 0.04)),
      rgba(8, 19, 33, 0.6) !important;
    box-shadow:
      inset 0 1px 0 rgba(255, 255, 255, 0.14),
      0 8px 16px rgba(4, 15, 25, 0.24) !important;
    font-weight: 700 !important;
    color: #d9ecff !important;
  }

  .topbar.premium-topbar.qb-header .header-stat-pill {
    position: relative !important;
    gap: 7px !important;
    padding: 8px 12px !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickContext::before,
  .topbar.premium-topbar.qb-header #headerQuickMode::before {
    content: "" !important;
    inline-size: 15px !important;
    block-size: 15px !important;
    flex: 0 0 15px !important;
    background-repeat: no-repeat !important;
    background-position: center !important;
    background-size: 15px 15px !important;
    opacity: 0.92 !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickContext::before {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23d7ebff' stroke-width='1.9' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='4' y='5' width='16' height='14' rx='2'/%3E%3Cpath d='M8 10h8M8 14h5'/%3E%3C/svg%3E") !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickMode::before {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23d7ebff' stroke-width='1.9' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M2.5 12s3.4-6 9.5-6 9.5 6 9.5 6-3.4 6-9.5 6-9.5-6-9.5-6z'/%3E%3Ccircle cx='12' cy='12' r='2.6'/%3E%3C/svg%3E") !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-controls {
    grid-area: controls !important;
    display: grid !important;
    grid-template-columns: max-content max-content !important;
    grid-template-areas:
      "settings mode"
      "nav nav" !important;
    align-items: center !important;
    justify-content: end !important;
    gap: 9px 10px !important;
    max-inline-size: none !important;
  }

  .topbar.premium-topbar.qb-header #settingsPanelToggle {
    grid-area: settings !important;
    min-height: 42px !important;
    border-radius: 14px !important;
    padding: 8px 14px !important;
    border-color: rgba(170, 214, 245, 0.24) !important;
    background:
      linear-gradient(145deg, rgba(83, 158, 220, 0.2), rgba(83, 158, 220, 0.08)),
      rgba(8, 19, 33, 0.7) !important;
    box-shadow:
      inset 0 1px 0 rgba(255, 255, 255, 0.16),
      0 10px 18px rgba(4, 14, 23, 0.26) !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickMode {
    grid-area: mode !important;
    min-height: 42px !important;
    padding: 8px 12px !important;
    white-space: nowrap !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track {
    grid-area: nav !important;
    inline-size: 100% !important;
    max-inline-size: none !important;
    overflow: visible !important;
    padding: 6px !important;
    border-radius: 15px !important;
    border-color: rgba(170, 214, 245, 0.18) !important;
    background:
      linear-gradient(145deg, rgba(109, 187, 244, 0.14), rgba(109, 187, 244, 0.04)),
      rgba(7, 18, 30, 0.54) !important;
    display: flex !important;
    flex-wrap: wrap !important;
    justify-content: flex-end !important;
    gap: 7px !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track::-webkit-scrollbar {
    display: none !important;
  }

  .topbar.premium-topbar.qb-header .header-toggle {
    min-height: 36px !important;
    border-radius: 11px !important;
    padding: 7px 10px !important;
    font-size: 0.76rem !important;
    border-color: rgba(173, 216, 245, 0.18) !important;
    background:
      linear-gradient(145deg, rgba(130, 199, 248, 0.16), rgba(130, 199, 248, 0.05)),
      rgba(8, 19, 33, 0.5) !important;
  }

  .topbar.premium-topbar.qb-header .header-toggle:hover,
  .topbar.premium-topbar.qb-header #settingsPanelToggle:hover,
  .topbar.premium-topbar.qb-header .header-stat-pill:hover,
  .topbar.premium-topbar.qb-header #headerQuickMode:hover {
    transform: translateY(-1px) !important;
    border-color: rgba(161, 216, 255, 0.38) !important;
    box-shadow: 0 12px 20px rgba(4, 15, 25, 0.3) !important;
  }

  .topbar.premium-topbar.qb-header .header-toggle.is-active,
  .topbar.premium-topbar.qb-header .header-control-btn[aria-expanded="true"] {
    border-color: rgba(121, 213, 255, 0.66) !important;
    background:
      linear-gradient(145deg, rgba(84, 190, 255, 0.34), rgba(84, 190, 255, 0.15)),
      rgba(7, 18, 30, 0.6) !important;
    box-shadow:
      0 14px 24px rgba(6, 33, 54, 0.34),
      inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
  }

  .topbar.premium-topbar.qb-header .header-toggle:disabled {
    opacity: 0.46 !important;
  }
}

/* Desktop Header Layout v7 (optimized structure + cleaner spacing) */
@media (min-width: 1024px) {
  .topbar.premium-topbar.qb-header .header-container {
    grid-template-columns: minmax(240px, 1fr) minmax(620px, 1.7fr) !important;
    grid-template-areas:
      "brand controls"
      "stats controls" !important;
    align-items: start !important;
    gap: 10px 14px !important;
    padding: 14px 16px !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-brand {
    grid-area: brand !important;
    align-self: center !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-stats {
    grid-area: stats !important;
    justify-self: start !important;
    inline-size: 100% !important;
    min-width: 0 !important;
  }

  .topbar.premium-topbar.qb-header .header-stats-track {
    justify-content: flex-start !important;
    gap: 0 !important;
    overflow: visible !important;
    inline-size: 100% !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickContext {
    inline-size: fit-content !important;
    max-inline-size: min(100%, 520px) !important;
    min-height: 36px !important;
    padding: 7px 11px !important;
    font-size: 0.8rem !important;
    border-radius: 11px !important;
    border-color: rgba(167, 214, 246, 0.24) !important;
    background:
      linear-gradient(145deg, rgba(108, 184, 239, 0.14), rgba(108, 184, 239, 0.04)),
      rgba(7, 18, 30, 0.52) !important;
    color: #d5e9fb !important;
    box-shadow:
      inset 0 1px 0 rgba(255, 255, 255, 0.12),
      0 8px 14px rgba(4, 14, 24, 0.22) !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-controls {
    grid-area: controls !important;
    display: grid !important;
    grid-template-columns: auto auto !important;
    grid-template-areas:
      "settings mode"
      "nav nav" !important;
    justify-content: end !important;
    align-items: center !important;
    gap: 8px 10px !important;
  }

  .topbar.premium-topbar.qb-header #settingsPanelToggle {
    grid-area: settings !important;
    min-height: 40px !important;
    padding: 8px 13px !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickMode {
    grid-area: mode !important;
    min-height: 40px !important;
    padding: 8px 11px !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track {
    grid-area: nav !important;
    inline-size: 100% !important;
    display: grid !important;
    grid-template-columns: repeat(5, minmax(0, 1fr)) !important;
    gap: 6px !important;
    padding: 5px !important;
    overflow: visible !important;
    border-radius: 13px !important;
    border-color: rgba(165, 213, 246, 0.2) !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track::-webkit-scrollbar {
    display: none !important;
  }

  .topbar.premium-topbar.qb-header .header-toggle {
    inline-size: 100% !important;
    justify-content: center !important;
    min-height: 34px !important;
    padding: 6px 8px !important;
    font-size: 0.74rem !important;
    line-height: 1.26 !important;
    border-radius: 10px !important;
  }
}

@media (min-width: 1024px) and (max-width: 1360px) {
  .topbar.premium-topbar.qb-header .header-container {
    grid-template-columns: minmax(220px, 1fr) minmax(560px, 1.5fr) !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-controls {
    grid-template-columns: 1fr auto !important;
    grid-template-areas:
      "mode settings"
      "nav nav" !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickMode {
    inline-size: 100% !important;
    justify-content: center !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track {
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  }
}

/* Profile Modern Redesign v5 */
.profile-orbit.profile-redesign-v2 {
  --pv-border: rgba(155, 206, 246, 0.24);
  --pv-surface:
    radial-gradient(120% 140% at 8% 8%, rgba(112, 199, 255, 0.22), transparent 42%),
    radial-gradient(120% 150% at 92% 92%, rgba(112, 236, 198, 0.16), transparent 48%),
    linear-gradient(150deg, rgba(7, 17, 30, 0.92), rgba(10, 24, 41, 0.84));
  position: relative !important;
  margin: 14px 0 16px !important;
  padding: 15px !important;
  border-radius: 24px !important;
  border: 1px solid var(--pv-border) !important;
  background: var(--pv-surface) !important;
  box-shadow:
    0 24px 44px rgba(2, 8, 14, 0.36),
    inset 0 1px 0 rgba(255, 255, 255, 0.12) !important;
  overflow: hidden !important;
  isolation: isolate !important;
}

.profile-orbit.profile-redesign-v2::before {
  content: "" !important;
  position: absolute !important;
  inset: -26% 30% auto -24% !important;
  height: 300px !important;
  background: radial-gradient(circle, rgba(130, 206, 255, 0.26), transparent 66%) !important;
  pointer-events: none !important;
}

.profile-orbit.profile-redesign-v2::after {
  content: "" !important;
  position: absolute !important;
  inset: auto -18% -38% 42% !important;
  height: 320px !important;
  background: radial-gradient(circle, rgba(115, 234, 198, 0.2), transparent 70%) !important;
  pointer-events: none !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid {
  position: relative !important;
  z-index: 1 !important;
  display: grid !important;
  grid-template-columns: minmax(360px, 1.08fr) minmax(320px, 1fr) !important;
  gap: 13px !important;
  align-items: stretch !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-card {
  position: relative !important;
  display: grid !important;
  gap: 10px !important;
  min-height: 100% !important;
  border-radius: 20px !important;
  border: 1px solid rgba(164, 212, 245, 0.2) !important;
  background:
    linear-gradient(148deg, rgba(107, 188, 243, 0.14), rgba(107, 188, 243, 0.04)),
    rgba(7, 17, 29, 0.62) !important;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.12),
    0 12px 22px rgba(4, 13, 22, 0.24) !important;
  padding: 14px !important;
  overflow: hidden !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-card::before {
  content: "" !important;
  position: absolute !important;
  inset: 0 !important;
  background: linear-gradient(104deg, rgba(255, 255, 255, 0.08), transparent 60%) !important;
  pointer-events: none !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-head {
  display: grid !important;
  grid-template-columns: minmax(0, 1fr) auto !important;
  align-items: center !important;
  gap: 10px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-kicker {
  display: inline-flex !important;
  align-items: center !important;
  width: fit-content !important;
  min-height: 24px !important;
  padding: 2px 9px !important;
  border-radius: 999px !important;
  border: 1px solid rgba(170, 214, 245, 0.22) !important;
  background: rgba(111, 191, 247, 0.14) !important;
  color: #c9e8ff !important;
  font-size: 0.68rem !important;
  font-weight: 700 !important;
  letter-spacing: 0.08em !important;
  text-transform: uppercase !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-title-wrap h2 {
  margin: 0 !important;
  color: #f1f8ff !important;
  font-size: clamp(1.03rem, 0.5vw + 0.82rem, 1.26rem) !important;
  font-weight: 800 !important;
  letter-spacing: -0.012em !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-title-wrap p {
  margin: 6px 0 0 !important;
  color: rgba(202, 223, 246, 0.86) !important;
  font-size: 0.79rem !important;
  line-height: 1.78 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-avatar {
  inline-size: 72px !important;
  block-size: 72px !important;
  border-radius: 22px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-greeting-card {
  border-radius: 14px !important;
  border: 1px solid rgba(163, 210, 242, 0.24) !important;
  background:
    radial-gradient(circle at 90% 14%, rgba(123, 206, 255, 0.16), transparent 42%),
    linear-gradient(145deg, rgba(112, 191, 246, 0.16), rgba(112, 191, 246, 0.04)) !important;
  padding: 10px 12px !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12) !important;
}

.profile-orbit.profile-redesign-v2 .profile-greeting {
  margin: 0 !important;
  font-size: 0.84rem !important;
  line-height: 1.84 !important;
  color: #dff1ff !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-fields {
  display: grid !important;
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap: 9px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-field {
  display: grid !important;
  gap: 6px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-label {
  color: rgba(204, 224, 246, 0.84) !important;
  font-size: 0.74rem !important;
  font-weight: 700 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-input-wrap {
  display: inline-flex !important;
  align-items: center !important;
  gap: 8px !important;
  min-height: 44px !important;
  border-radius: 12px !important;
  border: 1px solid rgba(164, 208, 240, 0.22) !important;
  background:
    linear-gradient(145deg, rgba(108, 188, 246, 0.13), rgba(108, 188, 246, 0.04)),
    rgba(8, 18, 30, 0.58) !important;
  padding: 6px 9px !important;
  transition: border-color 0.22s ease, box-shadow 0.22s ease, background-color 0.22s ease !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-field:focus-within .profile-v2-input-wrap {
  border-color: rgba(121, 212, 255, 0.52) !important;
  box-shadow:
    0 0 0 2px rgba(96, 188, 247, 0.18),
    0 10px 18px rgba(3, 18, 30, 0.24) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-icon {
  inline-size: 28px !important;
  block-size: 28px !important;
  border-radius: 9px !important;
  border: 1px solid rgba(168, 212, 243, 0.26) !important;
  background: rgba(113, 194, 249, 0.16) !important;
  color: #d8edff !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-icon svg {
  inline-size: 15px !important;
  block-size: 15px !important;
  stroke-width: 1.8 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-input-wrap input {
  min-height: 30px !important;
  border: 0 !important;
  background: transparent !important;
  color: #edf7ff !important;
  font-size: 0.84rem !important;
  padding: 0 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-input-wrap input::placeholder {
  color: rgba(184, 209, 233, 0.72) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-input-wrap input:focus {
  outline: none !important;
  box-shadow: none !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile.is-complete::after {
  content: "پروفایل تکمیل شد" !important;
  position: absolute !important;
  top: 12px !important;
  left: 12px !important;
  min-height: 24px !important;
  padding: 2px 9px !important;
  border-radius: 999px !important;
  border: 1px solid rgba(122, 224, 189, 0.38) !important;
  background: rgba(122, 224, 189, 0.2) !important;
  color: #dffef2 !important;
  font-size: 0.7rem !important;
  font-weight: 700 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-data {
  align-content: start !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-data-head {
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
  gap: 8px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-data h3 {
  margin: 0 !important;
  color: #f0f8ff !important;
  font-size: 1rem !important;
  font-weight: 800 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-data-pill {
  display: inline-flex !important;
  align-items: center !important;
  min-height: 24px !important;
  padding: 2px 8px !important;
  border-radius: 999px !important;
  border: 1px solid rgba(171, 214, 245, 0.24) !important;
  background: rgba(113, 193, 249, 0.14) !important;
  color: #cde8ff !important;
  font-size: 0.68rem !important;
  font-weight: 700 !important;
  letter-spacing: 0.07em !important;
  text-transform: uppercase !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-actions {
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 8px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-actions .glass-btn,
.profile-orbit.profile-redesign-v2 .profile-v2-json-actions .glass-btn {
  min-height: 40px !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  gap: 7px !important;
  border-radius: 11px !important;
  border: 1px solid rgba(168, 212, 244, 0.22) !important;
  background:
    linear-gradient(145deg, rgba(108, 187, 245, 0.16), rgba(108, 187, 245, 0.04)),
    rgba(8, 18, 31, 0.56) !important;
  color: #e9f6ff !important;
  font-size: 0.78rem !important;
  font-weight: 700 !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12) !important;
  transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-actions .glass-btn:hover,
.profile-orbit.profile-redesign-v2 .profile-v2-json-actions .glass-btn:hover {
  transform: translateY(-1px) !important;
  border-color: rgba(131, 209, 255, 0.42) !important;
  box-shadow: 0 10px 18px rgba(3, 16, 28, 0.3) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-actions .glass-btn::before,
.profile-orbit.profile-redesign-v2 .profile-v2-json-actions .glass-btn::before {
  content: "" !important;
  inline-size: 15px !important;
  block-size: 15px !important;
  flex: 0 0 15px !important;
  background-repeat: no-repeat !important;
  background-position: center !important;
  background-size: 15px 15px !important;
  opacity: 0.94 !important;
}

.profile-orbit.profile-redesign-v2 #jsonImportBtn::before {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e5f4ff' stroke-width='1.9' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 4v11'/%3E%3Cpath d='m7.8 10.9 4.2 4.2 4.2-4.2'/%3E%3Cpath d='M4 19h16'/%3E%3C/svg%3E") !important;
}

.profile-orbit.profile-redesign-v2 #jsonExportBtn::before {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e5f4ff' stroke-width='1.9' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 20V9'/%3E%3Cpath d='m16.2 13.1-4.2-4.2-4.2 4.2'/%3E%3Cpath d='M4 5h16'/%3E%3C/svg%3E") !important;
}

.profile-orbit.profile-redesign-v2 #jsonSchemaInfoBtn::before {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e5f4ff' stroke-width='1.9' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='4' y='4' width='16' height='16' rx='2'/%3E%3Cpath d='M8 9h8M8 12h8M8 15h5'/%3E%3C/svg%3E") !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-actions .glass-btn[data-action="import-json-text"]::before {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e5f4ff' stroke-width='1.9' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M8 5 4 9l4 4M16 19l4-4-4-4M10 19 14 5'/%3E%3C/svg%3E") !important;
}

.profile-orbit.profile-redesign-v2 #jsonTextImportBtn::before {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e5f4ff' stroke-width='1.9' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='8'/%3E%3Cpath d='M12 8v8M8 12h8'/%3E%3C/svg%3E") !important;
}

.profile-orbit.profile-redesign-v2 #jsonTextClearBtn::before {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e5f4ff' stroke-width='1.9' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 6l12 12M18 6 6 18'/%3E%3C/svg%3E") !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-json-label {
  color: rgba(204, 225, 247, 0.9) !important;
  font-size: 0.74rem !important;
  font-weight: 700 !important;
}

.profile-orbit.profile-redesign-v2 #jsonImportText {
  min-height: 176px !important;
  border-radius: 12px !important;
  border: 1px solid rgba(163, 210, 243, 0.24) !important;
  background:
    linear-gradient(145deg, rgba(108, 188, 245, 0.14), rgba(108, 188, 245, 0.04)),
    rgba(7, 16, 28, 0.62) !important;
  color: #eaf7ff !important;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace !important;
  font-size: 0.78rem !important;
  line-height: 1.72 !important;
  padding: 11px 12px !important;
}

.profile-orbit.profile-redesign-v2 #jsonImportText:focus {
  border-color: rgba(120, 211, 255, 0.5) !important;
  box-shadow: 0 0 0 2px rgba(96, 188, 247, 0.18) !important;
}

.profile-orbit.profile-redesign-v2 #jsonImportText::placeholder {
  color: rgba(176, 205, 230, 0.72) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-json-actions {
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 8px !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 {
  --pv-border: rgba(47, 108, 150, 0.22);
  --pv-surface:
    radial-gradient(120% 140% at 8% 8%, rgba(47, 130, 193, 0.17), transparent 42%),
    radial-gradient(120% 150% at 92% 92%, rgba(61, 167, 133, 0.12), transparent 48%),
    linear-gradient(150deg, rgba(245, 250, 255, 0.98), rgba(236, 245, 253, 0.94));
  box-shadow:
    0 20px 36px rgba(22, 60, 89, 0.14),
    inset 0 1px 0 rgba(255, 255, 255, 0.94) !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-card {
  border-color: rgba(47, 108, 150, 0.2) !important;
  background:
    linear-gradient(148deg, rgba(47, 130, 193, 0.12), rgba(47, 130, 193, 0.04)),
    rgba(255, 255, 255, 0.84) !important;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.92),
    0 11px 20px rgba(31, 74, 105, 0.12) !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-title-wrap h2,
html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-data h3 {
  color: #1a4f75 !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-title-wrap p,
html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-label,
html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-json-label {
  color: #346185 !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-input-wrap,
html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 #jsonImportText,
html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-actions .glass-btn,
html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-json-actions .glass-btn {
  border-color: rgba(47, 108, 150, 0.22) !important;
  background:
    linear-gradient(145deg, rgba(47, 130, 193, 0.12), rgba(47, 130, 193, 0.04)),
    rgba(255, 255, 255, 0.9) !important;
  color: #1f557b !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-greeting,
html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-input-wrap input {
  color: #22577e !important;
}

@media (max-width: 1100px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-grid {
    grid-template-columns: 1fr !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-fields {
    grid-template-columns: 1fr !important;
  }
}

@media (max-width: 700px) {
  .profile-orbit.profile-redesign-v2 {
    padding: 10px !important;
    border-radius: 18px !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-card {
    border-radius: 14px !important;
    padding: 10px !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-head {
    grid-template-columns: 1fr !important;
    justify-items: start !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-avatar {
    inline-size: 60px !important;
    block-size: 60px !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-actions {
    grid-template-columns: 1fr !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-json-actions {
    grid-template-columns: 1fr 1fr !important;
  }
}

/* Profile Layout Tune v6 (compact + better alignment) */
.profile-orbit.profile-redesign-v2 .profile-v2-grid {
  grid-template-columns: minmax(0, 1.02fr) minmax(0, 1.18fr) !important;
  align-items: start !important;
  gap: 12px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-card {
  min-height: 0 !important;
  height: auto !important;
  align-content: start !important;
  grid-auto-rows: max-content !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile {
  grid-template-rows: auto auto auto !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-head {
  align-items: start !important;
  margin-bottom: 2px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-title-wrap {
  display: grid !important;
  gap: 4px !important;
  align-content: start !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-avatar {
  align-self: start !important;
  justify-self: end !important;
  inline-size: 62px !important;
  block-size: 62px !important;
  border-radius: 18px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-greeting-card {
  margin-top: 2px !important;
  margin-bottom: 2px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-fields {
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap: 8px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-field {
  min-width: 0 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-input-wrap {
  min-height: 40px !important;
  padding: 5px 8px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-input-wrap input {
  min-width: 0 !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-data {
  grid-template-rows: auto auto auto auto auto !important;
  align-content: start !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-actions {
  grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-actions .glass-btn {
  min-height: 38px !important;
  padding-inline: 8px !important;
  font-size: 0.74rem !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-json-actions .glass-btn {
  min-height: 37px !important;
}

@media (max-width: 1380px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-actions {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }
}

@media (max-width: 1120px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-grid {
    grid-template-columns: 1fr !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-fields {
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  }
}

@media (max-width: 860px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-fields {
    grid-template-columns: 1fr !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-actions {
    grid-template-columns: 1fr !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-json-actions {
    grid-template-columns: 1fr !important;
  }
}

/* Profile Card Layout v7 (right panel fully restructured) */
.profile-orbit.profile-redesign-v2 .profile-v2-profile {
  display: grid !important;
  grid-template-rows: auto auto auto !important;
  gap: 10px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-head-modern {
  display: grid !important;
  grid-template-columns: auto minmax(0, 1fr) !important;
  align-items: center !important;
  gap: 12px !important;
  margin: 0 !important;
  padding: 2px 0 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-avatar {
  inline-size: 58px !important;
  block-size: 58px !important;
  border-radius: 16px !important;
  justify-self: start !important;
  align-self: start !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-head-main {
  min-width: 0 !important;
  display: grid !important;
  gap: 8px !important;
  align-content: start !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-title-wrap {
  display: grid !important;
  gap: 4px !important;
  align-content: start !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-title-wrap h2 {
  margin: 0 !important;
  font-size: clamp(1.08rem, 0.45vw + 0.88rem, 1.34rem) !important;
  line-height: 1.3 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-title-wrap p {
  margin: 0 !important;
  font-size: 0.82rem !important;
  line-height: 1.72 !important;
  max-width: 58ch !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-head-meta {
  display: flex !important;
  flex-wrap: wrap !important;
  gap: 6px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-head-chip {
  display: inline-flex !important;
  align-items: center !important;
  min-height: 24px !important;
  padding: 2px 9px !important;
  border-radius: 999px !important;
  border: 1px solid rgba(167, 213, 245, 0.24) !important;
  background: rgba(112, 193, 249, 0.16) !important;
  color: #d2eaff !important;
  font-size: 0.7rem !important;
  font-weight: 700 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-greeting-card {
  margin: 0 !important;
  padding: 10px 12px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-fields {
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 10px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-field-semester {
  grid-column: 1 / -1 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-label {
  font-size: 0.76rem !important;
  margin-bottom: 1px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-input-wrap {
  min-height: 42px !important;
  padding: 5px 9px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-input-wrap input {
  font-size: 0.83rem !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-head-chip {
  border-color: rgba(47, 108, 150, 0.24) !important;
  background: rgba(47, 130, 193, 0.14) !important;
  color: #21557c !important;
}

@media (max-width: 1120px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-fields {
    grid-template-columns: 1fr !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-field-semester {
    grid-column: auto !important;
  }
}

@media (max-width: 700px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-head-modern {
    grid-template-columns: 1fr !important;
    justify-items: start !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-avatar {
    order: 2 !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-head-main {
    order: 1 !important;
  }
}

/* Profile Card Layout v8 (icon top-right + compact greeting below) */
.profile-orbit.profile-redesign-v2 .profile-v2-profile {
  display: grid !important;
  grid-template-columns: minmax(0, 1fr) minmax(170px, 220px) !important;
  grid-template-areas:
    "main rail"
    "fields rail" !important;
  align-items: start !important;
  gap: 10px 12px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-head-modern {
  grid-area: main !important;
  display: block !important;
  margin: 0 !important;
  padding: 0 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-title-wrap {
  display: grid !important;
  gap: 5px !important;
  align-content: start !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-title-wrap h2 {
  margin: 0 !important;
  font-size: clamp(1.08rem, 0.4vw + 0.9rem, 1.3rem) !important;
  line-height: 1.28 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-title-wrap p {
  margin: 0 !important;
  font-size: 0.81rem !important;
  line-height: 1.72 !important;
  max-width: 58ch !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-rail {
  grid-area: rail !important;
  display: grid !important;
  justify-items: end !important;
  align-content: start !important;
  gap: 8px !important;
  min-width: 0 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-avatar {
  inline-size: 56px !important;
  block-size: 56px !important;
  border-radius: 15px !important;
  justify-self: end !important;
  align-self: start !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-greeting-compact {
  margin: 0 !important;
  inline-size: min(100%, 210px) !important;
  padding: 8px 9px !important;
  border-radius: 12px !important;
  border: 1px solid rgba(163, 210, 243, 0.24) !important;
  background:
    linear-gradient(145deg, rgba(107, 188, 245, 0.14), rgba(107, 188, 245, 0.04)),
    rgba(8, 18, 31, 0.54) !important;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.1),
    0 8px 14px rgba(3, 16, 28, 0.22) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-greeting-compact .profile-greeting {
  margin: 0 !important;
  font-size: 0.77rem !important;
  line-height: 1.72 !important;
  font-weight: 700 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-fields {
  grid-area: fields !important;
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 9px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-field-semester {
  grid-column: 1 / -1 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-input-wrap {
  min-height: 40px !important;
  padding: 5px 8px !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-greeting-compact {
  border-color: rgba(47, 108, 150, 0.22) !important;
  background:
    linear-gradient(145deg, rgba(47, 130, 193, 0.12), rgba(47, 130, 193, 0.04)),
    rgba(255, 255, 255, 0.92) !important;
}

@media (max-width: 1120px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-profile {
    grid-template-columns: 1fr !important;
    grid-template-areas:
      "main"
      "rail"
      "fields" !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-rail {
    justify-items: start !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-avatar {
    justify-self: start !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-greeting-compact {
    inline-size: min(100%, 360px) !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-fields {
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-field-semester {
    grid-column: auto !important;
  }
}

@media (max-width: 860px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-fields {
    grid-template-columns: 1fr !important;
  }
}

/* Profile Final Override v12 */
.profile-orbit.profile-redesign-v2 .profile-v2-kicker,
.profile-orbit.profile-redesign-v2 .profile-v2-head-meta,
.profile-orbit.profile-redesign-v2 .profile-v2-head-chip,
.profile-orbit.profile-redesign-v2 .profile-v2-rail {
  display: none !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid {
  display: grid !important;
  grid-template-columns: minmax(0, 1.15fr) minmax(0, 0.95fr) !important;
  gap: 16px !important;
  align-items: stretch !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile {
  position: relative !important;
  display: grid !important;
  grid-template-rows: auto auto auto !important;
  gap: 14px !important;
  min-height: 0 !important;
  overflow: hidden !important;
  padding-inline: clamp(16px, 2vw, 26px) !important;
  padding-inline-end: clamp(16px, 2vw, 26px) !important;
  padding-block: clamp(16px, 2vw, 24px) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-head-rebuild {
  display: grid !important;
  justify-items: end !important;
  align-content: start !important;
  gap: 12px !important;
  margin: 0 !important;
  padding: 0 !important;
  text-align: right !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-avatar {
  inline-size: 82px !important;
  block-size: 82px !important;
  border-radius: 26px !important;
  justify-self: end !important;
  align-self: start !important;
  box-shadow:
    0 16px 34px rgba(0, 7, 16, 0.36),
    inset 0 1px 0 rgba(255, 255, 255, 0.22) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-title-wrap {
  width: 100% !important;
  max-width: 100% !important;
  display: grid !important;
  gap: 6px !important;
  text-align: right !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-title-wrap h2 {
  margin: 0 !important;
  font-size: clamp(1.35rem, 0.9vw + 1rem, 1.85rem) !important;
  line-height: 1.22 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-title-wrap p {
  margin: 0 !important;
  font-size: 0.93rem !important;
  line-height: 1.85 !important;
  color: rgba(208, 227, 246, 0.9) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-greeting-modern {
  margin: 0 !important;
  justify-self: end !important;
  inline-size: min(100%, 620px) !important;
  padding: 14px 16px !important;
  border-radius: 16px !important;
  border: 1px solid rgba(160, 208, 242, 0.33) !important;
  background:
    radial-gradient(circle at 92% 6%, rgba(128, 213, 255, 0.2), transparent 42%),
    linear-gradient(140deg, rgba(112, 194, 246, 0.17), rgba(112, 194, 246, 0.05)),
    rgba(8, 19, 33, 0.6) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-greeting-modern .profile-greeting {
  margin: 0 !important;
  font-size: clamp(0.98rem, 0.36vw + 0.88rem, 1.08rem) !important;
  line-height: 1.9 !important;
  font-weight: 700 !important;
  color: #e6f4ff !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-fields-rebuild {
  display: grid !important;
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap: 12px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-field-semester {
  grid-column: auto !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-label {
  margin-bottom: 6px !important;
  font-size: 0.8rem !important;
  font-weight: 700 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-input-wrap {
  min-height: 50px !important;
  padding: 7px 11px !important;
  border-radius: 14px !important;
  border: 1px solid rgba(136, 184, 220, 0.3) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-input-wrap input {
  font-size: 0.92rem !important;
}

@media (max-width: 1220px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-grid {
    grid-template-columns: 1fr !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-greeting-modern {
    inline-size: 100% !important;
    justify-self: stretch !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-fields-rebuild {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-field-semester {
    grid-column: 1 / -1 !important;
  }
}

@media (max-width: 860px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-avatar {
    inline-size: 72px !important;
    block-size: 72px !important;
    border-radius: 22px !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-fields-rebuild {
    grid-template-columns: 1fr !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-field-semester {
    grid-column: auto !important;
  }
}

/* Profile Card Layout v11 (clean rebuild, icon on top-right, modern greeting) */
.profile-orbit.profile-redesign-v2 .profile-v2-grid {
  display: grid !important;
  grid-template-columns: minmax(0, 1.15fr) minmax(0, 0.95fr) !important;
  align-items: stretch !important;
  gap: 16px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile {
  position: relative !important;
  display: grid !important;
  grid-template-rows: auto auto auto !important;
  gap: 14px !important;
  padding-block: clamp(16px, 2.1vw, 24px) !important;
  padding-inline: clamp(16px, 2.1vw, 26px) !important;
  padding-inline-end: clamp(16px, 2.1vw, 26px) !important;
  min-height: 0 !important;
  overflow: hidden !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-head-rebuild {
  display: grid !important;
  justify-items: end !important;
  align-content: start !important;
  gap: 12px !important;
  margin: 0 !important;
  padding: 0 !important;
  text-align: right !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-avatar {
  inline-size: 82px !important;
  block-size: 82px !important;
  border-radius: 26px !important;
  justify-self: end !important;
  align-self: start !important;
  box-shadow:
    0 16px 34px rgba(0, 7, 16, 0.36),
    inset 0 1px 0 rgba(255, 255, 255, 0.22) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-title-wrap {
  width: 100% !important;
  max-width: 100% !important;
  display: grid !important;
  gap: 6px !important;
  text-align: right !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-title-wrap h2 {
  margin: 0 !important;
  font-size: clamp(1.35rem, 0.9vw + 1rem, 1.85rem) !important;
  line-height: 1.22 !important;
  letter-spacing: -0.012em !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-title-wrap p {
  margin: 0 !important;
  font-size: 0.93rem !important;
  line-height: 1.85 !important;
  color: rgba(208, 227, 246, 0.9) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-greeting-modern {
  justify-self: end !important;
  inline-size: min(100%, 620px) !important;
  margin: 0 !important;
  padding: 14px 16px !important;
  border-radius: 16px !important;
  border: 1px solid rgba(160, 208, 242, 0.33) !important;
  background:
    radial-gradient(circle at 92% 6%, rgba(128, 213, 255, 0.2), transparent 42%),
    linear-gradient(140deg, rgba(112, 194, 246, 0.17), rgba(112, 194, 246, 0.05)),
    rgba(8, 19, 33, 0.6) !important;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.13),
    0 14px 22px rgba(3, 14, 26, 0.26) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-greeting-modern .profile-greeting {
  margin: 0 !important;
  font-size: clamp(0.98rem, 0.36vw + 0.88rem, 1.08rem) !important;
  line-height: 1.9 !important;
  font-weight: 700 !important;
  color: #e6f4ff !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-fields-rebuild {
  display: grid !important;
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap: 12px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-field-semester {
  grid-column: auto !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-field {
  min-width: 0 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-label {
  margin-bottom: 6px !important;
  font-size: 0.8rem !important;
  font-weight: 700 !important;
  color: rgba(194, 220, 245, 0.96) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-input-wrap {
  min-height: 50px !important;
  padding: 7px 11px !important;
  border-radius: 14px !important;
  border: 1px solid rgba(136, 184, 220, 0.3) !important;
  background: linear-gradient(160deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02)) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-input-wrap:focus-within {
  border-color: rgba(143, 212, 255, 0.58) !important;
  box-shadow: 0 0 0 3px rgba(111, 189, 242, 0.18) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-input-wrap input {
  font-size: 0.92rem !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-data {
  display: grid !important;
  align-content: start !important;
  gap: 12px !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-title-wrap p {
  color: #3d6687 !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-greeting-modern {
  border-color: rgba(44, 105, 147, 0.25) !important;
  background:
    radial-gradient(circle at 92% 6%, rgba(54, 136, 193, 0.13), transparent 42%),
    linear-gradient(140deg, rgba(47, 132, 193, 0.11), rgba(47, 132, 193, 0.04)),
    rgba(255, 255, 255, 0.94) !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-greeting-modern .profile-greeting {
  color: #1f567c !important;
}

@media (max-width: 1220px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-grid {
    grid-template-columns: 1fr !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-greeting-modern {
    inline-size: 100% !important;
    justify-self: stretch !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-fields-rebuild {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-field-semester {
    grid-column: 1 / -1 !important;
  }
}

@media (max-width: 860px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-avatar {
    inline-size: 72px !important;
    block-size: 72px !important;
    border-radius: 22px !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-fields-rebuild {
    grid-template-columns: 1fr !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-grid > .profile-v2-card.profile-v2-profile .profile-v2-field-semester {
    grid-column: auto !important;
  }
}

/* Profile Rebuild v10 (from scratch, clean modern layout) */
.profile-orbit.profile-redesign-v2 .profile-v2-kicker,
.profile-orbit.profile-redesign-v2 .profile-v2-head-meta,
.profile-orbit.profile-redesign-v2 .profile-v2-head-chip,
.profile-orbit.profile-redesign-v2 .profile-v2-rail {
  display: none !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-grid {
  display: grid !important;
  grid-template-columns: minmax(0, 1.05fr) minmax(0, 1fr) !important;
  align-items: start !important;
  gap: 14px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-card {
  min-height: 0 !important;
  height: auto !important;
  align-content: start !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile {
  padding-inline-end: 0 !important;
  display: grid !important;
  grid-template-rows: auto auto auto !important;
  gap: 11px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-head-rebuild {
  display: grid !important;
  justify-items: end !important;
  align-content: start !important;
  gap: 8px !important;
  margin: 0 !important;
  padding: 0 !important;
  text-align: right !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-avatar {
  inline-size: 64px !important;
  block-size: 64px !important;
  border-radius: 18px !important;
  justify-self: end !important;
  align-self: start !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-title-wrap {
  display: grid !important;
  gap: 5px !important;
  width: 100% !important;
  max-width: 100% !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-title-wrap h2 {
  margin: 0 !important;
  font-size: clamp(1.1rem, 0.5vw + 0.9rem, 1.34rem) !important;
  line-height: 1.3 !important;
  letter-spacing: -0.012em !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-title-wrap p {
  margin: 0 !important;
  font-size: 0.84rem !important;
  line-height: 1.76 !important;
  color: rgba(204, 224, 246, 0.88) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-greeting-modern {
  margin: 0 !important;
  padding: 10px 12px !important;
  border-radius: 13px !important;
  border: 1px solid rgba(164, 211, 243, 0.28) !important;
  background:
    radial-gradient(circle at 88% 12%, rgba(121, 205, 255, 0.16), transparent 44%),
    linear-gradient(145deg, rgba(108, 188, 246, 0.16), rgba(108, 188, 246, 0.05)),
    rgba(8, 19, 32, 0.5) !important;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.12),
    0 10px 16px rgba(3, 16, 28, 0.22) !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-greeting-modern .profile-greeting {
  margin: 0 !important;
  font-size: 0.95rem !important;
  line-height: 1.82 !important;
  font-weight: 700 !important;
  color: #e4f3ff !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-fields-rebuild {
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 9px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-field-semester {
  grid-column: 1 / -1 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-field {
  min-width: 0 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-label {
  font-size: 0.78rem !important;
  font-weight: 700 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-input-wrap {
  min-height: 42px !important;
  padding: 5px 9px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-input-wrap input {
  font-size: 0.86rem !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-greeting-modern {
  border-color: rgba(47, 108, 150, 0.24) !important;
  background:
    radial-gradient(circle at 88% 12%, rgba(47, 130, 193, 0.12), transparent 44%),
    linear-gradient(145deg, rgba(47, 130, 193, 0.11), rgba(47, 130, 193, 0.04)),
    rgba(255, 255, 255, 0.92) !important;
}

html[data-theme^="light-"] .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-greeting-modern .profile-greeting {
  color: #1f567c !important;
}

@media (max-width: 1120px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-grid {
    grid-template-columns: 1fr !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-head-rebuild {
    justify-items: start !important;
    text-align: right !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-avatar {
    justify-self: start !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-fields-rebuild {
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-field-semester {
    grid-column: auto !important;
  }
}

@media (max-width: 860px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-fields-rebuild {
    grid-template-columns: 1fr !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-greeting-modern .profile-greeting {
    font-size: 0.9rem !important;
  }
}

/* Profile Card Layout v9 (strict right rail placement for RTL/LTR) */
.profile-orbit.profile-redesign-v2 .profile-v2-profile {
  position: relative !important;
  display: grid !important;
  grid-template-columns: 1fr !important;
  gap: 10px !important;
  padding-inline-end: 232px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-head-modern {
  margin: 0 !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-rail {
  position: absolute !important;
  top: 0 !important;
  inset-inline-end: 0 !important;
  inline-size: 212px !important;
  display: grid !important;
  justify-items: end !important;
  align-content: start !important;
  gap: 8px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-greeting-compact {
  inline-size: 100% !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-fields {
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap: 9px !important;
}

.profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-field-semester {
  grid-column: 1 / -1 !important;
}

@media (max-width: 1120px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-profile {
    padding-inline-end: 0 !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-rail {
    position: static !important;
    inline-size: auto !important;
    justify-items: start !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-greeting-compact {
    inline-size: min(100%, 360px) !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-fields {
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  }

  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-field-semester {
    grid-column: auto !important;
  }
}

@media (max-width: 860px) {
  .profile-orbit.profile-redesign-v2 .profile-v2-profile .profile-v2-fields {
    grid-template-columns: 1fr !important;
  }
}
/* ===== Premium Profile Hub (v1, isolated) ===== */
.profile-hub {
  --profile-bg: linear-gradient(145deg, var(--surface), var(--surface-soft));
  --profile-border: var(--line);
  --profile-text: var(--text-main);
  --profile-muted: var(--text-muted);
  --profile-focus: var(--accent-soft);
  --profile-card-radius: 18px;
  --profile-gap: 16px;
  --profile-control-height: 50px;
  margin: 0 0 16px;
}

.profile-hub-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--profile-gap);
}

.profile-card {
  min-width: 0;
  border-radius: var(--profile-card-radius);
  border: 1px solid var(--profile-border);
  background: var(--profile-bg);
  box-shadow: 0 20px 32px rgba(3, 12, 24, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1);
  padding: 16px;
  color: var(--profile-text);
  backdrop-filter: blur(16px);
}

.profile-card-top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 14px;
}

.profile-identity-cluster {
  min-width: 0;
  display: flex;
  align-items: center;
  gap: 12px;
}

.profile-avatar-circle {
  inline-size: 56px;
  block-size: 56px;
  border-radius: 999px;
  border: 1px solid var(--profile-border);
  background:
    radial-gradient(circle at 28% 24%, rgba(255, 255, 255, 0.24), transparent 44%),
    radial-gradient(circle at 70% 72%, var(--accent-soft), transparent 60%),
    linear-gradient(155deg, var(--surface-strong), var(--surface-soft));
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  font-size: 1.05rem;
  color: var(--profile-text);
  box-shadow: 0 10px 22px rgba(5, 14, 27, 0.32);
  flex-shrink: 0;
}

.profile-avatar-premium {
  position: relative;
  overflow: hidden;
  isolation: isolate;
}

.profile-avatar-orbit {
  position: absolute;
  inset: 6px;
  border-radius: 999px;
  border: 1px solid var(--profile-border);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
}

.profile-avatar-orbit::before {
  content: "";
  position: absolute;
  inset: -5px;
  border-radius: 999px;
  border-top: 1px solid var(--accent);
  border-inline-start: 1px solid var(--accent-soft);
  border-inline-end: 1px solid transparent;
  border-bottom: 1px solid transparent;
  opacity: 0.9;
  animation: profileAvatarSpin 9s linear infinite;
}

.profile-avatar-glyph {
  inline-size: 26px;
  block-size: 26px;
  position: relative;
  z-index: 1;
  fill: none;
  stroke: currentColor;
  stroke-width: 1.7;
  stroke-linecap: round;
  stroke-linejoin: round;
  filter: drop-shadow(0 2px 4px rgba(3, 14, 28, 0.38));
}

@keyframes profileAvatarSpin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.profile-identity-copy {
  min-width: 0;
}

.profile-identity-copy h2 {
  margin: 0;
  font-size: 1.08rem;
  line-height: 1.35;
  letter-spacing: -0.012em;
}

.profile-identity-copy p {
  margin: 5px 0 0;
  font-size: 0.83rem;
  line-height: 1.8;
  color: var(--profile-muted);
}

.profile-save-pill {
  flex-shrink: 0;
  border-radius: 999px;
  border: 1px solid var(--profile-border);
  background: var(--surface-soft);
  color: var(--profile-text);
  font-size: 0.73rem;
  font-weight: 700;
  line-height: 1;
  padding: 8px 10px;
  white-space: nowrap;
}

.profile-save-pill[data-state="saved"] {
  border-color: rgba(118, 221, 178, 0.38);
  background: rgba(19, 56, 46, 0.54);
  color: #9df3ca;
}

.profile-save-pill[data-state="saving"] {
  border-color: rgba(245, 204, 128, 0.42);
  background: rgba(57, 41, 18, 0.56);
  color: #ffd78f;
}

.profile-save-pill[data-state="error"] {
  border-color: rgba(255, 153, 153, 0.42);
  background: rgba(64, 22, 26, 0.62);
  color: #ffb9b9;
}

.profile-greeting-text {
  margin: 14px 0 0;
  border-radius: 14px;
  border: 1px solid var(--profile-border);
  background: var(--surface-soft);
  padding: 12px 14px;
  font-size: 0.94rem;
  line-height: 1.9;
  font-weight: 600;
  color: var(--profile-text);
}

.profile-datetime-pill {
  margin: 12px 0 0;
  display: flex;
  align-items: center;
  gap: 9px;
  flex-wrap: nowrap;
  width: 100%;
  max-width: 100%;
  padding: 9px 11px;
  border-radius: 14px;
  border: 1px solid var(--profile-border);
  background:
    radial-gradient(circle at 14% 20%, var(--accent-soft), transparent 45%),
    linear-gradient(150deg, var(--surface), var(--surface-soft));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06), 0 12px 24px rgba(2, 9, 18, 0.24);
  color: var(--profile-text);
  font-family: "Vazirmatn", "Tahoma", sans-serif;
  letter-spacing: -0.005em;
  white-space: nowrap;
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}

.profile-datetime-pill::-webkit-scrollbar {
  display: none;
}

.profile-datetime-pill::before {
  content: "";
  width: 32px;
  height: 32px;
  border-radius: 11px;
  border: 1px solid var(--profile-border);
  background:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ecf8ff' stroke-width='1.7' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3.8' y='4.8' width='16.4' height='14.4' rx='3'/%3E%3Cpath d='M8 3.2v3M16 3.2v3M3.8 9.2h16.4'/%3E%3Ccircle cx='12' cy='14.2' r='2.8'/%3E%3Cpath d='M12 12.9v1.4l1 .8'/%3E%3C/svg%3E") center / 17px 17px no-repeat,
    radial-gradient(circle at 30% 24%, rgba(255, 255, 255, 0.6), var(--accent-soft) 64%, transparent 72%),
    linear-gradient(165deg, var(--surface-strong), var(--surface-soft));
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.22),
    0 8px 16px rgba(4, 16, 30, 0.3),
    0 0 0 2px var(--accent-soft);
  flex: 0 0 auto;
}

.profile-datetime-day {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-height: 25px;
  padding-inline: 11px;
  border-radius: 999px;
  border: 1px solid rgba(147, 222, 183, 0.54);
  background: linear-gradient(145deg, rgba(126, 236, 184, 0.3), rgba(87, 182, 131, 0.2));
  color: #abf8d2;
  font-size: 0.72rem;
  line-height: 1;
  font-weight: 800;
  white-space: nowrap;
  flex: 0 0 auto;
}

.profile-datetime-main {
  display: inline-flex;
  align-items: center;
  flex-wrap: nowrap;
  gap: 6px;
  color: var(--profile-text);
  font-size: 0.84rem;
  line-height: 1.3;
  font-weight: 700;
  white-space: nowrap;
  flex: 0 0 auto;
}

.profile-datetime-date {
  opacity: 0.97;
}

.profile-datetime-sep {
  opacity: 0.55;
}

.profile-datetime-time {
  direction: rtl;
  unicode-bidi: plaintext;
  font-variant-numeric: tabular-nums lining-nums;
  font-family: "Vazirmatn", "Segoe UI", sans-serif;
  letter-spacing: 0.008em;
}

.profile-datetime-pill:empty {
  display: none;
}

.profile-quick-access {
  margin-top: 12px;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 9px;
}

.profile-quick-card {
  min-width: 0;
  border-radius: 13px;
  border: 1px solid var(--profile-border);
  background:
    radial-gradient(circle at 14% 12%, var(--accent-soft), transparent 44%),
    var(--surface-soft);
  padding: 9px;
  display: grid;
  gap: 8px;
}

.profile-quick-head {
  display: inline-flex;
  align-items: center;
  gap: 7px;
  min-width: 0;
}

.profile-quick-head strong {
  margin: 0;
  font-size: 0.78rem;
  line-height: 1.4;
  color: var(--profile-text);
}

.profile-quick-head-icon {
  width: 22px;
  height: 22px;
  border-radius: 8px;
  border: 1px solid var(--profile-border);
  background: var(--accent-soft);
  color: var(--profile-text);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.profile-quick-head-icon svg {
  width: 13px;
  height: 13px;
  fill: none;
  stroke: currentColor;
  stroke-width: 1.85;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.profile-quick-segment {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.profile-quick-viewport-btn,
.profile-quick-theme-btn {
  min-height: 31px;
  border-radius: 9px;
  border: 1px solid var(--profile-border);
  background: var(--surface-soft);
  color: var(--profile-text);
  font-family: inherit;
  font-size: 0.73rem;
  font-weight: 700;
  line-height: 1;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
  padding: 0 10px;
  transition: border-color 0.2s ease, background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.profile-quick-viewport-btn {
  flex: 1 1 calc(33.333% - 5px);
  min-width: 74px;
}

.profile-quick-theme-btn {
  flex: 1 1 calc(50% - 4px);
  min-width: 90px;
}

.profile-quick-theme-dot {
  width: 10px;
  height: 10px;
  border-radius: 999px;
  border: 1px solid rgba(198, 231, 255, 0.42);
  box-shadow: 0 0 0 1px rgba(5, 14, 24, 0.24);
  flex-shrink: 0;
}

.profile-theme-dot-graphite {
  background: linear-gradient(145deg, #8aa8c2, #3a4d63);
}

.profile-theme-dot-ocean {
  background: linear-gradient(145deg, #6ec9ff, #2d6ea4);
}

.profile-theme-dot-forest {
  background: linear-gradient(145deg, #86dfb3, #2f7a56);
}

.profile-theme-dot-ember {
  background: linear-gradient(145deg, #ffb178, #8a3f2f);
}

.profile-theme-dot-amethyst {
  background: linear-gradient(145deg, #dac2ff, #6f4da8);
}

.profile-theme-dot-espresso {
  background: linear-gradient(145deg, #f1c8a0, #6e4832);
}

.profile-theme-dot-teal {
  background: linear-gradient(145deg, #a7f0e6, #2f7f86);
}

.profile-theme-dot-crimson {
  background: linear-gradient(145deg, #ffc0d5, #8b3f62);
}

.profile-theme-dot-lunar {
  background: linear-gradient(145deg, #f0e6b5, #71839a);
}

.profile-theme-dot-void {
  background: linear-gradient(145deg, #7bcfff, #123f71);
}

.profile-theme-dot-light {
  background: linear-gradient(145deg, #ffffff, #cde6f8);
}

.profile-theme-dot-ice {
  background: linear-gradient(145deg, #f7fdff, #9fd7f4);
}

.profile-quick-viewport-btn:hover,
.profile-quick-theme-btn:hover {
  border-color: var(--accent);
  transform: translateY(-1px);
}

.profile-quick-viewport-btn:focus-visible,
.profile-quick-theme-btn:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(114, 193, 247, 0.23);
}

.profile-quick-viewport-btn.is-active,
.profile-quick-viewport-btn[aria-pressed="true"],
.profile-quick-theme-btn.is-active,
.profile-quick-theme-btn[aria-pressed="true"] {
  border-color: var(--accent);
  background:
    linear-gradient(145deg, var(--accent-soft), transparent),
    var(--surface-strong);
  color: var(--profile-text);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.14);
}

.profile-quick-meta {
  margin: 0;
  min-height: 16px;
  font-size: 0.69rem;
  line-height: 1.45;
  color: var(--profile-muted);
}

.profile-quick-sync-btn {
  grid-column: 1 / -1;
  min-height: 56px;
  border-radius: 13px;
  border: 1px solid var(--profile-border);
  background:
    radial-gradient(circle at 14% 22%, var(--accent-soft), transparent 46%),
    var(--surface-soft);
  color: var(--profile-text);
  display: grid;
  grid-template-columns: 36px minmax(0, 1fr);
  align-items: center;
  gap: 10px;
  padding: 10px;
  text-align: right;
  cursor: pointer;
  transition: border-color 0.22s ease, transform 0.22s ease, box-shadow 0.22s ease, opacity 0.2s ease;
}

.profile-quick-sync-btn:hover {
  border-color: rgba(174, 222, 251, 0.56);
  transform: translateY(-1px);
  box-shadow: 0 10px 18px rgba(4, 15, 27, 0.24);
}

.profile-quick-sync-btn:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(116, 194, 248, 0.24);
}

.profile-quick-sync-btn:disabled {
  cursor: not-allowed;
  opacity: 0.72;
  transform: none;
  box-shadow: none;
}

.profile-quick-sync-icon {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  border: 1px solid var(--profile-border);
  background: var(--accent-soft);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: var(--profile-text);
}

.profile-quick-sync-icon svg {
  width: 17px;
  height: 17px;
  fill: none;
  stroke: currentColor;
  stroke-width: 1.8;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.profile-quick-sync-copy {
  min-width: 0;
  display: grid;
  gap: 3px;
}

.profile-quick-sync-label {
  margin: 0;
  font-size: 0.8rem;
  line-height: 1.4;
  color: var(--profile-text);
}

.profile-quick-sync-state {
  margin: 0;
  font-size: 0.72rem;
  line-height: 1.55;
  color: var(--profile-muted);
}

.profile-quick-sync-btn[data-sync-level="ok"] .profile-quick-sync-state {
  color: #9df3ca;
}

.profile-quick-sync-btn[data-sync-level="warn"] .profile-quick-sync-state {
  color: #ffd78f;
}

.profile-quick-sync-btn[data-sync-level="muted"] .profile-quick-sync-state {
  color: var(--profile-muted);
}

.profile-quick-sync-btn.is-loading .profile-quick-sync-icon {
  position: relative;
}

.profile-quick-sync-btn.is-loading .profile-quick-sync-icon::after {
  content: "";
  position: absolute;
  inset: 7px;
  border-radius: 999px;
  border: 2px solid rgba(219, 242, 255, 0.18);
  border-top-color: rgba(219, 242, 255, 0.9);
  animation: profileQuickSyncSpin 0.8s linear infinite;
}

@keyframes profileQuickSyncSpin {
  to {
    transform: rotate(360deg);
  }
}

@media (max-width: 680px) {
  .profile-quick-access {
    grid-template-columns: 1fr;
  }

  .profile-quick-sync-btn {
    grid-column: auto;
  }
}

@media (max-width: 420px) {
  .profile-quick-card {
    padding: 8px;
  }

  .profile-quick-viewport-btn,
  .profile-quick-theme-btn {
    min-height: 30px;
    font-size: 0.7rem;
  }

  .profile-quick-theme-btn {
    min-width: 80px;
  }
}

.profile-card-headline {
  margin-bottom: 14px;
}

.profile-card-headline h3 {
  margin: 0;
  font-size: 0.98rem;
  line-height: 1.4;
}

.profile-card-headline p {
  margin: 6px 0 0;
  font-size: 0.8rem;
  line-height: 1.75;
  color: var(--profile-muted);
}

.profile-form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 13px;
}

.profile-field {
  min-width: 0;
  display: grid;
  gap: 6px;
}

.profile-field-label {
  font-size: 0.8rem;
  line-height: 1.4;
  font-weight: 700;
  color: var(--profile-text);
}

.profile-required-mark {
  color: #ff8f8f;
  font-size: 0.88rem;
}

.profile-field input,
.profile-field select {
  inline-size: 100%;
  height: var(--profile-control-height);
  min-height: var(--profile-control-height);
  border-radius: 12px;
  border: 1px solid var(--profile-border);
  background: var(--surface-soft);
  color: var(--profile-text);
  padding-inline: 12px;
  padding-block: 0;
  font-family: inherit;
  font-size: 0.93rem;
  line-height: 1.4;
  appearance: none;
  box-sizing: border-box;
}

.profile-field select {
  padding-inline-start: 38px;
  background-image: linear-gradient(45deg, transparent 50%, var(--profile-text) 50%), linear-gradient(135deg, var(--profile-text) 50%, transparent 50%);
  background-position: calc(0% + 14px) 50%, calc(0% + 9px) 50%;
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
}

.profile-field input::placeholder {
  color: var(--profile-muted);
}

.profile-field input:focus,
.profile-field select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--profile-focus);
}

.profile-help-text {
  margin: 0;
  font-size: 0.74rem;
  color: var(--profile-muted);
  line-height: 1.6;
  display: block;
}

.profile-error-text {
  margin: 0;
  font-size: 0.73rem;
  color: #ffb6b6;
  font-weight: 600;
  line-height: 1.5;
  display: block;
}

.profile-field.is-invalid input {
  border-color: rgba(255, 144, 144, 0.64);
  box-shadow: 0 0 0 2px rgba(255, 94, 94, 0.16);
}

.profile-card-data-headline {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 12px;
}

.profile-data-title-wrap {
  min-width: 0;
  display: grid;
  gap: 6px;
}

.profile-data-title-wrap h3 {
  margin: 0;
}

.profile-data-title-wrap p {
  margin: 0;
  font-size: 0.78rem;
  line-height: 1.7;
  color: var(--profile-muted);
}

.profile-data-tag {
  border-radius: 999px;
  border: 1px solid var(--profile-border);
  background: linear-gradient(145deg, var(--surface-strong), var(--surface-soft));
  color: var(--profile-text);
  font-size: 0.68rem;
  line-height: 1;
  padding: 7px 10px;
  font-weight: 700;
  white-space: nowrap;
}

.profile-card-data .profile-data-panel {
  display: grid;
  gap: 12px;
}

.profile-card-data .profile-data-actions {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 9px;
  padding: 12px;
  border-radius: 14px;
  border: 1px solid var(--profile-border);
  background:
    radial-gradient(circle at 12% 16%, var(--accent-soft), transparent 46%),
    var(--surface-soft);
}

.profile-card-data .profile-data-actions .glass-btn {
  min-height: 42px;
  border-radius: 11px;
  border-color: var(--profile-border);
  background: linear-gradient(145deg, var(--surface-strong), var(--surface-soft));
}

.profile-card-data .profile-data-actions .glass-btn:hover {
  border-color: var(--accent);
}

.profile-card-data .profile-data-editor {
  border-radius: 14px;
  border: 1px solid var(--profile-border);
  background:
    radial-gradient(circle at 85% 12%, var(--accent-soft), transparent 48%),
    var(--surface-soft);
  padding: 12px;
}

.profile-card-data .profile-v2-json-label {
  margin: 0 0 8px;
  font-size: 0.79rem;
  color: var(--profile-text);
  font-weight: 700;
  display: block;
}

.profile-card-data #jsonImportText {
  width: 100%;
  min-height: 160px;
  border-radius: 13px;
  border: 1px solid var(--profile-border);
  background: var(--surface-soft);
  color: var(--profile-text);
  padding: 11px 12px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size: 0.8rem;
  line-height: 1.7;
  resize: vertical;
}

.profile-card-data #jsonImportText:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(114, 193, 247, 0.24);
}

.profile-card-data .profile-v2-json-actions {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 9px;
  margin-top: 10px;
}

.profile-card-data .profile-v2-json-actions .glass-btn {
  min-height: 42px;
  border-radius: 11px;
}

.profile-card-data .profile-data-notes {
  margin-top: 10px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.profile-card-data .profile-data-note-chip {
  display: inline-flex;
  align-items: center;
  min-height: 26px;
  padding-inline: 10px;
  border-radius: 999px;
  border: 1px solid var(--profile-border);
  background: var(--surface-soft);
  color: var(--profile-text);
  font-size: 0.74rem;
  font-weight: 700;
  line-height: 1;
}

@media (min-width: 700px) {
  .profile-card {
    padding: 18px;
  }

  .profile-form-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .profile-field-semester {
    grid-column: 1 / -1;
  }

  .profile-card-data .profile-data-panel {
    gap: 14px;
  }

  .profile-card-form .profile-help-text,
  .profile-card-form .profile-error-text {
    min-height: 2.5em;
  }
}

@media (min-width: 980px) {
  .profile-hub-grid {
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    grid-template-areas:
      "identity form"
      "data data";
    align-items: stretch;
  }

  .profile-card-identity {
    grid-area: identity;
  }

  .profile-card-form {
    grid-area: form;
  }

  .profile-card-data {
    grid-area: data;
  }

  .profile-identity-copy h2 {
    font-size: 1.22rem;
  }

  .profile-card-data .profile-v2-actions {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .profile-card-data .profile-data-panel {
    grid-template-columns: minmax(240px, 0.9fr) minmax(0, 1.1fr);
    align-items: stretch;
  }

  .profile-card-identity,
  .profile-card-form {
    height: 100%;
  }
}

@media (min-width: 1280px) {
  .profile-hub-grid {
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    grid-template-areas:
      "identity form"
      "data data";
    align-items: stretch;
  }

  .profile-form-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }

  .profile-field-semester {
    grid-column: auto;
  }

  .profile-card-identity,
  .profile-card-form {
    height: 100%;
  }
}

@media (max-width: 560px) {
  .profile-card-data .profile-data-actions,
  .profile-card-data .profile-v2-json-actions {
    grid-template-columns: 1fr;
  }

  .profile-card-data .profile-data-panel,
  .profile-card-data .profile-data-editor {
    padding: 10px;
  }
}

html[data-theme^="light-"] .profile-hub {
  --profile-bg: linear-gradient(145deg, rgba(241, 248, 255, 0.95), rgba(226, 241, 253, 0.92));
  --profile-border: rgba(95, 143, 175, 0.26);
  --profile-text: #163a58;
  --profile-muted: rgba(37, 78, 111, 0.86);
  --profile-focus: rgba(52, 138, 196, 0.28);
}

html[data-theme^="light-"] .profile-hub .profile-avatar-circle {
  color: #114160;
  border-color: rgba(87, 138, 174, 0.36);
}

html[data-theme^="light-"] .profile-hub .profile-avatar-orbit {
  border-color: rgba(82, 137, 173, 0.34);
}

html[data-theme^="light-"] .profile-hub .profile-avatar-glyph {
  stroke: #1f5b84;
}

html[data-theme^="light-"] .profile-hub .profile-greeting-text,
html[data-theme^="light-"] .profile-hub .profile-field input,
html[data-theme^="light-"] .profile-hub .profile-field select,
html[data-theme^="light-"] .profile-hub .profile-card-data #jsonImportText {
  background: rgba(255, 255, 255, 0.88);
  color: #194262;
}

html[data-theme^="light-"] .profile-hub .profile-data-title-wrap p {
  color: rgba(39, 82, 114, 0.84);
}

html[data-theme^="light-"] .profile-hub .profile-data-tag {
  border-color: rgba(109, 164, 200, 0.34);
  background: linear-gradient(145deg, rgba(225, 241, 252, 0.95), rgba(212, 232, 248, 0.9));
  color: #2b6288;
}

html[data-theme^="light-"] .profile-hub .profile-card-data .profile-data-actions,
html[data-theme^="light-"] .profile-hub .profile-card-data .profile-data-editor {
  border-color: rgba(114, 168, 202, 0.26);
  background:
    radial-gradient(circle at 12% 16%, rgba(138, 202, 240, 0.14), transparent 46%),
    rgba(243, 250, 255, 0.9);
}

html[data-theme^="light-"] .profile-hub .profile-card-data .profile-data-actions .glass-btn {
  border-color: rgba(119, 171, 205, 0.34);
  background: linear-gradient(145deg, rgba(236, 248, 255, 0.94), rgba(218, 237, 251, 0.9));
  color: #1d4b6f;
}

html[data-theme^="light-"] .profile-hub .profile-card-data .profile-v2-json-label {
  color: #255575;
}

html[data-theme^="light-"] .profile-hub .profile-card-data .profile-data-note-chip {
  border-color: rgba(120, 171, 205, 0.32);
  background: rgba(227, 243, 255, 0.86);
  color: #1f587d;
}

html[data-theme^="light-"] .profile-hub .profile-quick-card,
html[data-theme^="light-"] .profile-hub .profile-quick-sync-btn {
  border-color: rgba(112, 165, 201, 0.28);
  background:
    radial-gradient(circle at 14% 12%, rgba(129, 200, 240, 0.16), transparent 44%),
    rgba(241, 250, 255, 0.9);
}

html[data-theme^="light-"] .profile-hub .profile-quick-head strong,
html[data-theme^="light-"] .profile-hub .profile-quick-sync-label {
  color: #225273;
}

html[data-theme^="light-"] .profile-hub .profile-quick-head-icon,
html[data-theme^="light-"] .profile-hub .profile-quick-sync-icon {
  border-color: rgba(118, 172, 205, 0.34);
  background: rgba(127, 189, 226, 0.2);
  color: #2b6288;
}

html[data-theme^="light-"] .profile-hub .profile-quick-viewport-btn,
html[data-theme^="light-"] .profile-hub .profile-quick-theme-btn {
  border-color: rgba(120, 173, 207, 0.32);
  background: rgba(255, 255, 255, 0.9);
  color: #26587d;
}

html[data-theme^="light-"] .profile-hub .profile-quick-viewport-btn.is-active,
html[data-theme^="light-"] .profile-hub .profile-quick-viewport-btn[aria-pressed="true"],
html[data-theme^="light-"] .profile-hub .profile-quick-theme-btn.is-active,
html[data-theme^="light-"] .profile-hub .profile-quick-theme-btn[aria-pressed="true"] {
  border-color: rgba(74, 150, 200, 0.56);
  background:
    linear-gradient(145deg, rgba(139, 204, 238, 0.34), rgba(110, 183, 228, 0.26)),
    rgba(255, 255, 255, 0.95);
  color: #1f4d70;
}

html[data-theme^="light-"] .profile-hub .profile-quick-meta,
html[data-theme^="light-"] .profile-hub .profile-quick-sync-state {
  color: rgba(43, 90, 124, 0.82);
}

html[data-theme^="light-"] .profile-hub .profile-quick-theme-dot {
  border-color: rgba(97, 153, 190, 0.42);
  box-shadow: 0 0 0 1px rgba(137, 184, 214, 0.28);
}

html[data-theme^="light-"] .profile-hub .profile-datetime-pill {
  border-color: rgba(111, 164, 198, 0.3);
  background:
    radial-gradient(circle at 16% 20%, rgba(113, 190, 236, 0.18), transparent 45%),
    linear-gradient(150deg, rgba(246, 252, 255, 0.96), rgba(233, 246, 255, 0.92));
  color: #225577;
}

html[data-theme^="light-"] .profile-hub .profile-datetime-pill::before {
  border-color: rgba(101, 160, 196, 0.34);
  background:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2321577b' stroke-width='1.7' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3.8' y='4.8' width='16.4' height='14.4' rx='3'/%3E%3Cpath d='M8 3.2v3M16 3.2v3M3.8 9.2h16.4'/%3E%3Ccircle cx='12' cy='14.2' r='2.8'/%3E%3Cpath d='M12 12.9v1.4l1 .8'/%3E%3C/svg%3E") center / 17px 17px no-repeat,
    radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.96), rgba(136, 200, 236, 0.4) 60%, transparent 70%),
    rgba(169, 216, 243, 0.56);
}

html[data-theme^="light-"] .profile-hub .profile-datetime-day {
  border-color: rgba(76, 170, 122, 0.42);
  background: linear-gradient(145deg, rgba(142, 234, 187, 0.3), rgba(110, 198, 152, 0.24));
  color: #1f7650;
}

html[data-theme^="light-"] .profile-hub .profile-datetime-main {
  color: #225577;
}

@media (max-width: 520px) {
  .profile-datetime-pill {
    padding: 8px 10px;
    gap: 8px;
  }

  .profile-datetime-pill::before {
    width: 30px;
    height: 30px;
    border-radius: 10px;
  }

  .profile-datetime-day {
    min-height: 23px;
    padding-inline: 9px;
    font-size: 0.69rem;
  }

  .profile-datetime-main {
    font-size: 0.79rem;
  }
}

@media (prefers-reduced-motion: reduce) {
  .profile-hub *,
  .profile-hub *::before,
  .profile-hub *::after {
    transition: none !important;
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
  }

  .profile-avatar-orbit::before {
    animation: none !important;
  }
}

/* Review status system */
.qb-filter-actions {
  grid-template-columns: minmax(260px, 1fr) auto auto auto auto;
}

.qb-review-wrap {
  display: grid;
  gap: 6px;
  min-width: 190px;
  padding: 6px 7px;
  border-radius: 12px;
  border: 1px solid rgba(145, 178, 206, 0.24);
  background: rgba(127, 127, 127, 0.08);
}

.qb-review-label {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 0.72rem;
  color: var(--text-muted);
}

.qb-review-label svg {
  width: 12px;
  height: 12px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.qb-review-group {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 4px;
}

.qb-review-chip {
  min-height: 24px;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid rgba(145, 178, 206, 0.28);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-muted);
  font-size: 0.68rem;
  font-weight: 700;
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, color 0.2s ease;
}

.qb-review-chip:hover {
  transform: translateY(-1px);
  border-color: rgba(93, 182, 242, 0.44);
  color: var(--text-main);
}

.qb-review-chip.is-active {
  border-color: rgba(116, 213, 255, 0.78);
  background: linear-gradient(145deg, rgba(99, 196, 248, 0.26), rgba(99, 196, 248, 0.1));
  color: #fff;
}

.qb-review-counters {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 4px;
}

.qb-review-counter {
  min-height: 20px;
  padding: 1px 6px;
  border-radius: 999px;
  border: 1px solid rgba(145, 178, 206, 0.26);
  background: rgba(127, 127, 127, 0.1);
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.qb-review-counter em {
  font-style: normal;
  font-size: 0.63rem;
  color: var(--text-muted);
}

.qb-review-counter strong {
  font-size: 0.67rem;
  color: var(--text-main);
}

.question-card:focus-visible {
  outline: none;
  border-color: rgba(118, 207, 255, 0.66);
  box-shadow: 0 0 0 3px rgba(118, 207, 255, 0.2), 0 14px 28px rgba(5, 10, 16, 0.3);
}

.question-review-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-height: 24px;
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid rgba(145, 178, 206, 0.3);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-main);
  font-size: 0.67rem;
  font-weight: 800;
  letter-spacing: 0.01em;
}

.question-review-badge.is-review {
  border-color: rgba(255, 132, 156, 0.46);
  background: linear-gradient(145deg, rgba(255, 132, 156, 0.24), rgba(255, 132, 156, 0.08));
  color: #ffd5df;
}

.question-review-badge.is-key {
  border-color: rgba(255, 204, 112, 0.46);
  background: linear-gradient(145deg, rgba(255, 204, 112, 0.24), rgba(255, 204, 112, 0.08));
  color: #ffe8ba;
}

.question-review-badge.is-mastered {
  border-color: rgba(110, 228, 175, 0.5);
  background: linear-gradient(145deg, rgba(110, 228, 175, 0.24), rgba(110, 228, 175, 0.08));
  color: #d4ffeb;
}

.question-review-tools {
  margin-top: 9px;
  padding: 8px;
  border-radius: 12px;
  border: 1px solid rgba(138, 172, 201, 0.24);
  background:
    radial-gradient(circle at 88% 8%, rgba(102, 189, 245, 0.12), transparent 34%),
    linear-gradient(152deg, rgba(127, 127, 127, 0.1), rgba(127, 127, 127, 0.05));
}

.question-review-row {
  display: grid;
  grid-template-columns: auto minmax(0, 1fr) auto;
  align-items: center;
  gap: 8px;
}

.question-review-title {
  font-size: 0.74rem;
  color: var(--text-muted);
  font-weight: 700;
  white-space: nowrap;
}

.question-review-group {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 5px;
}

.question-review-btn {
  min-height: 28px;
  padding: 3px 9px;
  border-radius: 999px;
  border: 1px solid rgba(145, 178, 206, 0.3);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-muted);
  font-size: 0.7rem;
  font-weight: 700;
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, color 0.2s ease;
}

.question-review-btn:hover {
  transform: translateY(-1px);
  border-color: rgba(95, 189, 247, 0.48);
  color: var(--text-main);
}

.question-review-btn.is-active {
  border-color: rgba(112, 206, 255, 0.74);
  background: linear-gradient(145deg, rgba(96, 188, 246, 0.28), rgba(96, 188, 246, 0.1));
  color: #fff;
}

.question-review-note-toggle {
  min-height: 28px;
  padding: 3px 10px;
  border-radius: 999px;
  border: 1px solid rgba(145, 178, 206, 0.3);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-muted);
  font-size: 0.69rem;
  font-weight: 700;
}

.question-review-note-toggle.is-active {
  border-color: rgba(112, 206, 255, 0.64);
  color: var(--text-main);
}

.question-review-note-toggle:disabled {
  opacity: 0.42;
  cursor: not-allowed;
}

.question-review-note {
  margin-top: 7px;
  display: grid;
  gap: 5px;
}

.question-review-note[hidden] {
  display: none;
}

.question-review-note-input {
  width: 100%;
  min-height: 62px;
  padding: 7px 9px;
  border-radius: 10px;
  border: 1px solid rgba(145, 178, 206, 0.28);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-main);
  line-height: 1.6;
  resize: vertical;
}

.question-review-note-input:focus {
  border-color: rgba(103, 197, 250, 0.62);
  box-shadow: 0 0 0 3px rgba(103, 197, 250, 0.16);
}

.question-review-note-input:disabled {
  opacity: 0.5;
}

.question-review-note-meta {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.question-review-note-status {
  min-height: 16px;
  font-size: 0.66rem;
  color: var(--text-muted);
}

.question-review-note-status[data-state="saving"] {
  color: #9fd7ff;
}

.question-review-note-status[data-state="saved"] {
  color: #92f1c0;
}

.question-review-note-status[data-state="error"] {
  color: #ffb1c0;
}

.question-review-note-chars {
  font-size: 0.63rem;
  color: var(--text-muted);
  letter-spacing: 0.02em;
}

html[data-theme^="light-"] .qb-review-wrap,
html[data-theme^="light-"] .question-review-tools {
  border-color: rgba(47, 82, 111, 0.22);
  background: rgba(255, 255, 255, 0.84);
}

html[data-theme^="light-"] .qb-review-chip,
html[data-theme^="light-"] .question-review-btn,
html[data-theme^="light-"] .question-review-note-toggle {
  border-color: rgba(47, 130, 193, 0.24);
  background: rgba(255, 255, 255, 0.88);
  color: #4e6c86;
}

html[data-theme^="light-"] .qb-review-chip.is-active,
html[data-theme^="light-"] .question-review-btn.is-active {
  background: linear-gradient(145deg, rgba(47, 130, 193, 0.24), rgba(47, 130, 193, 0.09));
  color: #154769;
}

html[data-theme^="light-"] .question-review-note-input {
  border-color: rgba(47, 130, 193, 0.24);
  background: rgba(255, 255, 255, 0.9);
  color: #163f5e;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode :is(.qb-topic-wrap, .qb-solved-wrap, .qb-review-wrap, .qb-sort-wrap) {
  width: 100% !important;
  min-width: 0 !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode :is(.qb-topic-quick, .qb-solved-group, .qb-review-group, .qb-sort-group, .qb-pill-group) {
  display: flex !important;
  flex-wrap: nowrap !important;
  overflow-x: auto !important;
}

:is(body.force-mobile, body.auto-mobile) .qb-filter-bar.qb-filter-pill-mode :is(.qb-topic-quick-btn, .qb-solved-chip, .qb-review-chip, .qb-sort-chip, .qb-pill) {
  flex: 0 0 auto !important;
}

:is(body.force-mobile, body.auto-mobile) .question-review-row {
  grid-template-columns: 1fr;
  align-items: start;
}

:is(body.force-mobile, body.auto-mobile) .question-review-group {
  overflow-x: auto;
  white-space: nowrap;
  padding-bottom: 2px;
}

:is(body.force-mobile, body.auto-mobile) .question-review-btn {
  min-height: 30px;
}

@media (prefers-reduced-motion: reduce) {
  .question-review-btn,
  .qb-review-chip,
  .question-review-note-toggle {
    transition: none !important;
  }
}

/* Question-bank filter panel layout v2 */
.qb-filter-layout-v2 {
  gap: 12px;
  padding: 12px;
}

.qb-filter-layout-v2 .qb-filter-row-primary {
  display: grid;
  grid-template-columns: minmax(320px, 1.2fr) auto;
  align-items: center;
  gap: 10px;
}

.qb-filter-layout-v2 .qb-search-wrap-primary {
  min-width: 0;
  width: 100%;
}

.qb-filter-layout-v2 .qb-filter-row-actions {
  display: inline-flex;
  align-items: center;
  justify-self: end;
  flex-wrap: wrap;
  gap: 8px;
}

.qb-filter-layout-v2 .qb-filter-active-count {
  min-height: 30px;
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid rgba(145, 178, 206, 0.28);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-muted);
  display: inline-flex;
  align-items: center;
  font-size: 0.72rem;
  font-weight: 700;
  white-space: nowrap;
}

.qb-filter-layout-v2 .qb-filter-active-toggle {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  cursor: pointer;
  gap: 7px;
  justify-content: center;
  transition: border-color 0.18s ease, background-color 0.18s ease, color 0.18s ease, transform 0.18s ease;
}

.qb-filter-layout-v2 .qb-filter-active-toggle > span {
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
}

.qb-filter-layout-v2 .qb-filter-active-toggle .qb-filter-toggle-caret {
  width: 7px;
  height: 7px;
  border-inline-end: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: rotate(45deg);
  margin-top: -2px;
  opacity: 0.88;
  flex: 0 0 auto;
  transition: transform 0.18s ease, opacity 0.18s ease;
}

.qb-filter-layout-v2 .qb-filter-active-toggle[aria-expanded="true"] .qb-filter-toggle-caret {
  transform: rotate(225deg);
}

.qb-filter-layout-v2 .qb-filter-active-toggle:disabled {
  cursor: default;
  opacity: 0.72;
}

.qb-filter-layout-v2 .qb-filter-active-toggle:not(:disabled):hover {
  border-color: rgba(149, 202, 236, 0.42);
  background: rgba(127, 127, 127, 0.12);
  color: var(--text-main);
}

.qb-filter-layout-v2 .qb-clear-btn-compact {
  min-height: 34px;
  padding-inline: 12px;
  border-radius: 10px;
}

.qb-filter-layout-v2 .qb-filter-panel-toggle {
  min-height: 30px;
  padding-inline: 10px;
}

.qb-filter-layout-v2 .qb-filter-collapse-body {
  display: grid;
  gap: 12px;
}

.qb-filter-layout-v2 .qb-filter-collapse-body[hidden],
.qb-filter-layout-v2 .qb-filter-collapse-body.is-collapsed {
  display: none !important;
}

.qb-filter-layout-v2 .qb-active-chips-row {
  min-height: 30px;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 6px;
  padding: 2px 2px 1px;
}

.qb-filter-layout-v2 .qb-active-chips-row[hidden],
.qb-filter-layout-v2 .qb-active-chips-row.is-collapsed {
  display: none !important;
}

.qb-filter-layout-v2 .qb-active-chips-row.is-empty {
  opacity: 0.92;
}

.qb-filter-layout-v2 .qb-active-chip-placeholder {
  font-size: 0.72rem;
  color: var(--text-muted);
}

.qb-filter-layout-v2 .qb-active-chip {
  min-height: 28px;
  padding: 3px 8px 3px 7px;
  border-radius: 999px;
  border: 1px solid rgba(144, 197, 232, 0.4);
  background: linear-gradient(145deg, rgba(90, 188, 246, 0.2), rgba(90, 188, 246, 0.07));
  color: #e5f6ff;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 0.68rem;
  font-weight: 700;
}

.qb-filter-layout-v2 .qb-active-chip i {
  font-style: normal;
  font-size: 0.86rem;
  line-height: 1;
  opacity: 0.86;
}

.qb-filter-layout-v2 .qb-filter-groups-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(220px, 1fr));
  gap: 12px;
  align-items: stretch;
}

.qb-filter-layout-v2 .qb-filter-group-card {
  min-height: 132px;
  border-radius: 13px;
  border: 1px solid rgba(145, 178, 206, 0.24);
  background:
    radial-gradient(circle at 10% 12%, rgba(102, 189, 245, 0.14), transparent 38%),
    linear-gradient(152deg, rgba(127, 127, 127, 0.1), rgba(127, 127, 127, 0.04));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
  padding: 12px;
  display: grid;
  grid-template-rows: auto 1fr;
  gap: 10px;
}

.qb-filter-layout-v2 .qb-filter-group-card.is-wide {
  grid-column: 1 / -1;
  min-height: 148px;
}

.qb-filter-layout-v2 .qb-lux-triple-card,
.qb-filter-layout-v2 .qb-lux-triple-card.is-wide {
  display: block;
  min-height: auto;
  padding: 10px;
  border-radius: 14px;
  border-color: rgba(131, 181, 216, 0.3);
  background:
    radial-gradient(circle at 9% 12%, rgba(108, 198, 252, 0.2), transparent 46%),
    linear-gradient(152deg, rgba(16, 29, 43, 0.54), rgba(10, 21, 33, 0.34));
  box-shadow: 0 12px 24px rgba(5, 12, 19, 0.24), inset 0 1px 0 rgba(255, 255, 255, 0.06);
}

.qb-filter-layout-v2 .qb-lux-triple-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 10px;
}

.qb-filter-layout-v2 .qb-lux-filter-panel {
  --lux-accent: rgba(114, 206, 255, 0.88);
  --lux-fill-a: rgba(114, 206, 255, 0.34);
  --lux-fill-b: rgba(114, 206, 255, 0.12);
  position: relative;
  min-height: 92px;
  border-radius: 12px;
  border: 1px solid rgba(138, 177, 205, 0.24);
  background:
    radial-gradient(circle at 88% 8%, rgba(116, 206, 255, 0.12), transparent 40%),
    linear-gradient(150deg, rgba(13, 24, 35, 0.78), rgba(10, 20, 30, 0.58));
  padding: 10px 10px 9px;
  display: grid;
  align-content: start;
  gap: 8px;
  overflow: hidden;
}

.qb-filter-layout-v2 .qb-lux-filter-panel::before {
  content: "";
  position: absolute;
  top: 0;
  right: 14px;
  left: 14px;
  height: 2px;
  border-radius: 999px;
  background: linear-gradient(90deg, transparent, var(--lux-accent), transparent);
  opacity: 0.9;
}

.qb-filter-layout-v2 .qb-lux-filter-panel.is-solved {
  --lux-accent: rgba(115, 227, 173, 0.9);
  --lux-fill-a: rgba(115, 227, 173, 0.34);
  --lux-fill-b: rgba(115, 227, 173, 0.12);
}

.qb-filter-layout-v2 .qb-lux-filter-panel.is-review {
  --lux-accent: rgba(255, 201, 110, 0.9);
  --lux-fill-a: rgba(255, 201, 110, 0.34);
  --lux-fill-b: rgba(255, 201, 110, 0.12);
}

.qb-filter-layout-v2 .qb-lux-filter-head {
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
  min-width: 0;
}

.qb-filter-layout-v2 .qb-lux-filter-title-wrap {
  display: grid;
  gap: 3px;
  min-width: 0;
}

.qb-filter-layout-v2 .qb-lux-filter-title {
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 0.75rem;
  color: var(--text-main);
  font-weight: 800;
}

.qb-filter-layout-v2 .qb-lux-filter-title svg {
  width: 12px;
  height: 12px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.qb-filter-layout-v2 .qb-lux-filter-subtitle {
  display: inline-flex;
  align-items: center;
  min-height: 18px;
  max-width: 100%;
  width: fit-content;
  padding: 1px 7px;
  border-radius: 999px;
  border: 1px solid rgba(136, 176, 205, 0.28);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-muted);
  font-size: 0.62rem;
  font-weight: 700;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.qb-filter-layout-v2 .qb-lux-filter-controls {
  display: flex;
  align-items: center;
  min-width: 0;
}

.qb-filter-layout-v2 .qb-lux-filter-panel :is(.qb-sort-group, .qb-solved-group, .qb-review-group) {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  min-width: 0;
}

.qb-filter-layout-v2 .qb-lux-filter-panel :is(.qb-sort-chip, .qb-solved-chip, .qb-review-chip) {
  min-height: 26px;
  padding: 2px 9px;
  border-radius: 999px;
  border: 1px solid rgba(140, 184, 214, 0.34);
  background: rgba(9, 20, 31, 0.42);
  color: #d9edf9;
  font-size: 0.67rem;
  font-weight: 700;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.07);
  transition: transform 0.18s ease, border-color 0.18s ease, background-color 0.18s ease, color 0.18s ease;
}

.qb-filter-layout-v2 .qb-lux-filter-panel .qb-sort-chip svg {
  width: 11px;
  height: 11px;
}

.qb-filter-layout-v2 .qb-lux-filter-panel :is(.qb-sort-chip, .qb-solved-chip, .qb-review-chip):hover {
  transform: translateY(-1px);
  border-color: rgba(145, 211, 255, 0.64);
}

.qb-filter-layout-v2 .qb-lux-filter-panel :is(.qb-sort-chip.is-active, .qb-solved-chip.is-active, .qb-review-chip.is-active) {
  border-color: var(--lux-accent);
  background: linear-gradient(145deg, var(--lux-fill-a), var(--lux-fill-b));
  color: #ffffff;
  box-shadow: 0 8px 16px rgba(5, 15, 24, 0.26), inset 0 1px 0 rgba(255, 255, 255, 0.12);
}

.qb-filter-layout-v2 .qb-lux-filter-foot {
  display: flex;
  align-items: center;
  gap: 5px;
}

.qb-filter-layout-v2 .qb-lux-filter-foot .qb-review-counters {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

.qb-filter-layout-v2 .qb-lux-filter-foot .qb-review-counter {
  min-height: 18px;
  padding: 1px 6px;
}

.qb-filter-layout-v2 .qb-lux-filter-foot .qb-review-counter em {
  font-size: 0.6rem;
}

.qb-filter-layout-v2 .qb-lux-filter-foot .qb-review-counter strong {
  font-size: 0.64rem;
}

.qb-filter-layout-v2 .qb-filter-group-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.qb-filter-layout-v2 .qb-filter-group-title {
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 0.78rem;
  color: var(--text-main);
  font-weight: 800;
}

.qb-filter-layout-v2 .qb-filter-group-title svg {
  width: 13px;
  height: 13px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.qb-filter-layout-v2 .qb-filter-group-body {
  display: grid;
  align-content: start;
  gap: 10px;
}

.qb-filter-layout-v2 :is(.qb-sort-group, .qb-solved-group, .qb-review-group) {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.qb-filter-layout-v2 .qb-filter-review-body {
  display: grid;
  gap: 9px;
}

.qb-filter-layout-v2 .qb-filter-topic-body {
  display: grid;
  gap: 7px;
}

.qb-filter-layout-v2 .qb-filter-topic-select-wrap {
  display: grid;
  gap: 5px;
}

.qb-filter-layout-v2 .qb-filter-topic-select-label {
  font-size: 0.72rem;
  color: var(--text-muted);
  font-weight: 700;
}

.qb-filter-layout-v2 .qb-topic-select {
  min-height: 34px;
  border-radius: 10px;
}

.qb-filter-layout-v2 .qb-topic-quick {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.qb-filter-layout-v2 .qb-filter-difficulty-strip {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 9px;
  width: 100%;
  border: 1px solid rgba(145, 178, 206, 0.24);
  border-radius: 13px;
  padding: 9px 11px;
  background: rgba(127, 127, 127, 0.08);
}

.qb-filter-layout-v2 .qb-filter-strip-label {
  font-size: 0.78rem;
  color: var(--text-main);
  font-weight: 800;
  white-space: nowrap;
}

.qb-filter-layout-v2 .qb-pill-group {
  justify-content: flex-start;
}

html[data-theme^="light-"] .qb-filter-layout-v2 .qb-filter-group-card,
html[data-theme^="light-"] .qb-filter-layout-v2 .qb-filter-difficulty-strip {
  border-color: rgba(47, 82, 111, 0.22);
  background: rgba(255, 255, 255, 0.86);
}

html[data-theme^="light-"] .qb-filter-layout-v2 .qb-lux-triple-card {
  border-color: rgba(47, 82, 111, 0.22);
  background:
    radial-gradient(circle at 9% 12%, rgba(47, 130, 193, 0.16), transparent 46%),
    linear-gradient(152deg, rgba(255, 255, 255, 0.94), rgba(245, 251, 255, 0.9));
}

html[data-theme^="light-"] .qb-filter-layout-v2 .qb-lux-filter-panel {
  border-color: rgba(47, 82, 111, 0.22);
  background:
    radial-gradient(circle at 88% 8%, rgba(47, 130, 193, 0.12), transparent 40%),
    linear-gradient(150deg, rgba(255, 255, 255, 0.96), rgba(246, 251, 255, 0.92));
}

html[data-theme^="light-"] .qb-filter-layout-v2 .qb-lux-filter-subtitle {
  border-color: rgba(47, 82, 111, 0.24);
  background: rgba(255, 255, 255, 0.92);
  color: #4b6a84;
}

html[data-theme^="light-"] .qb-filter-layout-v2 .qb-lux-filter-panel :is(.qb-sort-chip, .qb-solved-chip, .qb-review-chip) {
  border-color: rgba(47, 130, 193, 0.24);
  background: rgba(255, 255, 255, 0.9);
  color: #245779;
}

html[data-theme^="light-"] .qb-filter-layout-v2 .qb-filter-active-count {
  border-color: rgba(47, 82, 111, 0.24);
  background: rgba(255, 255, 255, 0.88);
  color: #4a6983;
}

html[data-theme^="light-"] .qb-filter-layout-v2 .qb-active-chip {
  border-color: rgba(47, 130, 193, 0.32);
  background: linear-gradient(145deg, rgba(47, 130, 193, 0.2), rgba(47, 130, 193, 0.07));
  color: #1c4e73;
}

@media (max-width: 1180px) {
  .qb-filter-layout-v2 .qb-filter-row-primary {
    grid-template-columns: 1fr;
  }

  .qb-filter-layout-v2 .qb-filter-row-actions {
    justify-self: start;
  }
}

@media (max-width: 980px) {
  .qb-filter-layout-v2 .qb-filter-groups-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .qb-filter-layout-v2 .qb-lux-triple-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .qb-filter-layout-v2 .qb-lux-filter-panel.is-review {
    grid-column: 1 / -1;
  }
}

@media (max-width: 760px) {
  .qb-filter-layout-v2 {
    gap: 10px;
    padding: 10px;
  }

  .qb-filter-layout-v2 .qb-filter-row-actions {
    width: 100%;
  }

  .qb-filter-layout-v2 .qb-filter-groups-grid {
    grid-template-columns: 1fr;
  }

  .qb-filter-layout-v2 .qb-filter-group-card,
  .qb-filter-layout-v2 .qb-filter-group-card.is-wide {
    grid-column: auto;
    min-height: auto;
  }

  .qb-filter-layout-v2 .qb-lux-triple-grid {
    grid-template-columns: 1fr;
    gap: 8px;
  }

  .qb-filter-layout-v2 .qb-lux-filter-panel.is-review {
    grid-column: auto;
  }

  .qb-filter-layout-v2 .qb-filter-difficulty-strip {
    flex-direction: column;
    align-items: flex-start;
  }

  .qb-filter-layout-v2 .qb-lux-filter-panel :is(.qb-sort-group, .qb-solved-group, .qb-review-group) {
    flex-wrap: nowrap;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    padding-bottom: 2px;
  }

  .qb-filter-layout-v2 .qb-lux-filter-panel :is(.qb-sort-chip, .qb-solved-chip, .qb-review-chip) {
    flex: 0 0 auto;
    min-height: 25px;
    font-size: 0.66rem;
  }
}

/* Mobile lightweight performance mode */
:is(body.force-mobile, body.auto-mobile) {
  overflow-x: hidden;
  overflow-x: clip;
}

:is(body.force-mobile, body.auto-mobile) .app-shell,
:is(body.force-mobile, body.auto-mobile) .surface,
:is(body.force-mobile, body.auto-mobile) .qb-filter-bar,
:is(body.force-mobile, body.auto-mobile) .question-card,
:is(body.force-mobile, body.auto-mobile) .practice-question-card,
:is(body.force-mobile, body.auto-mobile) .exam-paper,
:is(body.force-mobile, body.auto-mobile) .exam-paper-item,
:is(body.force-mobile, body.auto-mobile) .profile-surface,
:is(body.force-mobile, body.auto-mobile) .settings-panel-layout {
  min-width: 0;
}

:is(body.force-mobile, body.auto-mobile) :is(
  input[type="text"],
  input[type="search"],
  input[type="number"],
  input[type="email"],
  input[type="password"],
  select,
  textarea
) {
  font-size: 16px;
}

:is(body.force-mobile, body.auto-mobile) :is(
  .question-card,
  .practice-question-card,
  .exam-paper-item,
  .chapter-map-legend-item,
  .qb-filter-group-card,
  .qb-lux-filter-panel
) {
  content-visibility: auto;
  contain-intrinsic-size: 240px;
}

:is(body.force-mobile, body.auto-mobile).mobile-lite :is(
  .surface,
  .topbar.premium-topbar,
  .qb-filter-bar,
  .qb-filter-layout-v2 .qb-lux-filter-panel,
  .qb-filter-layout-v2 .qb-lux-triple-card,
  .question-card,
  .practice-question-card,
  .exam-paper,
  .exam-paper-item,
  .profile-surface,
  .settings-panel-layout,
  .question-review-tools,
  .chapter-map-stage,
  .chapter-map-legend
) {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  box-shadow: none !important;
}

:is(body.force-mobile, body.auto-mobile).mobile-lite :is(
  .topbar.premium-topbar,
  .qb-filter-bar,
  .qb-filter-layout-v2 .qb-lux-filter-panel,
  .qb-filter-layout-v2 .qb-lux-triple-card,
  .question-card,
  .practice-question-card,
  .exam-paper,
  .profile-surface,
  .settings-panel-layout,
  .chapter-map-stage,
  .chapter-map-legend,
  .question-review-tools
) {
  background-image: none !important;
}

:is(body.force-mobile, body.auto-mobile).mobile-lite .question-float-timer {
  width: 72px;
  height: 72px;
  border-radius: 18px;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 10px);
  left: 8px;
  transition-duration: 0.14s !important;
}

:is(body.force-mobile, body.auto-mobile).mobile-lite .question-float-core {
  border-radius: 14px;
  background:
    linear-gradient(152deg, rgba(9, 18, 28, 0.94), rgba(10, 20, 30, 0.9)),
    rgba(10, 20, 30, 0.92);
}

:is(body.force-mobile, body.auto-mobile).mobile-lite .question-float-ring i {
  animation: none !important;
  opacity: 0.2;
}

:is(body.force-mobile, body.auto-mobile).mobile-lite .question-float-value {
  font-size: 0.76rem;
}

:is(body.force-mobile, body.auto-mobile).mobile-lite .question-float-meta {
  font-size: 0.5rem;
}

:is(body.force-mobile, body.auto-mobile).mobile-lite :is(.chapter-map-blobs, .chapter-map-particles) {
  display: none !important;
}

:is(body.force-mobile, body.auto-mobile).mobile-lite :is(
  .qb-topic-quick,
  .qb-solved-group,
  .qb-review-group,
  .qb-sort-group,
  .qb-pill-group,
  .header-quick-actions,
  .chapter-map-legend-list
) {
  scrollbar-width: none;
}

:is(body.force-mobile, body.auto-mobile).mobile-lite :is(
  .qb-topic-quick,
  .qb-solved-group,
  .qb-review-group,
  .qb-sort-group,
  .qb-pill-group,
  .header-quick-actions,
  .chapter-map-legend-list
)::-webkit-scrollbar {
  width: 0;
  height: 0;
}

/* Premium question cards refresh */
.question-list {
  gap: 14px;
}

.question-card {
  --question-accent: rgba(108, 201, 255, 0.84);
  --question-accent-soft: rgba(108, 201, 255, 0.2);
  position: relative;
  isolation: isolate;
  overflow: hidden;
  padding: 14px;
  border-radius: 18px;
  border: 1px solid rgba(129, 170, 203, 0.3);
  background:
    radial-gradient(circle at 86% 10%, rgba(115, 205, 255, 0.18), transparent 42%),
    radial-gradient(circle at 10% 92%, rgba(112, 180, 248, 0.12), transparent 48%),
    linear-gradient(154deg, rgba(16, 30, 46, 0.76), rgba(9, 17, 27, 0.68));
  box-shadow: 0 16px 34px rgba(3, 8, 15, 0.33), inset 0 1px 0 rgba(255, 255, 255, 0.08);
  transition: transform 0.24s ease, border-color 0.24s ease, box-shadow 0.24s ease, background-color 0.24s ease;
}

.question-card::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(140deg, rgba(255, 255, 255, 0.1), transparent 40%);
  opacity: 0.74;
  pointer-events: none;
}

.question-card::after {
  content: "";
  position: absolute;
  top: 12px;
  bottom: 12px;
  inset-inline-end: 0;
  width: 4px;
  border-radius: 999px;
  background: linear-gradient(180deg, var(--question-accent), rgba(108, 201, 255, 0.18));
  opacity: 0.66;
  transition: opacity 0.24s ease, filter 0.24s ease;
  pointer-events: none;
}

.question-card:hover {
  transform: translateY(-3px);
  border-color: rgba(127, 200, 246, 0.58);
  box-shadow: 0 20px 36px rgba(2, 8, 15, 0.38), inset 0 1px 0 rgba(255, 255, 255, 0.12);
}

.question-card:hover::after {
  opacity: 1;
  filter: saturate(124%);
}

.question-card:focus-visible {
  outline: none;
  border-color: rgba(122, 211, 255, 0.74);
  box-shadow: 0 0 0 3px rgba(122, 211, 255, 0.18), 0 18px 32px rgba(4, 10, 17, 0.34);
}

.question-head {
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto;
  align-items: start;
  gap: 10px;
  margin-bottom: 11px;
  padding-bottom: 10px;
  border-bottom: 1px solid rgba(132, 170, 198, 0.24);
}

.question-head-main {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 7px;
  min-width: 0;
}

.question-head-tools {
  display: inline-flex;
  flex-wrap: wrap;
  justify-content: flex-end;
  align-items: center;
  gap: 7px;
}

.icon-edit-btn-inline {
  position: static;
  width: 30px;
  height: 30px;
  min-height: 30px;
  padding: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 9px;
  border: 1px solid rgba(118, 194, 244, 0.34);
  background: rgba(92, 174, 228, 0.14);
  color: #bce9ff;
  transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease;
}

.icon-edit-btn-inline svg {
  width: 15px;
  height: 15px;
  stroke: currentColor;
  stroke-width: 1.8;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.icon-edit-btn-inline:hover {
  border-color: rgba(127, 208, 255, 0.62);
  background: rgba(104, 190, 243, 0.24);
  transform: translateY(-1px);
}

.icon-edit-btn-inline.is-active {
  border-color: rgba(133, 219, 255, 0.76);
  background: rgba(106, 198, 255, 0.28);
  color: #e3f7ff;
}

.question-index {
  min-height: 30px;
  padding: 4px 11px;
  border-radius: 999px;
  border: 1px solid rgba(138, 184, 214, 0.34);
  background: rgba(10, 28, 44, 0.48);
  color: #e8f5ff;
  font-size: 0.79rem;
  font-weight: 800;
  letter-spacing: 0.01em;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.14);
}

.question-solved-badge {
  width: 27px;
  height: 27px;
}

.question-review-badge {
  min-height: 27px;
  padding: 3px 10px;
  font-size: 0.69rem;
  font-weight: 800;
  border-color: rgba(145, 178, 206, 0.34);
  background: rgba(127, 127, 127, 0.12);
}

.question-topic-chip {
  min-height: 28px;
  max-width: min(100%, 460px);
  padding: 4px 11px;
  border-radius: 999px;
}

.question-topic-chip-text {
  font-size: 0.72rem;
}

.question-head .stars {
  min-height: 28px;
  padding: 3px 10px;
  border-radius: 999px;
  border-color: rgba(255, 205, 116, 0.46);
  background: linear-gradient(145deg, rgba(255, 205, 116, 0.2), rgba(255, 205, 116, 0.08));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
  font-size: 0.84rem;
  line-height: 1;
}

.question-body {
  padding: 12px 13px;
  border-radius: 14px;
  border: 1px solid rgba(136, 177, 204, 0.28);
  background:
    radial-gradient(circle at 10% 14%, rgba(107, 194, 246, 0.12), transparent 42%),
    linear-gradient(152deg, rgba(127, 127, 127, 0.12), rgba(127, 127, 127, 0.06));
  line-height: 1.95;
  font-size: 0.97rem;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.question-body .text-line {
  margin: 0 0 0.58em;
}

.question-body .text-line:last-child {
  margin-bottom: 0;
}

.question-tools {
  margin-top: 11px;
  padding-top: 10px;
  border-top: 1px dashed rgba(133, 170, 197, 0.26);
  gap: 8px;
}

.question-card .tool-btn {
  min-height: 36px;
  padding: 7px 12px;
  border-radius: 12px;
  border: 1px solid rgba(145, 178, 206, 0.28);
  background: rgba(127, 127, 127, 0.1);
  font-size: 0.79rem;
  font-weight: 700;
  transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
}

.question-card .tool-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 8px 15px rgba(7, 17, 28, 0.28);
}

.question-card .tool-btn-hint {
  border-color: rgba(102, 189, 245, 0.42);
  background: linear-gradient(145deg, rgba(102, 189, 245, 0.22), rgba(102, 189, 245, 0.08));
}

.question-card .tool-btn-solution {
  border-color: rgba(102, 224, 178, 0.42);
  background: linear-gradient(145deg, rgba(102, 224, 178, 0.2), rgba(102, 224, 178, 0.08));
}

.disclosure {
  margin-top: 9px;
  padding: 31px 12px 12px;
  border-radius: 14px;
  border: 1px solid rgba(138, 172, 201, 0.3);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.disclosure::before {
  top: 8px;
  inset-inline-end: 10px;
  min-height: 21px;
  padding: 3px 9px;
  font-size: 0.69rem;
}

.disclosure::after {
  inset-inline-start: 0;
  width: 4px;
}

.disclosure.disclosure-solution {
  padding-top: 12px;
}

.disclosure.disclosure-hint {
  padding-top: 12px;
}

.question-review-tools {
  margin-top: 10px;
  padding: 10px;
  border-radius: 14px;
  border: 1px solid rgba(138, 172, 201, 0.28);
  background:
    radial-gradient(circle at 86% 10%, rgba(102, 189, 245, 0.14), transparent 36%),
    linear-gradient(152deg, rgba(127, 127, 127, 0.12), rgba(127, 127, 127, 0.06));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.question-edit-form {
  margin-top: 10px;
  padding: 11px;
  border-radius: 14px;
  border: 1px solid rgba(136, 182, 214, 0.28);
  background:
    radial-gradient(circle at 14% 16%, rgba(98, 190, 246, 0.16), transparent 40%),
    linear-gradient(148deg, rgba(127, 127, 127, 0.14), rgba(127, 127, 127, 0.07));
  display: grid;
  gap: 9px;
}

.question-edit-head {
  display: grid;
  gap: 2px;
}

.question-edit-head strong {
  font-size: 0.84rem;
  font-weight: 800;
  color: var(--text-main);
}

.question-edit-head span {
  font-size: 0.73rem;
  color: var(--text-muted);
}

.question-edit-grid {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 8px;
}

.question-edit-field {
  display: grid;
  gap: 4px;
}

.question-edit-field span {
  font-size: 0.69rem;
  font-weight: 700;
  color: var(--text-muted);
}

.question-edit-field input,
.question-edit-field select,
.question-edit-field textarea {
  width: 100%;
  min-width: 0;
  border-radius: 10px;
  border: 1px solid rgba(134, 175, 206, 0.3);
  background: rgba(9, 19, 31, 0.56);
  color: var(--text-main);
  padding: 7px 9px;
  font-size: 0.79rem;
  line-height: 1.5;
}

.question-edit-field textarea {
  resize: vertical;
  min-height: 82px;
}

.question-edit-field-block {
  grid-column: 1 / -1;
}

.question-edit-field-assets textarea {
  min-height: 118px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size: 0.73rem;
  line-height: 1.56;
}

.question-edit-field-hint {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.66rem;
  line-height: 1.52;
}

.question-edit-field-hint code {
  direction: ltr;
  unicode-bidi: isolate;
  padding: 0 4px;
  border-radius: 5px;
  border: 1px solid rgba(134, 175, 206, 0.26);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-main);
  font-size: 0.65rem;
}

.question-edit-assets-tools {
  display: flex;
  flex-wrap: wrap;
  gap: 7px;
  margin-top: 2px;
}

.question-edit-assets-btn {
  min-height: 31px;
  padding: 5px 10px;
  border-radius: 9px;
  border: 1px solid rgba(136, 179, 210, 0.34);
  background: rgba(127, 127, 127, 0.12);
  color: var(--text-main);
  font-size: 0.69rem;
  font-weight: 720;
}

.question-edit-assets-btn.ghost {
  background: rgba(127, 127, 127, 0.06);
}

.question-edit-check {
  display: inline-flex;
  align-items: center;
  justify-content: flex-start;
  gap: 7px;
  padding: 0 4px;
  min-height: 34px;
  border-radius: 10px;
  border: 1px dashed rgba(137, 176, 205, 0.24);
  background: rgba(127, 127, 127, 0.08);
  color: var(--text-main);
  font-size: 0.73rem;
  font-weight: 700;
}

.question-edit-check input {
  width: 16px;
  height: 16px;
}

.question-edit-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

.question-edit-btn {
  min-height: 35px;
  padding: 7px 12px;
  border-radius: 10px;
  border: 1px solid rgba(136, 179, 210, 0.34);
  background: rgba(127, 127, 127, 0.12);
  color: var(--text-main);
  font-size: 0.76rem;
  font-weight: 760;
}

.question-edit-btn-save {
  border-color: rgba(109, 212, 170, 0.45);
  background: linear-gradient(145deg, rgba(109, 212, 170, 0.24), rgba(109, 212, 170, 0.1));
  color: #dcfff3;
}

.question-edit-btn-cancel {
  border-color: rgba(148, 180, 206, 0.36);
}

.question-review-row {
  grid-template-columns: auto minmax(0, 1fr) auto;
  gap: 7px;
  align-items: center;
}

.question-review-title {
  font-size: 0.73rem;
  font-weight: 800;
}

.question-review-group {
  display: inline-flex;
  flex-wrap: wrap;
  gap: 6px;
  min-width: 0;
}

.question-review-btn {
  min-height: 32px;
  padding: 5px 11px;
  border-radius: 999px;
  border: 1px solid rgba(145, 178, 206, 0.32);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-main);
  font-size: 0.69rem;
  font-weight: 700;
  line-height: 1.2;
}

.question-review-btn[data-status="review"] {
  border-color: rgba(255, 139, 163, 0.34);
}

.question-review-btn[data-status="key"] {
  border-color: rgba(255, 205, 116, 0.38);
}

.question-review-btn[data-status="mastered"] {
  border-color: rgba(110, 228, 175, 0.38);
}

.question-review-btn.is-active[data-status="review"] {
  border-color: rgba(255, 139, 163, 0.62);
  background: linear-gradient(145deg, rgba(255, 132, 156, 0.24), rgba(255, 132, 156, 0.1));
  color: #ffe2e9;
}

.question-review-btn.is-active[data-status="key"] {
  border-color: rgba(255, 205, 116, 0.64);
  background: linear-gradient(145deg, rgba(255, 204, 112, 0.25), rgba(255, 204, 112, 0.1));
  color: #ffedc7;
}

.question-review-btn.is-active[data-status="mastered"] {
  border-color: rgba(110, 228, 175, 0.64);
  background: linear-gradient(145deg, rgba(110, 228, 175, 0.25), rgba(110, 228, 175, 0.1));
  color: #ddffef;
}

.question-review-note-toggle {
  min-height: 32px;
  padding: 5px 11px;
  border-radius: 999px;
  font-size: 0.69rem;
  font-weight: 700;
}

.question-review-note {
  margin-top: 8px;
  gap: 6px;
}

.question-review-note-input {
  min-height: 74px;
  padding: 9px 10px;
  border-radius: 11px;
  border-color: rgba(145, 178, 206, 0.32);
  background: rgba(127, 127, 127, 0.11);
  line-height: 1.68;
}

.question-review-note-meta {
  gap: 10px;
}

html[data-theme^="light-"] .question-card {
  border-color: rgba(47, 82, 111, 0.24);
  background:
    radial-gradient(circle at 86% 10%, rgba(53, 141, 207, 0.16), transparent 40%),
    radial-gradient(circle at 10% 92%, rgba(93, 153, 206, 0.1), transparent 48%),
    linear-gradient(152deg, rgba(255, 255, 255, 0.95), rgba(246, 251, 255, 0.9));
  box-shadow: 0 14px 28px rgba(29, 63, 92, 0.16), inset 0 1px 0 rgba(255, 255, 255, 0.92);
}

html[data-theme^="light-"] .question-index {
  border-color: rgba(47, 130, 193, 0.3);
  background: rgba(47, 130, 193, 0.1);
  color: #1f5f8a;
}

html[data-theme^="light-"] .question-head .stars {
  border-color: rgba(220, 168, 58, 0.42);
  background: linear-gradient(145deg, rgba(255, 208, 110, 0.2), rgba(255, 208, 110, 0.08));
  color: #ae7a10;
}

html[data-theme^="light-"] .question-body {
  border-color: rgba(47, 82, 111, 0.2);
  background:
    radial-gradient(circle at 10% 14%, rgba(47, 130, 193, 0.1), transparent 42%),
    linear-gradient(152deg, rgba(255, 255, 255, 0.9), rgba(247, 251, 255, 0.84));
}

html[data-theme^="light-"] .question-card .tool-btn {
  border-color: rgba(47, 130, 193, 0.24);
  background: rgba(255, 255, 255, 0.9);
  color: #3f6685;
}

html[data-theme^="light-"] .question-review-tools {
  border-color: rgba(47, 82, 111, 0.22);
  background:
    radial-gradient(circle at 86% 10%, rgba(47, 130, 193, 0.12), transparent 36%),
    linear-gradient(152deg, rgba(255, 255, 255, 0.9), rgba(248, 252, 255, 0.86));
}

html[data-theme^="light-"] .question-review-btn {
  border-color: rgba(47, 130, 193, 0.26);
  background: rgba(255, 255, 255, 0.9);
  color: #3f6685;
}

html[data-theme^="light-"] .question-review-note-input {
  border-color: rgba(47, 130, 193, 0.24);
  background: rgba(255, 255, 255, 0.92);
  color: #184363;
}

@media (max-width: 760px) {
  .question-list {
    gap: 10px;
  }

  .question-card {
    padding: 10px;
    border-radius: 14px;
  }

  .question-head {
    grid-template-columns: 1fr;
    gap: 7px;
    margin-bottom: 9px;
    padding-bottom: 8px;
  }

  .question-head-tools {
    justify-content: flex-start;
  }

  .question-index,
  .question-review-badge,
  .question-topic-chip {
    min-height: 26px;
  }

  .question-body {
    padding: 10px 11px;
    font-size: 0.92rem;
    line-height: 1.82;
  }

  .question-card .tool-btn {
    min-height: 34px;
    padding: 6px 10px;
  }

  .question-review-row {
    grid-template-columns: 1fr;
    align-items: start;
  }

  .question-review-group {
    flex-wrap: nowrap;
    overflow-x: auto;
    padding-bottom: 2px;
    -webkit-overflow-scrolling: touch;
  }

  .question-review-btn {
    flex: 0 0 auto;
  }

  .question-review-note-toggle {
    justify-self: start;
  }
}

@media (prefers-reduced-motion: reduce) {
  .question-card,
  .question-card::after,
  .question-card .tool-btn,
  .question-review-btn {
    transition: none !important;
  }
}

/* Header display chip refresh */
.topbar.premium-topbar.qb-header #headerQuickMode {
  --mode-tone-rgb: 116, 206, 255;
  --mode-glow-rgb: 62, 156, 224;
  position: relative !important;
  isolation: isolate !important;
  display: inline-flex !important;
  align-items: center !important;
  gap: 9px !important;
  min-height: 40px !important;
  max-inline-size: min(100%, 280px) !important;
  padding: 8px 13px !important;
  border-radius: 14px !important;
  border: 1px solid rgba(var(--mode-tone-rgb), 0.44) !important;
  background:
    radial-gradient(circle at 15% 18%, rgba(var(--mode-tone-rgb), 0.24), transparent 44%),
    linear-gradient(146deg, rgba(var(--mode-glow-rgb), 0.22), rgba(var(--mode-glow-rgb), 0.08)),
    rgba(7, 19, 32, 0.68) !important;
  color: #e6f5ff !important;
  font-size: 0.8rem !important;
  font-weight: 800 !important;
  letter-spacing: 0.01em !important;
  white-space: nowrap !important;
  text-shadow: 0 1px 0 rgba(0, 0, 0, 0.3) !important;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.18),
    0 12px 20px rgba(4, 15, 25, 0.24) !important;
  overflow: hidden !important;
  transition: transform 0.22s ease, border-color 0.22s ease, box-shadow 0.22s ease, background-color 0.22s ease !important;
}

.topbar.premium-topbar.qb-header #headerQuickMode::before {
  content: "" !important;
  inline-size: 19px !important;
  block-size: 19px !important;
  border-radius: 999px !important;
  flex: 0 0 auto !important;
  background:
    radial-gradient(circle at 32% 30%, rgba(255, 255, 255, 0.96) 0 16%, rgba(var(--mode-tone-rgb), 0.95) 42%, rgba(var(--mode-glow-rgb), 0.92) 100%) !important;
  box-shadow:
    0 0 0 3px rgba(var(--mode-tone-rgb), 0.18),
    0 8px 16px rgba(var(--mode-glow-rgb), 0.34) !important;
}

.topbar.premium-topbar.qb-header #headerQuickMode::after {
  content: "" !important;
  position: absolute !important;
  inset-inline-start: 11px !important;
  inset-inline-end: 11px !important;
  top: 0 !important;
  block-size: 1px !important;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent) !important;
  opacity: 0.7 !important;
  pointer-events: none !important;
}

.topbar.premium-topbar.qb-header #headerQuickMode:hover {
  transform: translateY(-1px) !important;
  border-color: rgba(var(--mode-tone-rgb), 0.64) !important;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.2),
    0 14px 24px rgba(4, 17, 30, 0.3) !important;
}

.topbar.premium-topbar.qb-header #headerQuickMode[data-view="subjects"] {
  --mode-tone-rgb: 116, 206, 255;
  --mode-glow-rgb: 62, 156, 224;
}

.topbar.premium-topbar.qb-header #headerQuickMode[data-view="chapters"] {
  --mode-tone-rgb: 147, 217, 255;
  --mode-glow-rgb: 78, 168, 232;
}

.topbar.premium-topbar.qb-header #headerQuickMode[data-view="bank"] {
  --mode-tone-rgb: 102, 214, 255;
  --mode-glow-rgb: 58, 170, 232;
}

.topbar.premium-topbar.qb-header #headerQuickMode[data-view="practice"] {
  --mode-tone-rgb: 132, 234, 183;
  --mode-glow-rgb: 46, 154, 115;
}

.topbar.premium-topbar.qb-header #headerQuickMode[data-view="exam"] {
  --mode-tone-rgb: 255, 206, 124;
  --mode-glow-rgb: 187, 132, 28;
  color: #fff4d4 !important;
}

.topbar.premium-topbar.qb-header #headerQuickMode[data-view="map"] {
  --mode-tone-rgb: 196, 176, 255;
  --mode-glow-rgb: 126, 98, 222;
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header #headerQuickMode {
  color: #1c4f74 !important;
  text-shadow: none !important;
  border-color: rgba(var(--mode-tone-rgb), 0.46) !important;
  background:
    radial-gradient(circle at 15% 18%, rgba(var(--mode-tone-rgb), 0.2), transparent 44%),
    linear-gradient(146deg, rgba(var(--mode-glow-rgb), 0.16), rgba(255, 255, 255, 0.88)),
    rgba(255, 255, 255, 0.9) !important;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.9),
    0 10px 18px rgba(31, 73, 104, 0.14) !important;
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header #headerQuickMode::before {
  box-shadow:
    0 0 0 3px rgba(var(--mode-tone-rgb), 0.16),
    0 7px 14px rgba(var(--mode-glow-rgb), 0.24) !important;
}

@media (max-width: 1023px) {
  .topbar.premium-topbar.qb-header #headerQuickMode {
    inline-size: 100% !important;
    max-inline-size: none !important;
    justify-content: center !important;
  }
}

@media (max-width: 640px) {
  .topbar.premium-topbar.qb-header #headerQuickMode {
    min-height: 38px !important;
    padding: 7px 10px !important;
    font-size: 0.77rem !important;
    justify-content: flex-start !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickMode::before {
    inline-size: 17px !important;
    block-size: 17px !important;
  }
}

/* Mobile header horizontal scroll rail (final override) */
@media (max-width: 1023px) {
  .topbar.premium-topbar.qb-header .header-pillar-controls {
    display: grid !important;
    grid-template-columns: auto minmax(0, 1fr) !important;
    grid-template-areas:
      "settings mode"
      "nav nav" !important;
    align-items: center !important;
    gap: 8px !important;
    min-width: 0 !important;
  }

  .topbar.premium-topbar.qb-header #settingsPanelToggle {
    grid-area: settings !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickMode {
    grid-area: mode !important;
    inline-size: auto !important;
    min-width: 0 !important;
    justify-content: flex-start !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track {
    grid-area: nav !important;
    inline-size: 100% !important;
    max-inline-size: none !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    scrollbar-width: thin !important;
    scrollbar-color: rgba(171, 219, 255, 0.52) rgba(255, 255, 255, 0.07) !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    scroll-snap-type: inline proximity !important;
    padding-block-end: 5px !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track::-webkit-scrollbar {
    display: block !important;
    height: 6px !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.07) !important;
    border-radius: 999px !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track::-webkit-scrollbar-thumb {
    background: linear-gradient(90deg, rgba(138, 204, 248, 0.64), rgba(174, 226, 255, 0.58)) !important;
    border-radius: 999px !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track .header-toggle {
    scroll-snap-align: start !important;
  }

  .topbar.premium-topbar.qb-header .header-stats-track {
    overflow-x: auto !important;
    overflow-y: hidden !important;
    scrollbar-width: thin !important;
    scrollbar-color: rgba(171, 219, 255, 0.48) rgba(255, 255, 255, 0.06) !important;
    -webkit-overflow-scrolling: touch !important;
    padding-block-end: 4px !important;
    justify-content: flex-start !important;
  }

  .topbar.premium-topbar.qb-header .header-stats-track::-webkit-scrollbar {
    display: block !important;
    height: 6px !important;
  }

  .topbar.premium-topbar.qb-header .header-stats-track::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.06) !important;
    border-radius: 999px !important;
  }

  .topbar.premium-topbar.qb-header .header-stats-track::-webkit-scrollbar-thumb {
    background: linear-gradient(90deg, rgba(130, 196, 242, 0.58), rgba(167, 223, 255, 0.52)) !important;
    border-radius: 999px !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickContext {
    inline-size: 100% !important;
    max-inline-size: 100% !important;
    min-inline-size: 0 !important;
    justify-content: flex-start !important;
    white-space: normal !important;
    text-wrap: balance !important;
    line-height: 1.5 !important;
  }
}

/* Absolute final lock: mobile header must have visible horizontal scrollbar */
@media (max-width: 1023px) {
  .topbar.premium-topbar.qb-header .header-controls-track {
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    inline-size: 100% !important;
    max-inline-size: none !important;
    overflow-x: scroll !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    scrollbar-gutter: stable both-edges !important;
    padding-block-end: 6px !important;
    gap: 8px !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track .header-toggle {
    flex: 0 0 auto !important;
    min-inline-size: 96px !important;
    justify-content: center !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track::-webkit-scrollbar {
    display: block !important;
    height: 7px !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1) !important;
    border-radius: 999px !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track::-webkit-scrollbar-thumb {
    background: linear-gradient(90deg, rgba(120, 196, 242, 0.82), rgba(168, 226, 255, 0.78)) !important;
    border-radius: 999px !important;
  }
}

/* Mobile lesson cards optimization + question-bank danger zone */
@media (max-width: 920px) {
  :is(body.force-mobile, body.auto-mobile) .subjects-premium-grid,
  body:not(.force-desktop) .subjects-premium-grid {
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .subject-premium-card,
  body:not(.force-desktop) .subject-premium-card {
    border-radius: 13px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .subject-open-btn,
  body:not(.force-desktop) .subject-open-btn {
    padding: 11px 12px !important;
    padding-left: 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .subject-open-btn::after,
  body:not(.force-desktop) .subject-open-btn::after {
    display: none !important;
  }

  :is(body.force-mobile, body.auto-mobile) .subject-open-btn h3,
  body:not(.force-desktop) .subject-open-btn h3 {
    font-size: 0.95rem !important;
    margin-bottom: 4px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .subject-open-btn p,
  body:not(.force-desktop) .subject-open-btn p {
    margin-bottom: 8px !important;
    font-size: 0.76rem !important;
    line-height: 1.6 !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-dashboard,
  body:not(.force-desktop) .lesson-dashboard {
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-dashboard-head,
  body:not(.force-desktop) .lesson-dashboard-head {
    border-radius: 12px !important;
    padding: 9px 10px !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-title-row h2,
  body:not(.force-desktop) .lesson-title-row h2 {
    font-size: 0.95rem !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-title-row p,
  body:not(.force-desktop) .lesson-title-row p {
    font-size: 0.75rem !important;
    line-height: 1.6 !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-stat-chip,
  body:not(.force-desktop) .lesson-stat-chip {
    border-radius: 10px !important;
    padding: 6px 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-add-card,
  body:not(.force-desktop) .lesson-add-card {
    border-radius: 12px !important;
    padding: 8px !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-chapter-grid,
  body:not(.force-desktop) .lesson-chapter-grid {
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-chapter-card,
  body:not(.force-desktop) .lesson-chapter-card {
    border-radius: 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-chapter-open,
  body:not(.force-desktop) .lesson-chapter-open {
    padding: 10px !important;
    padding-left: 10px !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-chapter-head h3,
  body:not(.force-desktop) .lesson-chapter-head h3 {
    font-size: 0.9rem !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-chapter-head p,
  body:not(.force-desktop) .lesson-chapter-head p {
    font-size: 0.74rem !important;
    line-height: 1.58 !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-chapter-badge,
  body:not(.force-desktop) .lesson-chapter-badge {
    min-height: 22px !important;
    padding: 2px 7px !important;
    font-size: 0.68rem !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-chapter-card .chapter-card-tools,
  body:not(.force-desktop) .lesson-chapter-card .chapter-card-tools {
    position: static !important;
    inset: auto !important;
    margin: 0 10px 10px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: flex-start !important;
    flex-wrap: wrap !important;
    gap: 6px !important;
    padding: 6px !important;
    border-radius: 11px !important;
    grid-template-columns: none !important;
    grid-template-rows: none !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-chapter-card .chapter-card-tools .chapter-move-group,
  body:not(.force-desktop) .lesson-chapter-card .chapter-card-tools .chapter-move-group {
    padding: 1px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .lesson-chapter-card .chapter-card-tools :is(.icon-open-btn, .icon-order-btn, .icon-delete-btn),
  body:not(.force-desktop) .lesson-chapter-card .chapter-card-tools :is(.icon-open-btn, .icon-order-btn, .icon-delete-btn) {
    width: 32px !important;
    height: 32px !important;
    min-height: 32px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .question-danger-zone,
  body:not(.force-desktop) .question-danger-zone {
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 8px !important;
    padding: 9px !important;
  }

  :is(body.force-mobile, body.auto-mobile) .question-danger-zone .bulk-delete-btn-danger,
  body:not(.force-desktop) .question-danger-zone .bulk-delete-btn-danger {
    width: 100% !important;
    min-height: 34px !important;
  }
}

/* Final mobile lock: question-bank filter carding + smooth mobile scrolling */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel {
    min-width: 0 !important;
    overflow-x: hidden !important;
    overscroll-behavior-y: contain !important;
    -webkit-overflow-scrolling: touch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-list {
    min-width: 0 !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-bar.qb-filter-layout-v2 {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
    gap: 10px !important;
    padding: 10px !important;
    border-radius: 14px !important;
    overflow-x: clip !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-bar.qb-filter-layout-v2 > * {
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-filter-row-primary {
    grid-template-columns: minmax(0, 1fr) !important;
    align-items: stretch !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-search-wrap-primary {
    width: 100% !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-search-wrap-primary .qb-search-input {
    min-height: 38px !important;
    border-radius: 11px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-filter-row-actions {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) auto !important;
    align-items: center !important;
    justify-self: stretch !important;
    gap: 8px !important;
    width: 100% !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-filter-active-count {
    width: 100% !important;
    min-width: 0 !important;
    justify-content: center !important;
    text-align: center !important;
    padding-inline: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-clear-btn-compact {
    min-height: 34px !important;
    min-width: 98px !important;
    width: auto !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-active-chips-row {
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    gap: 6px !important;
    min-height: 30px !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    scrollbar-width: thin !important;
    padding-bottom: 2px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-active-chip,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-active-chip-placeholder {
    flex: 0 0 auto !important;
    max-width: 82vw !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-filter-groups-grid {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 10px !important;
    align-items: stretch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-filter-group-card,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-filter-group-card.is-wide {
    grid-column: auto !important;
    width: 100% !important;
    min-width: 0 !important;
    min-height: 0 !important;
    padding: 10px !important;
    gap: 8px !important;
    border-radius: 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-lux-triple-card,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-lux-triple-card.is-wide {
    padding: 9px !important;
    border-radius: 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-lux-triple-grid {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 8px !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-lux-filter-panel,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-lux-filter-panel.is-review {
    grid-column: auto !important;
    width: 100% !important;
    min-width: 0 !important;
    min-height: 0 !important;
    padding: 9px !important;
    gap: 7px !important;
    border-radius: 11px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-lux-filter-subtitle {
    max-width: 100% !important;
    width: fit-content !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-filter-topic-body {
    gap: 8px !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-filter-topic-select-wrap {
    gap: 6px !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-topic-select {
    min-height: 36px !important;
    width: 100% !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 :is(
      .qb-sort-group,
      .qb-solved-group,
      .qb-review-group,
      .qb-topic-quick,
      .qb-pill-group
    ) {
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    gap: 6px !important;
    min-width: 0 !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    scrollbar-width: thin !important;
    padding-bottom: 2px !important;
    scroll-snap-type: inline proximity !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 :is(
      .qb-sort-chip,
      .qb-solved-chip,
      .qb-review-chip,
      .qb-topic-quick-btn,
      .qb-pill
    ) {
    flex: 0 0 auto !important;
    scroll-snap-align: start !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-filter-difficulty-strip {
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 8px !important;
    width: 100% !important;
    min-width: 0 !important;
    padding: 10px !important;
    border-radius: 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 .qb-filter-strip-label {
    line-height: 1.35 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 :is(
      .qb-sort-group,
      .qb-solved-group,
      .qb-review-group,
      .qb-topic-quick,
      .qb-pill-group,
      .qb-active-chips-row
    )::-webkit-scrollbar {
    display: block !important;
    height: 5px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 :is(
      .qb-sort-group,
      .qb-solved-group,
      .qb-review-group,
      .qb-topic-quick,
      .qb-pill-group,
      .qb-active-chips-row
    )::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.08) !important;
    border-radius: 999px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .qb-filter-layout-v2 :is(
      .qb-sort-group,
      .qb-solved-group,
      .qb-review-group,
      .qb-topic-quick,
      .qb-pill-group,
      .qb-active-chips-row
    )::-webkit-scrollbar-thumb {
    background: linear-gradient(90deg, rgba(132, 204, 248, 0.66), rgba(170, 226, 255, 0.6)) !important;
    border-radius: 999px !important;
  }
}

/* ABSOLUTE FINAL LOCK: mobile header must fully show all controls */
@media (max-width: 1023px) {
  .topbar.premium-topbar.qb-header {
    width: calc(100% - 10px) !important;
    max-width: calc(100% - 10px) !important;
    margin: 8px auto 12px !important;
    border-radius: 16px !important;
    overflow: visible !important;
  }

  .topbar.premium-topbar.qb-header .header-container {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) !important;
    grid-template-areas:
      "brand"
      "controls"
      "stats" !important;
    align-items: stretch !important;
    gap: 10px !important;
    padding: 10px !important;
    min-width: 0 !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-brand,
  .topbar.premium-topbar.qb-header .header-pillar-controls,
  .topbar.premium-topbar.qb-header .header-pillar-stats {
    min-width: 0 !important;
    max-inline-size: none !important;
    inline-size: 100% !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-brand {
    grid-area: brand !important;
    justify-content: stretch !important;
  }

  .topbar.premium-topbar.qb-header .header-brand-block {
    display: grid !important;
    grid-template-columns: auto minmax(0, 1fr) !important;
    align-items: center !important;
    gap: 9px !important;
    min-width: 0 !important;
  }

  .topbar.premium-topbar.qb-header .header-brand-title {
    font-size: clamp(0.92rem, 3.8vw, 1.04rem) !important;
    line-height: 1.46 !important;
    white-space: normal !important;
    overflow: visible !important;
    text-overflow: clip !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-controls {
    grid-area: controls !important;
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    grid-template-areas:
      "settings mode"
      "nav nav" !important;
    align-items: center !important;
    gap: 8px !important;
  }

  .topbar.premium-topbar.qb-header #settingsPanelToggle {
    grid-area: settings !important;
    inline-size: 100% !important;
    min-width: 0 !important;
    justify-content: center !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickMode {
    grid-area: mode !important;
    inline-size: 100% !important;
    max-inline-size: none !important;
    min-width: 0 !important;
    justify-content: center !important;
    font-size: 0.76rem !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    padding-inline: 8px !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track {
    grid-area: nav !important;
    inline-size: 100% !important;
    max-inline-size: none !important;
    min-width: 0 !important;
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    gap: 8px !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    padding: 4px 3px 6px !important;
    border-radius: 12px !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    scroll-snap-type: inline proximity !important;
    scrollbar-width: thin !important;
  }

  .topbar.premium-topbar.qb-header .header-controls-track .header-toggle {
    flex: 0 0 auto !important;
    min-inline-size: max-content !important;
    justify-content: center !important;
    white-space: nowrap !important;
    scroll-snap-align: start !important;
  }

  .topbar.premium-topbar.qb-header .header-pillar-stats {
    grid-area: stats !important;
    justify-content: stretch !important;
  }

  .topbar.premium-topbar.qb-header .header-stats-track {
    inline-size: 100% !important;
    min-width: 0 !important;
    justify-content: flex-start !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    padding-bottom: 4px !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickContext {
    flex: 0 0 auto !important;
    min-inline-size: max-content !important;
    max-inline-size: none !important;
    white-space: nowrap !important;
    overflow: visible !important;
    text-overflow: clip !important;
  }
}

@media (max-width: 640px) {
  .topbar.premium-topbar.qb-header .header-pillar-controls {
    grid-template-columns: minmax(0, 1fr) !important;
    grid-template-areas:
      "mode"
      "settings"
      "nav" !important;
  }

  .topbar.premium-topbar.qb-header #headerQuickMode,
  .topbar.premium-topbar.qb-header #settingsPanelToggle {
    justify-content: flex-start !important;
  }
}

/* Final mobile performance lock: keep lite mode truly lightweight */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile).mobile-lite :is(
    .subject-add-card,
    .subject-premium-card,
    .lesson-dashboard-head,
    .lesson-stat-chip,
    .lesson-add-card,
    .lesson-chapter-card,
    .chapter-card-tools,
    .header-control-btn,
    .header-toggle,
    .header-view-pill,
    .header-stat-pill,
    .settings-overview-card,
    .settings-tab-btn
  ) {
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  :is(body.force-mobile, body.auto-mobile).mobile-lite :is(
    .subject-add-icon,
    .subject-open-btn::before,
    .subject-open-btn::after,
    .question-card::before,
    .question-card::after
  ) {
    display: none !important;
  }

  :is(body.force-mobile, body.auto-mobile).mobile-lite :is(
    .subject-premium-card,
    .lesson-chapter-card,
    .question-card,
    .practice-question-card,
    .exam-paper-item,
    .header-toggle,
    .settings-tab-btn
  ) {
    transition: none !important;
    transform: none !important;
  }
}

/* Absolute final lock: lesson dashboard stats must stay in one row */
.lesson-dashboard-stats {
  display: grid !important;
  grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
  gap: 8px !important;
  align-items: stretch !important;
}

.lesson-stat-chip {
  min-width: 0 !important;
  min-height: 46px !important;
  padding: 7px 9px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
  gap: 8px !important;
}

.lesson-stat-head {
  min-width: 0 !important;
  flex: 1 1 auto !important;
}

.lesson-stat-head em {
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.lesson-stat-chip strong {
  flex: 0 0 auto !important;
  white-space: nowrap !important;
  font-variant-numeric: tabular-nums !important;
}

@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved='mobile']) .lesson-dashboard-stats,
  body:not(.force-desktop) .lesson-dashboard-stats {
    grid-template-columns: repeat(4, minmax(112px, 1fr)) !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    padding: 2px 2px 4px !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    scrollbar-width: thin !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved='mobile']) .lesson-stat-chip,
  body:not(.force-desktop) .lesson-stat-chip {
    min-width: 112px !important;
    min-height: 42px !important;
    padding: 6px 7px !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved='mobile']) .lesson-stat-head em,
  body:not(.force-desktop) .lesson-stat-head em {
    font-size: 0.65rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved='mobile']) .lesson-stat-chip strong,
  body:not(.force-desktop) .lesson-stat-chip strong {
    font-size: 0.86rem !important;
  }
}

/* JSON guide: premium AI prompt card with quick copy */
.schema-guide-notes {
  max-height: min(46dvh, 420px) !important;
}

.schema-ai-prompt-card {
  margin-bottom: 12px;
  border-radius: 14px;
  border: 1px solid rgba(144, 199, 236, 0.34);
  background:
    radial-gradient(circle at 10% 16%, rgba(120, 203, 255, 0.18), transparent 44%),
    linear-gradient(145deg, rgba(13, 33, 52, 0.84), rgba(8, 21, 35, 0.78));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 12px 26px rgba(4, 10, 18, 0.24);
  padding: 11px;
}

.schema-ai-prompt-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 8px;
}

.schema-ai-prompt-head strong {
  min-width: 0;
  font-size: 0.82rem;
  line-height: 1.6;
  color: #e5f5ff;
}

.schema-ai-prompt-copy {
  flex: 0 0 auto;
  min-height: 34px;
  border-radius: 10px;
  border: 1px solid rgba(132, 198, 237, 0.46);
  background:
    linear-gradient(145deg, rgba(85, 171, 229, 0.28), rgba(63, 138, 197, 0.22)),
    rgba(10, 28, 44, 0.72);
  color: #dff3ff;
  font-family: inherit;
  font-size: 0.76rem;
  font-weight: 700;
  line-height: 1;
  cursor: pointer;
  padding: 0 11px;
  transition: border-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.schema-ai-prompt-copy:hover {
  border-color: rgba(168, 222, 255, 0.64);
  transform: translateY(-1px);
  box-shadow: 0 8px 16px rgba(4, 15, 27, 0.28);
}

.schema-ai-prompt-copy:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(108, 189, 245, 0.26);
}

.schema-ai-prompt-note {
  margin: 0 0 8px;
  color: rgba(198, 224, 244, 0.9);
  font-size: 0.74rem;
  line-height: 1.72;
}

.schema-ai-prompt-code {
  margin: 0;
  max-height: min(34dvh, 280px);
  overflow: auto;
  border-radius: 11px;
  border: 1px solid rgba(136, 194, 233, 0.34);
  background: rgba(5, 14, 24, 0.8);
  padding: 10px 11px;
  color: #e4f3ff;
  direction: ltr;
  text-align: left;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size: 0.76rem;
  line-height: 1.72;
  white-space: pre;
}

html[data-theme^="light-"] .schema-ai-prompt-card {
  border-color: rgba(96, 154, 193, 0.3);
  background:
    radial-gradient(circle at 10% 16%, rgba(119, 194, 238, 0.16), transparent 44%),
    linear-gradient(145deg, rgba(243, 249, 255, 0.95), rgba(232, 244, 253, 0.92));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.86), 0 10px 20px rgba(23, 52, 79, 0.12);
}

html[data-theme^="light-"] .schema-ai-prompt-head strong {
  color: #1f5073;
}

html[data-theme^="light-"] .schema-ai-prompt-copy {
  border-color: rgba(106, 164, 200, 0.38);
  background: linear-gradient(145deg, rgba(230, 245, 255, 0.94), rgba(213, 234, 249, 0.9));
  color: #1f5378;
}

html[data-theme^="light-"] .schema-ai-prompt-note {
  color: rgba(39, 80, 109, 0.88);
}

html[data-theme^="light-"] .schema-ai-prompt-code {
  border-color: rgba(113, 165, 199, 0.34);
  background: rgba(248, 252, 255, 0.95);
  color: #234f70;
}

@media (max-width: 640px) {
  .schema-guide-notes {
    max-height: min(44dvh, 340px) !important;
  }

  .schema-ai-prompt-head {
    flex-direction: column;
    align-items: stretch;
  }

  .schema-ai-prompt-copy {
    width: 100%;
  }

  .schema-ai-prompt-code {
    max-height: min(32dvh, 230px);
    font-size: 0.72rem;
  }
}

/* ===== Profile Data Studio (modern redesign) ===== */
.profile-card-data.profile-data-lab {
  position: relative;
  overflow: hidden;
  border-color: var(--line);
  background:
    radial-gradient(circle at 8% 12%, var(--accent-soft), transparent 36%),
    radial-gradient(circle at 92% 88%, var(--accent-soft), transparent 42%),
    linear-gradient(148deg, var(--surface-strong), var(--surface-soft));
  box-shadow: 0 20px 38px rgba(3, 10, 19, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.profile-card-data.profile-data-lab::before {
  content: "";
  position: absolute;
  inset-inline: 14px;
  top: 0;
  height: 2px;
  border-radius: 999px;
  background: linear-gradient(90deg, transparent, var(--accent), transparent);
  pointer-events: none;
}

.profile-card-data.profile-data-lab .profile-card-data-headline {
  margin-bottom: 10px;
}

.profile-card-data.profile-data-lab .profile-data-title-wrap {
  gap: 5px;
}

.profile-card-data.profile-data-lab .profile-data-kicker {
  display: inline-flex;
  align-items: center;
  min-height: 20px;
  width: fit-content;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: var(--surface-soft);
  color: var(--text-main);
  font-size: 0.66rem;
  font-weight: 800;
  line-height: 1;
  letter-spacing: 0.03em;
  text-transform: uppercase;
  padding-inline: 8px;
}

.profile-card-data.profile-data-lab .profile-data-title-wrap h3 {
  font-size: 1.02rem;
  letter-spacing: -0.01em;
}

.profile-card-data.profile-data-lab .profile-data-title-wrap p {
  font-size: 0.78rem;
  line-height: 1.72;
  color: var(--text-muted);
}

.profile-card-data.profile-data-lab .profile-data-tag {
  border-color: var(--line);
  background: var(--surface-soft);
  color: var(--text-main);
}

.profile-card-data.profile-data-lab .profile-data-tag.profile-data-tag-icon {
  width: 42px;
  min-width: 42px;
  height: 42px;
  min-height: 42px;
  padding: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 13px;
  border: 1px solid var(--line);
  background:
    radial-gradient(circle at 24% 20%, rgba(255, 255, 255, 0.16), var(--accent-soft) 34%, transparent 88%),
    linear-gradient(148deg, var(--surface-strong), var(--surface-soft));
  box-shadow:
    0 10px 22px rgba(4, 14, 26, 0.36),
    inset 0 1px 0 rgba(240, 251, 255, 0.34),
    0 0 0 1px var(--accent-soft);
  color: var(--text-main);
}

.profile-card-data.profile-data-lab .profile-data-tag.profile-data-tag-icon svg {
  width: 24px;
  height: 24px;
  display: block;
}

.profile-card-data.profile-data-lab .profile-data-tag.profile-data-tag-icon .tag-ring {
  fill: none;
  stroke: currentColor;
  stroke-width: 1.35;
}

.profile-card-data.profile-data-lab .profile-data-tag.profile-data-tag-icon .tag-core,
.profile-card-data.profile-data-lab .profile-data-tag.profile-data-tag-icon .tag-core-lines {
  fill: none;
  stroke: currentColor;
  stroke-width: 1.45;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.profile-card-data.profile-data-lab .profile-data-tag.profile-data-tag-icon .tag-node {
  fill: var(--accent);
  opacity: 0.96;
  filter: drop-shadow(0 0 4px var(--accent-soft));
}

.profile-card-data.profile-data-lab .profile-data-shell {
  display: grid;
  grid-template-columns: minmax(250px, 0.9fr) minmax(0, 1.1fr);
  gap: 12px;
  align-items: stretch;
}

.profile-card-data.profile-data-lab .profile-data-actions-bento,
.profile-card-data.profile-data-lab .profile-data-editor-panel {
  border-radius: 14px;
  border: 1px solid var(--line);
  background:
    radial-gradient(circle at 12% 15%, var(--accent-soft), transparent 44%),
    var(--surface-soft);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06);
}

.profile-card-data.profile-data-lab .profile-data-actions-bento {
  padding: 10px;
  display: grid;
  gap: 8px;
  align-content: start;
}

.profile-card-data.profile-data-lab .profile-data-action-btn {
  width: 100%;
  min-height: 56px;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: linear-gradient(145deg, var(--surface-strong), var(--surface-soft));
  color: var(--text-main);
  display: grid;
  grid-template-columns: 34px minmax(0, 1fr);
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  text-align: right;
  transition: border-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.profile-card-data.profile-data-lab .profile-data-action-btn:hover {
  border-color: var(--accent);
  transform: translateY(-1px);
  box-shadow: 0 10px 18px rgba(4, 15, 28, 0.22);
}

.profile-card-data.profile-data-lab .profile-data-action-btn:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px var(--accent-soft);
}

.profile-card-data.profile-data-lab .profile-data-action-btn-accent {
  border-color: rgba(133, 214, 184, 0.4);
  background: linear-gradient(145deg, rgba(23, 71, 61, 0.62), rgba(14, 46, 40, 0.62));
}

.profile-card-data.profile-data-lab .profile-data-action-icon {
  width: 34px;
  height: 34px;
  border-radius: 10px;
  border: 1px solid var(--line);
  background: var(--accent-soft);
  color: var(--text-main);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.profile-card-data.profile-data-lab .profile-data-action-btn-accent .profile-data-action-icon {
  border-color: rgba(139, 219, 191, 0.38);
  background: rgba(100, 194, 155, 0.22);
}

.profile-card-data.profile-data-lab .profile-data-action-icon svg {
  width: 16px;
  height: 16px;
  fill: none;
  stroke: currentColor;
  stroke-width: 1.85;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.profile-card-data.profile-data-lab .profile-data-action-copy {
  min-width: 0;
  display: grid;
  gap: 2px;
}

.profile-card-data.profile-data-lab .profile-data-action-copy strong {
  margin: 0;
  font-size: 0.79rem;
  line-height: 1.35;
  color: var(--text-main);
}

.profile-card-data.profile-data-lab .profile-data-action-copy small {
  margin: 0;
  font-size: 0.68rem;
  line-height: 1.45;
  color: var(--text-muted);
}

.profile-card-data.profile-data-lab .profile-data-editor-panel {
  padding: 11px;
  display: grid;
  gap: 9px;
}

.profile-card-data.profile-data-lab .profile-data-editor-head {
  min-width: 0;
  display: grid;
  gap: 4px;
}

.profile-card-data.profile-data-lab .profile-v2-json-label {
  margin: 0;
  font-size: 0.8rem;
  color: var(--text-main);
  font-weight: 800;
}

.profile-card-data.profile-data-lab .profile-data-editor-hint {
  margin: 0;
  font-size: 0.71rem;
  line-height: 1.6;
  color: var(--text-muted);
}

.profile-card-data.profile-data-lab #jsonImportText {
  min-height: 180px;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: var(--surface-soft);
  color: var(--text-main);
  padding: 11px 12px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size: 0.79rem;
  line-height: 1.68;
}

.profile-card-data.profile-data-lab #jsonImportText:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-soft);
}

.profile-card-data.profile-data-lab .profile-data-editor-actions {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 8px;
}

.profile-card-data.profile-data-lab .profile-data-editor-btn {
  min-height: 40px;
  border-radius: 11px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  font-size: 0.78rem;
  font-weight: 700;
}

.profile-card-data.profile-data-lab .profile-data-editor-btn-primary {
  border-color: var(--line);
  background:
    radial-gradient(circle at 12% 18%, var(--accent-soft), transparent 46%),
    linear-gradient(145deg, var(--accent-soft), transparent),
    var(--surface-strong);
}

.profile-card-data.profile-data-lab .profile-data-notes {
  margin-top: 11px;
  display: flex;
  flex-wrap: wrap;
  gap: 7px;
}

.profile-card-data.profile-data-lab .profile-data-note-chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  min-height: 27px;
  padding-inline: 10px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: var(--surface-soft);
  color: var(--text-main);
  font-size: 0.72rem;
  font-weight: 700;
  line-height: 1;
}

.profile-card-data.profile-data-lab .profile-data-note-dot {
  width: 7px;
  height: 7px;
  border-radius: 999px;
  background: #7edfb0;
  box-shadow: 0 0 0 2px rgba(126, 223, 176, 0.24);
  flex-shrink: 0;
}

.profile-card-data.profile-data-lab .json-import-diagnostics {
  margin-top: 10px;
  border-radius: 12px;
}

@media (max-width: 980px) {
  .profile-card-data.profile-data-lab .profile-data-shell {
    grid-template-columns: 1fr;
    gap: 10px;
  }

  .profile-card-data.profile-data-lab .profile-data-actions-bento {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .profile-card-data.profile-data-lab .profile-data-action-btn {
    min-height: 52px;
  }
}

@media (max-width: 620px) {
  .profile-card-data.profile-data-lab .profile-data-actions-bento,
  .profile-card-data.profile-data-lab .profile-data-editor-panel {
    padding: 9px;
  }

  .profile-card-data.profile-data-lab .profile-data-actions-bento {
    grid-template-columns: 1fr;
  }

  .profile-card-data.profile-data-lab .profile-data-editor-actions {
    grid-template-columns: 1fr;
  }

  .profile-card-data.profile-data-lab #jsonImportText {
    min-height: 156px;
    font-size: 0.76rem;
  }
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab {
  border-color: rgba(104, 159, 195, 0.32);
  background:
    radial-gradient(circle at 8% 12%, rgba(119, 196, 239, 0.18), transparent 36%),
    radial-gradient(circle at 92% 88%, rgba(113, 184, 229, 0.14), transparent 42%),
    linear-gradient(148deg, rgba(244, 251, 255, 0.96), rgba(233, 246, 255, 0.92));
  box-shadow: 0 18px 30px rgba(25, 55, 82, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.88);
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-kicker {
  border-color: rgba(118, 174, 208, 0.36);
  background: rgba(218, 237, 250, 0.9);
  color: #2a6388;
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-title-wrap p {
  color: rgba(43, 86, 117, 0.86);
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-tag {
  border-color: rgba(115, 171, 204, 0.36);
  background: rgba(221, 239, 252, 0.9);
  color: #2d6489;
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-tag.profile-data-tag-icon {
  border-color: rgba(113, 173, 208, 0.52);
  background:
    radial-gradient(circle at 24% 20%, rgba(255, 255, 255, 0.92), rgba(176, 223, 248, 0.64) 34%, rgba(108, 176, 218, 0.42) 88%),
    linear-gradient(148deg, rgba(235, 248, 255, 0.96), rgba(218, 238, 250, 0.94));
  box-shadow:
    0 10px 20px rgba(38, 80, 111, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.96),
    0 0 0 1px rgba(126, 187, 220, 0.22);
  color: #2a678e;
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-tag.profile-data-tag-icon .tag-ring {
  stroke: rgba(69, 141, 184, 0.76);
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-tag.profile-data-tag-icon .tag-node {
  fill: #4f8fb8;
  filter: drop-shadow(0 0 3px rgba(94, 166, 207, 0.42));
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-actions-bento,
html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-editor-panel {
  border-color: rgba(117, 172, 206, 0.26);
  background:
    radial-gradient(circle at 12% 15%, rgba(139, 205, 244, 0.14), transparent 44%),
    rgba(244, 250, 255, 0.92);
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-action-btn {
  border-color: rgba(122, 176, 209, 0.36);
  background: linear-gradient(145deg, rgba(237, 248, 255, 0.96), rgba(221, 238, 250, 0.92));
  color: #26597d;
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-action-btn-accent {
  border-color: rgba(112, 178, 151, 0.38);
  background: linear-gradient(145deg, rgba(226, 246, 237, 0.95), rgba(209, 237, 224, 0.92));
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-action-icon {
  border-color: rgba(119, 173, 206, 0.36);
  background: rgba(146, 205, 239, 0.3);
  color: #2c648a;
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-action-copy strong {
  color: #1f5074;
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-action-copy small {
  color: rgba(44, 86, 117, 0.82);
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-v2-json-label {
  color: #275979;
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-editor-hint {
  color: rgba(46, 91, 122, 0.84);
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab #jsonImportText {
  border-color: rgba(118, 172, 205, 0.34);
  background: rgba(255, 255, 255, 0.94);
  color: #1f4f72;
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-note-chip {
  border-color: rgba(123, 177, 210, 0.32);
  background: rgba(227, 243, 255, 0.9);
  color: #245b7f;
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-note-dot {
  box-shadow: 0 0 0 2px rgba(126, 223, 176, 0.2);
}

/* Desktop premium refresh: chapter management */
@media (min-width: 1024px) {
  .lesson-dashboard {
    gap: 14px;
  }

  .lesson-dashboard-head {
    border-radius: 18px;
    padding: 14px 16px;
    gap: 10px;
  }

  .lesson-add-card {
    position: relative;
    gap: 12px;
    padding: 14px 16px;
    border-radius: 18px;
    border-color: rgba(138, 188, 228, 0.34);
    background:
      radial-gradient(circle at 12% 14%, rgba(101, 194, 255, 0.18), transparent 44%),
      linear-gradient(146deg, rgba(16, 36, 58, 0.9), rgba(13, 29, 46, 0.84));
    box-shadow: 0 14px 28px rgba(5, 12, 20, 0.28), inset 0 1px 0 rgba(255, 255, 255, 0.08);
    overflow: hidden;
  }

  .lesson-add-card::before {
    content: "";
    position: absolute;
    inset: 0 0 auto 0;
    height: 1px;
    background: linear-gradient(90deg, transparent 0%, rgba(164, 223, 255, 0.78) 50%, transparent 100%);
    pointer-events: none;
  }

  .lesson-add-top {
    align-items: center;
    gap: 10px;
  }

  .lesson-add-top h3 {
    font-size: 1rem;
  }

  .lesson-add-top p {
    margin-top: 5px;
    font-size: 0.8rem;
    line-height: 1.65;
  }

  .lesson-add-action {
    grid-template-columns: minmax(0, 1fr) auto;
    gap: 10px;
    align-items: stretch;
  }

  .lesson-add-action input {
    min-height: 46px;
    border-radius: 13px;
    padding-inline: 14px;
    border: 1px solid rgba(145, 194, 230, 0.32);
    background: rgba(8, 25, 42, 0.62);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06);
  }

  .lesson-add-action input::placeholder {
    color: rgba(205, 226, 244, 0.68);
  }

  .lesson-add-action input:focus-visible {
    outline: none;
    border-color: rgba(121, 202, 255, 0.74);
    box-shadow: 0 0 0 3px rgba(78, 170, 229, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.08);
  }

  .lesson-add-btn {
    min-height: 46px;
    min-width: 138px;
    border-radius: 13px;
    padding-inline: 16px;
    font-weight: 800;
    box-shadow: 0 12px 22px rgba(20, 86, 129, 0.34);
  }

  .lesson-add-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 15px 26px rgba(20, 86, 129, 0.38);
  }

  .lesson-chapter-grid {
    gap: clamp(12px, 1.2vw, 16px);
    grid-template-columns: repeat(2, minmax(0, 1fr));
    width: 100%;
    max-width: 100%;
    margin-inline: 0;
    align-items: stretch;
  }

  .lesson-chapter-card {
    min-width: 0;
    min-height: clamp(132px, 11.6vw, 154px);
    border-radius: 18px;
    border-color: rgba(144, 194, 231, 0.34);
    background:
      radial-gradient(circle at 82% 14%, rgba(99, 188, 244, 0.16), transparent 40%),
      linear-gradient(154deg, rgba(15, 33, 52, 0.88), rgba(12, 27, 43, 0.82));
    box-shadow: 0 16px 28px rgba(6, 12, 20, 0.28), inset 0 1px 0 rgba(255, 255, 255, 0.06);
  }

  .lesson-chapter-open {
    min-width: 0;
    min-height: 100%;
    padding: 13px 14px 12px;
    gap: 8px;
  }

  .lesson-chapter-head h3 {
    font-size: 1.03rem;
  }

  .lesson-chapter-head p {
    margin-top: 4px;
    font-size: 0.78rem;
    line-height: 1.54;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    overflow: hidden;
  }

  .lesson-chapter-meta {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 6px;
    width: 100%;
  }

  .lesson-chapter-badge {
    position: relative;
    min-width: 0;
    min-height: 26px;
    padding: 3px 9px 3px 10px;
    border-radius: 10px;
    border: 1px solid rgba(139, 190, 226, 0.36);
    background:
      linear-gradient(148deg, rgba(88, 170, 224, 0.2), rgba(88, 170, 224, 0.05)),
      linear-gradient(90deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0) 38%),
      rgba(10, 24, 38, 0.56);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 6px 12px rgba(5, 12, 20, 0.16);
    display: inline-flex;
    align-items: center;
    justify-content: flex-start;
    gap: 6px;
    font-size: 0.69rem;
    font-weight: 760;
    line-height: 1.12;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .lesson-chapter-badge::before {
    content: "";
    width: 8px;
    height: 8px;
    border-radius: 2px;
    transform: rotate(45deg);
    flex: 0 0 8px;
    box-shadow: 0 0 0 2px rgba(114, 196, 247, 0.16);
    background: linear-gradient(145deg, rgba(118, 210, 255, 0.95), rgba(97, 181, 235, 0.72));
  }

  .lesson-chapter-badge::after {
    content: "";
    margin-inline-start: auto;
    width: 18px;
    height: 1px;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(128, 203, 250, 0.72), transparent);
    opacity: 0.88;
    flex: 0 0 auto;
  }

  .lesson-chapter-badge.lesson-chapter-badge-count {
    border-color: rgba(104, 194, 255, 0.46);
    background:
      linear-gradient(148deg, rgba(104, 194, 255, 0.24), rgba(104, 194, 255, 0.08)),
      linear-gradient(90deg, rgba(181, 232, 255, 0.1), rgba(181, 232, 255, 0) 40%),
      rgba(10, 24, 38, 0.58);
  }

  .lesson-chapter-badge.lesson-chapter-badge-count::before {
    box-shadow: 0 0 0 2px rgba(104, 194, 255, 0.22);
    background: linear-gradient(145deg, rgba(140, 218, 255, 0.96), rgba(91, 186, 240, 0.78));
  }

  .lesson-chapter-badge.lesson-chapter-badge-count::after {
    background: linear-gradient(90deg, rgba(117, 202, 255, 0.78), transparent);
  }

  .lesson-chapter-badge.lesson-chapter-badge-load.is-ready {
    border-color: rgba(116, 233, 191, 0.5);
    background:
      linear-gradient(148deg, rgba(116, 233, 191, 0.24), rgba(116, 233, 191, 0.08)),
      linear-gradient(90deg, rgba(171, 249, 221, 0.1), rgba(171, 249, 221, 0) 40%),
      rgba(10, 31, 29, 0.56);
    color: #d5ffed;
  }

  .lesson-chapter-badge.lesson-chapter-badge-load.is-ready::before {
    box-shadow: 0 0 0 2px rgba(116, 233, 191, 0.24);
    background: linear-gradient(145deg, rgba(145, 245, 208, 0.96), rgba(102, 214, 175, 0.82));
  }

  .lesson-chapter-badge.lesson-chapter-badge-load.is-ready::after {
    background: linear-gradient(90deg, rgba(125, 235, 196, 0.82), transparent);
  }

  .lesson-chapter-badge.lesson-chapter-badge-load.is-loading {
    border-color: rgba(255, 191, 122, 0.48);
    background:
      linear-gradient(148deg, rgba(255, 191, 122, 0.24), rgba(255, 191, 122, 0.08)),
      linear-gradient(90deg, rgba(255, 221, 177, 0.1), rgba(255, 221, 177, 0) 40%),
      rgba(39, 25, 12, 0.52);
    color: #ffe0ba;
  }

  .lesson-chapter-badge.lesson-chapter-badge-load.is-loading::before {
    box-shadow: 0 0 0 2px rgba(255, 191, 122, 0.24);
    background: linear-gradient(145deg, rgba(255, 216, 158, 0.98), rgba(241, 170, 84, 0.84));
  }

  .lesson-chapter-badge.lesson-chapter-badge-load.is-loading::after {
    background: linear-gradient(90deg, rgba(255, 201, 129, 0.84), transparent);
  }

  .lesson-chapter-badge.lesson-chapter-badge-difficulty {
    border-color: rgba(172, 166, 255, 0.46);
    background:
      linear-gradient(148deg, rgba(172, 166, 255, 0.24), rgba(172, 166, 255, 0.08)),
      linear-gradient(90deg, rgba(218, 214, 255, 0.1), rgba(218, 214, 255, 0) 40%),
      rgba(21, 21, 43, 0.56);
    color: #e6e5ff;
  }

  .lesson-chapter-badge.lesson-chapter-badge-difficulty::before {
    box-shadow: 0 0 0 2px rgba(172, 166, 255, 0.24);
    background: linear-gradient(145deg, rgba(202, 198, 255, 0.98), rgba(149, 143, 244, 0.82));
  }

  .lesson-chapter-badge.lesson-chapter-badge-difficulty::after {
    background: linear-gradient(90deg, rgba(188, 183, 255, 0.82), transparent);
  }

  .chapter-card-tools {
    top: 12px;
    left: 12px;
    display: inline-flex;
    align-items: center;
    gap: 7px;
    grid-template-columns: none;
    grid-template-rows: none;
    padding: 6px;
    border-radius: 13px;
    border-color: rgba(146, 196, 233, 0.34);
    background: linear-gradient(150deg, rgba(12, 24, 36, 0.82), rgba(10, 20, 31, 0.76));
    box-shadow: 0 12px 24px rgba(6, 11, 17, 0.32), inset 0 1px 0 rgba(255, 255, 255, 0.12);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  .lesson-chapter-card:hover .chapter-card-tools {
    transform: translateY(-1px);
    box-shadow: 0 15px 28px rgba(6, 12, 19, 0.36), inset 0 1px 0 rgba(255, 255, 255, 0.14);
  }

  .chapter-card-tools .icon-order-btn,
  .chapter-card-tools .icon-delete-btn {
    width: 36px;
    height: 36px;
    min-height: 36px;
    border-radius: 11px;
    transition: transform 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
  }

  .chapter-card-tools .icon-order-btn {
    border-color: rgba(138, 187, 222, 0.38);
    background: linear-gradient(145deg, rgba(18, 38, 58, 0.82), rgba(14, 30, 46, 0.72));
    color: #ceeaff;
  }

  .chapter-card-tools .icon-order-btn[data-action="move-chapter-up"] {
    border-color: rgba(109, 199, 255, 0.5);
    color: #d7f1ff;
  }

  .chapter-card-tools .icon-order-btn[data-action="move-chapter-down"] {
    border-color: rgba(140, 193, 232, 0.4);
    color: #bed7eb;
  }

  .chapter-card-tools .icon-delete-btn {
    border-color: rgba(255, 140, 156, 0.44);
    background: linear-gradient(145deg, rgba(70, 24, 35, 0.7), rgba(58, 17, 29, 0.6));
    color: #ffc4d0;
  }

  .chapter-card-tools :is(.icon-order-btn, .icon-delete-btn):hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 16px rgba(8, 16, 25, 0.32);
  }

  .chapter-card-tools :is(.icon-order-btn, .icon-delete-btn):focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px rgba(113, 196, 252, 0.22);
  }

  .chapter-card-tools .icon-delete-btn:hover {
    border-color: rgba(255, 148, 164, 0.72);
    background: linear-gradient(145deg, rgba(93, 29, 43, 0.78), rgba(73, 20, 33, 0.72));
  }

  .chapter-card-tools .icon-order-btn:disabled {
    opacity: 0.32;
    background: rgba(61, 85, 105, 0.34);
    box-shadow: none;
  }
}

@media (min-width: 1024px) {
  html[data-theme^="light-"] .lesson-add-card,
  html[data-theme^="light-"] .lesson-chapter-card {
    border-color: rgba(112, 168, 205, 0.34);
    background:
      radial-gradient(circle at 90% 12%, rgba(118, 198, 243, 0.2), transparent 40%),
      linear-gradient(150deg, rgba(252, 255, 255, 0.96), rgba(240, 249, 255, 0.92));
    box-shadow: 0 14px 26px rgba(29, 63, 90, 0.16), inset 0 1px 0 rgba(255, 255, 255, 0.94);
  }

  html[data-theme^="light-"] .lesson-add-action input {
    border-color: rgba(118, 174, 207, 0.32);
    background: rgba(255, 255, 255, 0.95);
    color: #214f72;
  }

  html[data-theme^="light-"] .lesson-add-action input::placeholder {
    color: rgba(46, 95, 128, 0.62);
  }

  html[data-theme^="light-"] .chapter-card-tools {
    border-color: rgba(118, 172, 204, 0.34);
    background: linear-gradient(150deg, rgba(249, 253, 255, 0.94), rgba(234, 246, 255, 0.9));
    box-shadow: 0 12px 20px rgba(35, 70, 97, 0.16), inset 0 1px 0 rgba(255, 255, 255, 0.96);
  }

  html[data-theme^="light-"] .chapter-card-tools .icon-order-btn {
    border-color: rgba(117, 171, 205, 0.38);
    background: linear-gradient(145deg, rgba(242, 250, 255, 0.96), rgba(226, 241, 251, 0.9));
    color: #2b658a;
  }

  html[data-theme^="light-"] .chapter-card-tools .icon-delete-btn {
    border-color: rgba(223, 133, 149, 0.48);
    background: linear-gradient(145deg, rgba(255, 242, 245, 0.95), rgba(255, 228, 233, 0.9));
    color: #b84560;
  }

  html[data-theme^="light-"] .lesson-chapter-badge {
    border-color: rgba(108, 167, 206, 0.34);
    background:
      linear-gradient(148deg, rgba(111, 183, 230, 0.16), rgba(111, 183, 230, 0.04)),
      linear-gradient(90deg, rgba(120, 191, 234, 0.08), rgba(120, 191, 234, 0) 40%),
      rgba(255, 255, 255, 0.94);
    color: #255779;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.96);
  }

  html[data-theme^="light-"] .lesson-chapter-badge::before {
    box-shadow: 0 0 0 2px rgba(117, 187, 224, 0.16);
    background: linear-gradient(145deg, rgba(113, 187, 228, 0.9), rgba(73, 153, 200, 0.78));
  }

  html[data-theme^="light-"] .lesson-chapter-badge::after {
    background: linear-gradient(90deg, rgba(100, 173, 216, 0.56), transparent);
  }

  html[data-theme^="light-"] .lesson-chapter-badge.lesson-chapter-badge-load.is-ready {
    border-color: rgba(84, 172, 134, 0.4);
    background:
      linear-gradient(145deg, rgba(112, 210, 165, 0.2), rgba(112, 210, 165, 0.06)),
      rgba(247, 255, 251, 0.96);
    color: #1f6d4a;
  }

  html[data-theme^="light-"] .lesson-chapter-badge.lesson-chapter-badge-load.is-loading {
    border-color: rgba(211, 152, 84, 0.42);
    background:
      linear-gradient(145deg, rgba(255, 201, 135, 0.22), rgba(255, 201, 135, 0.07)),
      rgba(255, 251, 246, 0.96);
    color: #8b571e;
  }

  html[data-theme^="light-"] .lesson-chapter-badge.lesson-chapter-badge-difficulty {
    border-color: rgba(146, 138, 223, 0.4);
    background:
      linear-gradient(145deg, rgba(166, 160, 239, 0.2), rgba(166, 160, 239, 0.06)),
      rgba(248, 247, 255, 0.96);
    color: #4f4a95;
  }
}

/* Profile quick controls: compact icon mode + theme rail */
.profile-hub .profile-quick-access {
  margin-top: 10px;
  gap: 8px;
}

.profile-hub .profile-quick-card {
  padding: 8px;
  gap: 7px;
  border-radius: 12px;
}

.profile-hub .profile-quick-head {
  min-height: 24px;
  justify-content: flex-start;
  gap: 6px;
}

.profile-hub .profile-quick-head strong {
  font-size: 0.74rem;
  letter-spacing: -0.01em;
}

.profile-hub .profile-quick-head-icon {
  width: 20px;
  height: 20px;
  border-radius: 7px;
}

.profile-hub .profile-quick-head-icon svg {
  width: 12px;
  height: 12px;
}

.profile-hub .profile-quick-viewport-strip {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 6px;
}

.profile-hub .profile-quick-viewport-btn.profile-quick-icon-btn {
  min-width: 0;
  min-height: 38px;
  padding: 0;
  border-radius: 10px;
  background: var(--surface-soft);
}

.profile-hub .profile-quick-btn-icon {
  width: 18px;
  height: 18px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: var(--profile-text);
  opacity: 0.9;
}

.profile-hub .profile-quick-btn-icon svg {
  width: 18px;
  height: 18px;
  fill: none;
  stroke: currentColor;
  stroke-width: 1.85;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.profile-hub .profile-quick-theme-strip.profile-quick-theme-rail {
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  gap: 5px;
  min-height: 40px;
  padding: 4px;
  border-radius: 999px;
  border: 1px solid var(--profile-border);
  background:
    radial-gradient(circle at 14% 18%, var(--accent-soft), transparent 42%),
    var(--surface-soft);
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: x proximity;
  scrollbar-width: thin;
}

.profile-hub .profile-quick-theme-btn {
  position: relative;
  flex: 0 0 auto;
  min-width: 42px;
  width: 42px;
  min-height: 30px;
  padding: 0;
  border-radius: 999px;
  border: 1px solid transparent;
  background: var(--surface-soft);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.07);
  scroll-snap-align: start;
}

.profile-hub .profile-quick-theme-btn::after {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: 6px;
  height: 6px;
  margin-top: -3px;
  margin-left: -3px;
  border-radius: 999px;
  background: rgba(236, 248, 255, 0.88);
  box-shadow: 0 0 0 2px rgba(8, 22, 37, 0.2);
  opacity: 0;
  transform: scale(0.7);
  transition: opacity 0.2s ease, transform 0.2s ease;
}

.profile-hub .profile-quick-theme-dot {
  width: 14px;
  height: 14px;
  border-width: 1px;
}

.profile-hub .profile-quick-theme-btn:hover,
.profile-hub .profile-quick-viewport-btn.profile-quick-icon-btn:hover {
  transform: translateY(-1px);
  border-color: var(--accent);
}

.profile-hub .profile-quick-theme-btn:focus-visible,
.profile-hub .profile-quick-viewport-btn.profile-quick-icon-btn:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(114, 193, 247, 0.22);
}

.profile-hub .profile-quick-viewport-btn.is-active .profile-quick-btn-icon,
.profile-hub .profile-quick-viewport-btn[aria-pressed="true"] .profile-quick-btn-icon {
  color: var(--profile-text);
  opacity: 1;
}

.profile-hub .profile-quick-theme-btn.is-active,
.profile-hub .profile-quick-theme-btn[aria-pressed="true"] {
  border-color: var(--accent);
  background:
    linear-gradient(145deg, var(--accent-soft), transparent),
    var(--surface-strong);
  box-shadow: 0 0 0 1px var(--accent-soft), inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.profile-hub .profile-quick-theme-btn.is-active::after,
.profile-hub .profile-quick-theme-btn[aria-pressed="true"]::after {
  opacity: 1;
  transform: scale(1);
}

.profile-hub .profile-quick-meta {
  min-height: 14px;
  font-size: 0.67rem;
  line-height: 1.4;
  opacity: 0.9;
}

@media (max-width: 680px) {
  .profile-hub .profile-quick-access {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 420px) {
  .profile-hub .profile-quick-card {
    padding: 7px;
  }

  .profile-hub .profile-quick-viewport-btn.profile-quick-icon-btn {
    min-height: 36px;
  }

  .profile-hub .profile-quick-theme-strip.profile-quick-theme-rail {
    min-height: 38px;
  }
}

html[data-theme^="light-"] .profile-hub .profile-quick-theme-strip.profile-quick-theme-rail {
  border-color: rgba(121, 175, 207, 0.36);
  background:
    radial-gradient(circle at 16% 20%, rgba(126, 199, 239, 0.18), transparent 42%),
    rgba(246, 252, 255, 0.94);
}

html[data-theme^="light-"] .profile-hub .profile-quick-btn-icon {
  color: #2b6389;
}

html[data-theme^="light-"] .profile-hub .profile-quick-theme-btn {
  background: rgba(255, 255, 255, 0.92);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.92);
}

html[data-theme^="light-"] .profile-hub .profile-quick-theme-btn::after {
  box-shadow: 0 0 0 2px rgba(169, 204, 226, 0.5);
  background: rgba(24, 77, 111, 0.88);
}

/* Chapter Map V2: Orbit / Constellation */
.chapter-map-layout.chapter-map-layout-orbit {
  grid-template-columns: minmax(0, 1.42fr) minmax(240px, 0.58fr);
  gap: 12px;
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-stage {
  min-height: 430px;
  border-radius: 18px;
  border-color: rgba(134, 186, 224, 0.3);
  background:
    radial-gradient(circle at 12% 16%, rgba(115, 203, 255, 0.22), transparent 36%),
    radial-gradient(circle at 88% 84%, rgba(122, 206, 255, 0.14), transparent 42%),
    linear-gradient(152deg, rgba(8, 21, 34, 0.9), rgba(7, 18, 30, 0.84));
  box-shadow: 0 18px 34px rgba(4, 10, 18, 0.34), inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-canvas {
  min-height: 430px;
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-svg {
  width: 100%;
  height: 100%;
  display: block;
  touch-action: none;
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-toolbar-meta {
  font-size: 0.74rem;
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-action-btn {
  min-height: 36px;
  border-radius: 11px;
  padding-inline: 10px;
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-action-btn:disabled {
  opacity: 0.56;
  cursor: not-allowed;
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-action-btn[data-action="chapter-map-toggle-simple"] {
  border-color: rgba(126, 194, 237, 0.48);
  background: linear-gradient(148deg, rgba(67, 155, 221, 0.24), rgba(67, 155, 221, 0.1));
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-search {
  min-height: 38px;
  border-radius: 11px;
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-legend {
  min-height: 430px;
  border-radius: 16px;
  border-color: rgba(137, 186, 222, 0.28);
  background:
    radial-gradient(circle at 14% 12%, rgba(121, 199, 244, 0.14), transparent 46%),
    rgba(10, 23, 37, 0.56);
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-legend-list {
  max-height: 370px;
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-review-chip {
  min-width: 38px;
  justify-content: center;
}

.chapter-orbit-svg {
  font-family: "Vazirmatn", sans-serif;
}

.chapter-orbit-stars circle {
  opacity: 0.34;
}

.chapter-orbit-ring {
  fill: none;
  stroke: rgba(132, 197, 237, 0.24);
  stroke-width: 1.1;
  stroke-dasharray: 3.5 8;
}

.chapter-orbit-root-glow {
  fill: rgba(92, 188, 246, 0.24);
}

.chapter-orbit-root-ring {
  fill: rgba(88, 185, 244, 0.14);
  stroke: rgba(128, 214, 255, 0.56);
  stroke-width: 1.3;
}

.chapter-orbit-root-card {
  fill: rgba(8, 20, 33, 0.84);
  stroke: rgba(145, 208, 244, 0.44);
  stroke-width: 1.15;
}

.chapter-orbit-root-title {
  font-size: 0.92rem;
  font-weight: 800;
  fill: #e5f5ff;
  letter-spacing: -0.01em;
}

.chapter-orbit-root-subtitle {
  font-size: 0.68rem;
  font-weight: 600;
  fill: rgba(188, 218, 241, 0.92);
}

.chapter-orbit-link {
  fill: none;
  stroke-width: 1.85;
  opacity: 0.82;
  transition: opacity 0.2s ease, stroke-width 0.2s ease;
}

.chapter-map-link.is-focused,
.chapter-map-link.is-search-match {
  opacity: 1;
  stroke-width: 2.7;
}

.chapter-orbit-node {
  outline: none;
}

.chapter-orbit-node-halo {
  fill: rgba(97, 189, 246, 0.16);
  opacity: 0;
  transition: opacity 0.2s ease;
}

.chapter-orbit-node-ring {
  fill: rgba(90, 182, 239, 0.13);
  stroke: rgba(129, 211, 255, 0.52);
  stroke-width: 1.25;
  transition: stroke 0.2s ease, fill 0.2s ease;
}

.chapter-orbit-node-card {
  fill: rgba(9, 22, 36, 0.86);
  stroke: rgba(146, 194, 230, 0.34);
  stroke-width: 1;
}

.chapter-orbit-node-title {
  fill: #e9f7ff;
  font-size: 0.71rem;
  font-weight: 700;
  pointer-events: none;
}

.chapter-orbit-node-badges text {
  fill: #d8efff;
  font-size: 0.57rem;
  font-weight: 700;
  pointer-events: none;
}

.chapter-orbit-node-badge rect {
  stroke-width: 1;
}

.chapter-orbit-node-badge-total rect {
  fill: rgba(92, 183, 243, 0.18);
  stroke: rgba(131, 209, 255, 0.4);
}

.chapter-orbit-node-badge-review rect {
  fill: rgba(255, 110, 134, 0.18);
  stroke: rgba(255, 136, 156, 0.44);
}

.chapter-orbit-node-badge-review text {
  fill: #ffd4df;
}

.chapter-orbit-node-badge-muted rect {
  fill: rgba(136, 170, 195, 0.14);
  stroke: rgba(146, 184, 212, 0.32);
}

.chapter-orbit-node-badge-muted text {
  fill: rgba(192, 214, 231, 0.92);
}

.chapter-map-node.is-current .chapter-orbit-node-ring,
.chapter-map-node.is-focused .chapter-orbit-node-ring,
.chapter-map-node.is-search-match .chapter-orbit-node-ring,
.chapter-map-node:focus-visible .chapter-orbit-node-ring {
  stroke: rgba(124, 214, 255, 0.92);
  fill: rgba(104, 194, 249, 0.22);
}

.chapter-map-node.is-current .chapter-orbit-node-card,
.chapter-map-node.is-focused .chapter-orbit-node-card,
.chapter-map-node.is-search-match .chapter-orbit-node-card,
.chapter-map-node:focus-visible .chapter-orbit-node-card {
  stroke: rgba(127, 214, 255, 0.86);
}

.chapter-map-node.is-current .chapter-orbit-node-halo,
.chapter-map-node.is-focused .chapter-orbit-node-halo,
.chapter-map-node.is-search-match .chapter-orbit-node-halo,
.chapter-map-node:focus-visible .chapter-orbit-node-halo {
  opacity: 1;
}

.chapter-map-node.is-current .chapter-orbit-node-title,
.chapter-map-node.is-focused .chapter-orbit-node-title,
.chapter-map-node.is-search-match .chapter-orbit-node-title {
  fill: #f4fbff;
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-fallback {
  padding: 10px;
}

.chapter-map-layout.chapter-map-layout-orbit .chapter-map-fallback-note {
  border-style: solid;
  border-color: rgba(137, 186, 222, 0.36);
}

@media (max-width: 1023px) {
  .chapter-map-layout.chapter-map-layout-orbit {
    grid-template-columns: 1fr;
  }

  .chapter-map-layout.chapter-map-layout-orbit .chapter-map-stage,
  .chapter-map-layout.chapter-map-layout-orbit .chapter-map-canvas,
  .chapter-map-layout.chapter-map-layout-orbit .chapter-map-legend {
    min-height: 360px;
  }

  .chapter-map-layout.chapter-map-layout-orbit .chapter-map-legend-list {
    max-height: 260px;
  }

  .chapter-map-layout.chapter-map-layout-orbit .chapter-map-search-wrap {
    grid-template-columns: 1fr;
    gap: 8px;
  }

  .chapter-map-layout.chapter-map-layout-orbit .chapter-map-actions {
    justify-content: stretch;
    gap: 7px;
  }

  .chapter-map-layout.chapter-map-layout-orbit .chapter-map-action-btn {
    flex: 1 1 calc(50% - 4px);
    justify-content: center;
  }
}

html[data-theme^="light-"] .chapter-map-layout.chapter-map-layout-orbit .chapter-map-stage {
  border-color: rgba(101, 157, 194, 0.28);
  background:
    radial-gradient(circle at 12% 16%, rgba(112, 188, 233, 0.18), transparent 36%),
    radial-gradient(circle at 88% 84%, rgba(120, 194, 236, 0.14), transparent 42%),
    linear-gradient(152deg, rgba(250, 253, 255, 0.96), rgba(238, 248, 255, 0.92));
  box-shadow: 0 16px 30px rgba(25, 55, 82, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.94);
}

html[data-theme^="light-"] .chapter-map-layout.chapter-map-layout-orbit .chapter-map-legend {
  border-color: rgba(102, 158, 194, 0.26);
  background:
    radial-gradient(circle at 14% 12%, rgba(130, 199, 238, 0.16), transparent 46%),
    rgba(247, 252, 255, 0.94);
}

html[data-theme^="light-"] .chapter-orbit-ring {
  stroke: rgba(94, 154, 191, 0.3);
}

html[data-theme^="light-"] .chapter-orbit-root-glow {
  fill: rgba(102, 176, 220, 0.22);
}

html[data-theme^="light-"] .chapter-orbit-root-ring {
  fill: rgba(126, 195, 234, 0.18);
  stroke: rgba(78, 149, 196, 0.54);
}

html[data-theme^="light-"] .chapter-orbit-root-card {
  fill: rgba(255, 255, 255, 0.94);
  stroke: rgba(101, 157, 194, 0.42);
}

html[data-theme^="light-"] .chapter-orbit-root-title {
  fill: #1a4b70;
}

html[data-theme^="light-"] .chapter-orbit-root-subtitle {
  fill: rgba(52, 94, 126, 0.84);
}

html[data-theme^="light-"] .chapter-orbit-node-ring {
  fill: rgba(126, 194, 234, 0.16);
  stroke: rgba(99, 161, 198, 0.44);
}

html[data-theme^="light-"] .chapter-orbit-node-card {
  fill: rgba(255, 255, 255, 0.94);
  stroke: rgba(112, 165, 201, 0.34);
}

html[data-theme^="light-"] .chapter-orbit-node-title {
  fill: #1f5377;
}

html[data-theme^="light-"] .chapter-orbit-node-badges text {
  fill: #2a5e84;
}

html[data-theme^="light-"] .chapter-orbit-node-badge-total rect {
  fill: rgba(136, 203, 239, 0.22);
  stroke: rgba(95, 160, 199, 0.34);
}

html[data-theme^="light-"] .chapter-orbit-node-badge-review rect {
  fill: rgba(247, 179, 194, 0.24);
  stroke: rgba(211, 118, 139, 0.4);
}

html[data-theme^="light-"] .chapter-orbit-node-badge-review text {
  fill: #9b4059;
}

html[data-theme^="light-"] .chapter-orbit-node-badge-muted rect {
  fill: rgba(186, 210, 226, 0.24);
  stroke: rgba(129, 169, 194, 0.34);
}

/* Header V3: compact premium app bar (desktop + mobile) */
.topbar.premium-topbar.qb-header.app-header-v3 {
  --appbar-h-desktop: 56px;
  --appbar-h-mobile: 52px;
  position: sticky;
  top: 8px;
  z-index: 74;
  display: block;
  margin: 0 0 12px;
  padding: 6px 10px;
  border-radius: 14px;
  border: 1px solid rgba(136, 170, 202, 0.24);
  background: rgba(13, 24, 36, 0.82);
  box-shadow: 0 6px 18px rgba(4, 10, 18, 0.2);
  overflow: visible;
  animation: none !important;
  transition: box-shadow 0.2s ease, border-color 0.2s ease, background-color 0.2s ease;
}

.topbar.premium-topbar.qb-header.app-header-v3.is-lifted {
  background: rgba(14, 26, 40, 0.9);
  border-color: rgba(153, 192, 224, 0.3);
  box-shadow: 0 10px 24px rgba(4, 10, 18, 0.28);
}

.topbar.premium-topbar.qb-header.app-header-v3::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  background:
    radial-gradient(circle at 85% 8%, rgba(88, 178, 236, 0.14), transparent 34%),
    radial-gradient(circle at 8% 92%, rgba(78, 160, 216, 0.1), transparent 38%);
}

.topbar.premium-topbar.qb-header.app-header-v3::after {
  content: none;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-shell {
  position: relative;
  z-index: 1;
  min-height: var(--appbar-h-desktop);
  display: grid;
  grid-template-columns: auto minmax(0, 1fr) auto;
  align-items: center;
  gap: 10px;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-start,
.topbar.premium-topbar.qb-header.app-header-v3 .appbar-end {
  min-width: 0;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-center {
  min-width: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  overflow: hidden;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-context {
  min-width: 0;
  display: grid;
  gap: 1px;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-title {
  margin: 0;
  font-size: 1.02rem;
  font-weight: 700;
  line-height: 1.2;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-subtitle {
  margin: 0;
  font-size: 0.72rem;
  color: rgba(209, 225, 241, 0.8);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn {
  border: 0;
  margin: 0;
  padding: 0;
  background: transparent;
  color: inherit;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
  cursor: pointer;
  font: inherit;
}

.topbar.premium-topbar.qb-header.app-header-v3 .header-brand-icon {
  width: 30px;
  height: 30px;
  border-radius: 10px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.topbar.premium-topbar.qb-header.app-header-v3 .header-brand-icon svg {
  width: 17px;
  height: 17px;
  stroke: currentColor;
  stroke-width: 1.8;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-title {
  font-size: 0.84rem;
  font-weight: 700;
  line-height: 1;
  max-width: 140px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segmented {
  min-width: 0;
  flex: 0 1 auto;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 3px;
  border-radius: 12px;
  border: 1px solid rgba(123, 164, 197, 0.24);
  background: rgba(8, 17, 28, 0.48);
  overflow-x: auto;
  scrollbar-width: none;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segmented::-webkit-scrollbar {
  display: none;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn {
  border: 1px solid transparent;
  background: transparent;
  color: rgba(216, 232, 246, 0.9);
  border-radius: 9px;
  height: 30px;
  min-width: 62px;
  padding: 0 10px;
  font: inherit;
  font-size: 0.78rem;
  font-weight: 600;
  line-height: 1;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.18s ease, border-color 0.18s ease, color 0.18s ease;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn:hover {
  background: rgba(86, 153, 202, 0.16);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn.is-active {
  border-color: rgba(100, 191, 248, 0.44);
  background: rgba(86, 169, 224, 0.26);
  color: #eef8ff;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn:disabled {
  opacity: 0.42;
  cursor: not-allowed;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-chip {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: 30px;
  padding: 0 10px;
  border-radius: 999px;
  border: 1px solid rgba(139, 180, 212, 0.28);
  background: rgba(10, 19, 30, 0.56);
  color: rgba(215, 230, 242, 0.9);
  font-size: 0.7rem;
  font-weight: 600;
  line-height: 1;
  white-space: nowrap;
}

.topbar.premium-topbar.qb-header.app-header-v3 #headerQuickMode,
.topbar.premium-topbar.qb-header.app-header-v3 #headerSyncPill {
  height: 30px;
  min-width: 0;
  margin: 0;
  padding: 0 10px;
  border-radius: 999px;
}

.topbar.premium-topbar.qb-header.app-header-v3 #headerQuickContext {
  margin: 0;
  padding: 0;
  border: 0;
  background: transparent;
  font-size: 0.72rem;
  line-height: 1.25;
  color: rgba(209, 225, 241, 0.8);
}

.topbar.premium-topbar.qb-header.app-header-v3 #headerQuickMode::before,
.topbar.premium-topbar.qb-header.app-header-v3 #headerQuickMode::after {
  content: none !important;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-chip-sync[data-state="ok"] {
  border-color: rgba(105, 198, 153, 0.45);
  color: rgba(142, 236, 190, 0.96);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-chip-sync[data-state="warn"] {
  border-color: rgba(226, 186, 96, 0.45);
  color: rgba(245, 219, 156, 0.95);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-chip-sync[data-state="syncing"] {
  border-color: rgba(121, 196, 246, 0.45);
  color: rgba(193, 232, 255, 0.96);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-icon-btn {
  width: 36px;
  height: 36px;
  border-radius: 11px;
  border: 1px solid rgba(142, 182, 213, 0.26);
  background: rgba(8, 18, 29, 0.55);
  color: rgba(214, 231, 245, 0.94);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.18s ease, border-color 0.18s ease, color 0.18s ease;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-icon-btn:hover {
  background: rgba(84, 154, 204, 0.2);
  border-color: rgba(117, 185, 236, 0.38);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-icon-btn svg {
  width: 18px;
  height: 18px;
  stroke: currentColor;
  stroke-width: 1.95;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-toggle svg circle {
  fill: currentColor;
  stroke: none;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-settings-btn::after {
  content: none;
}

.topbar.premium-topbar.qb-header.app-header-v3 #settingsPanelToggle {
  width: 36px;
  height: 36px;
  min-width: 36px;
  padding: 0;
  border-radius: 11px;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-settings-btn .settings-trigger-status {
  position: absolute;
  top: 5px;
  inset-inline-start: 5px;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: rgba(97, 209, 154, 0.95);
  box-shadow: 0 0 0 3px rgba(85, 190, 139, 0.14);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-btn {
  display: none;
  align-items: center;
  justify-content: center;
  height: 36px;
  padding: 0 12px;
  border-radius: 11px;
  border: 1px solid rgba(145, 185, 215, 0.28);
  background: rgba(8, 18, 29, 0.55);
  color: rgba(221, 234, 246, 0.94);
  font: inherit;
  font-size: 0.77rem;
  font-weight: 600;
  line-height: 1;
  cursor: pointer;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-menu {
  position: absolute;
  top: calc(100% + 8px);
  inset-inline-end: 10px;
  min-width: 194px;
  padding: 6px;
  border-radius: 12px;
  border: 1px solid rgba(140, 180, 210, 0.3);
  background: rgba(8, 17, 28, 0.95);
  box-shadow: 0 14px 28px rgba(4, 10, 17, 0.34);
  display: grid;
  gap: 4px;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-menu[hidden] {
  display: none !important;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-item {
  height: 36px;
  border: 1px solid transparent;
  border-radius: 9px;
  background: transparent;
  color: rgba(220, 234, 246, 0.94);
  font: inherit;
  font-size: 0.79rem;
  font-weight: 600;
  cursor: pointer;
  text-align: start;
  padding: 0 10px;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-item:hover {
  background: rgba(88, 159, 209, 0.18);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-item.is-active {
  border-color: rgba(108, 195, 248, 0.5);
  background: rgba(82, 168, 223, 0.28);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-item:disabled {
  opacity: 0.44;
  cursor: not-allowed;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-sheet {
  position: fixed;
  inset: 0;
  z-index: 90;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-sheet[hidden] {
  display: none !important;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(4, 10, 18, 0.56);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-panel {
  position: absolute;
  inset-inline: 0;
  bottom: 0;
  width: min(680px, 100%);
  margin-inline: auto;
  border-radius: 16px 16px 0 0;
  border: 1px solid rgba(139, 179, 209, 0.3);
  background: rgba(10, 19, 30, 0.98);
  box-shadow: 0 -10px 30px rgba(4, 10, 17, 0.34);
  padding: 10px 12px calc(12px + env(safe-area-inset-bottom, 0px));
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 10px;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-head h2 {
  margin: 0;
  font-size: 0.92rem;
  font-weight: 700;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-close {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  border: 1px solid rgba(139, 179, 209, 0.32);
  background: rgba(8, 18, 30, 0.66);
  color: inherit;
  font-size: 1.2rem;
  line-height: 1;
  cursor: pointer;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-list {
  display: grid;
  gap: 8px;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-item {
  min-height: 44px;
  border-radius: 12px;
  border: 1px solid rgba(141, 181, 211, 0.28);
  background: rgba(8, 18, 30, 0.58);
  color: rgba(222, 236, 248, 0.96);
  font: inherit;
  font-size: 0.84rem;
  font-weight: 600;
  line-height: 1;
  cursor: pointer;
  text-align: start;
  padding: 0 12px;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-item.is-active {
  border-color: rgba(108, 195, 248, 0.5);
  background: rgba(82, 168, 223, 0.28);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-item:disabled {
  opacity: 0.45;
  cursor: not-allowed;
}

.topbar.premium-topbar.qb-header.app-header-v3 .settings-panel.settings-panel-premium {
  position: relative;
  z-index: 1;
  margin-top: 8px;
  margin-inline-start: auto;
}

.topbar.premium-topbar.qb-header.app-header-v3 button:focus-visible,
.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn:focus-visible,
.topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-item:focus-visible,
.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-item:focus-visible {
  outline: none;
  border-color: rgba(124, 199, 247, 0.66);
  box-shadow: 0 0 0 2px rgba(83, 172, 232, 0.24);
}

body.header-sheet-open {
  overflow: hidden;
}

@supports ((backdrop-filter: blur(14px)) or (-webkit-backdrop-filter: blur(14px))) {
  .topbar.premium-topbar.qb-header.app-header-v3 {
    backdrop-filter: blur(14px) saturate(132%);
    -webkit-backdrop-filter: blur(14px) saturate(132%);
  }
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 {
  background: rgba(247, 252, 255, 0.86);
  border-color: rgba(96, 150, 186, 0.26);
  box-shadow: 0 8px 20px rgba(24, 56, 82, 0.13);
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3.is-lifted {
  background: rgba(251, 255, 255, 0.94);
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-subtitle,
html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 #headerQuickContext,
html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-chip,
html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn,
html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-icon-btn,
html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-btn,
html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-item,
html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-item {
  color: #214c70;
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-segmented,
html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-chip,
html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-icon-btn,
html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-btn {
  border-color: rgba(102, 160, 199, 0.24);
  background: rgba(238, 247, 255, 0.74);
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-menu,
html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-panel {
  border-color: rgba(104, 159, 197, 0.26);
  background: rgba(249, 253, 255, 0.98);
}

@media (max-width: 1023px) {
  .topbar.premium-topbar.qb-header.app-header-v3 {
    padding: 4px 8px;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-shell {
    min-height: var(--appbar-h-mobile);
    gap: 8px;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-subtitle,
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-segmented,
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-chip-mode,
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-chip-sync,
  .topbar.premium-topbar.qb-header.app-header-v3 #headerSearchBtn,
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn,
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-title {
    display: none !important;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-title {
    font-size: 0.9rem;
    text-align: start;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-context {
    max-width: 100%;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-center {
    justify-content: flex-start;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-icon-btn,
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-btn {
    width: 44px;
    height: 44px;
    min-width: 44px;
    border-radius: 12px;
    padding: 0;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-btn {
    display: inline-flex;
    width: auto;
    min-width: 64px;
    padding: 0 10px;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 #settingsPanelToggle {
    width: 44px;
    height: 44px;
    min-width: 44px;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-menu {
    inset-inline-end: 8px;
    min-width: 180px;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .settings-panel.settings-panel-premium {
    width: min(96vw, 720px);
    margin-inline: auto;
  }
}

@media (prefers-reduced-motion: reduce) {
  .topbar.premium-topbar.qb-header.app-header-v3,
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-icon-btn,
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn,
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-item,
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-item {
    transition: none !important;
  }
}

/* Header v3 layout polish: strict 3-zone composition */
.topbar.premium-topbar.qb-header.app-header-v3 {
  --header-control-h: 44px;
  --header-gap-sm: 8px;
  --header-gap-md: 12px;
  --header-gap-lg: 16px;
  padding: 4px 10px !important;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-shell {
  grid-template-columns: auto minmax(0, 1fr) auto !important;
  align-items: center !important;
  min-height: 56px !important;
  gap: var(--header-gap-md) !important;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-zone {
  display: inline-flex;
  align-items: center;
  min-width: 0;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-start {
  max-width: min(35vw, 460px);
  gap: var(--header-gap-sm);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-back-btn {
  flex: 0 0 auto;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-back-btn[hidden] {
  display: none !important;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-back-btn:disabled,
.topbar.premium-topbar.qb-header.app-header-v3 .appbar-back-btn[aria-disabled="true"] {
  opacity: 0.5;
  cursor: default;
  pointer-events: none;
  filter: saturate(0.75);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn {
  width: auto;
  height: auto;
  min-width: 0;
  min-height: 0;
  padding: 0;
  border-radius: 0;
  border: 0;
  background: transparent;
  box-shadow: none;
  justify-content: flex-start;
  gap: 10px;
  flex: 0 0 auto;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-title {
  display: inline-flex !important;
  align-items: center;
  max-width: 220px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: clamp(1.08rem, 1.36vw, 1.42rem);
  font-weight: 900;
  line-height: 1.05;
  letter-spacing: -0.012em;
  color: var(--accent, #7fd5ff);
  background: linear-gradient(135deg, #f3fbff 8%, #97deff 48%, #5bb7f4 100%);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 2px 16px rgba(82, 171, 231, 0.3);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn .header-brand-icon {
  display: inline-grid !important;
  place-items: center;
  width: 34px;
  height: 34px;
  min-width: 34px;
  border-radius: 12px;
  position: relative;
  isolation: isolate;
  overflow: hidden;
  border: 1px solid rgba(136, 206, 249, 0.5);
  background:
    radial-gradient(circle at 26% 22%, rgba(214, 244, 255, 0.78), rgba(128, 207, 255, 0.36) 32%, rgba(20, 66, 104, 0.86) 84%),
    linear-gradient(148deg, rgba(107, 193, 246, 0.42), rgba(17, 49, 82, 0.78));
  box-shadow:
    0 10px 20px rgba(6, 19, 34, 0.36),
    inset 0 1px 0 rgba(255, 255, 255, 0.52),
    0 0 0 1px rgba(122, 199, 245, 0.14);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn .header-brand-icon::before {
  content: "";
  position: absolute;
  inset: -28%;
  border-radius: 50%;
  background: conic-gradient(
    from 0deg,
    rgba(146, 221, 255, 0.08) 0deg,
    rgba(153, 227, 255, 0.62) 86deg,
    rgba(120, 194, 243, 0.08) 178deg,
    rgba(126, 210, 255, 0.58) 266deg,
    rgba(146, 221, 255, 0.08) 360deg
  );
  animation: appbar-premium-emblem-spin 8.8s linear infinite;
  z-index: 0;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn .header-brand-icon::after {
  content: "";
  position: absolute;
  inset: 5px;
  border-radius: 9px;
  border: 1px solid rgba(183, 232, 255, 0.34);
  background: linear-gradient(180deg, rgba(214, 244, 255, 0.14), rgba(71, 148, 206, 0.04));
  z-index: 1;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn .header-brand-icon svg {
  width: 17px;
  height: 17px;
  position: relative;
  z-index: 2;
  color: #edf8ff;
  stroke: currentColor;
  stroke-width: 1.75;
  stroke-linecap: round;
  stroke-linejoin: round;
  filter: drop-shadow(0 1px 6px rgba(74, 170, 232, 0.4));
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn:hover .header-brand-icon,
.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn:focus-visible .header-brand-icon {
  transform: translateY(-1px) scale(1.03);
  box-shadow:
    0 12px 24px rgba(6, 19, 34, 0.44),
    inset 0 1px 0 rgba(255, 255, 255, 0.6),
    0 0 0 1px rgba(139, 214, 255, 0.24);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn:hover,
.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn:focus-visible {
  transform: none;
  box-shadow: none;
  background: transparent;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-context {
  display: none !important;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-hidden-meta[hidden] {
  display: none !important;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-context {
  min-width: 0;
  max-width: 100%;
  gap: 1px;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-title {
  font-size: 0.93rem;
  font-weight: 700;
  line-height: 1.18;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-subtitle,
.topbar.premium-topbar.qb-header.app-header-v3 #headerQuickContext {
  font-size: 0.66rem !important;
  line-height: 1.2 !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-center {
  justify-content: center !important;
  gap: var(--header-gap-md);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segmented {
  position: relative;
  isolation: isolate;
  height: var(--header-control-h);
  max-width: min(100%, 760px);
  border-radius: 999px;
  padding: 3px 4px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  border: 1px solid rgba(132, 188, 225, 0.34);
  background:
    linear-gradient(158deg, rgba(20, 42, 66, 0.9), rgba(9, 24, 40, 0.94)),
    radial-gradient(circle at 86% 18%, rgba(110, 196, 245, 0.16), transparent 52%);
  box-shadow:
    0 10px 22px rgba(4, 12, 22, 0.28),
    inset 0 1px 0 rgba(228, 245, 255, 0.16),
    inset 0 -1px 0 rgba(72, 125, 168, 0.3);
  overflow-x: auto;
  overflow-y: hidden;
  scrollbar-width: none;
  -webkit-mask-image: linear-gradient(90deg, transparent 0, #000 12px, #000 calc(100% - 12px), transparent 100%);
  mask-image: linear-gradient(90deg, transparent 0, #000 12px, #000 calc(100% - 12px), transparent 100%);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segmented::before {
  content: "";
  position: absolute;
  inset: 1px;
  border-radius: inherit;
  pointer-events: none;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0));
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segmented::after {
  content: "";
  position: absolute;
  inset-inline: 16px;
  bottom: 3px;
  height: 1px;
  border-radius: 999px;
  pointer-events: none;
  background: linear-gradient(90deg, transparent, rgba(168, 217, 247, 0.58), transparent);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segmented::-webkit-scrollbar {
  display: none;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn {
  position: relative;
  z-index: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: calc(var(--header-control-h) - 6px);
  min-height: calc(var(--header-control-h) - 6px);
  min-width: 78px;
  border-radius: 999px;
  padding-inline: 14px;
  border: 1px solid rgba(143, 194, 227, 0.2);
  background: linear-gradient(180deg, rgba(51, 84, 116, 0.22), rgba(14, 33, 52, 0.42));
  color: rgba(222, 238, 249, 0.92);
  font-size: 0.79rem;
  font-weight: 700;
  line-height: 1;
  letter-spacing: -0.01em;
  white-space: nowrap;
  transition:
    transform 0.18s ease,
    border-color 0.2s ease,
    background-color 0.2s ease,
    box-shadow 0.2s ease,
    color 0.2s ease;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn::before {
  content: "";
  position: absolute;
  inset: 1px;
  border-radius: inherit;
  pointer-events: none;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0));
  opacity: 0.36;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn span {
  position: relative;
  z-index: 1;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn:hover {
  transform: translateY(-1px);
  border-color: rgba(153, 216, 252, 0.44);
  background: linear-gradient(180deg, rgba(62, 109, 154, 0.34), rgba(24, 47, 72, 0.56));
  box-shadow:
    0 8px 16px rgba(5, 15, 28, 0.3),
    inset 0 1px 0 rgba(235, 249, 255, 0.2);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn.is-active {
  border-color: rgba(164, 228, 255, 0.7);
  background: linear-gradient(142deg, rgba(96, 190, 243, 0.86), rgba(46, 136, 202, 0.92));
  color: #f7fcff;
  box-shadow:
    0 10px 20px rgba(34, 123, 188, 0.44),
    inset 0 1px 0 rgba(241, 251, 255, 0.56);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn.is-active::after {
  content: "";
  position: absolute;
  inset-inline: 16px;
  bottom: 4px;
  height: 2px;
  border-radius: 999px;
  background: linear-gradient(90deg, transparent, rgba(242, 251, 255, 0.94), transparent);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn:active {
  transform: translateY(0);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn:disabled {
  opacity: 0.38;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-mode-a11y {
  position: absolute;
  width: 1px;
  height: 1px;
  margin: -1px;
  padding: 0;
  border: 0;
  overflow: hidden;
  clip: rect(0 0 0 0);
  white-space: nowrap;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sections-btn {
  display: none;
  height: var(--header-control-h);
  min-height: var(--header-control-h);
  border-radius: 999px;
  padding-inline: 12px;
  font-size: 0.78rem;
  font-weight: 700;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-mobile-title {
  display: none;
  min-width: 0;
  align-items: center;
  gap: 8px;
  padding: 0 10px;
  height: var(--header-control-h);
  border-radius: 999px;
  border: 1px solid rgba(141, 199, 235, 0.36);
  background:
    linear-gradient(150deg, rgba(32, 72, 108, 0.46), rgba(10, 28, 45, 0.7)),
    radial-gradient(circle at 86% 16%, rgba(114, 206, 255, 0.22), transparent 58%);
  box-shadow:
    inset 0 1px 0 rgba(238, 250, 255, 0.18),
    0 8px 18px rgba(7, 22, 35, 0.28);
  pointer-events: none;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-mobile-title-orb {
  width: 11px;
  height: 11px;
  min-width: 11px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(214, 246, 255, 0.96), rgba(106, 204, 255, 0.8) 56%, rgba(34, 120, 182, 0.32) 100%);
  box-shadow:
    0 0 0 4px rgba(102, 194, 244, 0.2),
    0 0 14px rgba(102, 194, 244, 0.48);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-mobile-title-text {
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: 0.9rem;
  font-weight: 900;
  letter-spacing: -0.012em;
  line-height: 1;
  color: var(--accent, #8ad9ff);
  background: linear-gradient(135deg, #f2fcff 0%, #8ddaff 48%, #57b8f6 100%);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 2px 10px rgba(84, 179, 235, 0.34);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-end {
  justify-content: flex-end;
  gap: var(--header-gap-sm);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-icon-btn,
.topbar.premium-topbar.qb-header.app-header-v3 #settingsPanelToggle {
  width: var(--header-control-h);
  height: var(--header-control-h);
  min-width: var(--header-control-h);
  min-height: var(--header-control-h);
  border-radius: 12px;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sync-indicator {
  width: 16px !important;
  min-width: 16px !important;
  height: 16px !important;
  min-height: 16px !important;
  padding: 0 !important;
  border-radius: 999px !important;
  font-size: 0 !important;
  color: transparent !important;
  border-width: 1px;
  position: relative;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sync-indicator::after {
  content: "";
  position: absolute;
  inset: 3px;
  border-radius: 50%;
  background: rgba(147, 173, 197, 0.78);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sync-indicator[data-state="ok"]::after {
  background: rgba(98, 210, 153, 0.96);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sync-indicator[data-state="warn"]::after {
  background: rgba(238, 197, 109, 0.96);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-sync-indicator[data-state="syncing"]::after {
  background: rgba(121, 197, 244, 0.96);
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-menu {
  min-width: 196px;
  padding: 6px;
  gap: 4px;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-item {
  height: 36px;
  min-height: 36px;
  border-radius: 10px;
  padding-inline: 10px;
  font-size: 0.78rem;
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-mobile-only {
  display: none;
}

@media (max-width: 1360px) and (min-width: 1024px) {
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn-extended {
    display: none;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-mobile-only {
    display: block;
  }
}

@media (max-width: 1023px) {
  .topbar.premium-topbar.qb-header.app-header-v3 {
    padding: 4px 8px !important;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-shell {
    min-height: 52px !important;
    gap: 8px !important;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-start {
    max-width: min(46vw, 188px);
    gap: 6px;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-subtitle,
  .topbar.premium-topbar.qb-header.app-header-v3 #headerQuickContext {
    display: none !important;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn {
    height: auto;
    min-height: 0;
    padding: 0;
    border: 0;
    background: transparent;
    gap: 8px;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn .header-brand-icon {
    display: inline-grid;
    width: 30px;
    height: 30px;
    min-width: 30px;
    border-radius: 10px;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-title {
    max-width: 156px;
    font-size: 1.01rem;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-segmented {
    display: none !important;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-mobile-title {
    display: inline-flex;
    max-width: min(56vw, 190px);
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-end {
    gap: 6px;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-sync-indicator,
  .topbar.premium-topbar.qb-header.app-header-v3 #settingsPanelToggle {
    display: none !important;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-mobile-only {
    display: block;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-overflow-menu {
    inset-inline-end: 8px;
    max-width: calc(100vw - 16px);
  }
}

@media (max-width: 380px) {
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-start {
    max-width: min(44vw, 152px);
  }

  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-title {
    max-width: 78px;
  }

  .topbar.premium-topbar.qb-header.app-header-v3 #headerSearchBtn {
    display: none !important;
  }
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn {
  border: 0;
  background: transparent;
  box-shadow: none;
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn .header-brand-icon {
  border-color: rgba(76, 160, 212, 0.52);
  background:
    radial-gradient(circle at 28% 22%, rgba(255, 255, 255, 0.92), rgba(182, 222, 247, 0.6) 34%, rgba(73, 143, 190, 0.82) 84%),
    linear-gradient(150deg, rgba(165, 217, 245, 0.42), rgba(84, 154, 202, 0.6));
  box-shadow:
    0 10px 18px rgba(44, 95, 132, 0.22),
    inset 0 1px 0 rgba(255, 255, 255, 0.9),
    0 0 0 1px rgba(119, 186, 228, 0.18);
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn .header-brand-icon::before {
  background: conic-gradient(
    from 0deg,
    rgba(141, 201, 236, 0.08) 0deg,
    rgba(121, 185, 224, 0.56) 86deg,
    rgba(141, 201, 236, 0.08) 178deg,
    rgba(116, 180, 220, 0.52) 266deg,
    rgba(141, 201, 236, 0.08) 360deg
  );
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-title {
  color: #0f5f98;
  background: linear-gradient(135deg, #0f5f98 2%, #1884ba 54%, #45b6e9 100%);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 1px 10px rgba(73, 154, 206, 0.22);
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-segmented {
  border-color: rgba(103, 162, 200, 0.34);
  background:
    linear-gradient(160deg, rgba(237, 247, 255, 0.96), rgba(226, 241, 252, 0.92)),
    radial-gradient(circle at 84% 16%, rgba(112, 188, 233, 0.2), transparent 54%);
  box-shadow:
    0 10px 18px rgba(56, 101, 134, 0.12),
    inset 0 1px 0 rgba(255, 255, 255, 0.88),
    inset 0 -1px 0 rgba(132, 181, 214, 0.24);
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-mobile-title {
  border-color: rgba(99, 173, 217, 0.36);
  background:
    linear-gradient(150deg, rgba(232, 247, 255, 0.9), rgba(214, 236, 250, 0.82)),
    radial-gradient(circle at 84% 14%, rgba(127, 203, 243, 0.26), transparent 62%);
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.86),
    0 8px 16px rgba(56, 113, 150, 0.2);
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-mobile-title-orb {
  background: radial-gradient(circle, rgba(255, 255, 255, 0.98), rgba(131, 205, 244, 0.86) 58%, rgba(59, 136, 194, 0.42) 100%);
  box-shadow:
    0 0 0 4px rgba(106, 183, 225, 0.2),
    0 0 12px rgba(100, 176, 218, 0.42);
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-mobile-title-text {
  background: linear-gradient(135deg, #0f5f98 0%, #1e84b8 48%, #47b6e8 100%);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 1px 9px rgba(91, 168, 214, 0.26);
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-segmented::after {
  background: linear-gradient(90deg, transparent, rgba(106, 173, 217, 0.56), transparent);
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn {
  border-color: rgba(123, 176, 211, 0.26);
  background: linear-gradient(180deg, rgba(243, 251, 255, 0.88), rgba(229, 242, 251, 0.82));
  color: #295978;
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn:hover {
  border-color: rgba(101, 171, 213, 0.5);
  background: linear-gradient(180deg, rgba(230, 245, 255, 0.96), rgba(213, 233, 247, 0.92));
  box-shadow:
    0 8px 14px rgba(44, 92, 127, 0.16),
    inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-segment-btn.is-active {
  border-color: rgba(78, 157, 208, 0.68);
  background: linear-gradient(142deg, rgba(113, 199, 244, 0.96), rgba(62, 149, 208, 0.94));
  color: #f3fbff;
  box-shadow:
    0 9px 18px rgba(74, 143, 190, 0.3),
    inset 0 1px 0 rgba(242, 252, 255, 0.84);
}

@keyframes appbar-premium-emblem-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: reduce) {
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-btn .header-brand-icon::before {
    animation: none;
  }
}

/* Chapter Tree View (Real Node-Link) */
.chapter-map-layout.chapter-map-layout-tree {
  --tree-surface-1: var(--surface1, rgba(18, 32, 47, 0.9));
  --tree-surface-2: var(--surface2, rgba(11, 23, 36, 0.88));
  --tree-surface-3: var(--surface3, rgba(7, 16, 28, 0.84));
  --tree-text-1: var(--text1, var(--text-main));
  --tree-text-2: var(--text2, var(--text-muted));
  --tree-accent: var(--accent, #57b8f6);
  --tree-accent-2: var(--accent2, var(--tree-accent));
  grid-template-columns: minmax(0, 1.44fr) minmax(236px, 0.56fr);
  gap: 12px;
  align-items: stretch;
}

.chapter-map-layout.chapter-map-layout-tree.chapter-map-layout-no-legend {
  grid-template-columns: minmax(0, 1fr);
}

.chapter-map-layout.chapter-map-layout-tree .chapter-map-stage {
  min-height: 440px;
  border-radius: 18px;
  border: 1px solid rgba(132, 188, 226, 0.28);
  border: 1px solid color-mix(in srgb, var(--tree-accent) 24%, transparent);
  background:
    radial-gradient(circle at 12% 12%, color-mix(in srgb, var(--tree-accent) 18%, transparent), transparent 44%),
    radial-gradient(circle at 88% 84%, color-mix(in srgb, var(--tree-accent) 12%, transparent), transparent 48%),
    linear-gradient(150deg, var(--tree-surface-1), var(--tree-surface-2));
  box-shadow: 0 18px 36px rgba(5, 10, 18, 0.34), inset 0 1px 0 rgba(255, 255, 255, 0.06);
}

.chapter-map-layout.chapter-map-layout-tree .chapter-map-canvas {
  min-height: 440px;
}

.chapter-map-layout.chapter-map-layout-tree .chapter-map-search-wrap {
  grid-template-columns: minmax(0, 1fr) auto;
}

.chapter-map-layout.chapter-map-layout-tree .chapter-map-actions {
  flex-wrap: nowrap;
}

.chapter-map-layout.chapter-map-layout-tree .chapter-map-action-btn {
  min-height: 36px;
  border-radius: 11px;
}

.chapter-map-layout.chapter-map-layout-tree .chapter-map-action-btn:disabled {
  opacity: 0.56;
  cursor: not-allowed;
}

.chapter-map-layout.chapter-map-layout-tree .chapter-map-legend {
  min-height: 440px;
  border-radius: 16px;
  border-color: rgba(132, 188, 226, 0.24);
  border-color: color-mix(in srgb, var(--tree-accent) 24%, transparent);
  background: rgba(11, 23, 35, 0.62);
  background:
    radial-gradient(circle at 14% 12%, color-mix(in srgb, var(--tree-accent) 14%, transparent), transparent 48%),
    color-mix(in srgb, var(--tree-surface-1) 74%, transparent);
}

.chapter-map-layout.chapter-map-layout-tree .chapter-map-legend-list {
  max-height: 370px;
}

.chapter-tree-shell {
  position: relative;
  width: 100%;
  height: 100%;
  isolation: isolate;
}

.chapter-tree-atmosphere {
  position: absolute;
  inset: 0;
  pointer-events: none;
  overflow: hidden;
  z-index: 0;
}

.chapter-tree-atmosphere-glow {
  position: absolute;
  border-radius: 50%;
  filter: blur(24px);
  opacity: 0.54;
}

.chapter-tree-atmosphere-glow.glow-a {
  width: min(44vw, 260px);
  height: min(44vw, 260px);
  inset-inline-end: -64px;
  top: -68px;
  background: color-mix(in srgb, var(--accent) 38%, transparent);
  animation: chapter-tree-atmosphere-float-a 11s ease-in-out infinite;
}

.chapter-tree-atmosphere-glow.glow-b {
  width: min(40vw, 220px);
  height: min(40vw, 220px);
  inset-inline-start: -60px;
  bottom: -62px;
  background: color-mix(in srgb, var(--accent2, var(--accent)) 30%, transparent);
  animation: chapter-tree-atmosphere-float-b 13s ease-in-out infinite;
}

.chapter-tree-atmosphere-grid {
  position: absolute;
  inset: 0;
  background-image:
    linear-gradient(to right, color-mix(in srgb, var(--accent) 8%, transparent) 1px, transparent 1px),
    linear-gradient(to bottom, color-mix(in srgb, var(--accent) 7%, transparent) 1px, transparent 1px);
  background-size: 28px 28px;
  opacity: 0.12;
  mask-image: radial-gradient(circle at center, rgba(0, 0, 0, 0.56), transparent 86%);
  -webkit-mask-image: radial-gradient(circle at center, rgba(0, 0, 0, 0.56), transparent 86%);
}

.chapter-tree-svg {
  position: relative;
  z-index: 2;
  width: 100%;
  height: 100%;
  display: block;
  touch-action: none;
  font-family: "Vazirmatn", sans-serif;
}

.chapter-tree-trunk {
  fill: none;
  stroke: rgba(108, 193, 244, 0.58);
  stroke: color-mix(in srgb, var(--accent) 56%, transparent);
  stroke-width: 2.35;
  stroke-linecap: round;
  stroke-linejoin: round;
  opacity: 0.76;
  filter: drop-shadow(0 0 8px color-mix(in srgb, var(--accent2, var(--accent)) 44%, transparent));
}

.chapter-tree-link {
  fill: none;
  stroke-width: 2.08;
  stroke-linecap: round;
  stroke-linejoin: round;
  opacity: 0.92;
  filter: drop-shadow(0 0 5px color-mix(in srgb, var(--accent) 34%, transparent));
  transition: stroke-width 0.2s ease, opacity 0.2s ease, filter 0.2s ease;
}

.chapter-tree-link[data-depth="1"] {
  stroke-width: 2.34;
  opacity: 0.97;
}

.chapter-tree-link[data-depth="2"] {
  stroke-width: 2.12;
}

.chapter-tree-link[data-depth="3"],
.chapter-tree-link[data-depth="4"] {
  stroke-width: 1.94;
  opacity: 0.88;
}

.chapter-tree-link-trail {
  fill: none;
  stroke-width: 5.4;
  opacity: 0.2;
  stroke-linecap: round;
  stroke-linejoin: round;
  stroke-dasharray: 8 15;
  filter: blur(0.3px) drop-shadow(0 0 10px color-mix(in srgb, var(--accent2, var(--accent)) 32%, transparent));
  animation: chapter-tree-link-drift 5.8s linear infinite;
}

.chapter-tree-link.is-focused,
.chapter-tree-link.is-active-path,
.chapter-map-link.is-search-match {
  stroke: var(--accent2, var(--accent));
  stroke-width: 3.14;
  opacity: 1;
  filter: drop-shadow(0 0 10px color-mix(in srgb, var(--accent2, var(--accent)) 52%, transparent));
}

.chapter-tree-node {
  outline: none;
}

.chapter-tree-root-aura-ring {
  fill: none;
  stroke: color-mix(in srgb, var(--accent) 44%, transparent);
  stroke-width: 1.4;
  opacity: 0.36;
}

.chapter-tree-root-aura-ring.ring-a {
  animation: chapter-tree-root-ring-breathe 4.6s ease-in-out infinite;
}

.chapter-tree-root-aura-ring.ring-b {
  stroke: color-mix(in srgb, var(--accent2, var(--accent)) 34%, transparent);
  opacity: 0.28;
  animation: chapter-tree-root-ring-breathe 5.8s ease-in-out infinite reverse;
}

.chapter-tree-root-aura-core {
  fill: color-mix(in srgb, var(--accent) 42%, transparent);
  opacity: 0.42;
  filter: blur(8px);
}

.chapter-tree-node-glow {
  fill: rgba(90, 183, 245, 0.2);
  fill: color-mix(in srgb, var(--accent) 20%, transparent);
  opacity: 0;
  transition: opacity 0.2s ease;
}

.chapter-tree-shell.is-fx-off .chapter-tree-node-glow {
  display: none;
}

.chapter-tree-shell.is-low-power .chapter-tree-link,
.chapter-tree-shell.is-low-power .chapter-tree-link-trail,
.chapter-tree-shell.is-low-power .chapter-tree-trunk,
.chapter-tree-shell.is-low-power .chapter-tree-node-glow {
  transition: none !important;
  filter: none !important;
}

.chapter-tree-shell.is-heavy-tree .chapter-tree-link,
.chapter-tree-shell.is-heavy-tree .chapter-tree-link-trail,
.chapter-tree-shell.is-heavy-tree .chapter-tree-trunk,
.chapter-tree-shell.is-heavy-tree .chapter-tree-node-glow {
  transition: none !important;
  filter: none !important;
}

.chapter-tree-shell.is-heavy-tree .chapter-tree-node-glow {
  display: none;
}

.chapter-tree-shell.is-mobile-dense .chapter-tree-node-title {
  font-size: 0.67rem;
}

.chapter-tree-shell.is-mobile-dense .chapter-tree-badges text {
  font-size: 0.54rem;
}

.chapter-tree-shell.is-mobile-dense .chapter-tree-node-ring {
  stroke-width: 1.08;
}

.chapter-tree-shell.is-mobile-dense .chapter-tree-node-card {
  stroke-width: 0.92;
}

.chapter-tree-shell.is-mobile-compact .chapter-tree-link {
  stroke-width: 1.86;
}

.chapter-tree-shell.is-mobile-compact .chapter-tree-link-trail {
  stroke-width: 3.2;
  stroke-dasharray: 6 13;
  opacity: 0.14;
}

.chapter-tree-shell.is-low-power .chapter-tree-node-card,
.chapter-tree-shell.is-low-power .chapter-tree-node-ring {
  filter: none !important;
}

.chapter-tree-node-ring {
  fill: rgba(89, 181, 241, 0.14);
  stroke: rgba(130, 209, 255, 0.54);
  fill: color-mix(in srgb, var(--accent) 13%, transparent);
  stroke: color-mix(in srgb, var(--accent) 52%, transparent);
  stroke-width: 1.25;
}

.chapter-tree-node-card {
  fill: var(--surface1, rgba(10, 21, 33, 0.9));
  stroke: rgba(128, 186, 224, 0.34);
  stroke: color-mix(in srgb, var(--accent) 28%, transparent);
  stroke-width: 1;
}

.chapter-tree-node[data-depth="1"] .chapter-tree-node-card {
  stroke: color-mix(in srgb, var(--accent2, var(--accent)) 44%, transparent);
}

.chapter-tree-node[data-depth="2"] .chapter-tree-node-card,
.chapter-tree-node[data-depth="3"] .chapter-tree-node-card {
  stroke: color-mix(in srgb, var(--accent) 32%, transparent);
}

.chapter-tree-node-accent {
  fill: color-mix(in srgb, var(--accent2, var(--accent)) 78%, transparent);
  opacity: 0.72;
}

.chapter-tree-node-dot {
  fill: color-mix(in srgb, var(--accent2, var(--accent)) 88%, #ffffff 12%);
  opacity: 0.84;
  filter: drop-shadow(0 0 6px color-mix(in srgb, var(--accent2, var(--accent)) 66%, transparent));
}

.chapter-tree-root-pulse {
  fill: color-mix(in srgb, var(--accent2, var(--accent)) 78%, #ffffff 14%);
  filter: drop-shadow(0 0 9px color-mix(in srgb, var(--accent2, var(--accent)) 62%, transparent));
  animation: chapter-tree-root-pulse 2.8s ease-in-out infinite;
}

.chapter-tree-node-title {
  fill: var(--text1, var(--text-main));
  font-size: 0.72rem;
  font-weight: 700;
  pointer-events: none;
}

.chapter-tree-node-title.is-root-title {
  font-size: 0.9rem;
  font-weight: 800;
  letter-spacing: -0.01em;
}

.chapter-tree-badges text {
  fill: var(--text1, var(--text-main));
  font-size: 0.58rem;
  font-weight: 700;
  pointer-events: none;
}

.chapter-tree-badge rect {
  stroke-width: 1;
}

.chapter-tree-badge-total rect {
  fill: rgba(88, 182, 246, 0.18);
  stroke: rgba(128, 206, 255, 0.34);
  fill: color-mix(in srgb, var(--accent) 18%, transparent);
  stroke: color-mix(in srgb, var(--accent) 34%, transparent);
}

.chapter-tree-badge-review rect {
  fill: rgba(89, 181, 241, 0.22);
  stroke: rgba(130, 209, 255, 0.44);
  fill: color-mix(in srgb, var(--accent2, var(--accent)) 22%, transparent);
  stroke: color-mix(in srgb, var(--accent2, var(--accent)) 44%, transparent);
}

.chapter-tree-badge-muted rect {
  fill: rgba(130, 153, 172, 0.18);
  stroke: rgba(155, 176, 194, 0.34);
  fill: color-mix(in srgb, var(--text-muted) 20%, transparent);
  stroke: color-mix(in srgb, var(--text-muted) 32%, transparent);
}

.chapter-tree-collapse-toggle circle {
  fill: rgba(15, 36, 56, 0.8);
  stroke: rgba(123, 199, 245, 0.46);
  fill: color-mix(in srgb, var(--surface2, #0f2438) 78%, transparent);
  stroke: color-mix(in srgb, var(--accent) 46%, transparent);
  stroke-width: 1;
}

.chapter-tree-collapse-toggle text {
  fill: var(--text1, var(--text-main));
  font-size: 0.68rem;
  font-weight: 800;
}

.chapter-tree-node.is-focused .chapter-tree-node-glow,
.chapter-tree-node.is-current .chapter-tree-node-glow,
.chapter-tree-node.is-search-match .chapter-tree-node-glow,
.chapter-tree-node.is-selected .chapter-tree-node-glow,
.chapter-tree-node.is-active-path .chapter-tree-node-glow,
.chapter-tree-node:focus-visible .chapter-tree-node-glow {
  opacity: 1;
}

.chapter-tree-node.is-focused .chapter-tree-node-ring,
.chapter-tree-node.is-current .chapter-tree-node-ring,
.chapter-tree-node.is-search-match .chapter-tree-node-ring,
.chapter-tree-node.is-selected .chapter-tree-node-ring,
.chapter-tree-node.is-active-path .chapter-tree-node-ring,
.chapter-tree-node:focus-visible .chapter-tree-node-ring {
  stroke: color-mix(in srgb, var(--accent2, var(--accent)) 76%, transparent);
}

.chapter-tree-node.is-focused .chapter-tree-node-card,
.chapter-tree-node.is-current .chapter-tree-node-card,
.chapter-tree-node.is-search-match .chapter-tree-node-card,
.chapter-tree-node.is-selected .chapter-tree-node-card,
.chapter-tree-node.is-active-path .chapter-tree-node-card,
.chapter-tree-node:focus-visible .chapter-tree-node-card {
  stroke: color-mix(in srgb, var(--accent2, var(--accent)) 64%, transparent);
}

.chapter-tree-node.is-selected .chapter-tree-node-ring {
  stroke-width: 1.5;
}

.chapter-tree-node.is-selected .chapter-tree-node-card {
  fill: color-mix(in srgb, var(--surface1, #102235) 84%, var(--accent2, var(--accent)) 16%);
}

.chapter-tree-link-trail.is-focused,
.chapter-tree-link-trail.is-active-path {
  opacity: 0.36;
  stroke-width: 6.1;
  filter: drop-shadow(0 0 12px color-mix(in srgb, var(--accent2, var(--accent)) 56%, transparent));
}

.chapter-tree-minimap {
  position: absolute;
  inset-inline-start: 12px;
  bottom: 12px;
  width: var(--chapter-tree-minimap-size, 150px);
  height: var(--chapter-tree-minimap-size, 150px);
  border-radius: 12px;
  border: 1px solid rgba(130, 202, 245, 0.28);
  border: 1px solid color-mix(in srgb, var(--accent) 28%, transparent);
  background: rgba(13, 31, 47, 0.88);
  background: color-mix(in srgb, var(--surface2, #102235) 86%, transparent);
  box-shadow: 0 10px 22px rgba(3, 8, 14, 0.24);
  cursor: pointer;
  overflow: hidden;
}

.chapter-tree-minimap-bg {
  fill: rgba(13, 31, 47, 0.86);
  fill: color-mix(in srgb, var(--surface2, #102235) 80%, transparent);
}

.chapter-tree-minimap-links path {
  fill: none;
  stroke: rgba(117, 195, 244, 0.46);
  stroke: color-mix(in srgb, var(--accent) 44%, transparent);
  stroke-width: 2;
  opacity: 0.7;
}

.chapter-tree-minimap-nodes circle {
  fill: rgba(122, 204, 255, 0.74);
  fill: color-mix(in srgb, var(--accent2, var(--accent)) 70%, transparent);
}

.chapter-tree-minimap-viewport {
  fill: rgba(95, 184, 241, 0.16);
  stroke: rgba(130, 212, 255, 0.76);
  fill: color-mix(in srgb, var(--accent) 14%, transparent);
  stroke: color-mix(in srgb, var(--accent2, var(--accent)) 76%, transparent);
  stroke-width: 2;
  pointer-events: none;
}

@media (max-width: 1023px) {
  .chapter-map-layout.chapter-map-layout-tree {
    grid-template-columns: 1fr;
    gap: 10px;
  }

  .chapter-map-layout.chapter-map-layout-tree .chapter-map-stage,
  .chapter-map-layout.chapter-map-layout-tree .chapter-map-canvas,
  .chapter-map-layout.chapter-map-layout-tree .chapter-map-legend {
    min-height: 360px;
  }

  .chapter-map-layout.chapter-map-layout-tree .chapter-map-toolbar {
    gap: 8px;
  }

  .chapter-map-layout.chapter-map-layout-tree .chapter-map-search-wrap {
    grid-template-columns: 1fr;
    gap: 8px;
  }

  .chapter-map-layout.chapter-map-layout-tree .chapter-map-actions {
    display: flex;
    flex-wrap: nowrap;
    overflow-x: auto;
    padding-bottom: 2px;
    gap: 7px;
    scrollbar-width: thin;
  }

  .chapter-map-layout.chapter-map-layout-tree .chapter-map-action-btn {
    min-height: 44px;
    min-width: 118px;
    flex: 0 0 auto;
    justify-content: center;
  }

  .chapter-map-layout.chapter-map-layout-tree .chapter-map-legend-list {
    max-height: 250px;
  }

  .chapter-tree-atmosphere-glow {
    filter: blur(16px);
    opacity: 0.42;
  }

  .chapter-tree-link-trail {
    stroke-width: 4.2;
    opacity: 0.15;
  }

  .chapter-tree-shell.is-mobile-dense .chapter-tree-node-glow {
    display: none;
  }

  .chapter-tree-shell.is-mobile-compact .chapter-tree-node-dot {
    display: none;
  }
}

@keyframes chapter-tree-atmosphere-float-a {
  0%,
  100% {
    transform: translate3d(0, 0, 0) scale(1);
  }
  50% {
    transform: translate3d(-10px, 8px, 0) scale(1.07);
  }
}

@keyframes chapter-tree-atmosphere-float-b {
  0%,
  100% {
    transform: translate3d(0, 0, 0) scale(1);
  }
  50% {
    transform: translate3d(8px, -9px, 0) scale(1.06);
  }
}

@keyframes chapter-tree-link-drift {
  0% {
    stroke-dashoffset: 0;
  }
  100% {
    stroke-dashoffset: -92;
  }
}

@keyframes chapter-tree-root-ring-breathe {
  0%,
  100% {
    opacity: 0.26;
    transform: scale(1);
  }
  50% {
    opacity: 0.44;
    transform: scale(1.04);
  }
}

@keyframes chapter-tree-root-pulse {
  0%,
  100% {
    opacity: 0.58;
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(1.18);
  }
}

@media (prefers-reduced-motion: reduce) {
  .chapter-tree-atmosphere-glow,
  .chapter-tree-link-trail,
  .chapter-tree-root-aura-ring,
  .chapter-tree-root-pulse {
    animation: none !important;
  }
}

/* Header Brand Title: Premium Modern Wordmark */
.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-title {
  position: relative;
  display: inline-flex;
  align-items: center;
  font-weight: 900;
  font-size: clamp(1.14rem, 1.52vw, 1.56rem);
  letter-spacing: -0.018em;
  line-height: 1.04;
  color: var(--accent, #7fd5ff);
  text-shadow:
    0 2px 14px color-mix(in srgb, var(--accent, #7fd5ff) 30%, transparent),
    0 1px 0 rgba(255, 255, 255, 0.06);
}

@supports ((-webkit-background-clip: text) or (background-clip: text)) {
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-title {
    background:
      linear-gradient(
        128deg,
        color-mix(in srgb, var(--accent2, var(--accent)) 92%, #ffffff 8%) 0%,
        color-mix(in srgb, var(--accent, #7fd5ff) 82%, #b8ecff 18%) 38%,
        color-mix(in srgb, var(--accent2, var(--accent)) 78%, #4fa8dc 22%) 72%,
        color-mix(in srgb, var(--accent, #7fd5ff) 74%, #2b79b3 26%) 100%
      );
    background-size: 220% 220%;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: appbar-brand-title-flow 8.5s ease-in-out infinite;
  }
}

.topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-title::after {
  content: "";
  position: absolute;
  inset-inline: 2px;
  bottom: -4px;
  height: 2px;
  border-radius: 999px;
  background: linear-gradient(
    90deg,
    color-mix(in srgb, var(--accent2, var(--accent)) 0%, transparent) 0%,
    color-mix(in srgb, var(--accent2, var(--accent)) 86%, #d6f4ff 14%) 40%,
    color-mix(in srgb, var(--accent, #7fd5ff) 74%, #2d7eb8 26%) 100%
  );
  box-shadow: 0 0 10px color-mix(in srgb, var(--accent, #7fd5ff) 38%, transparent);
  opacity: 0.82;
}

html[data-theme^="light-"] .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-title {
  color: #0f5f98;
  text-shadow: 0 1px 10px rgba(73, 154, 206, 0.2);
}

@keyframes appbar-brand-title-flow {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

@media (max-width: 1023px) {
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-title {
    font-size: 1.06rem;
  }
}

@media (prefers-reduced-motion: reduce) {
  .topbar.premium-topbar.qb-header.app-header-v3 .appbar-brand-title {
    animation: none !important;
  }
}

/* Exam flow: focus lock + per-question answer evaluation */
.exam-session-region {
  display: grid;
  gap: 10px;
}

html.exam-focus-locked-page,
body.exam-focus-locked {
  overflow: hidden !important;
  overscroll-behavior: none !important;
}

body.exam-focus-locked .topbar,
body.exam-focus-locked .profile-hub,
body.exam-focus-locked .breadcrumbs,
body.exam-focus-locked .status-bar,
body.exam-focus-locked .settings-panel {
  pointer-events: none !important;
  user-select: none !important;
}

body.exam-focus-locked .main-content {
  overflow: hidden !important;
}

.exam-session-region[data-exam-focus-lock="active"] {
  position: relative;
  border: 1px solid color-mix(in srgb, var(--accent2, var(--accent)) 34%, transparent);
  border-radius: 16px;
  padding: 10px;
  background: linear-gradient(
      145deg,
      color-mix(in srgb, var(--accent2, var(--accent)) 12%, transparent),
      color-mix(in srgb, var(--surface2, #162538) 90%, transparent)
    ),
    color-mix(in srgb, var(--surface1, #0f1e32) 86%, transparent);
}

body.exam-focus-locked .exam-session-region[data-exam-focus-lock="active"] {
  max-height: calc(100dvh - 92px);
  overflow: auto !important;
  overscroll-behavior: contain !important;
  -webkit-overflow-scrolling: touch !important;
  touch-action: pan-y;
}

.exam-session-region[data-exam-focus-lock="active"]::before {
  content: none;
  display: none;
}

.exam-session-region[data-exam-focus-lock="active"]:focus-visible {
  outline: 2px solid color-mix(in srgb, var(--accent, #74ceff) 68%, transparent);
  outline-offset: 2px;
}

.exam-question-review {
  margin-top: 10px;
  padding: 10px;
  border-radius: 12px;
  border: 1px solid color-mix(in srgb, var(--accent2, var(--accent)) 28%, transparent);
  background: linear-gradient(
      152deg,
      color-mix(in srgb, var(--accent2, var(--accent)) 16%, transparent),
      color-mix(in srgb, var(--surface2, #162538) 92%, transparent)
    ),
    color-mix(in srgb, var(--surface1, #0f1e32) 92%, transparent);
  display: grid;
  gap: 8px;
}

.exam-question-review-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  flex-wrap: wrap;
}

.exam-question-review-title {
  font-size: 0.88rem;
  font-weight: 800;
  color: var(--text-main);
}

.exam-question-mark-group {
  display: inline-flex;
  gap: 6px;
  flex-wrap: wrap;
}

.exam-question-mark-btn {
  min-height: 34px;
  padding: 0 11px;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--accent2, var(--accent)) 26%, transparent);
  background: color-mix(in srgb, var(--surface3, #1f3148) 90%, transparent);
  color: var(--text-main);
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 0.74rem;
  font-weight: 700;
  transition: border-color 0.2s ease, background-color 0.2s ease, transform 0.2s ease;
}

.exam-question-mark-btn svg {
  width: 13px;
  height: 13px;
  stroke: currentColor;
  stroke-width: 1.9;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.exam-question-mark-btn:hover {
  transform: translateY(-1px);
  border-color: color-mix(in srgb, var(--accent, #74ceff) 56%, transparent);
}

.exam-question-mark-btn.is-active {
  border-color: color-mix(in srgb, var(--accent2, var(--accent)) 72%, transparent);
  background: linear-gradient(
    145deg,
    color-mix(in srgb, var(--accent2, var(--accent)) 26%, transparent),
    color-mix(in srgb, var(--surface3, #1f3148) 84%, transparent)
  );
  box-shadow: 0 8px 16px rgba(4, 18, 32, 0.28);
}

.exam-question-mark-state {
  margin: 0;
  font-size: 0.74rem;
  line-height: 1.7;
  color: var(--text-muted);
}

.exam-question-mark-state.is-correct {
  color: #8af3c3;
}

.exam-question-mark-state.is-wrong {
  color: #ffc5be;
}

.exam-question-answer-body {
  border-top: 1px dashed color-mix(in srgb, var(--accent2, var(--accent)) 28%, transparent);
  padding-top: 8px;
  display: grid;
  gap: 2px;
}

.exam-paper.is-completed .exam-question-review {
  border-color: rgba(168, 156, 255, 0.34);
  background:
    radial-gradient(circle at 85% 12%, rgba(154, 132, 255, 0.18), transparent 42%),
    linear-gradient(148deg, rgba(40, 28, 70, 0.44), rgba(19, 26, 42, 0.55));
}

.exam-paper.is-completed .exam-question-review.is-correct {
  border-color: rgba(126, 232, 179, 0.45);
  background:
    radial-gradient(circle at 12% 14%, rgba(126, 232, 179, 0.2), transparent 42%),
    linear-gradient(148deg, rgba(19, 48, 40, 0.56), rgba(18, 28, 36, 0.58));
}

.exam-paper.is-completed .exam-question-review.is-wrong {
  border-color: rgba(255, 170, 158, 0.45);
  background:
    radial-gradient(circle at 12% 14%, rgba(255, 170, 158, 0.18), transparent 42%),
    linear-gradient(148deg, rgba(64, 28, 34, 0.56), rgba(24, 24, 34, 0.58));
}

.exam-paper.is-completed .exam-question-review.is-pending {
  border-color: rgba(255, 220, 140, 0.42);
  background:
    radial-gradient(circle at 12% 14%, rgba(255, 220, 140, 0.17), transparent 42%),
    linear-gradient(148deg, rgba(58, 46, 24, 0.5), rgba(24, 24, 34, 0.58));
}

.exam-paper.is-completed .exam-question-review .exam-question-answer-body {
  border-top-color: rgba(190, 176, 255, 0.4);
  background: rgba(255, 255, 255, 0.03);
  border-radius: 10px;
  padding: 8px 10px 6px;
}

html[data-theme^="light-"] .exam-paper.is-completed .exam-question-review {
  border-color: rgba(99, 92, 181, 0.22);
  background:
    radial-gradient(circle at 85% 12%, rgba(117, 95, 201, 0.16), transparent 42%),
    linear-gradient(148deg, rgba(255, 255, 255, 0.94), rgba(247, 244, 255, 0.9));
}

html[data-theme^="light-"] .exam-paper.is-completed .exam-question-review.is-correct {
  border-color: rgba(49, 151, 104, 0.28);
  background:
    radial-gradient(circle at 12% 14%, rgba(49, 151, 104, 0.14), transparent 42%),
    linear-gradient(148deg, rgba(255, 255, 255, 0.95), rgba(243, 252, 247, 0.92));
}

html[data-theme^="light-"] .exam-paper.is-completed .exam-question-review.is-wrong {
  border-color: rgba(194, 99, 88, 0.3);
  background:
    radial-gradient(circle at 12% 14%, rgba(194, 99, 88, 0.14), transparent 42%),
    linear-gradient(148deg, rgba(255, 255, 255, 0.95), rgba(255, 245, 244, 0.93));
}

html[data-theme^="light-"] .exam-paper.is-completed .exam-question-review.is-pending {
  border-color: rgba(196, 147, 46, 0.3);
  background:
    radial-gradient(circle at 12% 14%, rgba(196, 147, 46, 0.13), transparent 42%),
    linear-gradient(148deg, rgba(255, 255, 255, 0.95), rgba(255, 249, 238, 0.93));
}

.exam-eval-mark-stats {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
}

.exam-eval-mark-stats .exam-paper-meta-pill {
  justify-content: center;
}

.exam-eval-unresolved {
  margin: 0;
  font-size: 0.73rem;
  color: #ffc0b8;
}

.exam-eval-unresolved.is-complete {
  color: #8be8bc;
}

.exam-eval-insight-list {
  margin: 0;
  padding: 0;
  list-style: none;
  display: grid;
  gap: 6px;
}

.exam-eval-insight-item {
  min-height: 32px;
  display: inline-flex;
  align-items: center;
  padding: 5px 9px;
  border-radius: 10px;
  border: 1px solid rgba(146, 182, 214, 0.24);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-main);
  font-size: 0.75rem;
  line-height: 1.7;
}

.exam-eval-insight-item.is-strong {
  border-color: rgba(120, 226, 175, 0.42);
  background: rgba(120, 226, 175, 0.14);
}

.exam-eval-insight-item.is-weak {
  border-color: rgba(255, 172, 160, 0.42);
  background: rgba(255, 172, 160, 0.13);
}

.exam-eval-insight-item.is-focus {
  border-color: rgba(144, 187, 255, 0.42);
  background: rgba(144, 187, 255, 0.13);
}

.exam-eval-chapter-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 8px;
}

.exam-eval-chapter-card {
  display: grid;
  gap: 7px;
  border-radius: 11px;
  border: 1px solid rgba(145, 182, 214, 0.24);
  background: rgba(127, 127, 127, 0.08);
  padding: 8px;
}

.exam-eval-chapter-card.is-strong {
  border-color: rgba(120, 226, 175, 0.4);
}

.exam-eval-chapter-card.is-weak {
  border-color: rgba(255, 172, 160, 0.4);
}

.exam-eval-chapter-title {
  font-size: 0.8rem;
  font-weight: 800;
}

.exam-eval-chapter-meta {
  display: grid;
  grid-template-columns: 1fr;
  gap: 5px;
}

.exam-eval-chapter-meta .exam-paper-meta-pill {
  min-height: 26px;
  font-size: 0.7rem;
}

.exam-eval-chapter-rate {
  margin: 0;
  font-size: 0.73rem;
  color: var(--text-muted);
}

:is(body.force-mobile, body.auto-mobile) .exam-session-region[data-exam-focus-lock="active"] {
  padding: 8px;
  border-radius: 13px;
}

:is(body.force-mobile, body.auto-mobile).exam-focus-locked .exam-session-region[data-exam-focus-lock="active"] {
  max-height: calc(100dvh - 80px);
}

:is(body.force-mobile, body.auto-mobile) .exam-session-region[data-exam-focus-lock="active"]::before {
  top: 6px;
  inset-inline-start: 8px;
  font-size: 0.63rem;
}

:is(body.force-mobile, body.auto-mobile) .exam-question-review {
  margin-top: 8px;
  padding: 8px;
  border-radius: 10px;
}

:is(body.force-mobile, body.auto-mobile) .exam-question-mark-btn {
  min-height: 32px;
  font-size: 0.7rem;
  padding-inline: 9px;
}

:is(body.force-mobile, body.auto-mobile) .exam-eval-mark-stats {
  grid-template-columns: 1fr;
}

:is(body.force-mobile, body.auto-mobile) .exam-eval-chapter-grid {
  grid-template-columns: 1fr;
}

:is(body.force-mobile, body.auto-mobile) .exam-eval-insight-item {
  font-size: 0.71rem;
  min-height: 30px;
}

/* Exam builder per-chapter count planner */
.exam-chapter-check {
  display: grid;
  gap: 6px;
}

.exam-chapter-check-ui {
  cursor: pointer;
}

.exam-chapter-check-ui.is-disabled,
.exam-chapter-check > input[name="chapterIds"]:disabled + .exam-chapter-check-ui {
  opacity: 0.64;
  cursor: not-allowed;
  border-style: dashed;
}

.exam-chapter-count-wrap {
  display: grid;
  grid-template-columns: auto 1fr;
  align-items: center;
  gap: 6px;
  padding-inline: 2px;
}

.exam-chapter-count-label {
  font-size: 0.68rem;
  color: var(--text-muted);
  white-space: nowrap;
}

.exam-chapter-count-input {
  min-height: 32px;
  border-radius: 10px;
  border: 1px solid rgba(138, 172, 201, 0.24);
  background: rgba(127, 127, 127, 0.1);
  color: var(--text-main);
  font-size: 0.78rem;
  padding: 4px 8px;
  width: 100%;
}

.exam-chapter-count-input:focus {
  border-color: rgba(93, 182, 242, 0.56);
  box-shadow: 0 0 0 3px rgba(93, 182, 242, 0.14);
}

.exam-chapter-count-input:disabled {
  opacity: 0.6;
}

:is(body.force-mobile, body.auto-mobile) .exam-chapter-count-wrap {
  grid-template-columns: 1fr;
  gap: 4px;
}

:is(body.force-mobile, body.auto-mobile) .exam-chapter-count-label {
  font-size: 0.64rem;
}

:is(body.force-mobile, body.auto-mobile) .exam-chapter-count-input {
  min-height: 30px;
  font-size: 0.72rem;
  border-radius: 9px;
}

/* Practice Mode Modernization: premium hint/solution + utility actions */
.practice-mode-panel.practice-modernized .practice-toolbar {
  border-radius: 16px;
  border: 1px solid rgba(138, 186, 220, 0.24);
  background:
    radial-gradient(circle at 12% 10%, rgba(112, 194, 247, 0.12), transparent 35%),
    linear-gradient(154deg, rgba(12, 24, 37, 0.74), rgba(9, 18, 29, 0.62));
  box-shadow: 0 12px 24px rgba(4, 10, 18, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.practice-mode-panel.practice-modernized .practice-meta-strip-modern {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 7px;
}

.practice-mode-panel.practice-modernized .practice-meta-strip-modern .practice-meta-chip {
  min-height: 38px;
  padding: 6px 9px;
  border-radius: 11px;
  background: rgba(127, 127, 127, 0.08);
}

.practice-mode-panel.practice-modernized .practice-meta-strip-modern .practice-meta-copy {
  min-width: 0;
}

.practice-mode-panel.practice-modernized .practice-meta-strip-modern .practice-meta-copy strong {
  display: block;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.practice-mode-panel.practice-modernized .practice-question-card {
  border-radius: 16px;
  border: 1px solid rgba(136, 179, 211, 0.24);
  background:
    radial-gradient(circle at 88% 10%, rgba(113, 193, 247, 0.13), transparent 36%),
    linear-gradient(152deg, rgba(11, 22, 35, 0.8), rgba(10, 18, 29, 0.66));
  box-shadow: 0 14px 30px rgba(4, 9, 15, 0.24);
  contain: layout paint style;
}

.practice-mode-panel.practice-modernized .practice-focus-actions {
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 9px;
}

.practice-mode-panel.practice-modernized .practice-solution-stack {
  display: grid;
  grid-template-columns: 1fr;
  gap: 9px;
}

.practice-mode-panel.practice-modernized .practice-action-btn {
  min-height: 40px;
  border-radius: 12px;
  border: 1px solid rgba(143, 186, 218, 0.3);
  background:
    linear-gradient(155deg, rgba(124, 188, 232, 0.12), rgba(124, 188, 232, 0.03)),
    rgba(127, 127, 127, 0.08);
  font-size: 0.79rem;
  font-weight: 700;
  transition: transform 0.18s ease, border-color 0.18s ease, background-color 0.18s ease, box-shadow 0.18s ease;
}

.practice-mode-panel.practice-modernized .practice-action-btn:hover {
  transform: translateY(-1px);
  border-color: rgba(110, 199, 250, 0.56);
}

.practice-mode-panel.practice-modernized .practice-action-btn.primary {
  border-color: rgba(121, 220, 170, 0.54);
  background:
    linear-gradient(150deg, rgba(74, 180, 131, 0.28), rgba(74, 180, 131, 0.08)),
    rgba(127, 127, 127, 0.1);
}

.practice-mode-panel.practice-modernized .practice-action-btn.practice-action-utility {
  min-height: 36px;
  font-size: 0.74rem;
}

.practice-mode-panel.practice-modernized .practice-utility-actions {
  margin-top: 8px;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 8px;
}

.practice-mode-panel.practice-modernized .practice-reveal-box {
  position: relative;
  margin-top: 10px;
  border-radius: 14px;
  border: 1px solid rgba(142, 187, 220, 0.3);
  padding: 12px 12px 10px;
  overflow: hidden;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08), 0 10px 20px rgba(5, 13, 22, 0.22);
}

.practice-mode-panel.practice-modernized .practice-reveal-box::before {
  content: "";
  position: absolute;
  inset-inline: 12px;
  top: 0;
  height: 2px;
  border-radius: 999px;
  opacity: 0.9;
}

.practice-mode-panel.practice-modernized .practice-reveal-hint {
  border-color: rgba(128, 208, 255, 0.46);
  background:
    radial-gradient(circle at 10% 12%, rgba(130, 207, 255, 0.18), transparent 38%),
    linear-gradient(150deg, rgba(44, 102, 142, 0.22), rgba(21, 56, 84, 0.12)),
    rgba(9, 24, 38, 0.7);
}

.practice-mode-panel.practice-modernized .practice-reveal-hint::before {
  background: linear-gradient(90deg, transparent, rgba(129, 207, 255, 0.95), transparent);
}

.practice-mode-panel.practice-modernized .practice-reveal-solution {
  border-color: rgba(122, 228, 183, 0.46);
  background:
    radial-gradient(circle at 10% 12%, rgba(122, 228, 183, 0.18), transparent 38%),
    linear-gradient(150deg, rgba(31, 96, 73, 0.24), rgba(16, 55, 42, 0.14)),
    rgba(9, 27, 26, 0.7);
}

.practice-mode-panel.practice-modernized .practice-reveal-solution::before {
  content: none;
  display: none;
}

.practice-mode-panel.practice-modernized .practice-reveal-head {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 4px;
  font-size: 0.84rem;
  font-weight: 800;
}

.practice-mode-panel.practice-modernized .practice-reveal-head .practice-icon {
  width: 24px;
  height: 24px;
  border-radius: 9px;
  border: 1px solid rgba(143, 187, 220, 0.38);
  background: rgba(255, 255, 255, 0.06);
}

.practice-mode-panel.practice-modernized .practice-reveal-content {
  font-size: 0.95rem;
  line-height: 1.9;
  letter-spacing: 0.002em;
}

.practice-mode-panel.practice-modernized .practice-reveal-footer {
  margin-top: 8px;
  padding-top: 7px;
  border-top: 1px dashed rgba(151, 189, 218, 0.28);
  font-size: 0.72rem;
  color: var(--text-muted);
}

.practice-mode-panel.practice-modernized .practice-reveal-box.is-empty .practice-reveal-content {
  color: color-mix(in srgb, var(--text-muted) 92%, #f4fbff 8%);
  font-style: italic;
}

html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-toolbar,
html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-question-card {
  border-color: rgba(59, 108, 145, 0.24);
  background:
    radial-gradient(circle at 85% 12%, rgba(84, 168, 222, 0.12), transparent 38%),
    linear-gradient(156deg, rgba(255, 255, 255, 0.94), rgba(246, 251, 255, 0.89));
}

html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-hint {
  border-color: rgba(87, 157, 208, 0.34);
  background:
    radial-gradient(circle at 10% 12%, rgba(125, 196, 236, 0.18), transparent 38%),
    linear-gradient(150deg, rgba(234, 246, 255, 0.92), rgba(224, 240, 252, 0.88));
}

html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-solution {
  border-color: rgba(67, 158, 124, 0.32);
  background:
    radial-gradient(circle at 10% 12%, rgba(116, 205, 173, 0.2), transparent 38%),
    linear-gradient(150deg, rgba(235, 250, 243, 0.94), rgba(224, 245, 236, 0.89));
}

@media (max-width: 980px) {
  .practice-mode-panel.practice-modernized .practice-meta-strip-modern {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .practice-mode-panel.practice-modernized .practice-focus-actions {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .practice-mode-panel.practice-modernized .practice-focus-actions > .practice-next-btn {
    grid-column: 1 / -1;
  }

  .practice-mode-panel.practice-modernized .practice-utility-actions {
    grid-template-columns: 1fr;
  }
}

@media (prefers-reduced-motion: reduce) {
  .practice-mode-panel.practice-modernized .practice-action-btn {
    transition: none !important;
  }
}

/* Mobile Global Optimization Lock: stable carding + smooth rendering */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) {
    --mobile-safe-inline: clamp(8px, 2.8vw, 12px);
    --mobile-gap: clamp(8px, 2.4vw, 12px);
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
  }

  html,
  body {
    max-width: 100%;
    overflow-x: hidden !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .app-shell {
    width: 100% !important;
    max-width: 100% !important;
    margin-inline: auto !important;
    padding-inline: var(--mobile-safe-inline) !important;
    padding-bottom: max(14px, env(safe-area-inset-bottom, 0px)) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .main-content,
      .surface,
      .tab-panel,
      .profile-hub,
      .profile-hub-grid,
      .profile-card,
      .profile-quick-access,
      .profile-form-grid,
      .profile-form-actions,
      .profile-data-shell,
      .profile-data-actions-bento,
      .profile-data-editor-panel,
      .profile-data-editor-actions,
      .settings-panel,
      .settings-panel-layout,
      .settings-panel-workspace,
      .settings-overview-strip,
      .settings-grid,
      .settings-mode-grid,
      .settings-cloud-layout,
      .settings-sync-row-stack,
      .settings-utility-grid,
      .cloud-sync-grid,
      .sync-grid,
      .list-grid,
      .subjects-premium-grid,
      .lesson-dashboard,
      .lesson-dashboard-stats,
      .lesson-chapter-grid,
      .question-bank-panel,
      .question-list,
      .question-card,
      .qb-filter-bar,
      .qb-filter-layout-v2,
      .chapter-map-panel,
      .chapter-map-layout,
      .chapter-map-toolbar,
      .chapter-map-actions,
      .chapter-map-legend,
      .practice-mode-panel,
      .practice-focus-card,
      .practice-focus-actions,
      .practice-meta-strip,
      .practice-utility-actions,
      .exam-mode-panel,
      .exam-builder-form,
      .exam-builder-controls,
      .exam-chapter-grid,
      .exam-paper,
      .exam-paper-list,
      .exam-paper-meta-grid,
      .exam-eval-chapter-grid,
      .breadcrumbs,
      .tabs
    ) {
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .profile-hub-grid,
      .profile-quick-access,
      .profile-form-grid,
      .profile-form-actions,
      .profile-data-shell,
      .profile-data-actions-bento,
      .profile-data-editor-actions,
      .settings-panel-layout,
      .settings-grid,
      .settings-mode-grid,
      .settings-cloud-layout,
      .settings-sync-row-stack,
      .settings-utility-grid,
      .cloud-sync-grid,
      .sync-grid,
      .list-grid,
      .subjects-premium-grid,
      .lesson-chapter-grid,
      .practice-focus-actions,
      .practice-meta-strip,
      .practice-utility-actions,
      .exam-builder-controls,
      .exam-chapter-grid,
      .exam-paper-meta-grid,
      .exam-eval-chapter-grid,
      .chapter-map-layout,
      .chapter-map-actions
    ) {
    grid-template-columns: 1fr !important;
    gap: var(--mobile-gap) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .tabs {
    overflow-x: auto !important;
    overflow-y: hidden !important;
    flex-wrap: nowrap !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    scrollbar-width: thin !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .tab-btn {
    flex: 0 0 auto !important;
    min-width: 112px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .lesson-dashboard-stats,
      .qb-filter-layout-v2 .qb-active-chips-row,
      .breadcrumbs
    ) {
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    scrollbar-width: thin !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .app-shell :is(
      input:not([type="checkbox"]):not([type="radio"]),
      select,
      textarea
    ) {
    font-size: 16px !important;
    max-width: 100%;
    min-width: 0;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .app-shell :is(
      button,
      .tab-btn,
      .appbar-icon-btn,
      .glass-btn
    ) {
    touch-action: manipulation;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .topbar.premium-topbar.qb-header.app-header-v3,
      .surface,
      .profile-card,
      .settings-panel,
      .qb-filter-bar,
      .question-card,
      .chapter-map-stage,
      .practice-focus-card,
      .exam-paper,
      .exam-builder-form,
      .tabs,
      .tab-btn,
      .appbar-segmented,
      .appbar-segment-btn
    ) {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .header-brand-icon::before,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .appbar-brand-btn .header-brand-icon::before,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .settings-trigger::after,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .settings-trigger-status,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-blobs,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-particles {
    animation: none !important;
  }

  @supports (content-visibility: auto) {
    :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
        .question-card,
        .lesson-chapter-card,
        .subject-premium-card,
        .exam-paper-item
      ) {
      content-visibility: auto;
      contain-intrinsic-size: 1px 260px;
    }
  }
}

/* Mobile Final Performance Patch: no motion + fluid scrolling (manual/auto resolved mobile) */
:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) {
  scroll-behavior: auto !important;
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]):not(.exam-focus-locked) {
  overflow-x: hidden !important;
  overflow-y: auto !important;
  overscroll-behavior-y: auto !important;
}

:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) *,
:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) *::before,
:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) *::after {
  animation: none !important;
  transition: none !important;
  animation-delay: 0ms !important;
  animation-duration: 0ms !important;
  transition-delay: 0ms !important;
  transition-duration: 0ms !important;
  scroll-behavior: auto !important;
}

:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
    .app-shell,
    .main-content,
    .surface,
    .tab-panel,
    .question-bank-panel,
    .question-list,
    .practice-mode-panel,
    .exam-mode-panel,
    .chapter-map-panel,
    .settings-panel-layout,
    .settings-panel-workspace,
    .chapter-map-legend-list,
    .tabs,
    .breadcrumbs
  ) {
  -webkit-overflow-scrolling: touch !important;
  overscroll-behavior-y: auto !important;
}

@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]):not(.exam-focus-locked) {
    position: static !important;
    height: auto !important;
    min-height: 100dvh !important;
    -webkit-overflow-scrolling: touch !important;
  }

  html:not(.exam-focus-locked-page) {
    overflow-x: hidden !important;
    overflow-y: auto !important;
    overscroll-behavior-y: auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .chapter-map-svg,
      .chapter-tree-svg
    ) {
    touch-action: pan-y pinch-zoom !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .practice-mode-panel,
      .exam-mode-panel,
      .chapter-map-panel
    ) {
    overflow-x: hidden !important;
    overflow-y: visible !important;
    overscroll-behavior-y: auto !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .practice-mode-panel .practice-profile-bar,
      .practice-mode-panel .practice-focus-actions,
      .exam-mode-panel .exam-paper-quick-stats,
      .exam-mode-panel .exam-session-actions,
      .exam-mode-panel .exam-actions-grid
    ) {
    overflow: visible !important;
    overscroll-behavior-inline: auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-countdown-panel.exam-countdown-panel-pinned {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .chapter-map-layout.chapter-map-layout-tree,
      .chapter-map-layout.chapter-map-layout-orbit
    ) {
    grid-template-columns: 1fr !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-legend {
    min-height: 0 !important;
    max-height: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-legend-list {
    max-height: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .chapter-map-stage,
      .chapter-map-canvas
    ) {
    min-height: 260px !important;
  }
}

.runtime-fallback {
  display: grid;
  gap: 10px;
  justify-items: start;
  text-align: right;
  padding: 14px;
}

.runtime-fallback-title {
  margin: 0;
  font-size: 1rem;
  font-weight: 800;
  color: var(--text);
}

.runtime-fallback-text {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.86rem;
  line-height: 1.7;
}

.runtime-fallback-btn {
  min-height: 40px;
}

/* Mobile Scroll Stability Patch (exam/practice/chapter-map/chapters/question-bank) */
@media (max-width: 1023px) {
  html,
  body {
    overscroll-behavior-y: auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) {
    touch-action: pan-y pinch-zoom;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .main-content,
      .tab-panel,
      .lesson-dashboard,
      .question-bank-panel,
      .question-list,
      .practice-mode-panel,
      .exam-mode-panel,
      .chapter-map-panel
    ) {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    overflow-x: hidden !important;
    overscroll-behavior-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .question-bank-panel,
      .practice-mode-panel,
      .exam-mode-panel,
      .chapter-map-panel
    ) {
    overflow-y: visible !important;
    contain: layout style !important;
    scrollbar-gutter: stable;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .lesson-dashboard {
    gap: 8px !important;
    overflow-y: visible !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .lesson-chapter-grid {
    width: 100% !important;
    min-width: 0 !important;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 168px), 1fr)) !important;
    gap: 8px !important;
    overflow: visible !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-list {
    gap: 10px !important;
    contain: layout style !important;
    overflow: visible !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .question-card,
      .lesson-chapter-card,
      .practice-question-card,
      .exam-paper-item
    ) {
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-card::before,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-card::after,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .lesson-chapter-card::before,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .lesson-chapter-card::after {
    display: none !important;
  }

  @supports (content-visibility: auto) {
    :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
        .question-card,
        .lesson-chapter-card,
        .practice-question-card,
        .exam-paper-item
      ) {
      content-visibility: auto;
      contain: layout style paint !important;
      contain-intrinsic-size: 1px 220px;
    }
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .practice-mode-panel .practice-profile-bar,
      .practice-mode-panel .practice-focus-actions,
      .practice-mode-panel .practice-utility-actions,
      .exam-mode-panel .exam-paper-quick-stats,
      .exam-mode-panel .exam-session-actions,
      .exam-mode-panel .exam-actions-grid
    ) {
    overflow: visible !important;
    overscroll-behavior-inline: auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-panel :is(
      .chapter-map-layout,
      .chapter-map-stage,
      .chapter-map-canvas,
      .chapter-map-legend,
      .chapter-map-legend-list
    ) {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    overflow: visible !important;
  }

  .chapter-map-panel :is(.chapter-map-svg, .chapter-tree-svg) {
    touch-action: pan-y pinch-zoom !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-countdown-panel.exam-countdown-panel-pinned {
    position: sticky !important;
    top: calc(env(safe-area-inset-top, 0px) + 8px) !important;
    left: auto !important;
    right: auto !important;
    width: 100% !important;
    max-width: 100% !important;
    z-index: 24 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-has-live-timer {
    padding-top: 8px !important;
  }
}

/* Final Mobile Layout Optimization: Exam + Chapter Tree */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .exam-mode-panel,
      .chapter-map-panel
    ) {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel :is(
      .exam-builder-form,
      .exam-pane,
      .exam-paper,
      .exam-session-region
    ) {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    padding: 10px !important;
    border-radius: 12px !important;
    box-sizing: border-box !important;
    overflow: visible !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-builder-head {
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-builder-title {
    font-size: 0.92rem !important;
    line-height: 1.5 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-builder-head p {
    margin: 0 !important;
    font-size: 0.76rem !important;
    line-height: 1.65 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-builder-stats {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-chapter-toolbar {
    grid-template-columns: minmax(0, 1fr) !important;
    align-items: stretch !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-chapter-toolbar-actions {
    display: flex !important;
    flex-wrap: nowrap !important;
    gap: 6px !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    scrollbar-width: thin !important;
    padding-bottom: 2px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-chip-btn {
    flex: 0 0 auto !important;
    min-height: 40px !important;
    border-radius: 10px !important;
    font-size: 0.74rem !important;
    padding-inline: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-chapter-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-chapter-check {
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-chapter-check-ui {
    min-height: 64px !important;
    border-radius: 11px !important;
    padding: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-chapter-name {
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-chapter-count-wrap {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 4px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-chapter-count-input {
    min-height: 38px !important;
    font-size: 0.78rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-builder-controls {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-builder-controls :is(
      input,
      select,
      .exam-generate-btn
    ) {
    width: 100% !important;
    min-width: 0 !important;
    min-height: 42px !important;
    border-radius: 11px !important;
    box-sizing: border-box !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-paper-actions {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-paper-quick-stats {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-actions-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-actions-grid .btn-exam {
    min-height: 42px !important;
    width: 100% !important;
    min-width: 0 !important;
    border-radius: 11px !important;
    justify-content: center !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-paper-head {
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-paper-brand-row {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-paper-code {
    width: fit-content !important;
    max-width: 100% !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-paper-meta-grid,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-paper-instruction-grid {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-paper-list {
    gap: 8px !important;
    margin-top: 8px !important;
    padding-inline: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-paper-item {
    padding: 8px !important;
    border-radius: 11px !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-paper-question-meta {
    gap: 5px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .exam-paper-question-tag,
      .exam-paper-question-points
    ) {
    min-height: 24px !important;
    font-size: 0.69rem !important;
    max-width: 100% !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-toolbar {
    padding: 10px !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-toolbar-top {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 4px !important;
    align-items: start !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-toolbar-title {
    font-size: 0.86rem !important;
    line-height: 1.5 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-toolbar-meta {
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    max-width: 100% !important;
    font-size: 0.72rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-search-wrap {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-search {
    min-height: 42px !important;
    font-size: 0.88rem !important;
    border-radius: 11px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-actions {
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    gap: 7px !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    scrollbar-width: thin !important;
    padding-bottom: 2px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-action-btn {
    flex: 0 0 auto !important;
    min-height: 40px !important;
    min-width: 108px !important;
    border-radius: 10px !important;
    justify-content: center !important;
    padding-inline: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-layout.chapter-map-layout-tree,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-layout.chapter-map-layout-orbit {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .chapter-map-stage,
      .chapter-map-canvas
    ) {
    min-height: 320px !important;
    max-height: 62dvh !important;
    border-radius: 14px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-legend {
    min-height: 0 !important;
    max-height: none !important;
    border-radius: 13px !important;
    padding: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-legend-list {
    max-height: min(42dvh, 320px) !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-legend-item {
    min-height: 44px !important;
    border-radius: 10px !important;
    padding: 7px 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-legend-item strong {
    font-size: 0.74rem !important;
    line-height: 1.45 !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
    max-width: 100% !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-tree-shell {
    border-radius: 12px !important;
    overflow: hidden !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-tree-minimap {
    width: 96px !important;
    height: 96px !important;
    inset-inline-start: 6px !important;
    bottom: 6px !important;
    border-radius: 10px !important;
  }
}

@media (max-width: 560px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-chapter-grid,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-builder-stats,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-paper-quick-stats,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-actions-grid {
    grid-template-columns: minmax(0, 1fr) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .chapter-map-stage,
      .chapter-map-canvas
    ) {
    min-height: 286px !important;
    max-height: 56dvh !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-action-btn {
    min-width: 96px !important;
    min-height: 38px !important;
    font-size: 0.74rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-tree-minimap {
    width: 88px !important;
    height: 88px !important;
  }
}

@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-layout.chapter-map-layout-tree
    :is(.chapter-map-stage, .chapter-map-canvas) {
    min-height: clamp(304px, 56dvh, 460px) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-layout.chapter-map-layout-tree
    .chapter-tree-shell.is-mobile-dense
    .chapter-tree-node-title {
    font-size: 0.64rem !important;
    line-height: 1.34 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-layout.chapter-map-layout-tree
    .chapter-tree-shell.is-mobile-compact
    .chapter-tree-node-title {
    font-size: 0.6rem !important;
    line-height: 1.32 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-layout.chapter-map-layout-tree
    .chapter-tree-shell.is-mobile-compact
    .chapter-tree-badges
    text {
    font-size: 0.5rem !important;
  }
}

/* Mobile Ultra Smooth Mode: cross-section lag guard */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra :is(
      .topbar.premium-topbar,
      .surface,
      .profile-surface,
      .subject-premium-card,
      .lesson-dashboard,
      .lesson-add-card,
      .lesson-chapter-card,
      .qb-filter-bar,
      .qb-filter-layout-v2,
      .question-card,
      .practice-toolbar,
      .practice-question-card,
      .practice-reveal-box,
      .exam-builder-form,
      .exam-pane,
      .exam-paper,
      .exam-paper-item,
      .exam-answer-key,
      .exam-eval-panel,
      .chapter-map-toolbar,
      .chapter-map-stage,
      .chapter-map-legend,
      .chapter-map-legend-item
    ) {
    background-image: none !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    filter: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra :is(
      .question-card,
      .lesson-chapter-card,
      .subject-premium-card,
      .practice-question-card,
      .exam-paper-item,
      .chapter-map-legend-item
    ) {
    contain: layout style paint !important;
    content-visibility: auto;
    contain-intrinsic-size: 1px 190px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra :is(
      .main-content,
      .tab-panel,
      .question-bank-panel,
      .question-list,
      .practice-mode-panel,
      .exam-mode-panel,
      .chapter-map-panel,
      .lesson-dashboard,
      .settings-panel-layout,
      .settings-panel-workspace,
      .chapter-map-legend-list
    ) {
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior: auto !important;
    overflow-anchor: auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra .chapter-tree-minimap {
    display: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra .chapter-map-layout {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra :is(
      .chapter-map-stage,
      .chapter-map-canvas
    ) {
    min-height: 280px !important;
    max-height: 54dvh !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra :is(
      .exam-mode-panel,
      .practice-mode-panel,
      .chapter-map-panel,
      .question-bank-panel
    ) {
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra :is(
      .exam-builder-controls,
      .exam-chapter-grid,
      .exam-paper-meta-grid,
      .exam-paper-instruction-grid,
      .practice-focus-actions,
      .practice-profile-bar
    ) {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra :is(
      .btn-exam,
      .exam-chip-btn,
      .practice-action-btn,
      .practice-profile-chip,
      .qb-pill,
      .chapter-map-action-btn
    ) {
    min-height: 40px !important;
    transition: none !important;
    animation: none !important;
    transform: none !important;
  }
}

/* Mobile Exam Ready Optimization: when exam paper is generated */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready {
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready :is(
      .qb-overview,
      .exam-paper-actions,
      .exam-paper-quick-stats,
      .exam-actions-grid,
      .exam-paper,
      .exam-paper-head,
      .exam-paper-list,
      .exam-paper-item,
      .exam-session-region,
      .exam-eval-panel,
      .exam-question-review
    ) {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .qb-overview {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-actions {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-quick-stats {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-actions-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-actions-grid .btn-exam {
    min-height: 42px !important;
    border-radius: 11px !important;
    padding: 0 8px !important;
    font-size: 0.76rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-session-region {
    display: grid !important;
    gap: 8px !important;
    padding: 8px !important;
    border-radius: 12px !important;
    overflow-x: hidden !important;
    overflow-y: visible !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).exam-focus-locked .exam-mode-panel.exam-session-ready .exam-session-region[data-exam-focus-lock="active"] {
    max-height: calc(100dvh - 74px) !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    overscroll-behavior-y: contain !important;
    -webkit-overflow-scrolling: touch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper {
    padding: 10px !important;
    border-radius: 12px !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-head {
    gap: 7px !important;
    padding-bottom: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-title {
    font-size: 0.92rem !important;
    line-height: 1.45 !important;
    min-width: 0 !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-brand-row {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-code {
    min-height: 28px !important;
    max-width: 100% !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-meta-grid,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-instruction-grid {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-list {
    gap: 8px !important;
    margin-top: 8px !important;
    padding-inline: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-item {
    padding: 8px !important;
    border-radius: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-item .question-card {
    padding: 10px !important;
    border-radius: 11px !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-item .question-head,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-item .question-body,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-item .disclosure {
    min-width: 0 !important;
    overflow-wrap: anywhere !important;
    line-height: 1.75 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-question-meta {
    gap: 5px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready :is(
      .exam-paper-question-tag,
      .exam-paper-question-points
    ) {
    min-height: 23px !important;
    font-size: 0.68rem !important;
    max-width: 100% !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-question-review {
    padding: 8px !important;
    border-radius: 10px !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-question-mark-group {
    display: grid !important;
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
    gap: 6px !important;
    width: 100% !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-question-mark-btn {
    width: 100% !important;
    min-height: 34px !important;
    padding-inline: 6px !important;
    justify-content: center !important;
    font-size: 0.7rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-eval-panel {
    padding: 9px !important;
    border-radius: 11px !important;
    gap: 8px !important;
  }
}

@media (max-width: 560px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .qb-overview,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-paper-quick-stats,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-actions-grid,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-ready .exam-question-mark-group {
    grid-template-columns: minmax(0, 1fr) !important;
  }
}

/* Final Question-Bank Mobile Optimization: compact cards, no horizontal drift, lighter rendering */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf {
    gap: 8px !important;
    min-width: 0 !important;
    overflow-x: hidden !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf :is(
      .qb-filter-bar.qb-filter-layout-v2,
      .qb-overview,
      .pagination,
      .meta-row,
      .bulk-delete-bar,
      .question-danger-zone,
      .question-list,
      .question-card
    ) {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-bar.qb-filter-layout-v2 {
    gap: 8px !important;
    padding: 9px !important;
    border-radius: 12px !important;
    overflow: hidden !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-filter-row-primary {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-filter-row-actions {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) auto !important;
    gap: 7px !important;
    align-items: center !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-filter-active-count {
    min-height: 34px !important;
    justify-content: center !important;
    text-align: center !important;
    font-size: 0.71rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-clear-btn-compact {
    min-height: 34px !important;
    min-width: 94px !important;
    padding-inline: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-active-chips-row {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 6px !important;
    overflow: visible !important;
    min-height: 0 !important;
    padding-bottom: 0 !important;
    scrollbar-width: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-active-chips-row::-webkit-scrollbar {
    display: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 :is(.qb-active-chip, .qb-active-chip-placeholder) {
    max-width: 100% !important;
    white-space: normal !important;
    line-height: 1.35 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-filter-groups-grid,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-lux-triple-grid {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 :is(
      .qb-filter-group-card,
      .qb-filter-group-card.is-wide,
      .qb-lux-triple-card,
      .qb-lux-triple-card.is-wide,
      .qb-lux-filter-panel,
      .qb-lux-filter-panel.is-review
    ) {
    grid-column: auto !important;
    min-width: 0 !important;
    min-height: 0 !important;
    padding: 9px !important;
    border-radius: 11px !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 :is(
      .qb-sort-group,
      .qb-solved-group,
      .qb-review-group,
      .qb-topic-quick,
      .qb-pill-group
    ) {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
    overflow: visible !important;
    padding-bottom: 0 !important;
    scrollbar-width: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 :is(
      .qb-sort-group,
      .qb-solved-group,
      .qb-review-group,
      .qb-topic-quick,
      .qb-pill-group
    )::-webkit-scrollbar {
    display: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 :is(
      .qb-sort-chip,
      .qb-solved-chip,
      .qb-review-chip,
      .qb-topic-quick-btn,
      .qb-pill
    ) {
    width: 100% !important;
    min-width: 0 !important;
    min-height: 34px !important;
    padding: 4px 7px !important;
    justify-content: center !important;
    text-align: center !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-filter-difficulty-strip {
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 8px !important;
    padding: 9px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-overview {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .pagination {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .pagination .pager-info {
    grid-column: 1 / -1 !important;
    order: 3 !important;
    min-width: 0 !important;
    text-align: center !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .pagination button {
    min-height: 36px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-list {
    gap: 8px !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-card {
    padding: 10px !important;
    border-radius: 12px !important;
    box-shadow: none !important;
    background-image: none !important;
    contain: layout style paint !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-head {
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 7px !important;
    margin-bottom: 8px !important;
    padding-bottom: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-head-main,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-head-tools {
    gap: 6px !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-head-tools {
    justify-content: flex-start !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-topic-chip {
    max-width: 100% !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-topic-chip-text {
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf :is(.question-body, .disclosure) {
    padding: 10px !important;
    border-radius: 12px !important;
    font-size: 0.92rem !important;
    line-height: 1.78 !important;
    overflow-wrap: anywhere !important;
    word-break: break-word !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .disclosure {
    padding-top: 30px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .disclosure.disclosure-solution {
    padding-top: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .disclosure.disclosure-hint {
    padding-top: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .math-node {
    max-width: 100% !important;
    -webkit-overflow-scrolling: touch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-tools {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 7px !important;
    margin-top: 8px !important;
    padding-top: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-card .tool-btn {
    width: 100% !important;
    min-height: 36px !important;
    padding: 6px 8px !important;
    justify-content: center !important;
    font-size: 0.75rem !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-review-tools {
    margin-top: 8px !important;
    padding: 8px !important;
    border-radius: 12px !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-review-row {
    grid-template-columns: minmax(0, 1fr) !important;
    align-items: stretch !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-review-group {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
    overflow: visible !important;
    white-space: normal !important;
    padding-bottom: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf :is(.question-review-btn, .question-review-note-toggle) {
    width: 100% !important;
    min-height: 34px !important;
    justify-content: center !important;
    font-size: 0.69rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-review-note-toggle {
    justify-self: stretch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-review-note-input {
    min-height: 68px !important;
    line-height: 1.65 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-review-note-meta {
    flex-wrap: wrap !important;
    row-gap: 4px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-strip {
    margin-bottom: 8px !important;
    border-radius: 12px !important;
    padding: 8px 9px !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-actions {
    display: grid !important;
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-btn {
    min-height: 32px !important;
    padding: 4px 6px !important;
    font-size: 0.7rem !important;
    border-radius: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .bulk-delete-bar {
    position: static !important;
    bottom: auto !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .bulk-delete-bar.is-active {
    max-height: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-danger-zone {
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 8px !important;
    padding: 9px !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-danger-zone .bulk-delete-btn-danger {
    width: 100% !important;
    min-height: 34px !important;
  }
}

@media (max-width: 560px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-overview,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-tools,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 :is(
      .qb-sort-group,
      .qb-solved-group,
      .qb-topic-quick,
      .qb-pill-group
    ) {
    grid-template-columns: minmax(0, 1fr) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-review-group,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-review-group,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-actions {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-review-chip,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-review-btn,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-btn {
    min-height: 34px !important;
  }
}

/* Final Mobile Tune: denser filter panels + cleaner exam sheet */
@media (min-width: 561px) and (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-lux-triple-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 8px !important;
    align-items: stretch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-lux-filter-panel.is-review {
    grid-column: 1 / -1 !important;
  }
}

@media (min-width: 430px) and (max-width: 560px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-lux-triple-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-lux-filter-panel.is-review {
    grid-column: 1 / -1 !important;
  }
}

@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-session-region {
    gap: 7px !important;
    padding: 7px !important;
    border-radius: 12px !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-paper-actions {
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-paper {
    padding: 9px !important;
    border-radius: 12px !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-paper-title {
    white-space: normal !important;
    overflow: hidden !important;
    display: -webkit-box !important;
    -webkit-box-orient: vertical !important;
    -webkit-line-clamp: 2 !important;
    line-height: 1.45 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-paper-list {
    gap: 7px !important;
    margin-top: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-paper-item {
    padding: 7px !important;
    border-radius: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-paper-item
    .question-card {
    padding: 9px !important;
    border-radius: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-paper-item
    .question-body {
    font-size: 0.9rem !important;
    line-height: 1.72 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-paper-question-meta {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
    align-items: center !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-paper-question-meta
    .exam-paper-question-points {
    grid-column: 1 / -1 !important;
    justify-self: start !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-question-mark-group {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-question-mark-btn {
    min-height: 36px !important;
    font-size: 0.72rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-actions-grid
    .btn-exam {
    min-height: 40px !important;
    font-size: 0.74rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-eval-panel {
    padding: 8px !important;
    border-radius: 10px !important;
  }
}

@media (max-width: 420px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-question-mark-group {
    grid-template-columns: minmax(0, 1fr) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-paper-question-meta {
    grid-template-columns: minmax(0, 1fr) !important;
  }
}

/* Timer stability patch: no layout jump on control clicks + smoother mobile countdown */
:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-solve-actions {
  width: 100% !important;
}

:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-solve-btn {
  min-width: 0 !important;
}

:is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-countdown-track i {
  transition: none !important;
}

/* Home mobile smooth patch: lighter paint + smoother scroll without changing logic */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).view-level-home .main-content {
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-y: auto !important;
    overflow-x: hidden !important;
    touch-action: pan-y !important;
    scroll-behavior: auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).view-level-home .surface {
    contain: layout paint !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).view-level-home .subjects-dashboard {
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra.view-level-home :is(
      .subjects-dashboard-head,
      .subjects-stat-chip,
      .subject-add-card,
      .subject-premium-card
    ) {
    background-image: none !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    filter: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra.view-level-home :is(
      .subject-add-card,
      .subject-premium-card,
      .subjects-stat-chip
    ) {
    contain: layout style paint !important;
    content-visibility: auto;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra.view-level-home :is(
      .subject-premium-card::before,
      .subject-add-card::before,
      .subject-add-card::after
    ) {
    display: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra.view-level-home :is(
      .subject-add-track,
      .subject-add-flare
    ) {
    display: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).mobile-ultra.view-level-home .subject-add-icon {
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]).view-level-home :is(
      .subject-open-btn,
      .subject-add-btn
    ) {
    transform: none !important;
  }
}

/* Mobile layout rebalance: remove unnecessary single-column lock where space allows */
@media (min-width: 430px) and (max-width: 639px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .subjects-premium-grid,
      .list-grid,
      .sync-grid,
      .cloud-sync-grid,
      .settings-overview-strip,
      .settings-utility-grid,
      .lesson-dashboard-stats,
      .lesson-chapter-grid,
      .profile-inline-grid
    ) {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.subject-add-action, .lesson-add-action) {
    grid-template-columns: minmax(0, 1fr) auto !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.subject-add-btn, .lesson-add-btn) {
    width: auto !important;
    min-width: 108px !important;
  }
}

@media (min-width: 640px) and (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(
      .subjects-premium-grid,
      .list-grid,
      .sync-grid,
      .cloud-sync-grid,
      .settings-overview-strip,
      .settings-utility-grid,
      .settings-grid,
      .settings-sync-row-stack,
      .lesson-dashboard-stats,
      .lesson-chapter-grid,
      .exam-builder-controls,
      .practice-meta-strip,
      .profile-inline-grid
    ) {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 9px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .settings-cloud-layout {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 9px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.subject-add-action, .lesson-add-action) {
    grid-template-columns: minmax(0, 1fr) auto !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.subject-add-btn, .lesson-add-btn) {
    width: auto !important;
    min-width: 112px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .inline-form {
    flex-direction: row !important;
    flex-wrap: wrap !important;
    align-items: center !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .inline-form :is(input, select) {
    width: auto !important;
    min-width: 0 !important;
    flex: 1 1 190px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .inline-form button {
    width: auto !important;
    flex: 0 0 auto !important;
  }
}

@media (min-width: 820px) and (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .settings-panel-layout {
    grid-template-columns: minmax(220px, 0.88fr) minmax(0, 1.12fr) !important;
  }
}

/* Final mobile patch: completed exam view + global scroll stability */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]):not(.exam-focus-locked) .main-content {
    overflow-x: hidden !important;
    overflow-y: auto !important;
    overscroll-behavior-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    touch-action: pan-y !important;
  }

  html:not(.exam-focus-locked-page) {
    overflow-x: hidden !important;
    overflow-y: auto !important;
    overscroll-behavior-y: auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed {
    gap: 7px !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed :is(
      .exam-completion-banner,
      .exam-session-region,
      .exam-paper,
      .exam-paper-item,
      .exam-question-review,
      .exam-eval-panel,
      .exam-eval-result,
      .exam-eval-chapter-card
    ) {
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-session-region {
    gap: 7px !important;
    padding: 7px !important;
    border-radius: 11px !important;
    overflow-x: hidden !important;
    overflow-y: visible !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-paper {
    padding: 8px !important;
    gap: 7px !important;
    border-radius: 11px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-paper-list {
    gap: 7px !important;
    margin-top: 7px !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-paper-item {
    padding: 7px !important;
    border-radius: 10px !important;
    contain: layout style paint !important;
    content-visibility: auto;
    contain-intrinsic-size: 1px 200px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-review {
    margin-top: 7px !important;
    padding: 7px !important;
    border-radius: 10px !important;
    gap: 6px !important;
    contain: layout style paint !important;
    content-visibility: auto;
    contain-intrinsic-size: 1px 160px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-mark-group {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
    width: 100% !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-mark-btn {
    width: 100% !important;
    min-height: 33px !important;
    padding-inline: 5px !important;
    font-size: 0.69rem !important;
    justify-content: center !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-answer-body {
    padding: 7px 8px 6px !important;
    line-height: 1.72 !important;
    font-size: 0.88rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-panel {
    margin-top: 8px !important;
    padding: 8px !important;
    gap: 7px !important;
    border-radius: 11px !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-caption {
    font-size: 0.74rem !important;
    line-height: 1.6 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-mark-stats {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-mark-stats .exam-paper-meta-pill:first-child {
    grid-column: 1 / -1 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-result-top {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-status {
    font-size: 0.78rem !important;
    line-height: 1.75 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-insight-item {
    min-height: 0 !important;
    padding: 6px 8px !important;
    font-size: 0.7rem !important;
    line-height: 1.62 !important;
    align-items: flex-start !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-chapter-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-chapter-meta {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 5px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-chapter-meta .exam-paper-meta-pill:last-child {
    grid-column: 1 / -1 !important;
  }
}

@media (max-width: 429px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-mark-stats,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-result-top,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-eval-chapter-grid {
    grid-template-columns: minmax(0, 1fr) !important;
  }
}

/* Desktop performance patch: smooth scroll/render under heavy datasets */
@media (min-width: 1024px) {
  :is(body.force-desktop, body.auto-desktop, body[data-viewport-resolved="desktop"]).desktop-lite {
    scroll-behavior: auto !important;
  }

  :is(body.force-desktop, body.auto-desktop, body[data-viewport-resolved="desktop"]).desktop-lite :is(
      .subject-premium-card,
      .lesson-chapter-card,
      .question-card,
      .practice-toolbar,
      .practice-question-card,
      .practice-reveal-box,
      .exam-builder-form,
      .exam-pane,
      .exam-paper,
      .exam-paper-item,
      .chapter-map-toolbar,
      .chapter-map-stage,
      .chapter-map-legend,
      .chapter-map-legend-item
    ) {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    box-shadow: 0 8px 18px rgba(6, 10, 16, 0.24) !important;
  }

  :is(body.force-desktop, body.auto-desktop, body[data-viewport-resolved="desktop"]).desktop-lite :is(
      .topbar.premium-topbar,
      .settings-panel.settings-panel-premium
    ) {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  :is(body.force-desktop, body.auto-desktop, body[data-viewport-resolved="desktop"]).desktop-lite :is(
      .stagger-item,
      .chapter-map-link,
      .chapter-tree-link,
      .chapter-tree-node-glow,
      .practice-action-btn,
      .exam-chip-btn,
      .qb-pill
    ) {
    animation: none !important;
    transition: none !important;
  }

  :is(body.force-desktop, body.auto-desktop, body[data-viewport-resolved="desktop"]).desktop-lite :is(
      .header-brand-track-a,
      .header-brand-track-b,
      .header-brand-prism,
      .header-brand-flare,
      .subject-add-track-a,
      .subject-add-track-b,
      .subject-add-prism,
      .subject-add-flare
    ) {
    animation: none !important;
  }

  :is(body.force-desktop, body.auto-desktop, body[data-viewport-resolved="desktop"]).desktop-lite :is(
      .question-list .question-card.perf-lite-card,
      .exam-paper-list .exam-paper-item,
      .lesson-chapter-grid .lesson-chapter-card,
      .subjects-premium-grid .subject-premium-card,
      .chapter-map-legend-list .chapter-map-legend-item
    ) {
    contain: layout style paint !important;
    content-visibility: auto;
    contain-intrinsic-size: 1px 210px;
  }

  :is(body.force-desktop, body.auto-desktop, body[data-viewport-resolved="desktop"]).desktop-lite :is(
      .question-list,
      .exam-paper-list,
      .chapter-map-legend-list
    ) {
    contain: layout style paint !important;
  }

  :is(
      body.force-desktop,
      body.auto-desktop,
      body[data-viewport-resolved="desktop"]
    ).desktop-lite
    .chapter-map-desktop-perf
    :is(.chapter-map-blobs, .chapter-map-particles, .chapter-tree-minimap) {
    display: none !important;
  }

  :is(
      body.force-desktop,
      body.auto-desktop,
      body[data-viewport-resolved="desktop"]
    ).desktop-lite
    .chapter-map-desktop-perf
    .chapter-tree-shell.is-heavy-tree
    .chapter-tree-node-glow {
    display: none !important;
  }
}

/* Final mobile layout lock: question-bank rows + tree clarity */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-sort-group,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-solved-group {
    display: grid !important;
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
    gap: 6px !important;
    align-items: stretch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-review-group {
    display: grid !important;
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
    gap: 6px !important;
    align-items: stretch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 :is(.qb-sort-chip, .qb-solved-chip, .qb-review-chip) {
    min-height: 34px !important;
    padding-inline: 6px !important;
    font-size: 0.7rem !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-overview {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-tools {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-strip {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) auto !important;
    align-items: center !important;
    gap: 8px !important;
    flex-wrap: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-main,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-copy {
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-main {
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-orb {
    width: 24px !important;
    height: 24px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-value {
    min-width: 72px !important;
    font-size: 0.84rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-state {
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-actions {
    display: inline-flex !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    justify-content: flex-end !important;
    grid-template-columns: none !important;
    gap: 5px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-btn {
    min-width: 48px !important;
    min-height: 34px !important;
    padding: 4px 7px !important;
    font-size: 0.66rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-panel.chapter-map-mobile-perf .chapter-map-layout.chapter-map-layout-tree :is(.chapter-map-stage, .chapter-map-canvas) {
    min-height: 340px !important;
    max-height: 70dvh !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-panel.chapter-map-mobile-perf .chapter-tree-trunk {
    stroke-width: 2.28 !important;
    opacity: 0.78 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-panel.chapter-map-mobile-perf .chapter-tree-link {
    stroke-width: 2.02 !important;
    opacity: 0.92 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-panel.chapter-map-mobile-perf .chapter-tree-link-trail {
    stroke-width: 3.3 !important;
    opacity: 0.15 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-panel.chapter-map-mobile-perf .chapter-tree-shell.is-mobile-dense .chapter-tree-node-title {
    font-size: 0.64rem !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-panel.chapter-map-mobile-perf .chapter-tree-shell.is-mobile-dense .chapter-tree-badges text {
    font-size: 0.52rem !important;
  }
}

@media (max-width: 560px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-overview {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-tools {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-sort-group,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-solved-group,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 .qb-review-group {
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .chapter-map-panel.chapter-map-mobile-perf .chapter-map-layout.chapter-map-layout-tree :is(.chapter-map-stage, .chapter-map-canvas) {
    min-height: 320px !important;
    max-height: 68dvh !important;
  }
}

@media (max-width: 429px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-state {
    display: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .question-solve-btn {
    min-width: 44px !important;
    padding-inline: 6px !important;
  }
}

/* Mobile exam answers: strict box layout + lightweight rendering */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-paper-item {
    overflow: hidden !important;
    border-radius: 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-paper-item .question-card {
    padding: 8px !important;
    border-radius: 11px !important;
    gap: 7px !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-review {
    margin-top: 8px !important;
    padding: 8px 9px !important;
    border-radius: 11px !important;
    overflow: hidden !important;
    min-width: 0 !important;
    contain: layout style paint !important;
    content-visibility: auto;
    contain-intrinsic-size: 1px 196px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-review-top {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 7px !important;
    align-items: stretch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-review-title {
    min-width: 0 !important;
    font-size: 0.8rem !important;
    line-height: 1.45 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-mark-group {
    width: 100% !important;
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-mark-btn {
    min-height: 36px !important;
    width: 100% !important;
    justify-content: center !important;
    padding-inline: 8px !important;
    gap: 5px !important;
    transform: none !important;
    transition: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-mark-btn span {
    min-width: 0 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-mark-state {
    margin: 0 !important;
    font-size: 0.71rem !important;
    line-height: 1.7 !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-answer-body {
    margin-top: 1px !important;
    padding: 8px !important;
    border-radius: 10px !important;
    font-size: 0.89rem !important;
    line-height: 1.74 !important;
    max-width: 100% !important;
    min-width: 0 !important;
    overflow-wrap: anywhere !important;
    word-break: break-word !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-answer-body :is(pre, code) {
    white-space: pre-wrap !important;
    word-break: break-word !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed .exam-question-answer-body .math-node {
    max-width: 100% !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    scrollbar-width: thin !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-session-completed :is(
      .exam-question-review,
      .exam-question-mark-btn,
      .exam-question-answer-body,
      .exam-eval-panel,
      .exam-eval-result,
      .exam-eval-insight-item,
      .exam-eval-chapter-card
    ) {
    animation: none !important;
    transition: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
}

.exam-question-review-skeleton {
  border-style: dashed !important;
  opacity: 0.86;
}

.exam-question-mark-btn.exam-question-mark-btn-skeleton {
  min-height: 34px;
  justify-content: center;
  pointer-events: none;
  opacity: 0.74;
}

.exam-question-answer-body.exam-question-answer-body-skeleton {
  border-top-style: dotted;
  display: grid;
  gap: 6px;
}

.exam-answer-skeleton-line {
  display: block;
  height: 8px;
  border-radius: 999px;
  background: color-mix(in srgb, var(--text-muted, #9fb6ce) 24%, transparent);
}

.exam-answer-skeleton-line.line-a {
  width: 92%;
}

.exam-answer-skeleton-line.line-b {
  width: 68%;
}

/* Final mobile practice lock: 2-column actions + smoother scroll/render */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf {
    min-width: 0 !important;
    overflow-x: hidden !important;
    overflow-y: visible !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-y: auto !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .question-list {
    min-width: 0 !important;
    overflow-x: hidden !important;
    content-visibility: auto;
    contain: layout style paint !important;
    contain-intrinsic-size: 1px 780px;
    overflow-anchor: none !important;
    -webkit-overflow-scrolling: touch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-question-card {
    min-width: 0 !important;
    overflow: hidden !important;
    border-radius: 13px !important;
    padding: 9px !important;
    contain: layout style paint !important;
    content-visibility: auto;
    contain-intrinsic-size: 1px 560px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-focus-actions {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 7px !important;
    align-items: stretch !important;
    margin-top: 9px !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-solution-stack {
    display: contents !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-next-btn {
    grid-column: auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-focus-actions > .practice-action-btn[data-action="practice-reveal-hint"] {
    order: 1 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-focus-actions > .practice-action-btn[data-action="practice-prev"] {
    order: 2 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-focus-actions .practice-action-btn[data-action="practice-reveal-solution"] {
    order: 3 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-focus-actions .practice-action-btn[data-action="practice-random"] {
    order: 4 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-focus-actions > .practice-next-btn {
    order: 5 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-focus-actions > .practice-action-btn[data-action="practice-copy-question"] {
    order: 6 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-focus-actions > .practice-next-btn {
    grid-column: 1 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-focus-actions > .practice-action-btn[data-action="practice-copy-question"] {
    grid-column: 2 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-utility-actions {
    margin-top: 7px !important;
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 7px !important;
    min-width: 0 !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-utility-actions > .practice-action-btn[data-action="practice-toggle-review"] {
    width: 100% !important;
    min-height: 40px !important;
    padding-inline: 10px !important;
    font-size: 0.78rem !important;
    border-radius: 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf :is(
      .practice-focus-actions .practice-action-btn,
      .practice-utility-actions .practice-action-btn
    ) {
    width: 100% !important;
    min-width: 0 !important;
    min-height: 36px !important;
    padding: 6px 8px !important;
    border-radius: 11px !important;
    justify-content: center !important;
    gap: 5px !important;
    font-size: 0.74rem !important;
    line-height: 1.32 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    transition: none !important;
    animation: none !important;
    transform: none !important;
    will-change: auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-action-btn .practice-icon {
    width: 16px !important;
    height: 16px !important;
    flex: 0 0 16px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf :is(
      .practice-toolbar,
      .practice-question-card,
      .practice-reveal-box
    ) {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-reveal-box {
    margin-top: 8px !important;
    padding: 9px !important;
    border-radius: 11px !important;
    overflow: hidden !important;
    contain: layout style paint !important;
    content-visibility: auto;
    contain-intrinsic-size: 1px 220px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-reveal-content {
    max-width: 100% !important;
    min-width: 0 !important;
    overflow-wrap: anywhere !important;
    word-break: break-word !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-reveal-content .math-node {
    max-width: 100% !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    scrollbar-width: thin !important;
  }
}

/* Final mobile exam lock: answer boxes + smooth scroll stability */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed {
    overflow-x: hidden !important;
    overflow-y: visible !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed :is(
      .exam-session-region,
      .exam-paper,
      .exam-paper-list
    ) {
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-y: auto !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-paper-list {
    content-visibility: auto;
    contain: layout style paint !important;
    contain-intrinsic-size: 1px 1200px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed :is(
      .exam-question-review,
      .exam-question-review *,
      .exam-question-answer-body,
      .exam-question-mark-group,
      .exam-question-mark-btn
    ) {
    box-sizing: border-box !important;
    max-width: 100% !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-question-review {
    border-radius: 11px !important;
    border-width: 1px !important;
    background-image: none !important;
    background-color: color-mix(in srgb, var(--surface2, #162538) 92%, transparent) !important;
  }

  html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-question-review {
    background-color: rgba(255, 255, 255, 0.96) !important;
  }
}

/* Final mobile polish: practice row alignment + completed exam smoothness/theme parity */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-focus-actions > .practice-next-btn {
    order: 5 !important;
    grid-column: 1 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-focus-actions > .practice-copy-question-btn {
    order: 6 !important;
    grid-column: 2 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .practice-mode-panel.practice-mobile-perf .practice-utility-actions > .practice-review-toggle-btn {
    min-height: 40px !important;
    padding: 8px 12px !important;
    font-size: 0.79rem !important;
    border-radius: 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-paper-list {
    contain: layout paint style !important;
    content-visibility: auto;
    contain-intrinsic-size: 1px 1450px;
    overflow-anchor: none !important;
    scroll-behavior: auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-paper-item {
    contain: layout paint style !important;
    content-visibility: auto;
    contain-intrinsic-size: 1px 320px;
    overflow: clip !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-question-review {
    border-radius: 12px !important;
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 36%, transparent) !important;
    background:
      radial-gradient(circle at 86% 12%, color-mix(in srgb, var(--accent2, var(--accent)) 18%, transparent), transparent 44%),
      linear-gradient(148deg, color-mix(in srgb, var(--surface2, #162538) 86%, transparent), color-mix(in srgb, var(--surface1, #0f1e32) 92%, transparent)) !important;
    box-shadow: none !important;
    contain: layout paint style !important;
    content-visibility: auto;
    contain-intrinsic-size: 1px 180px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-question-review.is-correct {
    border-color: rgba(126, 232, 179, 0.52) !important;
    background:
      radial-gradient(circle at 12% 14%, rgba(126, 232, 179, 0.2), transparent 44%),
      linear-gradient(148deg, rgba(19, 48, 40, 0.58), rgba(18, 28, 36, 0.62)) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-question-review.is-wrong {
    border-color: rgba(255, 170, 158, 0.52) !important;
    background:
      radial-gradient(circle at 12% 14%, rgba(255, 170, 158, 0.2), transparent 44%),
      linear-gradient(148deg, rgba(64, 28, 34, 0.58), rgba(24, 24, 34, 0.62)) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-question-review.is-pending {
    border-color: rgba(255, 220, 140, 0.5) !important;
    background:
      radial-gradient(circle at 12% 14%, rgba(255, 220, 140, 0.2), transparent 44%),
      linear-gradient(148deg, rgba(58, 46, 24, 0.56), rgba(24, 24, 34, 0.62)) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-question-answer-body {
    border-top-color: color-mix(in srgb, var(--accent2, var(--accent)) 44%, transparent) !important;
    background: color-mix(in srgb, var(--surface3, #1f3148) 46%, transparent) !important;
    border-radius: 10px !important;
    padding: 8px 10px 7px !important;
    contain: layout paint style !important;
    content-visibility: auto;
    contain-intrinsic-size: 1px 132px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-question-answer-body .math-node {
    max-width: 100% !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
  }

  html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-question-review {
    border-color: rgba(99, 92, 181, 0.24) !important;
    background:
      radial-gradient(circle at 85% 12%, rgba(117, 95, 201, 0.16), transparent 42%),
      linear-gradient(148deg, rgba(255, 255, 255, 0.94), rgba(247, 244, 255, 0.9)) !important;
  }

  html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-question-review.is-correct {
    border-color: rgba(49, 151, 104, 0.28) !important;
    background:
      radial-gradient(circle at 12% 14%, rgba(49, 151, 104, 0.14), transparent 42%),
      linear-gradient(148deg, rgba(255, 255, 255, 0.95), rgba(243, 252, 247, 0.92)) !important;
  }

  html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-question-review.is-wrong {
    border-color: rgba(194, 99, 88, 0.3) !important;
    background:
      radial-gradient(circle at 12% 14%, rgba(194, 99, 88, 0.14), transparent 42%),
      linear-gradient(148deg, rgba(255, 255, 255, 0.95), rgba(255, 245, 244, 0.93)) !important;
  }

  html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .exam-mode-panel.exam-mobile-perf.exam-session-completed .exam-question-review.is-pending {
    border-color: rgba(196, 147, 46, 0.3) !important;
    background:
      radial-gradient(circle at 12% 14%, rgba(196, 147, 46, 0.13), transparent 42%),
      linear-gradient(148deg, rgba(255, 255, 255, 0.95), rgba(255, 249, 238, 0.93)) !important;
  }
}

/* Mobile premium pass: question-bank filter keys + topic chips + question index */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 {
    --qb-mobile-chip-h: 38px;
    --qb-mobile-chip-r: 13px;
    --qb-mobile-chip-pad-x: 9px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-filter-row-actions {
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: stretch !important;
    gap: 8px !important;
    width: 100% !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-filter-active-count {
    flex: 1 1 auto !important;
    min-width: 0 !important;
    min-height: var(--qb-mobile-chip-h) !important;
    padding-inline: 10px !important;
    border-radius: 12px !important;
    border: 1px solid color-mix(in srgb, var(--accent2, var(--accent)) 30%, transparent) !important;
    background:
      linear-gradient(160deg, color-mix(in srgb, var(--surface3, #1f3148) 58%, transparent), color-mix(in srgb, var(--surface1, #0f1e32) 92%, transparent)) !important;
    color: var(--text-main) !important;
    font-size: 0.74rem !important;
    font-weight: 760 !important;
    line-height: 1.2 !important;
    justify-content: center !important;
    text-align: center !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08), 0 7px 14px rgba(4, 12, 22, 0.1) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-clear-btn-compact {
    flex: 0 0 auto !important;
    min-height: var(--qb-mobile-chip-h) !important;
    min-width: 96px !important;
    padding-inline: 12px !important;
    border-radius: 12px !important;
    border: 1px solid color-mix(in srgb, var(--accent2, var(--accent)) 44%, transparent) !important;
    background: linear-gradient(155deg, color-mix(in srgb, var(--accent2, var(--accent)) 24%, transparent), color-mix(in srgb, var(--surface2, #162538) 90%, transparent)) !important;
    color: #fff !important;
    font-size: 0.73rem !important;
    font-weight: 820 !important;
    gap: 5px !important;
    white-space: nowrap !important;
    box-shadow: 0 9px 16px color-mix(in srgb, var(--accent2, var(--accent)) 24%, transparent), inset 0 1px 0 rgba(255, 255, 255, 0.14) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-clear-btn-compact
    svg {
    width: 14px !important;
    height: 14px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-clear-btn-compact:focus-visible {
    outline: none !important;
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 72%, transparent) !important;
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent2, var(--accent)) 22%, transparent), 0 8px 15px color-mix(in srgb, var(--accent2, var(--accent)) 24%, transparent) !important;
  }

  html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-filter-active-count {
    border-color: rgba(47, 130, 193, 0.34) !important;
    background: linear-gradient(160deg, rgba(255, 255, 255, 0.97), rgba(243, 250, 255, 0.94)) !important;
    color: #1f5477 !important;
    box-shadow: 0 8px 14px rgba(29, 63, 92, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.94) !important;
  }

  html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-clear-btn-compact {
    border-color: rgba(47, 130, 193, 0.38) !important;
    background: linear-gradient(155deg, rgba(83, 166, 224, 0.22), rgba(255, 255, 255, 0.95)) !important;
    color: #114a6a !important;
    box-shadow: 0 9px 15px rgba(29, 63, 92, 0.12), inset 0 1px 0 rgba(255, 255, 255, 0.92) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-lux-filter-panel {
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 28%, transparent) !important;
    background:
      radial-gradient(circle at 12% 10%, color-mix(in srgb, var(--accent2, var(--accent)) 17%, transparent), transparent 48%),
      linear-gradient(152deg, color-mix(in srgb, var(--surface2, #162538) 90%, transparent), color-mix(in srgb, var(--surface1, #0f1e32) 94%, transparent)) !important;
    box-shadow: 0 10px 20px rgba(5, 12, 19, 0.16), inset 0 1px 0 rgba(255, 255, 255, 0.06) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 :is(
      .qb-sort-chip,
      .qb-solved-chip,
      .qb-review-chip,
      .qb-topic-quick-btn
    ) {
    position: relative !important;
    isolation: isolate;
    width: 100% !important;
    min-height: var(--qb-mobile-chip-h) !important;
    padding: 7px var(--qb-mobile-chip-pad-x) !important;
    border-radius: var(--qb-mobile-chip-r) !important;
    border: 1px solid color-mix(in srgb, var(--accent2, var(--accent)) 28%, rgba(255, 255, 255, 0.08)) !important;
    background:
      linear-gradient(160deg, color-mix(in srgb, var(--surface3, #1f3148) 54%, transparent), color-mix(in srgb, var(--surface1, #0f1e32) 88%, transparent)) !important;
    color: var(--text-main) !important;
    font-size: 0.73rem !important;
    font-weight: 820 !important;
    line-height: 1.2 !important;
    letter-spacing: 0.01em;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 4px !important;
    text-align: center !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08), 0 6px 14px rgba(4, 12, 22, 0.12) !important;
    transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease, color 0.2s ease !important;
    -webkit-tap-highlight-color: transparent;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 :is(
      .qb-sort-chip,
      .qb-solved-chip,
      .qb-review-chip,
      .qb-topic-quick-btn
    )::after {
    content: "";
    position: absolute;
    inset: 1px;
    border-radius: calc(var(--qb-mobile-chip-r) - 2px);
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0));
    opacity: 0.66;
    pointer-events: none;
    z-index: -1;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 :is(
      .qb-sort-chip:hover,
      .qb-solved-chip:hover,
      .qb-review-chip:hover,
      .qb-topic-quick-btn:hover
    ) {
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 56%, transparent) !important;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12), 0 9px 16px rgba(4, 12, 22, 0.2) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel.question-bank-mobile-perf .qb-filter-layout-v2 :is(
      .qb-sort-chip:focus-visible,
      .qb-solved-chip:focus-visible,
      .qb-review-chip:focus-visible,
      .qb-topic-quick-btn:focus-visible
    ) {
    outline: none !important;
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 66%, transparent) !important;
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent2, var(--accent)) 24%, transparent), inset 0 1px 0 rgba(255, 255, 255, 0.14) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-lux-filter-panel:not(.is-solved):not(.is-review)
    .qb-sort-chip.is-active {
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 78%, transparent) !important;
    background: linear-gradient(155deg, color-mix(in srgb, var(--accent2, var(--accent)) 34%, transparent), color-mix(in srgb, var(--accent, #5db6f2) 18%, transparent)) !important;
    color: #fff !important;
    box-shadow: 0 10px 20px color-mix(in srgb, var(--accent2, var(--accent)) 28%, transparent), inset 0 1px 0 rgba(255, 255, 255, 0.18) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-lux-filter-panel.is-solved
    .qb-solved-chip.is-active {
    border-color: rgba(122, 230, 177, 0.86) !important;
    background: linear-gradient(155deg, rgba(112, 224, 169, 0.36), rgba(112, 224, 169, 0.16)) !important;
    color: #f2fff8 !important;
    box-shadow: 0 10px 18px rgba(66, 170, 122, 0.28), inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-lux-filter-panel.is-review
    .qb-review-chip.is-active {
    border-color: rgba(255, 209, 126, 0.9) !important;
    background: linear-gradient(155deg, rgba(255, 206, 112, 0.34), rgba(255, 206, 112, 0.14)) !important;
    color: #fff4d8 !important;
    box-shadow: 0 10px 18px rgba(176, 124, 48, 0.28), inset 0 1px 0 rgba(255, 255, 255, 0.22) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-topic-quick {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-topic-select {
    min-height: var(--qb-mobile-chip-h) !important;
    border-radius: var(--qb-mobile-chip-r) !important;
    padding-inline: 12px 34px !important;
    border: 1px solid color-mix(in srgb, var(--accent2, var(--accent)) 28%, transparent) !important;
    background:
      linear-gradient(160deg, color-mix(in srgb, var(--surface3, #1f3148) 62%, transparent), color-mix(in srgb, var(--surface1, #0f1e32) 92%, transparent)) !important;
    color: var(--text-main) !important;
    font-size: 0.75rem !important;
    font-weight: 760 !important;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08), 0 6px 14px rgba(4, 12, 22, 0.1) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-topic-select:focus-visible {
    outline: none !important;
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 72%, transparent) !important;
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent2, var(--accent)) 22%, transparent), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .question-card
    .question-index {
    position: relative;
    min-height: 34px !important;
    padding: 6px 13px !important;
    border-radius: 12px !important;
    border: 1px solid color-mix(in srgb, var(--accent2, var(--accent)) 34%, transparent) !important;
    background:
      linear-gradient(160deg, color-mix(in srgb, var(--accent2, var(--accent)) 28%, transparent), color-mix(in srgb, var(--surface2, #162538) 94%, transparent)) !important;
    color: #f8fcff !important;
    font-size: 0.78rem !important;
    font-weight: 900 !important;
    letter-spacing: 0.015em !important;
    box-shadow: 0 10px 18px rgba(5, 13, 22, 0.18), inset 0 1px 0 rgba(255, 255, 255, 0.18) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .question-card
    .question-index::before {
    content: "";
    width: 7px;
    height: 7px;
    border-radius: 50%;
    display: inline-block;
    margin-inline-start: 6px;
    background: color-mix(in srgb, var(--accent2, var(--accent)) 88%, #fff);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent2, var(--accent)) 22%, transparent);
  }

  html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    :is(.qb-sort-chip, .qb-solved-chip, .qb-review-chip, .qb-topic-quick-btn, .qb-topic-select) {
    border-color: rgba(47, 130, 193, 0.34) !important;
    background:
      linear-gradient(160deg, rgba(255, 255, 255, 0.97), rgba(243, 250, 255, 0.94)) !important;
    color: #1f5477 !important;
    box-shadow: 0 8px 14px rgba(29, 63, 92, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.94) !important;
  }

html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .question-card
    .question-index {
    border-color: rgba(47, 130, 193, 0.4) !important;
    background: linear-gradient(160deg, rgba(83, 166, 224, 0.24), rgba(255, 255, 255, 0.95)) !important;
    color: #114a6a !important;
    box-shadow: 0 9px 15px rgba(29, 63, 92, 0.12), inset 0 1px 0 rgba(255, 255, 255, 0.92) !important;
  }
}

/* Mobile header/settings stability patch: overflow actions + settings cards + smooth scroll */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .topbar.premium-topbar.qb-header.app-header-v3
    .appbar-overflow-menu {
    min-width: min(240px, calc(100vw - 16px)) !important;
    max-height: min(62dvh, 420px) !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior: contain !important;
    padding: 8px !important;
    border-radius: 14px !important;
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 30%, transparent) !important;
    background:
      linear-gradient(152deg, color-mix(in srgb, var(--surface2, #162538) 92%, transparent), color-mix(in srgb, var(--surface1, #0f1e32) 96%, transparent)) !important;
    box-shadow: 0 12px 24px rgba(4, 10, 17, 0.28) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .topbar.premium-topbar.qb-header.app-header-v3
    .appbar-overflow-item {
    min-height: 44px !important;
    height: 44px !important;
    border-radius: 11px !important;
    border: 1px solid color-mix(in srgb, var(--accent2, var(--accent)) 24%, transparent) !important;
    background:
      linear-gradient(158deg, color-mix(in srgb, var(--surface3, #1f3148) 58%, transparent), color-mix(in srgb, var(--surface1, #0f1e32) 92%, transparent)) !important;
    color: var(--text-main) !important;
    font-size: 0.81rem !important;
    font-weight: 760 !important;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .topbar.premium-topbar.qb-header.app-header-v3
    .settings-panel.settings-panel-premium {
    width: min(100%, calc(100vw - 12px)) !important;
    margin-inline: auto !important;
    margin-top: 8px !important;
    border-radius: 14px !important;
    contain: layout style paint !important;
    box-shadow: 0 12px 24px rgba(6, 12, 18, 0.22) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .topbar.premium-topbar.qb-header.app-header-v3
    .settings-panel-premium.is-open {
    --settings-panel-open-max: min(78dvh, 760px) !important;
    max-height: var(--settings-panel-open-max) !important;
    padding: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .topbar.premium-topbar.qb-header.app-header-v3
    .settings-panel-layout {
    max-height: calc(var(--settings-panel-open-max, 78dvh) - 64px) !important;
    gap: 8px !important;
    padding-inline-end: 0 !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior: contain !important;
    contain: layout style !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .topbar.premium-topbar.qb-header.app-header-v3
    :is(
      .settings-panel-side,
      .settings-panel-workspace,
      .settings-tab-panel,
      .settings-overview-card,
      .settings-mode-card,
      .settings-utility-card,
      .drive-sync-diagnostics,
      .drive-diag-item
    ) {
    border-radius: 12px !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .topbar.premium-topbar.qb-header.app-header-v3
    .settings-tab-strip {
    display: grid !important;
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .topbar.premium-topbar.qb-header.app-header-v3
    .settings-tab-btn {
    min-height: 40px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .topbar.premium-topbar.qb-header.app-header-v3
    :is(.settings-overview-strip, .settings-grid, .settings-cloud-layout, .settings-sync-row-stack, .settings-utility-grid) {
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .topbar.premium-topbar.qb-header.app-header-v3
    :is(.settings-inline-actions .glass-btn, .settings-sync-row-stack .glass-btn, .drive-sync-redesign-actions .glass-btn) {
    min-height: 40px !important;
  }

  @supports (content-visibility: auto) {
    :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
      .topbar.premium-topbar.qb-header.app-header-v3
      .settings-panel.is-open
      :is(.settings-overview-card, .settings-utility-card, .drive-diag-item) {
      content-visibility: auto;
      contain-intrinsic-size: 1px 96px;
    }
  }

  html[data-theme^="light-"] :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .topbar.premium-topbar.qb-header.app-header-v3
    :is(.appbar-overflow-item, .settings-overview-card, .settings-mode-card, .settings-utility-card, .drive-diag-item) {
    border-color: rgba(47, 130, 193, 0.3) !important;
    background:
      linear-gradient(158deg, rgba(255, 255, 255, 0.96), rgba(244, 251, 255, 0.92)) !important;
  }
}

/* Final mobile fix: balance "active filters" and "clear" sizes in one row */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-filter-row-actions {
    display: grid !important;
    grid-template-columns: minmax(0, 1.15fr) minmax(112px, 0.85fr) !important;
    align-items: stretch !important;
    gap: 8px !important;
    width: 100% !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-filter-active-count {
    width: 100% !important;
    min-width: 0 !important;
    max-width: none !important;
    flex: none !important;
    justify-content: center !important;
    text-align: center !important;
    padding-inline: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-clear-btn-compact {
    width: 100% !important;
    min-width: 0 !important;
    flex: none !important;
    justify-content: center !important;
    text-align: center !important;
    padding-inline: 10px !important;
  }
}

/* Final mobile patch: pinned header + readable topic/method chips + wider question index */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .topbar.premium-topbar.qb-header.app-header-v3 {
    position: fixed !important;
    top: max(0px, env(safe-area-inset-top, 0px)) !important;
    inset-inline: 5px !important;
    width: auto !important;
    max-width: none !important;
    z-index: 1800 !important;
    margin: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .app-shell {
    overflow: visible !important;
    padding-top: calc(env(safe-area-inset-top, 0px) + 72px) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-topic-quick,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-topic-quick {
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    gap: 7px !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-inline: contain !important;
    scrollbar-width: thin !important;
    padding-bottom: 3px !important;
    scroll-snap-type: x proximity !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-topic-quick::-webkit-scrollbar,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-topic-quick::-webkit-scrollbar {
    display: block !important;
    height: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-topic-quick::-webkit-scrollbar-track,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-topic-quick::-webkit-scrollbar-track {
    background: color-mix(in srgb, var(--surface2, #162538) 74%, transparent) !important;
    border-radius: 999px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-topic-quick::-webkit-scrollbar-thumb,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-topic-quick::-webkit-scrollbar-thumb {
    background: linear-gradient(90deg, color-mix(in srgb, var(--accent2, var(--accent)) 84%, #fff), color-mix(in srgb, var(--accent, #5db6f2) 78%, #fff)) !important;
    border-radius: 999px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-topic-quick-btn,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-topic-quick-btn {
    flex: 0 0 auto !important;
    width: max-content !important;
    min-width: max-content !important;
    max-width: none !important;
    padding-inline: 12px !important;
    white-space: nowrap !important;
    overflow: visible !important;
    text-overflow: clip !important;
    scroll-snap-align: start !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .question-card
    .question-index,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .question-card
    .question-index {
    min-width: 96px !important;
    padding-inline: 16px !important;
    justify-content: center !important;
  }
}

/* FINAL FINAL MOBILE QUESTION TEXT WRAP LOCK */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .question-card
    .question-body,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .practice-mode-panel
    .question-card
    .question-body,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel
    .question-card
    .question-body,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .question-card
    .question-body,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .practice-mode-panel.practice-mobile-perf
    .practice-question-card
    .question-body,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-mobile-perf
    .exam-paper-item
    .question-card
    .question-body,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .exam-mode-panel.exam-session-ready
    .exam-paper-item
    .question-card
    .question-body {
    width: 100% !important;
    min-width: 0 !important;
    max-width: 100% !important;
    padding: 11px 12px !important;
    font-size: clamp(0.92rem, 3.65vw, 1rem) !important;
    line-height: 1.9 !important;
    white-space: normal !important;
    overflow-wrap: break-word !important;
    word-break: normal !important;
    hyphens: none !important;
    line-break: auto !important;
    text-wrap: pretty !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-body
    .text-line {
    margin: 0 0 0.66em !important;
    white-space: normal !important;
    overflow-wrap: break-word !important;
    word-break: normal !important;
    hyphens: none !important;
    line-break: auto !important;
    text-wrap: pretty !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-body
    .text-line:last-child {
    margin-bottom: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-body
    .math-node {
    max-width: 100% !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    scrollbar-width: thin !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-body
    .math-node[data-display="1"] {
    margin: 9px 0 !important;
  }
}

/* Final lock: mobile filter active + clear must stay in one row with balanced widths */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-filter-row-actions,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-filter-row-actions {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) minmax(96px, 38%) !important;
    align-items: stretch !important;
    gap: 8px !important;
    width: 100% !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-filter-active-count,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-filter-active-count {
    width: 100% !important;
    min-width: 0 !important;
    max-width: none !important;
    justify-content: center !important;
    text-align: center !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    padding-inline: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-clear-btn-compact,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-clear-btn-compact {
    width: 100% !important;
    min-width: 0 !important;
    max-width: none !important;
    justify-content: center !important;
    text-align: center !important;
    white-space: nowrap !important;
    padding-inline: 9px !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
}

@media (max-width: 420px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-filter-row-actions,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-filter-row-actions {
    grid-template-columns: minmax(0, 1fr) minmax(88px, 36vw) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-clear-btn-compact,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-clear-btn-compact {
    padding-inline: 8px !important;
    gap: 4px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel.question-bank-mobile-perf
    .qb-filter-layout-v2
    .qb-clear-btn-compact
    span,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-clear-btn-compact
    span {
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
}

/* ULTRA FINAL MOBILE LOCK (END OF FILE): active filters + clear in one row */
@media (max-width: 1023px) {
  .qb-filter-layout-v2 .qb-filter-row-actions {
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    justify-content: stretch !important;
    gap: 8px !important;
    width: 100% !important;
    min-width: 0 !important;
    overflow: hidden !important;
  }

  .qb-filter-layout-v2 .qb-filter-row-actions > .qb-filter-active-count {
    flex: 1 1 0 !important;
    min-width: 0 !important;
    max-width: none !important;
    width: auto !important;
    justify-content: center !important;
    text-align: center !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    padding-inline: 10px !important;
  }

  .qb-filter-layout-v2 .qb-filter-row-actions > .qb-clear-btn-compact {
    flex: 0 0 clamp(92px, 36vw, 124px) !important;
    width: clamp(92px, 36vw, 124px) !important;
    min-width: 0 !important;
    max-width: none !important;
    justify-content: center !important;
    text-align: center !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    padding-inline: 8px !important;
    gap: 4px !important;
  }

  .qb-filter-layout-v2 .qb-filter-row-actions > .qb-clear-btn-compact span {
    display: block !important;
    min-width: 0 !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
  }
}

@media (max-width: 420px) {
  .qb-filter-layout-v2 .qb-filter-row-actions {
    gap: 6px !important;
  }

  .qb-filter-layout-v2 .qb-filter-row-actions > .qb-clear-btn-compact {
    flex-basis: clamp(84px, 34vw, 108px) !important;
    width: clamp(84px, 34vw, 108px) !important;
  }
}

/* HARD LOCK (mobile): keep "active filters" + "clear" strictly in one row */
@media (max-width: 1023px) {
  :is(
      body.force-mobile,
      body.auto-mobile,
      body[data-viewport-resolved="mobile"]
    )
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-filter-row-actions {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) clamp(88px, 33vw, 118px) !important;
    grid-auto-flow: column !important;
    align-items: stretch !important;
    justify-items: stretch !important;
    gap: 7px !important;
    width: 100% !important;
    min-width: 0 !important;
    flex-wrap: nowrap !important;
    overflow: hidden !important;
  }

  :is(
      body.force-mobile,
      body.auto-mobile,
      body[data-viewport-resolved="mobile"]
    )
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-filter-row-actions
    > .qb-filter-active-count,
  :is(
      body.force-mobile,
      body.auto-mobile,
      body[data-viewport-resolved="mobile"]
    )
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-filter-row-actions
    > .qb-clear-btn-compact {
    grid-column: auto !important;
    min-width: 0 !important;
    max-width: 100% !important;
    width: 100% !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    justify-content: center !important;
    text-align: center !important;
  }

  :is(
      body.force-mobile,
      body.auto-mobile,
      body[data-viewport-resolved="mobile"]
    )
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-filter-row-actions
    > .qb-filter-active-count {
    font-size: 0.72rem !important;
    padding-inline: 8px !important;
  }

  :is(
      body.force-mobile,
      body.auto-mobile,
      body[data-viewport-resolved="mobile"]
    )
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-filter-row-actions
    > .qb-clear-btn-compact {
    padding-inline: 8px !important;
    gap: 4px !important;
  }

  :is(
      body.force-mobile,
      body.auto-mobile,
      body[data-viewport-resolved="mobile"]
    )
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-filter-row-actions
    > .qb-clear-btn-compact
    span {
    display: block !important;
    min-width: 0 !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
  }
}

@media (max-width: 420px) {
  :is(
      body.force-mobile,
      body.auto-mobile,
      body[data-viewport-resolved="mobile"]
    )
    .question-bank-panel
    .qb-filter-layout-v2
    .qb-filter-row-actions {
    grid-template-columns: minmax(0, 1fr) clamp(82px, 32vw, 104px) !important;
    gap: 6px !important;
  }
}

/* FINAL MOBILE MATH LOCK: lines containing formulas stay on one row with horizontal scroll */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .text-line.text-line-has-math {
    display: block !important;
    max-width: 100% !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    white-space: nowrap !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-x: contain !important;
    scrollbar-width: thin !important;
    margin-inline: 0 !important;
    padding-bottom: 2px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .text-line.text-line-has-math::-webkit-scrollbar {
    height: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .text-line.text-line-has-math::-webkit-scrollbar-thumb {
    border-radius: 999px !important;
    background: rgba(143, 203, 245, 0.6) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .text-line.text-line-has-math::-webkit-scrollbar-track {
    border-radius: 999px !important;
    background: rgba(121, 164, 197, 0.16) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .text-line.text-line-has-math
    .math-node {
    display: inline-block !important;
    width: max-content !important;
    max-width: none !important;
    overflow: visible !important;
    white-space: nowrap !important;
    vertical-align: middle !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .text-line.text-line-has-math
    .math-node[data-display="1"] {
    display: inline-block !important;
    margin: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .text-line.text-line-has-math
    :is(.katex, .katex-display, .katex *) {
    white-space: nowrap !important;
    word-break: keep-all !important;
    overflow-wrap: normal !important;
  }
}

/* ULTRA FINAL MOBILE LOCK: question index width + spacing in question bank */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .question-card
    .question-head-main {
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .question-card
    .question-index {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    flex: 0 0 auto !important;
    min-width: clamp(102px, 31vw, 136px) !important;
    max-width: min(46vw, 168px) !important;
    min-height: 34px !important;
    padding-inline: 14px !important;
    margin-inline-end: 4px !important;
    border-radius: 12px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    font-size: 0.8rem !important;
    line-height: 1.15 !important;
  }
}

@media (max-width: 420px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    .question-bank-panel
    .question-card
    .question-index {
    min-width: clamp(94px, 34vw, 118px) !important;
    max-width: min(52vw, 138px) !important;
    padding-inline: 11px !important;
    margin-inline-end: 3px !important;
  }
}

/* ULTRA FINAL MOBILE LOCK: keep math formulas unbroken (bank + practice + exam) */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .math-node {
    display: inline-block !important;
    max-width: 100% !important;
    vertical-align: middle !important;
    white-space: nowrap !important;
    word-break: keep-all !important;
    overflow-wrap: normal !important;
    line-break: normal !important;
    hyphens: none !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .math-node[data-display="1"],
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .katex-display
    > .katex {
    display: block !important;
    width: max-content !important;
    max-width: 100% !important;
    margin: 8px 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .math-node
    :is(.katex, .katex *) {
    white-space: nowrap !important;
    word-break: normal !important;
    overflow-wrap: normal !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .math-node {
    scrollbar-width: thin !important;
    scrollbar-color: rgba(143, 203, 245, 0.62) rgba(121, 164, 197, 0.16) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .math-node::-webkit-scrollbar {
    display: block !important;
    width: 6px !important;
    height: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .math-node::-webkit-scrollbar-thumb {
    border-radius: 999px !important;
    background: rgba(143, 203, 245, 0.62) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .math-node::-webkit-scrollbar-track {
    border-radius: 999px !important;
    background: rgba(121, 164, 197, 0.16) !important;
  }
}

/* FINAL MOBILE READABILITY PATCH: question text quality (bank + practice + exam) */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-body {
    width: 100% !important;
    min-width: 0 !important;
    max-width: 100% !important;
    padding: clamp(10px, 2.7vw, 13px) clamp(10px, 3.1vw, 14px) !important;
    border-radius: 13px !important;
    font-size: clamp(0.95rem, 3.75vw, 1.02rem) !important;
    line-height: 2 !important;
    letter-spacing: 0 !important;
    word-spacing: 0.01em !important;
    text-align: right !important;
    direction: rtl !important;
    unicode-bidi: plaintext !important;
    white-space: normal !important;
    overflow-wrap: break-word !important;
    word-break: normal !important;
    hyphens: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-body
    .text-line {
    margin: 0 0 0.7em !important;
    line-height: inherit !important;
    white-space: normal !important;
    overflow-wrap: break-word !important;
    word-break: normal !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-body
    .text-line:last-child {
    margin-bottom: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-body
    .math-node {
    max-width: 100% !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-body
    .math-node
    :is(.katex, .katex-display, .katex *) {
    max-width: 100% !important;
    white-space: nowrap !important;
  }
}

/* Mobile landscape enhancement: denser question layout closer to desktop */
@media (max-width: 1023px) and (max-height: 560px) and (orientation: landscape) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .topbar.premium-topbar.qb-header.app-header-v3 {
    padding: 6px 9px !important;
    border-radius: 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .app-shell {
    width: min(1220px, 98vw) !important;
    padding-top: calc(env(safe-area-inset-top, 0px) + 58px) !important;
    padding-bottom: 16px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .qb-filter-bar.qb-filter-layout-v2 {
    padding: 10px 11px !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .qb-filter-layout-v2 .qb-filter-row-primary {
    grid-template-columns: minmax(0, 1fr) minmax(220px, auto) !important;
    align-items: center !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .qb-filter-layout-v2 .qb-filter-row-actions {
    display: inline-flex !important;
    align-items: center !important;
    justify-self: end !important;
    gap: 6px !important;
    width: auto !important;
    min-width: 220px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .qb-filter-layout-v2 .qb-filter-row-actions > .qb-filter-active-count {
    flex: 1 1 auto !important;
    width: auto !important;
    min-width: 0 !important;
    padding-inline: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .qb-filter-layout-v2 .qb-filter-row-actions > .qb-clear-btn-compact {
    flex: 0 0 auto !important;
    width: auto !important;
    min-width: 96px !important;
    padding-inline: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .qb-filter-layout-v2 .qb-filter-groups-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .qb-filter-layout-v2 .qb-lux-triple-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .qb-filter-layout-v2 .qb-lux-filter-panel.is-review {
    grid-column: auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .qb-filter-layout-v2 .qb-filter-difficulty-strip {
    flex-direction: row !important;
    align-items: center !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .qb-filter-layout-v2 :is(
      .qb-sort-group,
      .qb-solved-group,
      .qb-review-group,
      .qb-topic-quick,
      .qb-pill-group
    ) {
    display: flex !important;
    flex-wrap: nowrap !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    gap: 6px !important;
    padding-bottom: 2px !important;
    scrollbar-width: thin !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .qb-filter-layout-v2 :is(
      .qb-sort-chip,
      .qb-solved-chip,
      .qb-review-chip,
      .qb-topic-quick-btn,
      .qb-pill
    ) {
    width: auto !important;
    min-width: max-content !important;
    padding-inline: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .question-list {
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)) !important;
    gap: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel) .question-card {
    padding: 11px 12px !important;
    border-radius: 13px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel) .question-head {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) auto !important;
    align-items: center !important;
    gap: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel) .question-head-tools {
    justify-content: flex-end !important;
    flex-wrap: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel) .question-topic-chip {
    max-width: min(40vw, 260px) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel) .question-solve-strip {
    flex-direction: row !important;
    align-items: center !important;
    justify-content: space-between !important;
    gap: 8px !important;
    padding: 8px 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel) .question-solve-main {
    flex: 1 1 auto !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel) .question-solve-actions {
    display: inline-flex !important;
    flex-wrap: nowrap !important;
    justify-content: flex-end !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel) .question-solve-btn {
    min-height: 31px !important;
    min-width: 58px !important;
    padding: 4px 9px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel) .question-card .question-body {
    font-size: clamp(0.92rem, 1.6vw, 0.99rem) !important;
    line-height: 1.88 !important;
    padding: 10px 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .question-review-row {
    grid-template-columns: auto minmax(0, 1fr) auto !important;
    align-items: center !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel .question-review-group {
    display: flex !important;
    flex-wrap: nowrap !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    gap: 6px !important;
    padding-bottom: 2px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"]) .question-bank-panel :is(.question-review-btn, .question-review-note-toggle) {
    width: auto !important;
    min-width: max-content !important;
    padding-inline: 10px !important;
  }
}

/* Math-only question statements: center content */
.question-body.question-body-math-only {
  display: grid;
  justify-items: center;
  align-content: center;
  text-align: center;
  direction: ltr;
  unicode-bidi: isolate;
}

.question-body.question-body-math-only .text-line {
  width: 100%;
  text-align: center;
  margin-inline: auto;
}

.question-body.question-body-math-only .math-node {
  margin-inline: auto;
}

.question-body.question-body-math-only .math-node[data-display="1"] {
  margin: 8px auto;
}

@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-body.question-body-math-only {
    text-align: center !important;
    direction: ltr !important;
    unicode-bidi: isolate !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-body.question-body-math-only
    .text-line {
    text-align: center !important;
    margin-inline: auto !important;
  }
}

/* App realism pass: startup splash + view transitions + tactile feedback */
body {
  overscroll-behavior-y: contain;
  -webkit-tap-highlight-color: transparent;
}

.app-shell {
  min-height: 100dvh;
}

.app-boot-splash {
  position: fixed;
  inset: 0;
  z-index: 4000;
  display: grid;
  place-items: center;
  padding: 20px;
  background:
    radial-gradient(circle at 18% 12%, rgba(87, 180, 255, 0.2), transparent 40%),
    radial-gradient(circle at 82% 88%, rgba(87, 180, 255, 0.14), transparent 44%),
    linear-gradient(160deg, rgba(8, 15, 24, 0.96), rgba(10, 18, 29, 0.94));
  transition: opacity 0.34s ease, visibility 0.34s ease;
}

.app-boot-splash[hidden] {
  display: none !important;
}

.app-boot-splash.is-hiding {
  opacity: 0;
  visibility: hidden;
}

.app-boot-card {
  width: min(440px, 92vw);
  border-radius: 22px;
  border: 1px solid rgba(145, 178, 206, 0.28);
  background:
    radial-gradient(circle at 82% 20%, rgba(102, 196, 250, 0.2), transparent 36%),
    linear-gradient(152deg, rgba(17, 28, 40, 0.92), rgba(11, 20, 31, 0.88));
  box-shadow: 0 24px 48px rgba(3, 8, 14, 0.42), inset 0 1px 0 rgba(255, 255, 255, 0.08);
  padding: 24px 22px;
  display: grid;
  justify-items: center;
  gap: 10px;
  text-align: center;
}

.app-boot-logo {
  width: 54px;
  height: 54px;
  border-radius: 16px;
  border: 1px solid rgba(129, 208, 255, 0.44);
  background: linear-gradient(150deg, rgba(102, 196, 250, 0.3), rgba(102, 196, 250, 0.08));
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: #d9f3ff;
}

.app-boot-logo svg {
  width: 30px;
  height: 30px;
  fill: none;
  stroke: currentColor;
  stroke-width: 1.9;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.app-boot-title {
  font-size: 1.08rem;
  letter-spacing: -0.01em;
}

.app-boot-subtitle {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.86rem;
}

.app-boot-loader {
  width: 68px;
  height: 4px;
  border-radius: 999px;
  background: rgba(166, 206, 235, 0.2);
  overflow: hidden;
  position: relative;
}

.app-boot-loader::after {
  content: "";
  position: absolute;
  inset: 0;
  width: 42%;
  border-radius: inherit;
  background: linear-gradient(90deg, rgba(123, 210, 255, 0.9), rgba(133, 242, 222, 0.86));
  animation: app-boot-loader 1.05s ease-in-out infinite;
}

@keyframes app-boot-loader {
  0% {
    transform: translateX(-110%);
  }
  100% {
    transform: translateX(240%);
  }
}

#levelContainer.is-view-transitioning > * {
  animation: app-view-enter 0.3s cubic-bezier(0.2, 0.8, 0.2, 1) both;
}

body.is-view-transitioning .topbar.premium-topbar.qb-header.app-header-v3 {
  animation: app-header-shift 0.3s cubic-bezier(0.2, 0.8, 0.2, 1) both;
}

@keyframes app-view-enter {
  0% {
    opacity: 0;
    transform: translateY(8px) scale(0.995);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes app-header-shift {
  0% {
    transform: translateY(-3px);
    filter: saturate(96%);
  }
  100% {
    transform: translateY(0);
    filter: saturate(100%);
  }
}

.app-shell :is(
    button,
    .tab-btn,
    .card-btn,
    .subject-open-btn,
    .lesson-chapter-open,
    .tool-btn,
    .glass-btn,
    .appbar-segment-btn,
    .appbar-overflow-item,
    .appbar-sections-item,
    .pwa-mobile-dock-btn
  ):not(:disabled):not([aria-disabled="true"]) {
  transition:
    transform 0.14s ease,
    filter 0.14s ease,
    box-shadow 0.2s ease,
    border-color 0.2s ease;
}

.app-shell :is(
    button,
    .tab-btn,
    .card-btn,
    .subject-open-btn,
    .lesson-chapter-open,
    .tool-btn,
    .glass-btn,
    .appbar-segment-btn,
    .appbar-overflow-item,
    .appbar-sections-item,
    .pwa-mobile-dock-btn
  ).is-pressed {
  transform: translateY(1px) scale(0.992) !important;
  filter: saturate(94%);
}

@media (prefers-reduced-motion: reduce) {
  .app-boot-splash,
  #levelContainer.is-view-transitioning > *,
  body.is-view-transitioning .topbar.premium-topbar.qb-header.app-header-v3 {
    animation: none !important;
    transition: none !important;
  }

  .app-shell :is(
      button,
      .tab-btn,
      .card-btn,
      .subject-open-btn,
      .lesson-chapter-open,
      .tool-btn,
      .glass-btn,
      .appbar-segment-btn,
      .appbar-overflow-item,
      .appbar-sections-item,
      .pwa-mobile-dock-btn
    ) {
    transition: none !important;
  }
}

/* Standalone mobile native-app shell (A2HS) */
body.standalone-native-app {
  min-height: 100dvh;
  overscroll-behavior: none;
  touch-action: manipulation;
}

body.standalone-native-app::before {
  content: "";
  position: fixed;
  top: 0;
  right: 0;
  left: 0;
  height: calc(env(safe-area-inset-top, 0px) + 6px);
  z-index: 1798;
  pointer-events: none;
  background: linear-gradient(180deg, rgba(6, 12, 20, 0.42), rgba(6, 12, 20, 0));
}

body.standalone-native-app .app-shell {
  width: 100% !important;
  max-width: none !important;
  margin: 0 !important;
  padding:
    calc(env(safe-area-inset-top, 0px) + 8px)
    clamp(8px, 2.6vw, 14px)
    calc(env(safe-area-inset-bottom, 0px) + 106px) !important;
  min-height: 100dvh;
}

body.standalone-native-app .topbar.premium-topbar.qb-header.app-header-v3 {
  top: calc(env(safe-area-inset-top, 0px) + 4px) !important;
  margin-bottom: 10px !important;
  border-radius: 18px !important;
}

body.standalone-native-app #breadcrumbs {
  display: none !important;
}

body.standalone-native-app .main-content {
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 104px) !important;
}

body.standalone-native-app :is(.surface, .profile-surface) {
  border-radius: 18px !important;
  border-color: rgba(138, 172, 201, 0.24) !important;
  box-shadow: 0 16px 28px rgba(4, 10, 16, 0.24), inset 0 1px 0 rgba(255, 255, 255, 0.06) !important;
}

body.standalone-native-app .status-bar {
  position: fixed;
  inset-inline: clamp(10px, 3vw, 16px);
  bottom: calc(env(safe-area-inset-bottom, 0px) + 82px);
  z-index: 120;
  min-height: 40px;
  margin: 0;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 13px;
  border: 1px solid rgba(138, 172, 201, 0.26);
  background:
    linear-gradient(155deg, rgba(15, 24, 36, 0.9), rgba(10, 18, 28, 0.84));
  color: var(--text-main);
  box-shadow: 0 12px 24px rgba(4, 10, 16, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  opacity: 1;
  transform: translateY(0);
  transition: opacity 0.22s ease, transform 0.22s ease;
  pointer-events: none;
}

body.standalone-native-app .status-bar:empty {
  opacity: 0;
  transform: translateY(10px);
}

body.standalone-native-app .toast-stack {
  right: 14px;
  left: 14px;
  width: auto;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 152px);
}

body.standalone-native-app .toast-item {
  border-radius: 14px;
}

body.standalone-native-app .pwa-mobile-dock {
  inset-inline: clamp(8px, 2.4vw, 14px);
  bottom: calc(env(safe-area-inset-bottom, 0px) + 10px);
  border-radius: 22px;
  padding: 9px;
  gap: 8px;
  border-color: rgba(138, 172, 201, 0.28);
  box-shadow: 0 20px 34px rgba(2, 8, 14, 0.38), inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

body.standalone-native-app .pwa-mobile-dock-btn {
  position: relative;
  min-height: 58px;
  border-radius: 15px;
}

body.standalone-native-app .pwa-mobile-dock-btn.is-active {
  transform: translateY(-1px);
}

body.standalone-native-app .pwa-mobile-dock-btn.is-active::before {
  content: "";
  position: absolute;
  top: 4px;
  right: 50%;
  width: 18px;
  height: 3px;
  border-radius: 999px;
  transform: translateX(50%);
  background: linear-gradient(90deg, rgba(124, 216, 255, 0.95), rgba(136, 243, 221, 0.92));
  box-shadow: 0 0 8px rgba(124, 216, 255, 0.44);
}

body.standalone-native-app .pwa-scroll-top-btn {
  bottom: calc(env(safe-area-inset-bottom, 0px) + 96px);
}

body.standalone-native-app .app-boot-splash {
  background:
    radial-gradient(circle at 16% 11%, rgba(96, 195, 255, 0.24), transparent 40%),
    radial-gradient(circle at 84% 86%, rgba(114, 227, 197, 0.18), transparent 44%),
    linear-gradient(158deg, rgba(7, 14, 22, 0.97), rgba(8, 16, 26, 0.95));
}

@media (max-width: 460px) {
  body.standalone-native-app .status-bar {
    bottom: calc(env(safe-area-inset-bottom, 0px) + 78px);
    min-height: 36px;
    padding: 7px 10px;
    font-size: 0.8rem;
  }

  body.standalone-native-app .toast-stack {
    bottom: calc(env(safe-area-inset-bottom, 0px) + 142px);
  }
}

@media (prefers-reduced-motion: reduce) {
  body.standalone-native-app .status-bar,
  body.standalone-native-app .pwa-mobile-dock-btn,
  body.standalone-native-app .toast-item {
    transition: none !important;
  }
}

/* Mobile ultra smooth rendering patch: lighter paint + reduced offscreen work */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel.question-bank-mobile-perf, .practice-mode-panel.practice-mobile-perf, .exam-mode-panel.exam-mobile-perf)
    .question-list {
    grid-template-columns: minmax(0, 1fr) !important;
    contain: layout style paint !important;
    touch-action: pan-y pinch-zoom !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel.question-bank-mobile-perf, .practice-mode-panel.practice-mobile-perf, .exam-mode-panel.exam-mobile-perf)
    :is(.question-card, .practice-question-card) {
    transition: none !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel.question-bank-mobile-perf, .practice-mode-panel.practice-mobile-perf, .exam-mode-panel.exam-mobile-perf)
    .question-card::before,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
    :is(.question-bank-panel.question-bank-mobile-perf, .practice-mode-panel.practice-mobile-perf, .exam-mode-panel.exam-mobile-perf)
    .question-card::after {
    display: none !important;
  }

  @supports (content-visibility: auto) {
    :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
      :is(.question-bank-panel.question-bank-mobile-perf, .practice-mode-panel.practice-mobile-perf, .exam-mode-panel.exam-mobile-perf)
      :is(.question-card, .practice-question-card) {
      content-visibility: auto;
      contain-intrinsic-size: 1px 440px;
    }

    :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"])
      :is(.question-bank-panel.question-bank-mobile-perf, .practice-mode-panel.practice-mobile-perf, .exam-mode-panel.exam-mobile-perf)
      :is(.question-body, .disclosure, .question-review-tools, .practice-reveal-box) {
      content-visibility: auto;
      contain-intrinsic-size: 1px 220px;
    }
  }
}

/* Desktop practice actions: one-row, consistent sizing, no stacked buttons */
@media (min-width: 1024px) {
  :is(body.force-desktop, body.auto-desktop, body[data-viewport-resolved="desktop"], body:not(.force-mobile):not(.auto-mobile))
    .practice-mode-panel.practice-modernized
    .practice-focus-actions {
    display: grid !important;
    grid-template-columns: repeat(7, minmax(0, 1fr)) !important;
    gap: 8px !important;
    align-items: stretch !important;
  }

  :is(body.force-desktop, body.auto-desktop, body[data-viewport-resolved="desktop"], body:not(.force-mobile):not(.auto-mobile))
    .practice-mode-panel.practice-modernized
    .practice-solution-stack {
    display: contents !important;
  }

  :is(body.force-desktop, body.auto-desktop, body[data-viewport-resolved="desktop"], body:not(.force-mobile):not(.auto-mobile))
    .practice-mode-panel.practice-modernized
    .practice-action-btn {
    min-height: 42px !important;
    padding: 8px 10px !important;
    border-radius: 11px !important;
    font-size: 0.78rem !important;
    font-weight: 700 !important;
    white-space: nowrap !important;
    line-height: 1.2 !important;
    justify-content: center !important;
  }

  :is(body.force-desktop, body.auto-desktop, body[data-viewport-resolved="desktop"], body:not(.force-mobile):not(.auto-mobile))
    .practice-mode-panel.practice-modernized
    .practice-action-btn.practice-action-utility {
    min-height: 42px !important;
    font-size: 0.78rem !important;
  }
}

/* Premium print pass: elegant exam PDF with compact spacing */
@media print {
  @page {
    size: A4;
    margin: 9mm 8.5mm 10mm;
  }

  body.print-exam-only,
  body.print-exam-only * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  body.print-exam-only {
    font-family: "Vazirmatn", Tahoma, "Segoe UI", sans-serif !important;
    color: #000 !important;
    line-height: 1.44 !important;
  }

  body.print-exam-only .exam-session-region[data-exam-focus-lock="active"]::before {
    content: none !important;
    display: none !important;
  }

  body.print-exam-only .exam-paper,
  body.print-exam-only .exam-paper-list,
  body.print-exam-only .exam-paper-item,
  body.print-exam-only .question-card,
  body.print-exam-only .question-head,
  body.print-exam-only .question-body,
  body.print-exam-only .question-body * {
    color: #000 !important;
    box-shadow: none !important;
    text-shadow: none !important;
    background-image: none !important;
  }

  body.print-exam-only .exam-paper > .exam-paper-head {
    display: grid !important;
    gap: 1.55mm !important;
    margin: 0 0 2.2mm !important;
    padding: 0 0 2mm !important;
    border-bottom: 0.35mm solid #000 !important;
    background: #fff !important;
  }

  body.print-exam-only .exam-paper-head > :not(.exam-paper-meta-grid) {
    display: none !important;
  }

  body.print-exam-only .exam-paper-brand-row {
    display: none !important;
  }

  body.print-exam-only .exam-paper-brand {
    display: grid !important;
    gap: 0.7mm !important;
    min-width: 0 !important;
  }

  body.print-exam-only .exam-paper-title {
    margin: 0 !important;
    font-size: 13.6pt !important;
    font-weight: 800 !important;
    line-height: 1.2 !important;
    letter-spacing: -0.01em !important;
    color: #0f172a !important;
  }

  body.print-exam-only .exam-paper-title .exam-icon {
    display: none !important;
  }

  body.print-exam-only .exam-paper-brand p {
    margin: 0 !important;
    color: #334155 !important;
    font-size: 8.7pt !important;
    line-height: 1.35 !important;
  }

  body.print-exam-only .exam-paper-code {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    min-height: 0 !important;
    margin: 0 !important;
    padding: 1.2mm 2.5mm !important;
    border-radius: 999px !important;
    border: 0.24mm solid #000 !important;
    background: #fff !important;
    color: #000 !important;
    font-size: 8.1pt !important;
    font-weight: 800 !important;
    white-space: nowrap !important;
  }

  body.print-exam-only .exam-paper-meta-grid {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 1.15mm !important;
    margin: 0 !important;
  }

  body.print-exam-only .exam-paper-meta-pill {
    display: none !important;
    align-items: center !important;
    gap: 1.2mm !important;
    min-height: 0 !important;
    margin: 0 !important;
    padding: 0.95mm 1.75mm !important;
    border-radius: 999px !important;
    border: 0.22mm solid #000 !important;
    background: #fff !important;
  }

  body.print-exam-only .exam-paper-meta-pill[data-meta-key="chapter"],
  body.print-exam-only .exam-paper-meta-pill[data-meta-key="subject"],
  body.print-exam-only .exam-paper-meta-pill[data-meta-key="count"],
  body.print-exam-only .exam-paper-meta-pill[data-meta-key="duration"] {
    display: inline-flex !important;
  }

  body.print-exam-only .exam-paper-meta-pill em {
    font-style: normal !important;
    font-size: 7.25pt !important;
    color: #000 !important;
  }

  body.print-exam-only .exam-paper-meta-pill strong {
    font-size: 8.1pt !important;
    font-weight: 700 !important;
    color: #000 !important;
  }

  body.print-exam-only .exam-paper-chapter-list {
    display: none !important;
  }

  body.print-exam-only .exam-paper-chapter-pill {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    min-height: 0 !important;
    margin: 0 !important;
    padding: 0.85mm 1.8mm !important;
    border-radius: 999px !important;
    border: 0.22mm solid #c8d2df !important;
    background: #f8fafc !important;
    color: #1e293b !important;
    font-size: 7.35pt !important;
    font-weight: 600 !important;
    line-height: 1.2 !important;
  }

  body.print-exam-only .exam-paper-student-line {
    display: none !important;
  }

  body.print-exam-only .exam-paper {
    display: block !important;
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    background: #fff !important;
  }

  body.print-exam-only .exam-paper-list {
    display: block !important;
    margin: 0 !important;
    padding: 0 !important;
    background: #fff !important;
  }

  body.print-exam-only .exam-paper-item {
    display: block !important;
    margin: 0 0 1.9mm !important;
    padding: 2.1mm 2.35mm 2mm !important;
    border: 0.27mm solid #000 !important;
    border-radius: 1.85mm !important;
    background: #fff !important;
    break-inside: avoid-page !important;
    page-break-inside: avoid !important;
  }

  body.print-exam-only .exam-paper-item.exam-print-break-before {
    break-before: page !important;
    page-break-before: always !important;
  }

  body.print-exam-only .exam-paper-item.exam-print-tight {
    break-before: page !important;
    page-break-before: always !important;
  }

  body.print-exam-only .exam-paper-item,
  body.print-exam-only .exam-paper-item .question-card,
  body.print-exam-only .exam-paper-item .question-head,
  body.print-exam-only .exam-paper-item .question-body,
  body.print-exam-only .exam-paper-item .exam-paper-question-meta {
    break-inside: avoid-page !important;
    page-break-inside: avoid !important;
  }

  body.print-exam-only .question-card {
    display: block !important;
    gap: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
    border-radius: 0 !important;
    background: transparent !important;
    box-shadow: none !important;
    color: #000 !important;
  }

  body.print-exam-only .question-head {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    margin: 0 0 1.4mm !important;
    padding: 0 0 1.15mm !important;
    border: 0 !important;
    border-bottom: 0.2mm solid #000 !important;
    background: transparent !important;
  }

  body.print-exam-only .question-head-main {
    display: inline-flex !important;
    align-items: center !important;
    gap: 0 !important;
  }

  body.print-exam-only .question-head-main > :not(.question-index),
  body.print-exam-only .question-head-tools,
  body.print-exam-only .stars {
    display: none !important;
  }

  body.print-exam-only .question-index {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    min-width: 11.5mm !important;
    min-height: 5.9mm !important;
    margin: 0 !important;
    padding: 0.7mm 2.4mm !important;
    border-radius: 999px !important;
    border: 0.22mm solid #000 !important;
    background: #fff !important;
    color: #000 !important;
    font-size: 8.85pt !important;
    font-weight: 800 !important;
    line-height: 1 !important;
  }

  body.print-exam-only .question-body,
  body.print-exam-only .question-body * {
    color: #000 !important;
  }

  body.print-exam-only .question-body {
    margin: 0 !important;
    padding: 0 !important;
    font-size: 10pt !important;
    line-height: 1.57 !important;
    letter-spacing: 0 !important;
  }

  body.print-exam-only .question-body p {
    margin: 0 0 1mm !important;
  }

  body.print-exam-only .question-body :is(ul, ol) {
    margin: 0.2mm 0 1.3mm !important;
    padding: 0 4.2mm 0 0 !important;
  }

  body.print-exam-only .question-body li {
    margin: 0 0 0.72mm !important;
  }

  body.print-exam-only .exam-paper-item.exam-print-tight {
    padding: 1.35mm 1.7mm 1.35mm !important;
    border-radius: 1.35mm !important;
  }

  body.print-exam-only .exam-paper-item.exam-print-tight .question-head {
    margin: 0 0 0.9mm !important;
    padding: 0 0 0.8mm !important;
  }

  body.print-exam-only .exam-paper-item.exam-print-tight .question-index {
    min-width: 10.2mm !important;
    min-height: 5.1mm !important;
    font-size: 8.2pt !important;
  }

  body.print-exam-only .exam-paper-item.exam-print-tight .question-body {
    font-size: 9.05pt !important;
    line-height: 1.49 !important;
  }

  body.print-exam-only .exam-paper-question-meta,
  body.print-exam-only .exam-paper-question-tag,
  body.print-exam-only .exam-paper-question-points {
    display: none !important;
  }

  body.print-exam-only .math-node,
  body.print-exam-only .katex,
  body.print-exam-only .katex * {
    color: #000 !important;
  }

  body.print-exam-only .question-asset-image {
    width: 100% !important;
    max-width: 100% !important;
    height: auto !important;
    max-height: 68mm !important;
    object-fit: contain !important;
    filter: grayscale(100%) contrast(1.06) !important;
  }

  body.print-exam-only .question-asset-figure,
  body.print-exam-only .question-asset-media {
    break-inside: avoid-page !important;
    page-break-inside: avoid !important;
  }

  body.print-exam-only .exam-paper > .exam-paper-print-goodluck {
    display: block !important;
    margin: 3.5mm 0 0 !important;
    padding: 2.1mm 0 0 !important;
    border-top: 0.3mm solid #000 !important;
    text-align: center !important;
    font-size: 12.5pt !important;
    font-weight: 800 !important;
    letter-spacing: 0.01em !important;
    color: #000 !important;
    break-inside: avoid-page !important;
    page-break-inside: avoid !important;
  }

  body.print-exam-only .exam-paper > .exam-paper-answer-sheet {
    display: none !important;
  }

  body.print-exam-only.print-exam-with-answers .exam-paper > .exam-paper-answer-sheet {
    display: block !important;
    margin: 0 !important;
    padding: 0 !important;
    break-before: auto !important;
    page-break-before: auto !important;
  }

  body.print-exam-only.print-exam-with-answers .exam-paper > .exam-paper-list,
  body.print-exam-only.print-exam-with-answers .exam-paper > .exam-paper-head,
  body.print-exam-only.print-exam-with-answers .exam-paper > .exam-paper-print-goodluck {
    display: none !important;
  }

  body.print-exam-only .exam-paper-answer-sheet-title {
    margin: 0 0 1.2mm !important;
    padding: 0 !important;
    font-size: 13pt !important;
    font-weight: 800 !important;
    color: #000 !important;
  }

  body.print-exam-only .exam-paper-answer-sheet-caption {
    margin: 0 0 2mm !important;
    font-size: 8.4pt !important;
    color: #000 !important;
  }

  body.print-exam-only.print-exam-with-answers .exam-paper-answer-sheet-caption {
    display: none !important;
  }

  body.print-exam-only .exam-paper-answer-sheet-list {
    display: grid !important;
    gap: 1.05mm !important;
  }

  body.print-exam-only .exam-paper-answer-item {
    border: 0.24mm solid #000 !important;
    border-radius: 1.6mm !important;
    padding: 1.15mm !important;
    background: #fff !important;
    break-inside: avoid-page !important;
    page-break-inside: avoid !important;
  }

  body.print-exam-only .exam-paper-answer-item.exam-print-break-before {
    break-before: page !important;
    page-break-before: always !important;
  }

  body.print-exam-only .exam-paper-answer-item.exam-print-tight {
    padding: 0.95mm !important;
  }

  body.print-exam-only .exam-paper-answer-item-title {
    display: block !important;
    margin: 0 0 0.6mm !important;
    font-size: 8.55pt !important;
    font-weight: 800 !important;
    color: #000 !important;
  }

  body.print-exam-only .exam-paper-answer-item-body,
  body.print-exam-only .exam-paper-answer-item-body * {
    color: #000 !important;
    font-size: 8.95pt !important;
    line-height: 1.45 !important;
  }

  body.print-exam-only .exam-paper-answer-sheet-empty {
    margin: 0 !important;
    font-size: 9pt !important;
    color: #000 !important;
  }

  body.print-exam-only .katex {
    font-size: 1.01em !important;
  }

  body.print-exam-only .katex-display {
    margin: 1.05mm 0 !important;
  }

  body.print-exam-only .katex-display > .katex {
    max-width: 100% !important;
    white-space: normal !important;
  }

  body.print-exam-only.print-exam-mobile .exam-paper > .exam-paper-head {
    gap: 1.3mm !important;
    margin: 0 0 1.85mm !important;
    padding: 0 0 1.65mm !important;
  }

  body.print-exam-only.print-exam-mobile .exam-paper-meta-grid {
    gap: 0.95mm !important;
  }

  body.print-exam-only.print-exam-mobile .exam-paper-meta-pill {
    padding: 0.78mm 1.45mm !important;
  }

  body.print-exam-only.print-exam-mobile .exam-paper-item {
    margin: 0 0 1.55mm !important;
    padding: 1.55mm 1.85mm 1.5mm !important;
    border-radius: 1.55mm !important;
  }

  body.print-exam-only.print-exam-mobile .question-head {
    margin: 0 0 1.05mm !important;
    padding: 0 0 0.95mm !important;
  }

  body.print-exam-only.print-exam-mobile .question-index {
    min-width: 10.6mm !important;
    min-height: 5.4mm !important;
    padding: 0.6mm 2.05mm !important;
    font-size: 8.35pt !important;
  }

  body.print-exam-only.print-exam-mobile .question-body {
    font-size: 9.35pt !important;
    line-height: 1.5 !important;
  }

  body.print-exam-only.print-exam-mobile .question-body p {
    margin: 0 0 0.82mm !important;
  }

  body.print-exam-only.print-exam-mobile .question-body :is(ul, ol) {
    margin: 0.1mm 0 1.05mm !important;
    padding: 0 3.8mm 0 0 !important;
  }

  body.print-exam-only.print-exam-mobile .katex {
    font-size: 0.95em !important;
  }

  body.print-exam-only.print-exam-mobile .question-asset-stack {
    margin: 1.1mm 0 1.35mm !important;
  }

  body.print-exam-only.print-exam-mobile .question-asset-figure {
    margin: 0 0 1.35mm !important;
    padding: 0.92mm !important;
    border-radius: 1.08mm !important;
  }

  body.print-exam-only.print-exam-mobile .question-asset-media {
    min-height: 0 !important;
    aspect-ratio: auto !important;
  }

  body.print-exam-only.print-exam-mobile .question-asset-image {
    width: 100% !important;
    max-width: 100% !important;
    height: auto !important;
    max-height: 56mm !important;
    object-fit: contain !important;
  }

  body.print-exam-only.print-exam-mobile .exam-paper > .exam-paper-print-goodluck {
    margin-top: 2.8mm !important;
    padding-top: 1.8mm !important;
    font-size: 11.2pt !important;
  }

  body.print-exam-only.print-exam-mobile .exam-paper-answer-item {
    padding: 1.35mm !important;
  }

  body.print-exam-only.print-exam-mobile .exam-paper-answer-item-body,
  body.print-exam-only.print-exam-mobile .exam-paper-answer-item-body * {
    font-size: 8.8pt !important;
    line-height: 1.5 !important;
  }

  /* Print hardening across desktop/mobile/app/auto: keep layout stable and compact */
  body.print-exam-only .exam-paper,
  body.print-exam-only .exam-paper-list,
  body.print-exam-only .exam-paper-answer-sheet,
  body.print-exam-only .exam-paper-answer-sheet-list {
    max-width: 100% !important;
    min-width: 0 !important;
    overflow: visible !important;
    box-sizing: border-box !important;
  }

  body.print-exam-only :is(.question-body, .exam-paper-answer-item-body),
  body.print-exam-only :is(.question-body, .exam-paper-answer-item-body) * {
    overflow-wrap: anywhere !important;
    word-break: normal !important;
  }

  body.print-exam-only.print-exam-mobile .exam-paper-answer-sheet-list {
    gap: 0.85mm !important;
  }

  body.print-exam-only.print-exam-mobile.print-exam-with-answers .exam-paper-answer-item {
    padding: 1.05mm !important;
    border-radius: 1.3mm !important;
  }

  body.print-exam-only.print-exam-mobile.print-exam-with-answers .exam-paper-answer-item-title {
    margin: 0 0 0.5mm !important;
    font-size: 8.2pt !important;
  }

  body.print-exam-only.print-exam-mobile.print-exam-with-answers .exam-paper-answer-item-body,
  body.print-exam-only.print-exam-mobile.print-exam-with-answers .exam-paper-answer-item-body * {
    font-size: 8.45pt !important;
    line-height: 1.4 !important;
  }
}

/* Mobile/App Question Header Standardization (Question Bank): balanced sizing + compact space use */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel) {
    --qb-head-chip-h: 28px;
    --qb-head-chip-font: 0.71rem;
    --qb-head-chip-pad-x: 9px;
    --qb-head-chip-radius: 10px;
    --qb-head-icon-btn: 30px;
    --qb-head-gap: 5px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-head {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) auto !important;
    align-items: center !important;
    gap: 6px !important;
    margin-bottom: 7px !important;
    padding-bottom: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-head-main {
    display: flex !important;
    flex-wrap: wrap !important;
    align-items: center !important;
    gap: var(--qb-head-gap) !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-head-tools {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: flex-end !important;
    flex-wrap: nowrap !important;
    gap: var(--qb-head-gap) !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-head-tools > * {
    flex: 0 0 auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-index {
    min-height: var(--qb-head-chip-h) !important;
    padding: 3px var(--qb-head-chip-pad-x) !important;
    border-radius: var(--qb-head-chip-radius) !important;
    font-size: var(--qb-head-chip-font) !important;
    font-weight: 800 !important;
    line-height: 1.05 !important;
    letter-spacing: 0 !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-index::before {
    display: none !important;
    content: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .qb-check {
    width: 20px !important;
    height: 20px !important;
    flex-basis: 20px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .qb-check-ui {
    border-radius: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .qb-check-ui svg {
    width: 12px !important;
    height: 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-solved-badge {
    width: 24px !important;
    height: 24px !important;
    border-radius: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-solved-badge svg {
    width: 13px !important;
    height: 13px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-review-badge {
    min-height: 24px !important;
    padding: 2px 8px !important;
    border-radius: 999px !important;
    font-size: 0.66rem !important;
    font-weight: 780 !important;
    line-height: 1 !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-topic-chip {
    min-height: 26px !important;
    max-width: min(46vw, 220px) !important;
    padding: 3px 8px !important;
    border-radius: 999px !important;
    gap: 4px !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-topic-chip svg {
    width: 11px !important;
    height: 11px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-topic-chip-text {
    font-size: 0.68rem !important;
    font-weight: 700 !important;
    letter-spacing: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-head .stars {
    min-height: 26px !important;
    padding: 2px 8px !important;
    border-radius: 999px !important;
    font-size: 0.77rem !important;
    line-height: 1 !important;
    letter-spacing: 0.02em !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-solved-toggle {
    min-height: 26px !important;
    padding: 2px 8px !important;
    border-radius: 999px !important;
    font-size: 0.67rem !important;
    font-weight: 760 !important;
    line-height: 1 !important;
    white-space: nowrap !important;
    gap: 4px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-solved-toggle svg {
    width: 11px !important;
    height: 11px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .icon-edit-btn-inline {
    display: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .icon-delete-btn-inline {
    width: var(--qb-head-icon-btn) !important;
    height: var(--qb-head-icon-btn) !important;
    min-height: var(--qb-head-icon-btn) !important;
    border-radius: 9px !important;
    padding: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .icon-delete-btn-inline svg {
    width: 14px !important;
    height: 14px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-edit-form {
    display: none !important;
  }
}

/* Mobile/App review controls standardization (Question Bank): 3 status chips in one row + note below */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-review-tools {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) !important;
    gap: 8px !important;
    margin-top: 8px !important;
    padding: 9px !important;
    border-radius: 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-review-row {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) !important;
    align-items: stretch !important;
    gap: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-review-title {
    order: 1 !important;
    font-size: 0.71rem !important;
    line-height: 1.2 !important;
    opacity: 0.92 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-review-group {
    order: 2 !important;
    display: grid !important;
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
    gap: 6px !important;
    width: 100% !important;
    overflow: visible !important;
    white-space: normal !important;
    padding-bottom: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-review-btn {
    width: 100% !important;
    min-height: 36px !important;
    padding: 5px 6px !important;
    border-radius: 10px !important;
    font-size: clamp(0.68rem, 2.2vw, 0.74rem) !important;
    font-weight: 740 !important;
    line-height: 1.2 !important;
    text-align: center !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    white-space: normal !important;
    text-wrap: balance !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-review-note-toggle {
    order: 3 !important;
    width: 100% !important;
    min-height: 34px !important;
    padding: 5px 8px !important;
    border-radius: 10px !important;
    font-size: clamp(0.68rem, 2.1vw, 0.73rem) !important;
    font-weight: 730 !important;
    line-height: 1.15 !important;
    display: flex !important;
    align-items: center !important;
    justify-self: stretch !important;
    justify-content: center !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-review-note {
    margin-top: 0 !important;
    gap: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-review-note-input {
    min-height: 70px !important;
    padding: 8px 9px !important;
    border-radius: 10px !important;
    font-size: 0.8rem !important;
    line-height: 1.6 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel:not(.practice-mode-panel):not(.exam-mode-panel):not(.chapter-map-panel)
    .question-review-note-meta {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    gap: 8px !important;
    flex-wrap: wrap !important;
  }
}

/* Mobile/App Question Header Standardization (Practice): match Question Bank top tags */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel {
    --pr-head-chip-h: 28px;
    --pr-head-chip-font: 0.71rem;
    --pr-head-chip-pad-x: 9px;
    --pr-head-chip-radius: 10px;
    --pr-head-icon-btn: 30px;
    --pr-head-gap: 5px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-head {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) auto !important;
    align-items: center !important;
    gap: 6px !important;
    margin-bottom: 7px !important;
    padding-bottom: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-head-main {
    display: flex !important;
    flex-wrap: wrap !important;
    align-items: center !important;
    gap: var(--pr-head-gap) !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-head-tools {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: flex-end !important;
    flex-wrap: nowrap !important;
    gap: var(--pr-head-gap) !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-head-tools > * {
    flex: 0 0 auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-index {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    flex: 0 0 auto !important;
    min-width: clamp(102px, 31vw, 136px) !important;
    max-width: min(46vw, 168px) !important;
    min-height: var(--pr-head-chip-h) !important;
    padding: 3px var(--pr-head-chip-pad-x) !important;
    margin-inline-end: 4px !important;
    border-radius: var(--pr-head-chip-radius) !important;
    font-size: var(--pr-head-chip-font) !important;
    font-weight: 800 !important;
    line-height: 1.05 !important;
    letter-spacing: 0 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-index::before {
    display: none !important;
    content: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-solved-badge {
    width: 24px !important;
    height: 24px !important;
    border-radius: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-solved-badge svg {
    width: 13px !important;
    height: 13px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-review-badge {
    min-height: 24px !important;
    padding: 2px 8px !important;
    border-radius: 999px !important;
    font-size: 0.66rem !important;
    font-weight: 780 !important;
    line-height: 1 !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-head .stars {
    min-height: 26px !important;
    padding: 2px 8px !important;
    border-radius: 999px !important;
    font-size: 0.77rem !important;
    line-height: 1 !important;
    letter-spacing: 0.02em !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-solved-toggle {
    min-height: 26px !important;
    padding: 2px 8px !important;
    border-radius: 999px !important;
    font-size: 0.67rem !important;
    font-weight: 760 !important;
    line-height: 1 !important;
    white-space: nowrap !important;
    gap: 4px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-solved-toggle svg {
    width: 11px !important;
    height: 11px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .icon-delete-btn-inline {
    width: var(--pr-head-icon-btn) !important;
    height: var(--pr-head-icon-btn) !important;
    min-height: var(--pr-head-icon-btn) !important;
    border-radius: 9px !important;
    padding: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .icon-delete-btn-inline svg {
    width: 14px !important;
    height: 14px !important;
  }
}

@media (max-width: 420px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel
    .question-index {
    min-width: clamp(94px, 34vw, 118px) !important;
    max-width: min(52vw, 138px) !important;
    padding-inline: 11px !important;
    margin-inline-end: 3px !important;
  }
}

/* Final mobile/app math overflow policy:
   Horizontal scroll is allowed only on math formulas when needed. */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body) {
    overflow-x: hidden !important;
    overflow-y: visible !important;
    white-space: normal !important;
    word-break: normal !important;
    overflow-wrap: break-word !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .text-line.text-line-has-math {
    display: block !important;
    max-width: 100% !important;
    overflow-x: visible !important;
    overflow-y: visible !important;
    white-space: normal !important;
    margin-inline: 0 !important;
    padding-bottom: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .math-node {
    display: inline-block !important;
    max-width: 100% !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    white-space: nowrap !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior-x: contain !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .math-node[data-display="1"] {
    display: block !important;
    width: auto !important;
    max-width: 100% !important;
    margin: 8px 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-body.question-body-math-only
    .math-node {
    margin-inline: auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-body.question-body-math-only
    .math-node[data-display="1"] {
    margin: 8px auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-body, .disclosure, .practice-reveal-content, .exam-question-answer-body)
    .math-node
    :is(.katex, .katex-display, .katex *) {
    white-space: nowrap !important;
    word-break: keep-all !important;
    overflow-wrap: normal !important;
  }
}

/* FINAL V5 STANDALONE PATCH: keep last for priority */
@media (max-width: 1023px) {
  body.standalone-native-app {
    --app-glow-a: color-mix(in srgb, var(--accent) 20%, transparent);
    --app-glow-b: color-mix(in srgb, var(--accent2, var(--accent)) 16%, transparent);
    background:
      radial-gradient(circle at 14% 6%, var(--app-glow-a), transparent 38%),
      radial-gradient(circle at 88% 92%, var(--app-glow-b), transparent 42%),
      linear-gradient(160deg, color-mix(in srgb, var(--bg-main) 92%, #02060b), var(--bg-soft)) !important;
  }

  body.standalone-native-app .topbar.premium-topbar.qb-header.app-header-v3 {
    border-radius: 20px !important;
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 28%, transparent) !important;
    background:
      radial-gradient(circle at 84% 8%, color-mix(in srgb, var(--accent) 16%, transparent), transparent 34%),
      linear-gradient(150deg, color-mix(in srgb, var(--surface-strong) 90%, transparent), color-mix(in srgb, var(--surface-soft) 92%, transparent)) !important;
    box-shadow: 0 16px 30px rgba(3, 9, 16, 0.32), inset 0 1px 0 rgba(255, 255, 255, 0.09) !important;
    backdrop-filter: blur(10px) saturate(126%) !important;
    -webkit-backdrop-filter: blur(10px) saturate(126%) !important;
  }

  body.standalone-native-app :is(.surface, .profile-surface, .question-card, .practice-question-card, .exam-paper, .exam-question-review) {
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 22%, var(--line)) !important;
    box-shadow: 0 12px 22px rgba(3, 9, 16, 0.22), inset 0 1px 0 rgba(255, 255, 255, 0.06) !important;
  }

  body.standalone-native-app :is(.question-card, .practice-question-card, .exam-paper-item .question-card, .exam-question-review) {
    content-visibility: auto;
    contain: layout paint style;
    contain-intrinsic-size: 1px 420px;
  }

  body.standalone-native-app :is(.question-list, .exam-paper-list) {
    content-visibility: auto;
    contain: layout paint style;
    contain-intrinsic-size: 1px 1200px;
    -webkit-overflow-scrolling: touch !important;
  }

  body.standalone-native-app .pwa-mobile-dock {
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 34%, transparent) !important;
    background:
      linear-gradient(152deg, color-mix(in srgb, var(--surface-strong) 90%, transparent), color-mix(in srgb, var(--surface-soft) 94%, transparent)) !important;
    box-shadow: 0 22px 34px rgba(2, 8, 14, 0.38), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: blur(12px) saturate(130%) !important;
    -webkit-backdrop-filter: blur(12px) saturate(130%) !important;
  }

  body.standalone-native-app .pwa-mobile-dock-btn {
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 18%, var(--line)) !important;
    background:
      linear-gradient(148deg, color-mix(in srgb, var(--surface-soft) 94%, transparent), color-mix(in srgb, var(--surface-strong) 90%, transparent)) !important;
    min-height: 60px !important;
  }

  body.standalone-native-app .pwa-mobile-dock-btn.is-active {
    border-color: color-mix(in srgb, var(--accent2, var(--accent)) 42%, transparent) !important;
    background:
      linear-gradient(
        150deg,
        color-mix(in srgb, var(--accent2, var(--accent)) 30%, transparent),
        color-mix(in srgb, var(--surface-soft) 90%, transparent)
      ) !important;
  }
}

@media (max-width: 1023px) and (orientation: landscape) {
  body.standalone-native-app .app-shell {
    padding-inline: clamp(10px, 2.4vw, 18px) !important;
    padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 96px) !important;
  }

  body.standalone-native-app .pwa-mobile-dock {
    max-width: min(760px, calc(100vw - 20px));
    margin-inline: auto;
  }
}

@media (max-width: 1023px) and (update: slow) {
  body.standalone-native-app :is(.topbar.premium-topbar.qb-header.app-header-v3, .pwa-mobile-dock, .status-bar) {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    box-shadow: 0 12px 20px rgba(3, 9, 16, 0.22) !important;
  }
}

/* Final mobile/app question head layout:
   top chips in one standard row + method/topic chip on a dedicated row below */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-head {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) auto !important;
    align-items: center !important;
    gap: 6px !important;
    margin-bottom: 8px !important;
    padding-bottom: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-head-main {
    display: flex !important;
    align-items: center !important;
    flex-wrap: nowrap !important;
    gap: 6px !important;
    min-width: 0 !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    scrollbar-width: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-head-main::-webkit-scrollbar {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-head-tools {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: flex-end !important;
    flex-wrap: nowrap !important;
    gap: 6px !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-head-method-row {
    grid-column: 1 / -1 !important;
    width: 100% !important;
    min-width: 0 !important;
    margin-top: 2px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-index {
    min-width: clamp(96px, 30vw, 128px) !important;
    max-width: min(42vw, 154px) !important;
    min-height: 30px !important;
    padding: 3px 10px !important;
    border-radius: 10px !important;
    font-size: 0.71rem !important;
    font-weight: 790 !important;
    line-height: 1.08 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-review-badge {
    min-height: 26px !important;
    padding: 2px 8px !important;
    border-radius: 999px !important;
    font-size: 0.65rem !important;
    font-weight: 770 !important;
    line-height: 1 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-head
    .stars {
    min-height: 30px !important;
    padding: 3px 9px !important;
    border-radius: 999px !important;
    font-size: 0.76rem !important;
    line-height: 1 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-solved-toggle {
    min-height: 30px !important;
    padding: 3px 9px !important;
    border-radius: 999px !important;
    font-size: 0.69rem !important;
    font-weight: 760 !important;
    line-height: 1 !important;
    white-space: nowrap !important;
    gap: 4px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-solved-toggle svg {
    width: 11px !important;
    height: 11px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-solved-badge {
    width: 28px !important;
    height: 28px !important;
    border-radius: 9px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-solved-badge svg {
    width: 13px !important;
    height: 13px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .icon-delete-btn-inline {
    width: 30px !important;
    height: 30px !important;
    min-height: 30px !important;
    border-radius: 9px !important;
    padding: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .icon-delete-btn-inline svg {
    width: 14px !important;
    height: 14px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-topic-chip {
    width: 100% !important;
    max-width: 100% !important;
    min-height: 31px !important;
    margin-top: 0 !important;
    padding: 4px 10px !important;
    border-radius: 999px !important;
    gap: 5px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-topic-chip-text {
    font-size: 0.71rem !important;
    font-weight: 720 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
}

/* Question focus mode: show question body + 3 core actions */
.question-focus-fab {
  position: fixed;
  right: max(10px, env(safe-area-inset-right, 0px));
  left: auto;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 74px);
  z-index: 160;
  min-height: 36px;
  padding: 8px 12px;
  border-radius: 999px;
  border: 1px solid rgba(122, 181, 222, 0.34);
  background: rgba(17, 40, 64, 0.86);
  color: #eef8ff;
  font-size: 0.75rem;
  font-weight: 760;
  box-shadow: 0 10px 20px rgba(5, 13, 24, 0.3);
}

.question-focus-fab.is-active {
  border-color: rgba(116, 222, 176, 0.46);
  background: rgba(17, 72, 54, 0.86);
  color: #e8fff4;
}

body.question-focus-mode :is(.qb-filter-bar, .qb-overview, .meta-row, .bulk-delete-bar, .question-danger-zone, .pager) {
  display: none !important;
}

body.question-focus-mode {
  overscroll-behavior-x: none;
  overscroll-behavior-y: contain;
  touch-action: pan-y;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) {
  gap: 10px !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-list {
  gap: 8px !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-card {
  padding: 10px !important;
  border-radius: 12px !important;
  box-shadow: 0 6px 14px rgba(4, 10, 16, 0.2) !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head {
  margin: 0 0 7px !important;
  padding: 0 !important;
  border-bottom: 0 !important;
  min-height: 0 !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head-main,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head-method-row,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-review-tools,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-solve-strip,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head .stars,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-solved-badge,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .icon-delete-btn-inline,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .icon-edit-btn-inline {
  display: none !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head-tools {
  display: flex !important;
  align-items: center !important;
  justify-content: flex-start !important;
  gap: 8px !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head-tools > :not(.question-solved-toggle) {
  display: none !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-solved-toggle {
  min-height: 32px !important;
  padding: 4px 11px !important;
  border-radius: 999px !important;
  font-size: 0.72rem !important;
  font-weight: 780 !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-body {
  margin: 0 !important;
  padding: 10px !important;
  border-radius: 12px !important;
  box-shadow: none !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-tools {
  margin-top: 8px !important;
  padding-top: 7px !important;
  border-top-style: solid !important;
  display: flex !important;
  flex-wrap: wrap !important;
  gap: 7px !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-tools > :not([data-kind="hint"]):not([data-kind="solution"]) {
  display: none !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-tools .tool-btn {
  min-height: 32px !important;
  padding: 5px 11px !important;
  font-size: 0.73rem !important;
  border-radius: 10px !important;
}

body.question-focus-mode .practice-focus-actions {
  margin-top: 8px !important;
  padding-top: 7px !important;
  border-top: 1px solid rgba(138, 172, 201, 0.24) !important;
}

body.question-focus-mode .practice-focus-actions > :not([data-action="practice-reveal-hint"]):not([data-action="practice-reveal-solution"]) {
  display: none !important;
}

body.question-focus-mode .practice-focus-actions :is([data-action="practice-reveal-hint"], [data-action="practice-reveal-solution"]) {
  min-height: 32px !important;
  font-size: 0.73rem !important;
  border-radius: 10px !important;
}

@media (max-width: 1023px) {
  .question-focus-fab {
    right: max(8px, env(safe-area-inset-right, 0px));
    left: auto;
    bottom: calc(env(safe-area-inset-bottom, 0px) + 86px);
    min-height: 34px;
    padding: 7px 11px;
    font-size: 0.72rem;
  }

  body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-card {
    padding: 9px !important;
  }

  body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-body {
    font-size: 0.88rem !important;
    line-height: 1.76 !important;
  }
}

/* Final mobile/app header transparency restore */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .topbar.premium-topbar.qb-header {
    background: transparent !important;
    background-image: none !important;
    border-color: transparent !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .topbar.premium-topbar.qb-header::before,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .topbar.premium-topbar.qb-header::after {
    content: none !important;
    opacity: 0 !important;
    background: transparent !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .topbar.premium-topbar.qb-header
    :is(.appbar-shell, .header-container) {
    background: transparent !important;
    background-image: none !important;
    box-shadow: none !important;
    border-color: transparent !important;
  }
}

/* Final mobile bank layout: compact two-row question head */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-head {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) auto !important;
    grid-template-areas:
      "main controls"
      "method method" !important;
    align-items: start !important;
    gap: 6px !important;
    margin-bottom: 8px !important;
    padding-bottom: 6px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-head-main {
    grid-area: main !important;
    display: flex !important;
    align-items: center !important;
    flex-wrap: nowrap !important;
    gap: 6px !important;
    min-width: 0 !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    scrollbar-width: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-head-main::-webkit-scrollbar {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-head-tools {
    grid-area: controls !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: flex-end !important;
    justify-self: end !important;
    flex-wrap: nowrap !important;
    gap: 6px !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-head-method-row {
    grid-area: method !important;
    grid-column: 1 / -1 !important;
    justify-self: stretch !important;
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    margin-top: 1px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-index {
    min-width: clamp(104px, 32vw, 140px) !important;
    max-width: min(52vw, 176px) !important;
    min-height: 32px !important;
    padding: 4px 11px !important;
    border-radius: 11px !important;
    font-size: 0.74rem !important;
    font-weight: 800 !important;
    line-height: 1.06 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    :is(.question-review-badge, .question-head .stars, .question-solved-toggle) {
    min-height: 30px !important;
    border-radius: 999px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-review-badge {
    padding: 2px 9px !important;
    font-size: 0.67rem !important;
    font-weight: 780 !important;
    line-height: 1 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-head
    .stars {
    padding: 3px 10px !important;
    font-size: 0.77rem !important;
    line-height: 1 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-solved-toggle {
    padding: 3px 10px !important;
    font-size: 0.68rem !important;
    font-weight: 770 !important;
    white-space: nowrap !important;
    gap: 4px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-solved-toggle svg {
    width: 11px !important;
    height: 11px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-solved-badge {
    width: 28px !important;
    height: 28px !important;
    border-radius: 9px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-solved-badge svg {
    width: 13px !important;
    height: 13px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .icon-delete-btn-inline {
    width: 30px !important;
    height: 30px !important;
    min-height: 30px !important;
    border-radius: 9px !important;
    padding: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .icon-delete-btn-inline svg {
    width: 14px !important;
    height: 14px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-topic-chip {
    width: 100% !important;
    max-width: 100% !important;
    min-height: 32px !important;
    margin-top: 0 !important;
    padding: 4px 10px !important;
    border-radius: 999px !important;
    gap: 5px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-bank-panel
    .question-card
    .question-topic-chip-text {
    font-size: 0.71rem !important;
    font-weight: 730 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
}

/* Data Studio layout v3: two-row tools + PDF preview beside JSON editor */
.profile-card-data.profile-data-lab .profile-card-data-headline {
  margin-bottom: 8px;
}

.profile-card-data.profile-data-lab .profile-data-title-wrap {
  gap: 3px;
}

.profile-card-data.profile-data-lab .profile-data-title-wrap p {
  font-size: 0.73rem;
  line-height: 1.55;
}

.profile-card-data.profile-data-lab .profile-data-shell {
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}

.profile-card-data.profile-data-lab .profile-data-actions-bento {
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 6px;
  padding: 8px;
  border-radius: 12px;
}

.profile-card-data.profile-data-lab .profile-data-action-btn {
  min-height: 48px;
  border-radius: 10px;
  grid-template-columns: 29px minmax(0, 1fr);
  gap: 6px;
  padding: 6px 8px;
}

.profile-card-data.profile-data-lab .profile-data-action-icon {
  width: 29px;
  height: 29px;
  border-radius: 9px;
}

.profile-card-data.profile-data-lab .profile-data-action-icon svg {
  width: 14px;
  height: 14px;
}

.profile-card-data.profile-data-lab .profile-data-action-copy {
  gap: 1px;
}

.profile-card-data.profile-data-lab .profile-data-action-copy strong {
  font-size: 0.72rem;
  line-height: 1.2;
}

.profile-card-data.profile-data-lab .profile-data-action-copy small {
  font-size: 0.62rem;
  line-height: 1.22;
}

.profile-card-data.profile-data-lab .profile-data-main-grid {
  display: grid;
  direction: ltr;
  grid-template-columns: minmax(250px, 0.88fr) minmax(0, 1.12fr);
  gap: 8px;
  align-items: stretch;
}

.profile-card-data.profile-data-lab .profile-data-preview-panel,
.profile-card-data.profile-data-lab .profile-data-editor-panel {
  direction: rtl;
  border-radius: 12px;
  border: 1px solid var(--line);
  background:
    radial-gradient(circle at 10% 14%, var(--accent-soft), transparent 43%),
    var(--surface-soft);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06);
}

.profile-card-data.profile-data-lab .profile-data-preview-panel {
  padding: 8px;
  display: grid;
  gap: 6px;
}

.profile-card-data.profile-data-lab .profile-data-preview-head {
  min-width: 0;
  display: grid;
  gap: 4px;
}

.profile-card-data.profile-data-lab .profile-data-preview-head strong {
  font-size: 0.78rem;
  font-weight: 780;
  color: var(--text-main);
}

.profile-card-data.profile-data-lab .profile-data-preview-panel .profile-data-pdf-status {
  margin: 0;
  padding: 6px 8px;
  border-radius: 9px;
  font-size: 0.68rem;
}

.profile-card-data.profile-data-lab .profile-data-preview-body {
  min-height: 190px;
  border-radius: 10px;
  border: 1px solid var(--line);
  background:
    radial-gradient(circle at 50% 0%, rgba(129, 194, 240, 0.14), transparent 50%),
    rgba(9, 19, 31, 0.44);
  overflow: hidden;
  position: relative;
}

.profile-card-data.profile-data-lab .profile-data-preview-frame {
  width: 100%;
  height: 100%;
  min-height: 190px;
  border: 0;
  display: block;
  background: #101722;
}

.profile-card-data.profile-data-lab .profile-data-preview-image {
  width: 100%;
  height: 100%;
  min-height: 190px;
  display: block;
  object-fit: contain;
  object-position: center;
  background: #101722;
}

.profile-card-data.profile-data-lab .profile-data-preview-placeholder {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  text-align: center;
  padding: 12px;
  color: var(--text-muted);
  font-size: 0.73rem;
  line-height: 1.55;
}

.profile-card-data.profile-data-lab .profile-data-editor-panel {
  padding: 8px;
  display: grid;
  gap: 6px;
}

.profile-card-data.profile-data-lab .profile-data-editor-head {
  gap: 2px;
}

.profile-card-data.profile-data-lab .profile-v2-json-label {
  font-size: 0.75rem;
}

.profile-card-data.profile-data-lab .profile-data-editor-hint {
  font-size: 0.67rem;
  line-height: 1.45;
}

.profile-card-data.profile-data-lab #jsonImportText {
  min-height: 205px !important;
  border-radius: 10px;
  padding: 8px 10px;
  font-size: 0.73rem;
  line-height: 1.54;
}

.profile-card-data.profile-data-lab .profile-data-editor-actions {
  gap: 6px;
}

.profile-card-data.profile-data-lab .json-text-actions .profile-data-editor-btn.glass-btn {
  min-height: 26px !important;
  padding: 3px 8px !important;
  border-radius: 10px;
  font-size: 0.7rem;
}

.profile-card-data.profile-data-lab .profile-data-notes {
  margin-top: 8px;
  gap: 6px;
}

.profile-card-data.profile-data-lab .profile-data-note-chip {
  min-height: 24px;
  padding-inline: 8px;
  font-size: 0.68rem;
}

.profile-card-data.profile-data-lab .json-import-diagnostics {
  margin-top: 7px;
  border-radius: 10px;
}

@media (max-width: 1180px) {
  .profile-card-data.profile-data-lab .profile-data-actions-bento {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .profile-card-data.profile-data-lab .profile-data-main-grid {
    grid-template-columns: 1fr;
    direction: rtl;
  }

  .profile-card-data.profile-data-lab .profile-data-preview-body,
  .profile-card-data.profile-data-lab .profile-data-preview-frame,
  .profile-card-data.profile-data-lab .profile-data-preview-image {
    min-height: 180px;
  }

  .profile-card-data.profile-data-lab #jsonImportText {
    min-height: 185px !important;
  }
}

@media (max-width: 620px) {
  .profile-card-data.profile-data-lab .profile-data-actions-bento {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 5px;
  }

  .profile-card-data.profile-data-lab .profile-data-action-btn {
    min-height: 44px;
  }

  .profile-card-data.profile-data-lab .profile-data-action-copy strong {
    font-size: 0.7rem;
  }

  .profile-card-data.profile-data-lab .profile-data-action-copy small {
    font-size: 0.6rem;
  }

  .profile-card-data.profile-data-lab .profile-data-preview-body,
  .profile-card-data.profile-data-lab .profile-data-preview-frame,
  .profile-card-data.profile-data-lab .profile-data-preview-image {
    min-height: 158px;
  }

  .profile-card-data.profile-data-lab #jsonImportText {
    min-height: 167px !important;
    font-size: 0.71rem;
  }
}

@media (max-width: 430px) {
  .profile-card-data.profile-data-lab .profile-data-actions-bento {
    grid-template-columns: 1fr;
  }
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-preview-panel,
html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-editor-panel {
  border-color: rgba(117, 172, 206, 0.28);
  background:
    radial-gradient(circle at 12% 15%, rgba(139, 205, 244, 0.14), transparent 44%),
    rgba(244, 250, 255, 0.92);
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-preview-body {
  border-color: rgba(118, 172, 205, 0.34);
  background:
    radial-gradient(circle at 50% 0%, rgba(130, 195, 237, 0.2), transparent 55%),
    rgba(235, 246, 255, 0.92);
}

html[data-theme^="light-"] .profile-card-data.profile-data-lab .profile-data-preview-placeholder {
  color: rgba(44, 86, 117, 0.82);
}

@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .profile-card-data.profile-data-lab
    .profile-data-actions-bento {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .profile-card-data.profile-data-lab
    .profile-data-editor-actions {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .profile-card-data.profile-data-lab
    .profile-data-main-grid {
    grid-template-columns: 1fr;
    direction: rtl;
  }
}

@media (max-width: 430px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .profile-card-data.profile-data-lab
    .profile-data-actions-bento,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .profile-card-data.profile-data-lab
    .profile-data-editor-actions {
    grid-template-columns: 1fr !important;
  }
}

/* Question asset premium display patch: balanced all modes + stronger mobile/app rendering */
.question-body .question-asset-stack {
  grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
  gap: 11px;
  margin: 0 0 11px;
}

.question-body .question-asset-figure {
  border-radius: 14px;
  border: 1px solid color-mix(in srgb, var(--line) 84%, transparent);
  background:
    radial-gradient(circle at 14% 12%, color-mix(in srgb, var(--accent-soft) 52%, transparent), transparent 44%),
    linear-gradient(155deg, color-mix(in srgb, var(--surface-strong) 90%, transparent), color-mix(in srgb, var(--surface-soft) 95%, transparent));
  box-shadow: 0 10px 24px rgba(6, 10, 16, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.06);
  transition: transform 0.22s ease, box-shadow 0.22s ease, border-color 0.22s ease;
}

@media (hover: hover) and (pointer: fine) {
  .question-body .question-asset-figure.is-ready:hover {
    transform: translateY(-2px);
    border-color: color-mix(in srgb, var(--accent) 34%, var(--line));
    box-shadow: 0 14px 28px rgba(5, 9, 14, 0.26), inset 0 1px 0 rgba(255, 255, 255, 0.07);
  }
}

.question-body .question-asset-media {
  min-height: clamp(132px, 16vw, 226px);
  aspect-ratio: var(--question-asset-ratio, 4 / 3);
  border-radius: 11px;
  overflow: hidden;
}

.question-body .question-asset-figure[data-asset-ratio="wide"] .question-asset-media {
  --question-asset-ratio: 16 / 9;
}

.question-body .question-asset-figure[data-asset-ratio="balanced"] .question-asset-media {
  --question-asset-ratio: 4 / 3;
}

.question-body .question-asset-figure[data-asset-ratio="tall"] .question-asset-media {
  --question-asset-ratio: 3 / 4;
}

.question-body .question-asset-image {
  max-width: 100%;
  width: 100%;
  height: auto;
  max-height: min(66vh, 540px);
  margin: 0 auto;
  border-radius: 8px;
  cursor: zoom-in;
  outline: none;
  touch-action: manipulation;
}

.question-body .question-asset-image:focus-visible {
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 62%, #fff), 0 0 0 5px color-mix(in srgb, var(--accent-soft) 60%, transparent);
}

.question-body .question-asset-zoom-hint {
  position: absolute;
  left: 8px;
  bottom: 8px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-height: 22px;
  padding: 2px 9px;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--line) 76%, transparent);
  background: color-mix(in srgb, var(--surface-strong) 84%, transparent);
  color: color-mix(in srgb, var(--text-main) 86%, #fff);
  font-size: 0.62rem;
  font-weight: 720;
  line-height: 1;
  pointer-events: none;
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

.question-body .question-asset-figure.is-loading .question-asset-zoom-hint,
.question-body .question-asset-figure.is-error .question-asset-zoom-hint {
  display: none;
}

.question-asset-viewer {
  position: fixed;
  inset: 0;
  z-index: 1400;
  display: grid;
  place-items: center;
  padding: max(12px, env(safe-area-inset-top)) max(10px, env(safe-area-inset-right))
    max(12px, env(safe-area-inset-bottom)) max(10px, env(safe-area-inset-left));
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
}

.question-asset-viewer.is-open {
  opacity: 1;
  pointer-events: auto;
}

.question-asset-viewer-backdrop {
  position: absolute;
  inset: 0;
  border: 0;
  margin: 0;
  padding: 0;
  background: rgba(5, 10, 17, 0.8);
}

.question-asset-viewer-card {
  position: relative;
  margin: 0;
  width: min(96vw, 1120px);
  max-height: 94vh;
  padding: 10px 10px 12px;
  border-radius: 16px;
  border: 1px solid color-mix(in srgb, var(--line) 80%, transparent);
  background:
    linear-gradient(155deg, color-mix(in srgb, var(--surface-strong) 95%, transparent), color-mix(in srgb, var(--surface-soft) 96%, transparent));
  box-shadow: 0 28px 64px rgba(3, 8, 15, 0.62);
  display: grid;
  gap: 8px;
  overflow: hidden;
}

.question-asset-viewer-image {
  display: block;
  width: 100%;
  max-height: min(82vh, 980px);
  object-fit: contain;
  border-radius: 10px;
}

.question-asset-viewer-caption {
  margin: 0;
  color: var(--text-muted);
  font-size: 0.8rem;
  line-height: 1.5;
}

.question-asset-viewer-close {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 34px;
  height: 34px;
  border-radius: 10px;
  border: 1px solid color-mix(in srgb, var(--line) 75%, transparent);
  background: color-mix(in srgb, var(--surface-strong) 88%, transparent);
  color: var(--text-main);
  font-size: 1.4rem;
  line-height: 1;
  cursor: pointer;
}

.question-asset-viewer-close:hover {
  border-color: color-mix(in srgb, var(--accent) 42%, transparent);
}

body.question-asset-viewer-open {
  overflow: hidden !important;
}

@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-body
    .question-asset-stack {
    grid-template-columns: 1fr !important;
    gap: 9px !important;
    margin-bottom: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-body
    .question-asset-figure {
    border-radius: 12px !important;
    padding: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-body
    .question-asset-media {
    min-height: 124px !important;
    border-radius: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-body
    .question-asset-image {
    max-height: min(58vh, 430px) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .question-body
    .question-asset-zoom-hint {
    font-size: 0.58rem;
    min-height: 20px;
    padding: 2px 8px;
    left: 6px;
    bottom: 6px;
  }

  .question-asset-viewer {
    padding: calc(env(safe-area-inset-top) + 8px) max(8px, env(safe-area-inset-right))
      calc(env(safe-area-inset-bottom) + 8px) max(8px, env(safe-area-inset-left));
  }

  .question-asset-viewer-card {
    width: min(99vw, 720px);
    max-height: 95vh;
    border-radius: 13px;
    padding: 8px 8px 10px;
    gap: 7px;
  }

  .question-asset-viewer-image {
    max-height: min(80vh, 760px);
    border-radius: 9px;
  }
}

body.standalone-native-app .question-asset-viewer {
  padding-top: calc(env(safe-area-inset-top) + 10px);
  padding-bottom: calc(env(safe-area-inset-bottom) + 10px);
}

@media print {
  .question-asset-viewer,
  .question-asset-zoom-hint {
    display: none !important;
  }

  body.print-exam-only .question-asset-media {
    min-height: 0 !important;
    aspect-ratio: auto !important;
  }
}

/* Subject-level merged chapter tree (new model) */
.lesson-chapters-tree-layout {
  display: grid;
  grid-template-columns: minmax(0, 1.08fr) minmax(340px, 0.92fr);
  gap: 12px;
  align-items: start;
}

.lesson-chapters-col,
.lesson-tree-col {
  min-width: 0;
}

.lesson-tree-col .lesson-merged-tree-section {
  margin-top: 0;
}

.lesson-tree-col .chapter-map-layout.chapter-map-layout-tree {
  grid-template-columns: minmax(0, 1fr) !important;
  gap: 10px !important;
}

.lesson-tree-col .chapter-map-panel.chapter-map-merged-subject .chapter-map-layout.chapter-map-layout-tree .chapter-map-stage,
.lesson-tree-col .chapter-map-panel.chapter-map-merged-subject .chapter-map-layout.chapter-map-layout-tree .chapter-map-canvas {
  min-height: 420px;
}

.lesson-merged-tree-section {
  display: grid;
  gap: 10px;
  margin-top: 10px;
}

.lesson-merged-tree-head {
  border-radius: 14px;
  border: 1px solid rgba(124, 189, 230, 0.24);
  background:
    radial-gradient(circle at 12% 10%, rgba(87, 184, 246, 0.13), transparent 44%),
    linear-gradient(150deg, rgba(15, 29, 44, 0.86), rgba(10, 22, 35, 0.78));
  padding: 10px 12px;
  display: grid;
  gap: 4px;
}

.lesson-merged-tree-head h3 {
  margin: 0;
  display: inline-flex;
  align-items: center;
  gap: 7px;
  font-size: 0.9rem;
  line-height: 1.45;
}

.lesson-merged-tree-head p {
  margin: 0;
  font-size: 0.76rem;
  color: var(--text-muted);
  line-height: 1.55;
}

.lesson-merged-tree-panel.chapter-map-panel {
  margin: 0;
}

.chapter-map-panel.chapter-map-merged-subject .chapter-map-layout.chapter-map-layout-tree .chapter-map-stage,
.chapter-map-panel.chapter-map-merged-subject .chapter-map-layout.chapter-map-layout-tree .chapter-map-canvas {
  min-height: 500px;
}

.chapter-map-panel.chapter-map-merged-subject .chapter-map-legend-list {
  max-height: 420px;
}

@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .lesson-chapters-tree-layout {
    grid-template-columns: minmax(0, 1fr);
    gap: 10px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .lesson-merged-tree-section {
    gap: 8px;
    margin-top: 8px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .lesson-merged-tree-head {
    border-radius: 12px;
    padding: 9px 10px;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .lesson-merged-tree-head h3 {
    font-size: 0.83rem;
    line-height: 1.5;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .lesson-merged-tree-head p {
    font-size: 0.71rem;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-panel.chapter-map-merged-subject
    .chapter-map-layout.chapter-map-layout-tree {
    gap: 10px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-panel.chapter-map-merged-subject
    .chapter-map-layout.chapter-map-layout-tree
    :is(.chapter-map-stage, .chapter-map-canvas) {
    min-height: 362px !important;
    max-height: 72dvh !important;
    border-radius: 14px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-panel.chapter-map-merged-subject
    .chapter-map-legend {
    border-radius: 13px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-panel.chapter-map-merged-subject
    .chapter-map-legend-list {
    max-height: min(48dvh, 370px) !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-panel.chapter-map-merged-subject
    .chapter-map-legend-item {
    min-height: 48px !important;
    padding: 8px 9px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-panel.chapter-map-merged-subject
    .chapter-map-legend-item
    strong {
    white-space: normal !important;
    line-height: 1.45 !important;
  }
}

@media (max-width: 560px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-panel.chapter-map-merged-subject
    .chapter-map-layout.chapter-map-layout-tree
    :is(.chapter-map-stage, .chapter-map-canvas) {
    min-height: 336px !important;
    max-height: 68dvh !important;
  }
}

@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-panel
    .chapter-map-layout.chapter-map-layout-tree
    :is(.chapter-map-stage, .chapter-map-canvas) {
    min-height: 344px !important;
    max-height: 70dvh !important;
  }
}

@media (max-width: 560px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .chapter-map-panel
    .chapter-map-layout.chapter-map-layout-tree
    :is(.chapter-map-stage, .chapter-map-canvas) {
    min-height: 320px !important;
    max-height: 66dvh !important;
  }
}

@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app).mobile-ultra
    .chapter-map-panel
    .chapter-map-layout.chapter-map-layout-tree
    :is(.chapter-map-stage, .chapter-map-canvas) {
    min-height: 328px !important;
    max-height: 64dvh !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app).mobile-ultra
    .chapter-map-panel.chapter-map-merged-subject
    .chapter-map-layout.chapter-map-layout-tree
    :is(.chapter-map-stage, .chapter-map-canvas) {
    min-height: 342px !important;
    max-height: 68dvh !important;
  }
}

/* Standalone app heavy optimization mode: keep interactions fast under long sessions */
@media (max-width: 1023px) {
  body.standalone-native-app.app-ultra-perf::before {
    display: none !important;
  }

  body.standalone-native-app.app-ultra-perf :is(
      .surface,
      .profile-surface,
      .question-card,
      .practice-question-card,
      .exam-paper,
      .exam-question-review,
      .chapter-map-stage,
      .chapter-map-legend,
      .status-bar,
      .toast-item,
      .pwa-mobile-dock
    ) {
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    background-image: none !important;
  }

  body.standalone-native-app.app-ultra-perf :is(
      .chapter-map-blobs,
      .chapter-map-particles,
      .chapter-tree-atmosphere,
      .chapter-tree-node-glow,
      .chapter-tree-link-trail,
      .chapter-tree-root-aura,
      .chapter-tree-root-pulse,
      .chapter-tree-minimap
    ) {
    display: none !important;
  }

  body.standalone-native-app.app-ultra-perf :is(
      .stagger-item,
      .app-boot-splash,
      #levelContainer.is-view-transitioning > *,
      .topbar.premium-topbar.qb-header.app-header-v3,
      .pwa-mobile-dock-btn,
      .chapter-map-action-btn,
      .practice-action-btn,
      .exam-generate-btn,
      .lesson-chapter-open,
      .subject-open-btn,
      .glass-btn,
      .tab-btn
    ) {
    animation: none !important;
    transition: none !important;
  }

  body.standalone-native-app.app-ultra-perf :is(.question-asset-zoom-hint, .question-asset-viewer-close) {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  body.standalone-native-app.app-ultra-perf :is(.chapter-map-panel, .question-list, .exam-paper-list, .practice-mode-panel) {
    contain: layout style paint !important;
  }

  @supports (content-visibility: auto) {
    body.standalone-native-app.app-ultra-perf :is(
        .question-card,
        .practice-question-card,
        .exam-paper-item,
        .exam-question-review,
        .lesson-chapter-card,
        .subject-premium-card
      ) {
      content-visibility: auto;
      contain: layout style paint;
      contain-intrinsic-size: 1px 380px;
    }

    body.standalone-native-app.app-ultra-perf :is(
        .question-body,
        .disclosure,
        .practice-reveal-content,
        .exam-question-answer-body,
        .question-asset-stack
      ) {
      content-visibility: auto;
      contain-intrinsic-size: 1px 180px;
    }
  }
}

/* Hard override: pinned mobile/app header must remain fully transparent */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .topbar.premium-topbar.qb-header.app-header-v3,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .topbar.premium-topbar.qb-header.app-header-v3.is-lifted {
    background: transparent !important;
    background-color: transparent !important;
    background-image: none !important;
    border-color: transparent !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .topbar.premium-topbar.qb-header.app-header-v3::before,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .topbar.premium-topbar.qb-header.app-header-v3::after {
    content: none !important;
    opacity: 0 !important;
    background: transparent !important;
    background-image: none !important;
    box-shadow: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .topbar.premium-topbar.qb-header.app-header-v3
    .appbar-shell {
    background: transparent !important;
    background-color: transparent !important;
    background-image: none !important;
    box-shadow: none !important;
    border-color: transparent !important;
  }
}

/* App experience enhancer patch: swipe/tactile/offline/scroll/deeplink skeleton */
.app-network-pill {
  position: fixed;
  top: max(10px, env(safe-area-inset-top, 0px));
  right: max(10px, env(safe-area-inset-right, 0px));
  z-index: 140;
  padding: 7px 12px;
  border-radius: 999px;
  border: 1px solid rgba(120, 166, 201, 0.34);
  background: rgba(17, 40, 64, 0.84);
  color: #f4fbff;
  font-size: 0.78rem;
  font-weight: 700;
  letter-spacing: 0.01em;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  box-shadow: 0 8px 20px rgba(5, 15, 30, 0.35);
  pointer-events: none;
}

.app-network-pill[data-state="offline"] {
  border-color: rgba(255, 119, 119, 0.54);
  background: rgba(86, 18, 18, 0.86);
  color: #fff6f6;
}

#levelContainer.is-view-loading {
  position: relative;
  min-height: 180px;
}

#levelContainer.is-view-loading::after {
  content: "";
  position: absolute;
  inset: 6px;
  border-radius: 18px;
  border: 1px solid rgba(117, 167, 206, 0.24);
  background:
    linear-gradient(
      110deg,
      rgba(23, 49, 77, 0.32) 18%,
      rgba(68, 111, 146, 0.4) 48%,
      rgba(23, 49, 77, 0.32) 78%
    );
  background-size: 220% 100%;
  animation: app-experience-shimmer 0.84s ease-in-out infinite;
  pointer-events: none;
}

@keyframes app-experience-shimmer {
  0% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

body.is-offline .status-bar {
  border-color: rgba(255, 105, 105, 0.34) !important;
  color: rgba(255, 216, 216, 0.97) !important;
}

@media (max-width: 1023px) {
  .app-network-pill {
    top: calc(env(safe-area-inset-top, 0px) + 8px);
    right: calc(env(safe-area-inset-right, 0px) + 8px);
    font-size: 0.74rem;
    padding: 6px 11px;
  }

  body.standalone-native-app .app-network-pill {
    top: calc(env(safe-area-inset-top, 0px) + 8px);
    right: calc(env(safe-area-inset-right, 0px) + 8px);
  }

  #levelContainer.is-view-loading {
    min-height: 140px;
  }
}

@media (prefers-reduced-motion: reduce) {
  #levelContainer.is-view-loading::after {
    animation: none !important;
  }
}

/* Minimal app pass: declutter chrome + keep actions in "more" */
body.app-minimal-ui .topbar.premium-topbar.qb-header.app-header-v3 .appbar-sync-indicator {
  display: none !important;
}

@media (max-width: 1023px) {
  body.app-minimal-mobile .topbar.premium-topbar.qb-header.app-header-v3 .appbar-center {
    display: none !important;
  }

  body.app-minimal-mobile .topbar.premium-topbar.qb-header.app-header-v3 #headerSearchBtn,
  body.app-minimal-mobile .topbar.premium-topbar.qb-header.app-header-v3 #settingsPanelToggle {
    display: none !important;
  }

  body.app-minimal-mobile .topbar.premium-topbar.qb-header.app-header-v3 .appbar-end {
    gap: 6px !important;
  }

  body.app-minimal-mobile #headerSectionsSheet,
  body.app-minimal-mobile #headerSectionsToggle {
    display: none !important;
  }
}

/* Data Studio: simple/pro mode switch + decluttered simple layout */
.profile-card-data.profile-data-lab .data-studio-mode-switch {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  margin-inline-start: auto;
  padding: 4px;
  border-radius: 999px;
  border: 1px solid rgba(120, 166, 201, 0.26);
  background: rgba(20, 42, 66, 0.52);
}

.profile-card-data.profile-data-lab .data-studio-mode-btn {
  border: 1px solid transparent;
  border-radius: 999px;
  background: transparent;
  color: rgba(228, 241, 255, 0.88);
  padding: 6px 12px;
  font-size: 0.76rem;
  font-weight: 700;
  cursor: pointer;
}

.profile-card-data.profile-data-lab .data-studio-mode-btn.is-active {
  background: linear-gradient(145deg, rgba(43, 88, 129, 0.86), rgba(24, 53, 84, 0.9));
  border-color: rgba(122, 181, 222, 0.34);
  color: #f6fbff;
}

.profile-card-data.profile-data-lab[data-studio-mode="simple"] .profile-data-actions-bento,
.profile-card-data.profile-data-lab[data-studio-mode="simple"] .profile-data-preview-panel,
.profile-card-data.profile-data-lab[data-studio-mode="simple"] .profile-data-notes {
  display: none !important;
}

.profile-card-data.profile-data-lab[data-studio-mode="simple"] .profile-data-main-grid {
  grid-template-columns: minmax(0, 1fr) !important;
}

.profile-card-data.profile-data-lab[data-studio-mode="simple"] #jsonImportText {
  min-height: clamp(300px, 42vh, 520px) !important;
}

/* Question bank deferred/virtual slots */
.question-virtual-slot {
  position: relative;
  border-radius: 18px;
}

.question-virtual-skeleton {
  display: grid;
  gap: 10px;
  border-radius: 18px;
  border: 1px solid rgba(114, 163, 198, 0.24);
  background: linear-gradient(160deg, rgba(18, 40, 64, 0.62), rgba(14, 30, 49, 0.74));
  padding: 18px 16px;
  min-height: inherit;
}

.question-virtual-line {
  display: block;
  height: 10px;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(111, 161, 197, 0.2), rgba(170, 205, 232, 0.44), rgba(111, 161, 197, 0.2));
  background-size: 220% 100%;
  animation: question-virtual-skeleton-glow 1.04s ease-in-out infinite;
}

.question-virtual-line-lg {
  width: 88%;
}

.question-virtual-line-md {
  width: 74%;
}

.question-virtual-line-sm {
  width: 52%;
}

@keyframes question-virtual-skeleton-glow {
  0% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

/* Compact settings mode + quick search */
.settings-panel .settings-compact-tools {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
}

.settings-panel .settings-compact-btn {
  border: 1px solid rgba(120, 166, 201, 0.3);
  border-radius: 10px;
  background: rgba(20, 42, 66, 0.5);
  color: rgba(232, 243, 255, 0.9);
  padding: 6px 10px;
  font-size: 0.74rem;
  font-weight: 700;
  cursor: pointer;
}

.settings-panel .settings-compact-btn.is-active {
  border-color: rgba(116, 191, 153, 0.5);
  background: rgba(19, 76, 58, 0.44);
  color: #e9fff3;
}

.settings-panel .settings-quick-search-wrap {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  border: 1px solid rgba(120, 166, 201, 0.28);
  border-radius: 10px;
  background: rgba(16, 34, 54, 0.46);
  padding: 5px 8px;
}

.settings-panel .settings-quick-search-label {
  font-size: 0.72rem;
  color: rgba(190, 214, 236, 0.84);
}

.settings-panel .settings-quick-search-input {
  border: 0;
  outline: none;
  min-width: 140px;
  background: transparent;
  color: rgba(240, 247, 255, 0.96);
  font-size: 0.78rem;
}

.settings-panel .settings-search-empty {
  width: 100%;
  font-size: 0.74rem;
  color: rgba(255, 202, 202, 0.92);
}

.settings-panel .settings-search-hidden {
  display: none !important;
}

body.settings-compact-mode .settings-panel.settings-panel-premium .settings-panel-side {
  display: none !important;
}

body.settings-compact-mode .settings-panel.settings-panel-premium .settings-panel-layout {
  grid-template-columns: minmax(0, 1fr) !important;
  gap: 10px !important;
}

body.settings-compact-mode .settings-panel.settings-panel-premium .settings-tab-panel {
  padding: 10px !important;
}

body.settings-compact-mode .settings-panel.settings-panel-premium .settings-inline-actions {
  gap: 6px !important;
}

body.settings-compact-mode .settings-panel.settings-panel-premium :is(.control-field, .settings-mode-card, .drive-field-group) {
  gap: 6px !important;
}

@media (max-width: 1023px) {
  .profile-card-data.profile-data-lab .data-studio-mode-switch {
    width: 100%;
    justify-content: space-between;
    margin-top: 8px;
  }

  .profile-card-data.profile-data-lab .data-studio-mode-btn {
    flex: 1 1 48%;
  }

  .settings-panel .settings-compact-tools {
    width: 100%;
  }

  .settings-panel .settings-quick-search-wrap {
    width: 100%;
    justify-content: space-between;
  }

  .settings-panel .settings-quick-search-input {
    min-width: 0;
    width: 100%;
  }
}

@media (prefers-reduced-motion: reduce) {
  .question-virtual-line {
    animation: none !important;
  }
}

/* Final visual polish: (2) stronger typography hierarchy + (4) lower glow intensity */
:root {
  --type-title-xl: clamp(1.18rem, 0.6vw + 1.02rem, 1.56rem);
  --type-title-lg: clamp(1.02rem, 0.45vw + 0.92rem, 1.28rem);
  --type-title-md: clamp(0.9rem, 0.28vw + 0.84rem, 1.06rem);
  --type-body-md: clamp(0.84rem, 0.16vw + 0.8rem, 0.94rem);
  --type-body-sm: clamp(0.74rem, 0.08vw + 0.72rem, 0.82rem);
  --type-btn: clamp(0.78rem, 0.1vw + 0.75rem, 0.86rem);
  --ui-shadow-soft: 0 6px 14px rgba(5, 10, 16, 0.18);
  --ui-shadow-card: 0 10px 24px rgba(5, 10, 16, 0.24);
}

@media screen {
  body {
    font-size: var(--type-body-md);
    line-height: 1.62;
  }

  .appbar-brand-title,
  .appbar-mobile-title-text,
  .toolbar-head h2,
  .subjects-dashboard-head h2,
  .chapter-head h2,
  .lesson-title-row h2,
  .profile-head-copy h2,
  .settings-panel-head h3 {
    font-size: var(--type-title-xl) !important;
    line-height: 1.34 !important;
    font-weight: 780 !important;
    letter-spacing: 0.01em;
    text-shadow: none !important;
  }

  .settings-section-head h4,
  .profile-data-title-wrap h3,
  .subject-open-btn h3,
  .card-btn h3,
  .lesson-chapter-head h3 {
    font-size: var(--type-title-lg) !important;
    line-height: 1.36 !important;
    font-weight: 760 !important;
    text-shadow: none !important;
  }

  .toolbar-head p,
  .subjects-dashboard-head p,
  .chapter-head p,
  .lesson-title-row p,
  .profile-head-copy p,
  .settings-panel-head p,
  .settings-section-head p,
  .profile-data-title-wrap p,
  .profile-data-editor-hint,
  .profile-data-note-chip,
  .question-body,
  .question-body p,
  .disclosure {
    font-size: var(--type-body-md) !important;
    line-height: 1.74 !important;
    font-weight: 520;
  }

  .glass-btn,
  .tool-btn,
  .appbar-segment-btn,
  .settings-tab-btn,
  .profile-data-action-btn,
  .profile-data-editor-btn,
  .chapter-map-action-btn,
  .pwa-mobile-dock-btn,
  .question-solved-toggle,
  .exam-chip-btn,
  .exam-library-btn,
  .exam-print-btn {
    font-size: var(--type-btn) !important;
    font-weight: 700 !important;
    letter-spacing: 0.008em;
    text-shadow: none !important;
  }

  .question-index,
  .question-topic-chip,
  .question-review-badge,
  .settings-overview-label,
  .profile-data-kicker {
    font-size: var(--type-body-sm) !important;
    font-weight: 700;
    text-shadow: none !important;
  }

  .surface,
  .profile-surface,
  .profile-card,
  .settings-panel.settings-panel-premium,
  .subject-premium-card,
  .lesson-chapter-card,
  .question-card,
  .practice-question-card,
  .exam-paper,
  .exam-paper-item,
  .profile-data-actions-bento,
  .profile-data-preview-panel,
  .profile-data-editor-panel {
    box-shadow: var(--ui-shadow-card) !important;
  }

  .glass-btn,
  .tool-btn,
  .card-btn,
  .profile-quick-sync-btn,
  .profile-quick-card,
  .profile-data-action-btn,
  .profile-data-editor-btn,
  .settings-tab-btn,
  .chapter-map-action-btn {
    box-shadow: var(--ui-shadow-soft) !important;
    filter: none !important;
  }

  .profile-data-tag.profile-data-tag-icon,
  .profile-save-pill,
  .header-brand-icon,
  .profile-avatar-circle,
  .profile-quick-theme-btn::after {
    box-shadow: none !important;
    filter: none !important;
  }

  .appbar-chip,
  .question-solved-badge,
  .question-review-badge,
  .profile-data-note-chip,
  .settings-state-pill {
    text-shadow: none !important;
  }
}

@media (max-width: 1023px) {
  body {
    font-size: 0.84rem;
    line-height: 1.64;
  }

  .question-body,
  .question-body p,
  .disclosure {
    font-size: 0.86rem !important;
    line-height: 1.8 !important;
  }

  .glass-btn,
  .tool-btn,
  .appbar-segment-btn,
  .pwa-mobile-dock-btn,
  .profile-data-action-btn,
  .profile-data-editor-btn {
    font-size: 0.8rem !important;
  }
}

/* Ultimate mobile/app question-head tidy layout (final override) */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-head {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) !important;
    grid-template-areas:
      "main"
      "tools"
      "method" !important;
    align-items: start !important;
    row-gap: 6px !important;
    column-gap: 0 !important;
    margin-bottom: 8px !important;
    padding-bottom: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-head-main {
    grid-area: main !important;
    display: flex !important;
    flex-wrap: wrap !important;
    align-items: center !important;
    gap: 6px !important;
    min-width: 0 !important;
    overflow: visible !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-head-tools {
    grid-area: tools !important;
    display: flex !important;
    flex-wrap: wrap !important;
    align-items: center !important;
    justify-content: flex-start !important;
    gap: 6px !important;
    min-width: 0 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-head-tools > * {
    flex: 0 0 auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-head-method-row {
    grid-area: method !important;
    grid-column: 1 / -1 !important;
    width: 100% !important;
    max-width: 100% !important;
    margin-top: 1px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-index {
    min-height: 30px !important;
    padding: 3px 10px !important;
    border-radius: 10px !important;
    font-size: 0.72rem !important;
    font-weight: 800 !important;
    line-height: 1.06 !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-review-badge {
    min-height: 28px !important;
    padding: 2px 9px !important;
    border-radius: 999px !important;
    font-size: 0.67rem !important;
    font-weight: 780 !important;
    line-height: 1 !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-head
    .stars {
    min-height: 28px !important;
    padding: 2px 9px !important;
    border-radius: 999px !important;
    font-size: 0.76rem !important;
    line-height: 1 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-solved-toggle {
    min-height: 28px !important;
    padding: 2px 9px !important;
    border-radius: 999px !important;
    font-size: 0.68rem !important;
    font-weight: 770 !important;
    line-height: 1 !important;
    gap: 4px !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-solved-toggle
    svg {
    width: 11px !important;
    height: 11px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-solved-badge {
    width: 26px !important;
    height: 26px !important;
    border-radius: 8px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-solved-badge
    svg {
    width: 12px !important;
    height: 12px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .qb-check {
    width: 20px !important;
    height: 20px !important;
    flex: 0 0 20px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-topic-chip {
    width: 100% !important;
    max-width: 100% !important;
    min-height: 31px !important;
    padding: 4px 10px !important;
    border-radius: 999px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    .question-card
    .question-topic-chip-text {
    font-size: 0.71rem !important;
    font-weight: 730 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
}

/* Question focus mode: keep-last overrides (all modes + mobile/app) */
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head-main,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head-method-row,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-review-tools,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-solve-strip,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head .stars,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-solved-badge,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .icon-delete-btn-inline,
body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .icon-edit-btn-inline {
  display: none !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head-tools {
  display: flex !important;
  align-items: center !important;
  justify-content: flex-start !important;
  flex-wrap: wrap !important;
  gap: 8px !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head-tools > :not(.question-solved-toggle) {
  display: none !important;
}

body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-tools > :not([data-kind="hint"]):not([data-kind="solution"]) {
  display: none !important;
}

body.question-focus-mode .practice-focus-actions > :not([data-action="practice-reveal-hint"]):not([data-action="practice-reveal-solution"]) {
  display: none !important;
}

@media (max-width: 1023px) {
  body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head {
    display: flex !important;
    align-items: center !important;
    flex-wrap: wrap !important;
    gap: 6px !important;
    margin: 0 0 7px !important;
    padding: 0 !important;
    border-bottom: 0 !important;
    min-height: 0 !important;
  }

  body.question-focus-mode :is(.question-bank-panel, .practice-mode-panel) .question-head-tools {
    width: 100% !important;
    min-width: 0 !important;
  }
}

/* Final mobile/app question header optimization */
@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-head {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) auto !important;
    grid-template-areas:
      "main tools"
      "method method" !important;
    align-items: start !important;
    column-gap: 8px !important;
    row-gap: 6px !important;
    margin-bottom: 9px !important;
    padding-bottom: 7px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-head-main {
    grid-area: main !important;
    display: flex !important;
    align-items: center !important;
    flex-wrap: nowrap !important;
    gap: 6px !important;
    min-width: 0 !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    scrollbar-width: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-head-main::-webkit-scrollbar {
    width: 0 !important;
    height: 0 !important;
    display: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-head-tools {
    grid-area: tools !important;
    justify-self: end !important;
    display: flex !important;
    align-items: center !important;
    justify-content: flex-end !important;
    flex-wrap: nowrap !important;
    gap: 6px !important;
    min-width: 0 !important;
    max-width: 46vw !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    scrollbar-width: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-head-tools::-webkit-scrollbar {
    width: 0 !important;
    height: 0 !important;
    display: none !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-head-tools > * {
    flex: 0 0 auto !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-head-method-row {
    grid-area: method !important;
    grid-column: 1 / -1 !important;
    width: 100% !important;
    max-width: 100% !important;
    margin-top: 1px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    :is(.question-index, .question-review-badge, .question-head .stars, .question-solved-toggle) {
    min-height: 30px !important;
    border-radius: 10px !important;
    line-height: 1 !important;
    white-space: nowrap !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-index {
    min-width: clamp(108px, 33vw, 144px) !important;
    max-width: min(55vw, 182px) !important;
    padding: 4px 11px !important;
    font-size: 0.73rem !important;
    font-weight: 800 !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-review-badge {
    padding: 2px 9px !important;
    font-size: 0.67rem !important;
    font-weight: 780 !important;
    border-radius: 999px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-head
    .stars {
    padding: 3px 10px !important;
    font-size: 0.76rem !important;
    border-radius: 999px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-solved-toggle {
    padding: 3px 10px !important;
    font-size: 0.68rem !important;
    font-weight: 770 !important;
    border-radius: 999px !important;
    gap: 4px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-solved-toggle
    svg {
    width: 11px !important;
    height: 11px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-solved-badge {
    width: 28px !important;
    height: 28px !important;
    border-radius: 9px !important;
    flex: 0 0 28px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .qb-check {
    width: 20px !important;
    height: 20px !important;
    flex: 0 0 20px !important;
  }
}

@media (max-width: 430px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-head {
    grid-template-columns: minmax(0, 1fr) !important;
    grid-template-areas:
      "main"
      "tools"
      "method" !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app):not(.question-focus-mode)
    :is(.question-bank-panel, .practice-mode-panel, .exam-mode-panel)
    :is(.question-card, .practice-question-card)
    .question-head-tools {
    justify-self: stretch !important;
    justify-content: flex-start !important;
    max-width: 100% !important;
  }
}

/* Data Studio: remove extra descriptions + better icon placement */
.profile-card-data.profile-data-lab .profile-card-data-headline {
  display: grid;
  grid-template-columns: minmax(0, 1fr);
  align-items: start;
  gap: 8px;
}

.profile-card-data.profile-data-lab .profile-data-title-wrap {
  min-width: 0;
  display: block;
}

.profile-card-data.profile-data-lab .profile-data-title-row {
  min-width: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.profile-card-data.profile-data-lab .profile-data-title-copy {
  min-width: 0;
  display: grid;
  gap: 3px;
}

.profile-card-data.profile-data-lab .profile-data-title-copy h3 {
  margin: 0;
}

.profile-card-data.profile-data-lab .profile-data-title-copy .profile-data-kicker {
  width: fit-content;
}

.profile-card-data.profile-data-lab .profile-data-title-row .profile-data-tag.profile-data-tag-icon {
  margin: 0;
  flex: 0 0 auto;
}

.profile-card-data.profile-data-lab .profile-data-title-wrap p,
.profile-card-data.profile-data-lab .profile-data-editor-hint,
.profile-card-data.profile-data-lab .profile-data-notes {
  display: none !important;
}

.profile-card-data.profile-data-lab .data-studio-mode-switch {
  justify-self: end;
  margin-inline-start: 0;
}

@media (max-width: 1023px) {
  .profile-card-data.profile-data-lab .profile-data-title-row {
    gap: 8px;
  }

  .profile-card-data.profile-data-lab .profile-data-title-row .profile-data-tag.profile-data-tag-icon {
    width: 38px;
    min-width: 38px;
    height: 38px;
    min-height: 38px;
    border-radius: 11px;
  }

  .profile-card-data.profile-data-lab .profile-data-title-copy h3 {
    font-size: 0.96rem !important;
  }

  .profile-card-data.profile-data-lab .data-studio-mode-switch {
    width: 100%;
    justify-self: stretch;
  }
}

@media (max-width: 460px) {
  .profile-card-data.profile-data-lab .profile-data-title-row .profile-data-tag.profile-data-tag-icon {
    width: 34px;
    min-width: 34px;
    height: 34px;
    min-height: 34px;
    border-radius: 10px;
  }

  .profile-card-data.profile-data-lab .profile-data-tag.profile-data-tag-icon svg {
    width: 20px;
    height: 20px;
  }
}

/* Final practice stability patch: icon reliability + distinct hint/solution themes */
.practice-mode-panel.practice-modernized .practice-action-btn .practice-icon {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 17px !important;
  min-width: 17px !important;
  height: 17px !important;
  min-height: 17px !important;
  flex: 0 0 17px !important;
  border-radius: 6px !important;
  opacity: 1 !important;
  visibility: visible !important;
  overflow: visible !important;
  color: currentColor !important;
}

.practice-mode-panel.practice-modernized .practice-action-btn .practice-icon svg {
  display: block !important;
  width: 14px !important;
  height: 14px !important;
  stroke: currentColor !important;
  stroke-width: 1.9 !important;
  fill: none !important;
  opacity: 1 !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-box {
  border-width: 1px !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-head {
  display: inline-flex !important;
  align-items: center !important;
  gap: 8px !important;
  font-size: 0.85rem !important;
  font-weight: 800 !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-head .practice-icon {
  width: 23px !important;
  min-width: 23px !important;
  height: 23px !important;
  min-height: 23px !important;
  flex: 0 0 23px !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-hint {
  border-color: rgba(128, 211, 255, 0.52) !important;
  background:
    radial-gradient(circle at 11% 10%, rgba(129, 212, 255, 0.26), transparent 39%),
    linear-gradient(152deg, rgba(24, 77, 112, 0.34), rgba(12, 41, 68, 0.2)),
    rgba(8, 24, 41, 0.72) !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-hint::before {
  content: "" !important;
  position: absolute !important;
  inset-inline: 12px !important;
  top: 0 !important;
  height: 2px !important;
  border-radius: 999px !important;
  background: linear-gradient(90deg, transparent, rgba(150, 219, 255, 0.98), transparent) !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-hint .practice-reveal-head {
  color: #d9f3ff !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-hint .practice-reveal-head .practice-icon {
  border-color: rgba(142, 214, 255, 0.48) !important;
  background: rgba(130, 208, 255, 0.18) !important;
  color: #d9f4ff !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-hint .practice-reveal-footer {
  border-top-color: rgba(145, 214, 255, 0.34) !important;
  color: rgba(220, 241, 255, 0.86) !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-solution {
  border-color: rgba(126, 229, 181, 0.56) !important;
  background:
    radial-gradient(circle at 11% 10%, rgba(121, 224, 176, 0.28), transparent 39%),
    linear-gradient(152deg, rgba(19, 91, 63, 0.38), rgba(8, 52, 37, 0.23)),
    rgba(9, 31, 27, 0.74) !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-solution::before {
  content: "" !important;
  position: absolute !important;
  inset-inline: 12px !important;
  top: 0 !important;
  height: 2px !important;
  border-radius: 999px !important;
  background: linear-gradient(90deg, transparent, rgba(148, 232, 191, 0.98), transparent) !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-head {
  color: #ddffec !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-head .practice-icon {
  border-color: rgba(139, 230, 189, 0.52) !important;
  background: rgba(118, 226, 178, 0.19) !important;
  color: #dcffe9 !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-footer {
  border-top-color: rgba(143, 231, 190, 0.34) !important;
  color: rgba(224, 250, 235, 0.86) !important;
}

html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-hint {
  border-color: rgba(61, 137, 185, 0.38) !important;
  background:
    radial-gradient(circle at 11% 10%, rgba(127, 197, 238, 0.24), transparent 39%),
    linear-gradient(152deg, rgba(234, 246, 255, 0.97), rgba(226, 241, 253, 0.93)) !important;
}

html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-hint .practice-reveal-head {
  color: #174d74 !important;
}

html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-hint .practice-reveal-footer {
  color: #2c6388 !important;
}

html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-solution {
  border-color: rgba(42, 146, 102, 0.36) !important;
  background:
    radial-gradient(circle at 11% 10%, rgba(114, 205, 171, 0.22), transparent 39%),
    linear-gradient(152deg, rgba(235, 250, 243, 0.98), rgba(224, 245, 235, 0.94)) !important;
}

html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-head {
  color: #165e41 !important;
}

html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-footer {
  color: #2e6c54 !important;
}

@media (max-width: 1023px) {
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel.practice-modernized
    .practice-action-btn
    .practice-icon,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel.practice-mobile-perf
    .practice-action-btn
    .practice-icon {
    width: 16px !important;
    min-width: 16px !important;
    height: 16px !important;
    min-height: 16px !important;
    flex: 0 0 16px !important;
  }

  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel.practice-modernized
    .practice-action-btn
    .practice-icon
    svg,
  :is(body.force-mobile, body.auto-mobile, body[data-viewport-resolved="mobile"], body.standalone-native-app)
    .practice-mode-panel.practice-mobile-perf
    .practice-action-btn
    .practice-icon
    svg {
    width: 13px !important;
    height: 13px !important;
  }
}

/* Question focus hard lock (bank only): prevent escaping by page scroll */
html.question-focus-locked-page,
body.question-focus-bank-locked {
  overflow: hidden !important;
  overscroll-behavior: none !important;
}

body.question-focus-bank-locked {
  --question-focus-lock-offset: 122px;
}

body.question-focus-bank-locked .main-content,
body.question-focus-bank-locked #levelContainer {
  overflow: hidden !important;
}

body.question-focus-bank-locked .question-bank-panel {
  max-height: calc(100dvh - var(--question-focus-lock-offset)) !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  overscroll-behavior: contain !important;
  -webkit-overflow-scrolling: touch !important;
  touch-action: pan-y !important;
  scrollbar-gutter: stable both-edges;
}

body.question-focus-bank-locked .question-bank-panel .question-list {
  overscroll-behavior: contain !important;
}

body.question-focus-bank-locked :is(.topbar, .profile-hub, #breadcrumbs, #statusBar, .settings-panel) {
  user-select: none !important;
}

@media (max-width: 1023px) {
  body.question-focus-bank-locked {
    --question-focus-lock-offset: 154px;
  }

  body.question-focus-bank-locked .question-bank-panel {
    padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 78px) !important;
  }
}

/* Final practice solution readability lock:
   keep normal text fully visible and let math formulas scroll horizontally. */
.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content {
  overflow-x: visible !important;
  overflow-y: visible !important;
  word-break: normal !important;
  overflow-wrap: anywhere !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content :is(p, li, div, span, em, strong) {
  max-inline-size: 100% !important;
  word-break: normal !important;
  overflow-wrap: anywhere !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .math-node {
  display: inline-block !important;
  max-width: 100% !important;
  white-space: nowrap !important;
  overflow-x: auto !important;
  overflow-y: hidden !important;
  vertical-align: middle !important;
  -webkit-overflow-scrolling: touch !important;
  scrollbar-width: thin !important;
  scrollbar-color: rgba(141, 204, 246, 0.76) rgba(121, 164, 197, 0.2) !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .math-node[data-display="1"],
.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .katex-display {
  display: block !important;
  max-width: 100% !important;
  margin: 8px 0 !important;
  overflow-x: auto !important;
  overflow-y: hidden !important;
  -webkit-overflow-scrolling: touch !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .katex-display > .katex {
  display: inline-block !important;
  min-width: max-content !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .math-node::-webkit-scrollbar,
.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .katex-display::-webkit-scrollbar {
  display: block !important;
  width: 7px !important;
  height: 7px !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .math-node::-webkit-scrollbar-thumb,
.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .katex-display::-webkit-scrollbar-thumb {
  background: rgba(141, 204, 246, 0.76) !important;
  border-radius: 999px !important;
}

.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .math-node::-webkit-scrollbar-track,
.practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .katex-display::-webkit-scrollbar-track {
  background: rgba(121, 164, 197, 0.2) !important;
  border-radius: 999px !important;
}

html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .math-node,
html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .katex-display {
  scrollbar-color: rgba(67, 139, 189, 0.72) rgba(106, 154, 188, 0.24) !important;
}

html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .math-node::-webkit-scrollbar-thumb,
html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .katex-display::-webkit-scrollbar-thumb {
  background: rgba(67, 139, 189, 0.72) !important;
}

html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .math-node::-webkit-scrollbar-track,
html[data-theme^="light-"] .practice-mode-panel.practice-modernized .practice-reveal-solution .practice-reveal-content .katex-display::-webkit-scrollbar-track {
  background: rgba(106, 154, 188, 0.24) !important;
}
